/* *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved. 
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0  
 
THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE, 
MERCHANTABLITY OR NON-INFRINGEMENT. 
 
See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

var TypeScript;(function(e){function t(e,t){return(e&t)!=0}function h(e){return e}function g(e,t){var n="";for(var r=1;r<1<<31;r<<=1)if((t&r)!=0)for(var i in e)if(e[i]==r){n.length>0&&(n+="|"),n+=i;break}return n}e.hasFlag=t,function(e){e._map=[],e.None=0,e.Comma=1,e.SColon=2,e.Asg=4,e.BinOp=8,e.RBrack=16,e.RCurly=32,e.RParen=64,e.Dot=128,e.Colon=256,e.PrimType=512,e.AddOp=1024,e.LCurly=2048,e.PreOp=4096,e.RegExp=8192,e.LParen=16384,e.LBrack=32768,e.Scope=65536,e.In=1<<17,e.SCase=1<<18,e.Else=1<<19,e.Catch=1<<20,e.Var=1<<21,e.Stmt=1<<22,e.While=1<<23,e.ID=1<<24,e.Prefix=1<<25,e.Literal=1<<26,e.RLit=1<<27,e.Func=1<<28,e.EOF=1<<29,e.TypeScriptS=1<<30,e.ExprStart=e.SColon|e.AddOp|e.LCurly|e.PreOp|e.RegExp|e.LParen|e.LBrack|e.ID|e.Prefix|e.RLit|e.Func|e.Literal,e.StmtStart=e.ExprStart|e.SColon|e.Var|e.Stmt|e.While|e.TypeScriptS,e.Postfix=e.Dot|e.LParen|e.LBrack}(e.ErrorRecoverySet||(e.ErrorRecoverySet={}));var n=e.ErrorRecoverySet;(function(e){e._map=[],e.None=0,e.Statements=1,e.FunctionDecls=2,e.ModuleDecls=4,e.ClassDecls=8,e.InterfaceDecls=16,e.TypedFuncDecls=32,e.TypedDecls=64,e.TypedFuncSignatures=256,e.TypedSignatures=512,e.AmbientDecls=1024,e.Properties=2048,e.Block=e.Statements|e.FunctionDecls|e.TypedFuncDecls|e.TypedDecls,e.Global=e.Statements|e.FunctionDecls|e.ModuleDecls|e.ClassDecls|e.InterfaceDecls|e.AmbientDecls,e.FunctionBody=e.Statements|e.FunctionDecls,e.ModuleMembers=e.TypedFuncDecls|e.FunctionDecls|e.ModuleDecls|e.ClassDecls|e.InterfaceDecls|e.TypedDecls|e.Statements|e.AmbientDecls,e.ClassMembers=e.TypedFuncDecls|e.FunctionDecls|e.Statements|e.TypedDecls|e.Properties,e.InterfaceMembers=e.TypedFuncSignatures|e.TypedSignatures,e.QuickParse=e.Global|e.Properties})(e.AllowedElements||(e.AllowedElements={}));var r=e.AllowedElements;(function(e){e._map=[],e.None=0,e.Private=1,e.Public=2,e.Readonly=4,e.Ambient=8,e.Exported=16,e.Getter=32,e.Setter=64,e.Static=128})(e.Modifiers||(e.Modifiers={}));var i=e.Modifiers;(function(e){e._map=[],e.None=0,e.ExplicitSemicolon=1,e.AutomaticSemicolon=2,e.Writeable=4,e.Error=8,e.DotLHSPartial=16,e.DotLHS=32,e.IsStatement=64,e.StrictMode=128,e.PossibleOptionalParameter=256,e.ClassBaseConstructorCall=512,e.OptionalName=1024})(e.ASTFlags||(e.ASTFlags={}));var s=e.ASTFlags;(function(e){e._map=[],e.None=0,e.Exported=1,e.Private=2,e.Public=4,e.Ambient=8,e.Static=16,e.LocalStatic=32,e.GetAccessor=64,e.SetAccessor=128})(e.DeclFlags||(e.DeclFlags={}));var o=e.DeclFlags;(function(e){e._map=[],e.None=0,e.Exported=1,e.Private=2,e.Public=4,e.Ambient=8,e.Static=16,e.LocalStatic=32,e.GetAccessor=64,e.SetAccessor=128,e.IsEnum=256,e.ShouldEmitModuleDecl=512,e.IsWholeFile=1024,e.IsDynamic=2048})(e.ModuleFlags||(e.ModuleFlags={}));var u=e.ModuleFlags;(function(e){e._map=[],e.None=0,e.Exported=1,e.Private=2,e.Public=4,e.Ambient=8,e.Static=16,e.LocalStatic=32,e.GetAccessor=64,e.SetAccessor=128,e.Property=256,e.Readonly=512,e.ModuleMember=1024,e.InterfaceMember=2048,e.ClassMember=4096,e.BuiltIn=8192,e.TypeSetDuringScopeAssignment=16384,e.Constant=32768,e.Optional=65536,e.RecursivelyReferenced=1<<17,e.Bound=1<<18})(e.SymbolFlags||(e.SymbolFlags={}));var a=e.SymbolFlags;(function(e){e._map=[],e.None=0,e.Exported=1,e.Private=2,e.Public=4,e.Ambient=8,e.Static=16,e.LocalStatic=32,e.GetAccessor=64,e.SetAccessor=128,e.AutoInit=256,e.Property=512,e.Readonly=1024,e.Class=2048,e.ClassProperty=4096,e.ClassBodyProperty=8192,e.ClassConstructorProperty=16384,e.ClassSuperMustBeFirstCallInConstructor=32768,e.Constant=65536})(e.VarFlags||(e.VarFlags={}));var f=e.VarFlags;(function(e){e._map=[],e.None=0,e.Exported=1,e.Private=2,e.Public=4,e.Ambient=8,e.Static=16,e.LocalStatic=32,e.GetAccessor=64,e.SetAccessor=128,e.Definition=256,e.Signature=512,e.Method=1024,e.HasReturnExpression=2048,e.CallMember=4096,e.ConstructMember=8192,e.HasSelfReference=16384,e.IsFatArrowFunction=32768,e.IndexerMember=65536,e.IsFunctionExpression=1<<17,e.ClassMethod=1<<18,e.ClassPropertyMethodExported=1<<19})(e.FncFlags||(e.FncFlags={}));var l=e.FncFlags;(function(e){e._map=[],e.None=0,e.IsIndexer=1,e.IsStringIndexer=2,e.IsNumberIndexer=4})(e.SignatureFlags||(e.SignatureFlags={}));var c=e.SignatureFlags;e.ToDeclFlags=h,function(e){e._map=[],e.None=0,e.HasImplementation=1,e.HasSelfReference=2,e.MergeResult=4,e.IsEnum=8,e.BuildingName=16,e.HasBaseType=32,e.HasBaseTypeOfObject=64,e.IsClass=128}(e.TypeFlags||(e.TypeFlags={}));var p=e.TypeFlags;(function(e){e._map=[],e.SuccessfulComparison=0,e.SourceIsNullTargetIsVoidOrUndefined=1,e.RequiredPropertyIsMissing=2,e.IncompatibleSignatures=4,e.SourceSignatureHasTooManyParameters=3,e.IncompatibleReturnTypes=16,e.IncompatiblePropertyTypes=32,e.IncompatibleParameterTypes=64})(e.TypeRelationshipFlags||(e.TypeRelationshipFlags={}));var d=e.TypeRelationshipFlags;(function(e){e._map=[],e.ES3=0,e.ES5=1})(e.CodeGenTarget||(e.CodeGenTarget={}));var v=e.CodeGenTarget;(function(e){e._map=[],e.Synchronous=0,e.Asynchronous=1,e.Local=2})(e.ModuleGenTarget||(e.ModuleGenTarget={}));var m=e.ModuleGenTarget;e.codeGenTarget=v.ES3,e.moduleGenTarget=m.Synchronous,e.optimizeModuleCodeGen=!0,e.flagsToString=g})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(e){e._map=[],e._map[0]="None",e.None=0,e._map[1]="Empty",e.Empty=1,e._map[2]="EmptyExpr",e.EmptyExpr=2,e._map[3]="True",e.True=3,e._map[4]="False",e.False=4,e._map[5]="This",e.This=5,e._map[6]="Super",e.Super=6,e._map[7]="QString",e.QString=7,e._map[8]="Regex",e.Regex=8,e._map[9]="Null",e.Null=9,e._map[10]="ArrayLit",e.ArrayLit=10,e._map[11]="ObjectLit",e.ObjectLit=11,e._map[12]="Void",e.Void=12,e._map[13]="Comma",e.Comma=13,e._map[14]="Pos",e.Pos=14,e._map[15]="Neg",e.Neg=15,e._map[16]="Delete",e.Delete=16,e._map[17]="Await",e.Await=17,e._map[18]="In",e.In=18,e._map[19]="Dot",e.Dot=19,e._map[20]="From",e.From=20,e._map[21]="Is",e.Is=21,e._map[22]="InstOf",e.InstOf=22,e._map[23]="Typeof",e.Typeof=23,e._map[24]="NumberLit",e.NumberLit=24,e._map[25]="Name",e.Name=25,e._map[26]="TypeRef",e.TypeRef=26,e._map[27]="Index",e.Index=27,e._map[28]="Call",e.Call=28,e._map[29]="New",e.New=29,e._map[30]="Asg",e.Asg=30,e._map[31]="AsgAdd",e.AsgAdd=31,e._map[32]="AsgSub",e.AsgSub=32,e._map[33]="AsgDiv",e.AsgDiv=33,e._map[34]="AsgMul",e.AsgMul=34,e._map[35]="AsgMod",e.AsgMod=35,e._map[36]="AsgAnd",e.AsgAnd=36,e._map[37]="AsgXor",e.AsgXor=37,e._map[38]="AsgOr",e.AsgOr=38,e._map[39]="AsgLsh",e.AsgLsh=39,e._map[40]="AsgRsh",e.AsgRsh=40,e._map[41]="AsgRs2",e.AsgRs2=41,e._map[42]="QMark",e.QMark=42,e._map[43]="LogOr",e.LogOr=43,e._map[44]="LogAnd",e.LogAnd=44,e._map[45]="Or",e.Or=45,e._map[46]="Xor",e.Xor=46,e._map[47]="And",e.And=47,e._map[48]="Eq",e.Eq=48,e._map[49]="Ne",e.Ne=49,e._map[50]="Eqv",e.Eqv=50,e._map[51]="NEqv",e.NEqv=51,e._map[52]="Lt",e.Lt=52,e._map[53]="Le",e.Le=53,e._map[54]="Gt",e.Gt=54,e._map[55]="Ge",e.Ge=55,e._map[56]="Add",e.Add=56,e._map[57]="Sub",e.Sub=57,e._map[58]="Mul",e.Mul=58,e._map[59]="Div",e.Div=59,e._map[60]="Mod",e.Mod=60,e._map[61]="Lsh",e.Lsh=61,e._map[62]="Rsh",e.Rsh=62,e._map[63]="Rs2",e.Rs2=63,e._map[64]="Not",e.Not=64,e._map[65]="LogNot",e.LogNot=65,e._map[66]="IncPre",e.IncPre=66,e._map[67]="DecPre",e.DecPre=67,e._map[68]="IncPost",e.IncPost=68,e._map[69]="DecPost",e.DecPost=69,e._map[70]="TypeAssertion",e.TypeAssertion=70,e._map[71]="FuncDecl",e.FuncDecl=71,e._map[72]="Member",e.Member=72,e._map[73]="VarDecl",e.VarDecl=73,e._map[74]="ArgDecl",e.ArgDecl=74,e._map[75]="Return",e.Return=75,e._map[76]="Break",e.Break=76,e._map[77]="Continue",e.Continue=77,e._map[78]="Throw",e.Throw=78,e._map[79]="For",e.For=79,e._map[80]="ForIn",e.ForIn=80,e._map[81]="If",e.If=81,e._map[82]="While",e.While=82,e._map[83]="DoWhile",e.DoWhile=83,e._map[84]="Block",e.Block=84,e._map[85]="Case",e.Case=85,e._map[86]="Switch",e.Switch=86,e._map[87]="Try",e.Try=87,e._map[88]="TryCatch",e.TryCatch=88,e._map[89]="TryFinally",e.TryFinally=89,e._map[90]="Finally",e.Finally=90,e._map[91]="Catch",e.Catch=91,e._map[92]="List",e.List=92,e._map[93]="Script",e.Script=93,e._map[94]="Class",e.Class=94,e._map[95]="Interface",e.Interface=95,e._map[96]="Module",e.Module=96,e._map[97]="Import",e.Import=97,e._map[98]="With",e.With=98,e._map[99]="Label",e.Label=99,e._map[100]="LabeledStatement",e.LabeledStatement=100,e._map[101]="EBStart",e.EBStart=101,e._map[102]="GotoEB",e.GotoEB=102,e._map[103]="EndCode",e.EndCode=103,e._map[104]="Error",e.Error=104,e._map[105]="Comment",e.Comment=105,e._map[106]="Debugger",e.Debugger=106,e.GeneralNode=e.FuncDecl,e.LastAsg=e.AsgRs2})(e.NodeType||(e.NodeType={}));var t=e.NodeType})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function i(e){var t=668265261;return e=e^61^e>>>16,e+=e<<3,e^=e>>>4,e*=t,e^=e>>>15,e}function s(e,t){return t^(e>>5)+e}var t=function(){function e(){this.prototype=undefined,this.toString=undefined,this.toLocaleString=undefined,this.valueOf=undefined,this.hasOwnProperty=undefined,this.propertyIsEnumerable=undefined,this.isPrototypeOf=undefined,this.constructor=undefined}return e}();e.BlockIntrinsics=t;var n=function(){function e(){this.itemCount=0,this.table=new t}return e.prototype.getAllKeys=function(){var e=[];for(var t in this.table)this.table[t]!=undefined&&(e[e.length]=t);return e},e.prototype.add=function(e,t){return this.table[e]!=undefined?!1:(this.table[e]=t,this.itemCount++,!0)},e.prototype.addOrUpdate=function(e,t){return this.table[e]!=undefined?(this.table[e]=t,!1):(this.table[e]=t,this.itemCount++,!0)},e.prototype.map=function(e,t){for(var n in this.table){var r=this.table[n];r!=undefined&&e(n,this.table[n],t)}},e.prototype.every=function(e,t){for(var n in this.table){var r=this.table[n];if(r!=undefined&&!e(n,this.table[n],t))return!1}return!0},e.prototype.some=function(e,t){for(var n in this.table){var r=this.table[n];if(r!=undefined&&e(n,this.table[n],t))return!0}return!1},e.prototype.count=function(){return this.itemCount},e.prototype.lookup=function(e){var t=this.table[e];return t!=undefined?t:null},e}();e.StringHashTable=n;var r=function(){function e(e,t){this.primaryTable=e,this.secondaryTable=t,this.insertPrimary=!0}return e.prototype.getAllKeys=function(){return this.primaryTable.getAllKeys().concat(this.secondaryTable.getAllKeys())},e.prototype.add=function(e,t){return this.insertPrimary?this.primaryTable.add(e,t):this.secondaryTable.add(e,t)},e.prototype.addOrUpdate=function(e,t){return this.insertPrimary?this.primaryTable.addOrUpdate(e,t):this.secondaryTable.addOrUpdate(e,t)},e.prototype.map=function(e,t){this.primaryTable.map(e,t),this.secondaryTable.map(e,t)},e.prototype.every=function(e,t){return this.primaryTable.every(e,t)&&this.secondaryTable.every(e,t)},e.prototype.some=function(e,t){return this.primaryTable.some(e,t)||this.secondaryTable.some(e,t)},e.prototype.count=function(){return this.primaryTable.count()+this.secondaryTable.count()},e.prototype.lookup=function(e){var t=this.primaryTable.lookup(e);return t!=undefined?t:this.secondaryTable.lookup(e)},e}();e.DualStringHashTable=r,e.numberHashFn=i,e.combineHashes=s;var o=function(){function e(e,t){this.key=e,this.data=t}return e}();e.HashEntry=o;var u=function(){function e(e,t,n){this.size=e,this.hashFn=t,this.equalsFn=n,this.itemCount=0,this.table=new Array;for(var r=0;r<this.size;r++)this.table[r]=null}return e.prototype.add=function(e,t){var n,r=new o(e,t),i=this.hashFn(e);i%=this.size;for(n=this.table[i];n!=null;n=n.next)if(this.equalsFn(e,n.key))return!1;return r.next=this.table[i],this.table[i]=r,this.itemCount++,!0},e.prototype.remove=function(e){var t,n=this.hashFn(e);n%=this.size;var r=null,i=null;for(t=this.table[n];t!=null;t=t.next){if(this.equalsFn(e,t.key)){r=t.data,this.itemCount--,i?i.next=t.next:this.table[n]=t.next;break}i=t}return r},e.prototype.count=function(){return this.itemCount},e.prototype.lookup=function(e){var t,n=this.hashFn(e);n%=this.size;for(t=this.table[n];t!=null;t=t.next)if(this.equalsFn(e,t.key))return t.data;return null},e}();e.HashTable=u})(TypeScript||(TypeScript={}));var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},TypeScript;(function(e){var t=function(){function t(t){this.nodeType=t,this.type=null,this.flags=e.ASTFlags.Writeable,this.minChar=-1,this.limChar=-1,this.passCreated=e.CompilerDiagnostics.analysisPass,this.preComments=null,this.postComments=null,this.isParenthesized=!1}return t.prototype.isStatementOrExpression=function(){return!1},t.prototype.isCompoundStatement=function(){return!1},t.prototype.isLeaf=function(){return this.isStatementOrExpression()&&!this.isCompoundStatement()},t.prototype.typeCheck=function(t){switch(this.nodeType){case e.NodeType.Error:case e.NodeType.EmptyExpr:this.type=t.anyType;break;case e.NodeType.This:return t.typeCheckThis(this);case e.NodeType.Null:this.type=t.nullType;break;case e.NodeType.False:case e.NodeType.True:this.type=t.booleanType;break;case e.NodeType.Super:return t.typeCheckSuper(this);case e.NodeType.EndCode:case e.NodeType.Empty:case e.NodeType.Void:this.type=t.voidType;break;default:throw new Error("please implement in derived class")}return this},t.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);switch(this.nodeType){case e.NodeType.This:t.thisFnc&&e.hasFlag(t.thisFnc.fncFlags,e.FncFlags.IsFatArrowFunction)?t.writeToOutput("_this"):t.writeToOutput("this");break;case e.NodeType.Null:t.writeToOutput("null");break;case e.NodeType.False:t.writeToOutput("false");break;case e.NodeType.True:t.writeToOutput("true");break;case e.NodeType.Super:t.emitSuperReference();case e.NodeType.EndCode:break;case e.NodeType.Error:case e.NodeType.EmptyExpr:break;case e.NodeType.Empty:t.writeToOutput("; ");break;case e.NodeType.Void:t.writeToOutput("void ");break;default:throw new Error("please implement in derived class")}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},t.prototype.print=function(t){t.startLine();var n={line:-1,col:-1},r={line:-1,col:-1};t.parser!==null&&(t.parser.getSourceLineCol(n,this.minChar),t.parser.getSourceLineCol(r,this.limChar),t.write("("+n.line+","+n.col+")--"+"("+r.line+","+r.col+"): "));var i=this.printLabel();e.hasFlag(this.flags,e.ASTFlags.Error)&&(i+=" (Error)"),t.writeLine(i)},t.prototype.printLabel=function(){return e.nodeTypeTable[this.nodeType]!==undefined?e.nodeTypeTable[this.nodeType]:e.NodeType._map[this.nodeType]},t.prototype.addToControlFlow=function(e){e.walker.options.goChildren=!1,e.addContent(this)},t.prototype.netFreeUses=function(e,t){},t.prototype.treeViewLabel=function(){return e.NodeType._map[this.nodeType]},t}();e.AST=t;var n=function(t){function n(n,r){t.call(this,e.NodeType.Error),this.minChar=n,this.limChar=r}return __extends(n,t),n}(t);e.IncompleteAST=n;var r=function(t){function n(){t.call(this,e.NodeType.List),this.enclosingScope=null,this.members=new Array}return __extends(n,t),n.prototype.addToControlFlow=function(e){var t=this.members.length;for(var n=0;n<t;n++){if(e.noContinuation){e.addUnreachable(this.members[n]);break}this.members[n]=e.walk(this.members[n],this)}e.walker.options.goChildren=!1},n.prototype.append=function(e){return this.members[this.members.length]=e,this},n.prototype.appendAll=function(t){if(t.nodeType==e.NodeType.List){var n=t;for(var r=0,i=n.members.length;r<i;r++)this.append(n.members[r])}else this.append(t);return this},n.prototype.emit=function(t,n,r,i){t.emitJavascriptList(this,null,e.TokenID.SColon,r,!1,!1,i)},n.prototype.typeCheck=function(e){var t=this.members.length;e.nestingLevel++;for(var n=0;n<t;n++)this.members[n]&&(this.members[n]=this.members[n].typeCheck(e));return e.nestingLevel--,this},n}(t);e.ASTList=r;var i=function(t){function n(n){t.call(this,e.NodeType.Name),this.text=n,this.sym=null,this.cloId=-1}return __extends(n,t),n.prototype.isMissing=function(){return!1},n.prototype.isLeaf=function(){return!0},n.prototype.treeViewLabel=function(){return"id: "+this.text},n.prototype.printLabel=function(){return this.text?"id: "+this.text:"name node"},n.prototype.typeCheck=function(e){return e.typeCheckName(this)},n.prototype.emit=function(e,t,n,r){e.emitJavascriptName(this,!0)},n}(t);e.Identifier=i;var s=function(e){function t(){e.call(this,"__missing")}return __extends(t,e),t.prototype.isMissing=function(){return!0},t.prototype.emit=function(e,t,n,r){},t}(i);e.MissingIdentifier=s;var o=function(t){function n(n){t.call(this,e.NodeType.Label),this.id=n}return __extends(n,t),n.prototype.printLabel=function(){return this.id.text+":"},n.prototype.typeCheck=function(e){return this.type=e.voidType,this},n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this),e.writeLineToOutput(this.id.text+":"),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n}(t);e.Label=o;var u=function(t){function n(e,n){t.call(this,e),this.operand=n,this.targetType=null,this.castTerm=null,this.nty=e}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.addToControlFlow=function(n){t.prototype.addToControlFlow.call(this,n),this.nodeType==e.NodeType.Throw&&n.returnStmt()},n.prototype.typeCheck=function(t){switch(this.nty){case e.NodeType.Not:return t.typeCheckBitNot(this);case e.NodeType.LogNot:return t.typeCheckLogNot(this);case e.NodeType.Pos:case e.NodeType.Neg:return t.typeCheckUnaryNumberOperator(this);case e.NodeType.IncPost:case e.NodeType.IncPre:case e.NodeType.DecPost:case e.NodeType.DecPre:return t.typeCheckIncOrDec(this);case e.NodeType.ArrayLit:return t.typeCheckArrayLit(this),this;case e.NodeType.ObjectLit:return t.typeCheckObjectLit(this),this;case e.NodeType.Throw:return this.operand=t.typeCheck(this.operand),this.type=t.voidType,this;case e.NodeType.Typeof:return this.operand=t.typeCheck(this.operand),this.type=t.stringType,this;case e.NodeType.Delete:this.operand=t.typeCheck(this.operand),this.type=t.booleanType;break;case e.NodeType.TypeAssertion:this.castTerm=t.typeCheck(this.castTerm);var n=!this.operand.isParenthesized,r=n?this.castTerm.type:null;return t.checker.typeCheckWithContextualType(r,t.checker.inProvisionalTypecheckMode(),!0,this.operand),t.castWithCoercion(this.operand,this.castTerm.type,!1,!0),this.type=this.castTerm.type,this;case e.NodeType.Void:this.operand=t.typeCheck(this.operand),this.type=t.checker.undefinedType;break;default:throw new Error("please implement in derived class")}return this},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);switch(this.nty){case e.NodeType.IncPost:t.emitJavascript(this.operand,e.TokenID.Inc,!1),t.writeToOutput("++");break;case e.NodeType.LogNot:t.writeToOutput("!"),t.emitJavascript(this.operand,e.TokenID.Bang,!1);break;case e.NodeType.DecPost:t.emitJavascript(this.operand,e.TokenID.Dec,!1),t.writeToOutput("--");break;case e.NodeType.ObjectLit:t.emitObjectLiteral(this.operand);break;case e.NodeType.ArrayLit:t.emitArrayLiteral(this.operand);break;case e.NodeType.Not:t.writeToOutput("~"),t.emitJavascript(this.operand,e.TokenID.Tilde,!1);break;case e.NodeType.Neg:t.writeToOutput("-"),this.operand.nodeType==e.NodeType.Neg&&(this.operand.isParenthesized=!0),t.emitJavascript(this.operand,e.TokenID.Sub,!1);break;case e.NodeType.Pos:t.writeToOutput("+"),this.operand.nodeType==e.NodeType.Pos&&(this.operand.isParenthesized=!0),t.emitJavascript(this.operand,e.TokenID.Add,!1);break;case e.NodeType.IncPre:t.writeToOutput("++"),t.emitJavascript(this.operand,e.TokenID.Inc,!1);break;case e.NodeType.DecPre:t.writeToOutput("--"),t.emitJavascript(this.operand,e.TokenID.Dec,!1);break;case e.NodeType.Throw:t.writeToOutput("throw "),t.emitJavascript(this.operand,e.TokenID.Tilde,!1),t.writeToOutput(";");break;case e.NodeType.Typeof:t.writeToOutput("typeof "),t.emitJavascript(this.operand,e.TokenID.Tilde,!1);break;case e.NodeType.Delete:t.writeToOutput("delete "),t.emitJavascript(this.operand,e.TokenID.Tilde,!1);break;case e.NodeType.Void:t.writeToOutput("void "),t.emitJavascript(this.operand,e.TokenID.Tilde,!1);break;case e.NodeType.TypeAssertion:t.emitJavascript(this.operand,e.TokenID.Tilde,!1);break;default:throw new Error("please implement in derived class")}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n}(t);e.UnaryExpression=u;var a=function(t){function n(e,n,r){t.call(this,e),this.target=n,this.args=r,this.signature=null,this.nty=e,this.minChar=this.target.minChar}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.typeCheck=function(t){return this.nty==e.NodeType.New?t.typeCheckNew(this):t.typeCheckCall(this)},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.nty==e.NodeType.New?t.emitNew(this.target,this.args):t.emitCall(this,this.target,this.args),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n}(t);e.CallExpression=a;var f=function(t){function n(e,n,r){t.call(this,e),this.operand1=n,this.operand2=r,this.nty=e}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.typeCheck=function(t){switch(this.nty){case e.NodeType.Dot:return t.typeCheckDotOperator(this);case e.NodeType.Asg:return t.typeCheckAsgOperator(this);case e.NodeType.Add:case e.NodeType.Sub:case e.NodeType.Mul:case e.NodeType.Div:case e.NodeType.Mod:case e.NodeType.Or:case e.NodeType.And:return t.typeCheckArithmeticOperator(this,!1);case e.NodeType.Xor:return t.typeCheckBitwiseOperator(this,!1);case e.NodeType.Ne:case e.NodeType.Eq:var n;t.checker.styleSettings.eqeqeq?(n=e.nodeTypeTable[this.nty],t.checker.errorReporter.styleError(this,"use of "+n)):t.checker.styleSettings.eqnull&&(n=e.nodeTypeTable[this.nty],this.operand2!==null&&this.operand2.nodeType==e.NodeType.Null&&t.checker.errorReporter.styleError(this,"use of "+n+" to compare with null"));case e.NodeType.Eqv:case e.NodeType.NEqv:case e.NodeType.Lt:case e.NodeType.Le:case e.NodeType.Ge:case e.NodeType.Gt:return t.typeCheckBooleanOperator(this);case e.NodeType.Index:return t.typeCheckIndex(this);case e.NodeType.Member:return this.type=t.voidType,this;case e.NodeType.LogOr:return t.typeCheckLogOr(this);case e.NodeType.LogAnd:return t.typeCheckLogAnd(this);case e.NodeType.AsgAdd:case e.NodeType.AsgSub:case e.NodeType.AsgMul:case e.NodeType.AsgDiv:case e.NodeType.AsgMod:case e.NodeType.AsgOr:case e.NodeType.AsgAnd:return t.typeCheckArithmeticOperator(this,!0);case e.NodeType.AsgXor:return t.typeCheckBitwiseOperator(this,!0);case e.NodeType.Lsh:case e.NodeType.Rsh:case e.NodeType.Rs2:return t.typeCheckShift(this,!1);case e.NodeType.AsgLsh:case e.NodeType.AsgRsh:case e.NodeType.AsgRs2:return t.typeCheckShift(this,!0);case e.NodeType.Comma:return t.typeCheckCommaOperator(this);case e.NodeType.InstOf:return t.typeCheckInstOf(this);case e.NodeType.In:return t.typeCheckInOperator(this);case e.NodeType.From:t.checker.errorReporter.simpleError(this,"Illegal use of 'from' keyword in binary expression");break;default:throw new Error("please implement in derived class")}return this},n.prototype.emit=function(t,n,r,i){var s=e.nodeTypeToTokTable[this.nodeType];t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);if(s!=undefined)t.emitJavascript(this.operand1,s,!1),e.tokenTable[s].text=="instanceof"?t.writeToOutput(" instanceof "):e.tokenTable[s].text=="in"?t.writeToOutput(" in "):t.writeToOutputTrimmable(" "+e.tokenTable[s].text+" "),t.emitJavascript(this.operand2,s,!1);else switch(this.nty){case e.NodeType.Dot:t.tryEmitConstant(this)||(t.emitJavascript(this.operand1,e.TokenID.Dot,!1),t.writeToOutput("."),t.emitJavascriptName(this.operand2,!1));break;case e.NodeType.Index:t.emitIndex(this.operand1,this.operand2);break;case e.NodeType.Member:if(this.operand2.nodeType==e.NodeType.FuncDecl&&this.operand2.isAccessor()){var o=this.operand2;e.hasFlag(o.fncFlags,e.FncFlags.GetAccessor)?t.writeToOutput("get "):t.writeToOutput("set "),t.emitJavascript(this.operand1,e.TokenID.Colon,!1)}else t.emitJavascript(this.operand1,e.TokenID.Colon,!1),t.writeToOutputTrimmable(": ");t.emitJavascript(this.operand2,e.TokenID.Comma,!1);break;case e.NodeType.Comma:t.emitJavascript(this.operand1,e.TokenID.Comma,!1),t.emitState.inObjectLiteral?t.writeLineToOutput(", "):t.writeToOutput(","),t.emitJavascript(this.operand2,e.TokenID.Comma,!1);break;case e.NodeType.Is:throw new Error("should be de-sugared during type check");default:throw new Error("please implement in derived class")}t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n}(t);e.BinaryExpression=f;var l=function(t){function n(e,n,r,i){t.call(this,e),this.operand1=n,this.operand2=r,this.operand3=i,this.nty=e}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.typeCheck=function(e){return e.typeCheckQMark(this)},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascript(this.operand1,e.TokenID.QMark,!1),t.writeToOutput(" ? "),t.emitJavascript(this.operand2,e.TokenID.QMark,!1),t.writeToOutput(" : "),t.emitJavascript(this.operand3,e.TokenID.QMark,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n}(t);e.TrinaryExpression=l;var c=function(t){function n(n){t.call(this,e.NodeType.NumberLit),this.value=n,this.isNegativeZero=!1}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.typeCheck=function(e){return this.type=e.doubleType,this},n.prototype.treeViewLabel=function(){return"num: "+this.value},n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this),this.isNegativeZero&&e.writeToOutput("-"),e.writeToOutput(this.value.toString()),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n.prototype.printLabel=function(){return Math.floor(this.value)!=this.value?this.value.toFixed(2).toString():this.value.toString()},n}(t);e.NumberLiteral=c;var h=function(t){function n(n){t.call(this,e.NodeType.Regex),this.regex=n}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.typeCheck=function(e){return this.type=e.regexType,this},n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this),e.writeToOutput(this.regex.toString()),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n}(t);e.RegexLiteral=h;var p=function(t){function n(n){t.call(this,e.NodeType.QString),this.text=n}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this),e.emitStringLiteral(this.text),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return this.type=e.stringType,this},n.prototype.treeViewLabel=function(){return"st: "+this.text},n.prototype.printLabel=function(){return this.text},n}(t);e.StringLiteral=p;var d=function(t){function n(n,r){t.call(this,e.NodeType.Import),this.id=n,this.alias=r,this.varFlags=e.VarFlags.None,this.isDynamicImport=!1}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.emit=function(t,n,r,i){var s=this.alias.type;i&&t.emitImportDecl(this);if(!this.isDynamicImport||this.id.sym&&!this.id.sym.onlyReferencedAsTypeRef){var o=t.modAliasId,u=t.firstModAlias;t.recordSourceMappingStart(this),t.emitParensAndCommentsInPlace(this,!0),t.writeToOutput("var "+this.id.text+" = "),t.modAliasId=this.id.text,t.firstModAlias=this.firstAliasedModToString(),t.emitJavascript(this.alias,e.TokenID.Tilde,!1,i),this.isDynamicImport||t.writeToOutput(";"),t.emitParensAndCommentsInPlace(this,!1),t.recordSourceMappingEnd(this),t.modAliasId=o,t.firstModAlias=u}},n.prototype.typeCheck=function(e){return e.typeCheckImportDecl(this)},n.prototype.getAliasName=function(t){typeof t=="undefined"&&(t=this.alias);if(t.nodeType==e.NodeType.Name)return t.text;var n=t;return this.getAliasName(n.operand1)+"."+this.getAliasName(n.operand2)},n.prototype.firstAliasedModToString=function(){if(this.alias.nodeType==e.NodeType.Name)return this.alias.text;var t=this.alias,n=t.operand1;return n.text},n}(t);e.ImportDecl=d;var v=function(t){function n(n,r,i){t.call(this,r),this.id=n,this.nestingLevel=i,this.init=null,this.typeExpr=null,this.varFlags=e.VarFlags.None,this.sym=null}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isPrivate=function(){return e.hasFlag(this.varFlags,e.VarFlags.Private)},n.prototype.isPublic=function(){return e.hasFlag(this.varFlags,e.VarFlags.Public)},n.prototype.isProperty=function(){return e.hasFlag(this.varFlags,e.VarFlags.Property)},n.prototype.typeCheck=function(e){return e.typeCheckBoundDecl(this)},n.prototype.printLabel=function(){return this.treeViewLabel()},n}(t);e.BoundDecl=v;var m=function(t){function n(n,r){t.call(this,n,e.NodeType.VarDecl,r)}return __extends(n,t),n.prototype.isAmbient=function(){return e.hasFlag(this.varFlags,e.VarFlags.Ambient)},n.prototype.isExported=function(){return e.hasFlag(this.varFlags,e.VarFlags.Exported)},n.prototype.isStatic=function(){return e.hasFlag(this.varFlags,e.VarFlags.Static)},n.prototype.emit=function(e,t,n,r){e.emitJavascriptVarDecl(this,t,r)},n.prototype.treeViewLabel=function(){return"var "+this.id.text},n}(v);e.VarDecl=m;var g=function(t){function n(n){t.call(this,n,e.NodeType.ArgDecl,0),this.isOptional=!1,this.parameterPropertySym=null}return __extends(n,t),n.prototype.isOptionalArg=function(){return this.isOptional||this.init},n.prototype.treeViewLabel=function(){return"arg: "+this.id.text},n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this),e.writeToOutput(this.id.text),r&&e.emitArgDecl(this),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n}(v);e.ArgDecl=g;var y=0,b=function(t){function n(n,r,i,s,o,u,a,f){t.call(this,f),this.name=n,this.bod=r,this.isConstructor=i,this.args=s,this.vars=o,this.scopes=u,this.statics=a,this.hint=null,this.fncFlags=e.FncFlags.None,this.returnTypeAnnotation=null,this.variableArgList=!1,this.jumpRefs=null,this.internalNameCache=null,this.tmp1Declared=!1,this.enclosingFnc=null,this.freeVariables=[],this.unitIndex=-1,this.classDecl=null,this.boundToProperty=null,this.isOverload=!1,this.innerStaticFuncs=[],this.isTargetTypedAsMethod=!1,this.isInlineCallLiteral=!1,this.accessorSymbol=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.returnStatementsWithExpressions=[],this.scopeType=null}return __extends(n,t),n.prototype.internalName=function(){if(this.internalNameCache==null){var e=this.getNameText();e?this.internalNameCache="_internal_"+e:this.internalNameCache="_internal_"+y++}return this.internalNameCache},n.prototype.hasSelfReference=function(){return e.hasFlag(this.fncFlags,e.FncFlags.HasSelfReference)},n.prototype.setHasSelfReference=function(){this.fncFlags|=e.FncFlags.HasSelfReference},n.prototype.addCloRef=function(e,t){this.envids==null&&(this.envids=new Array),this.envids[this.envids.length]=e;var n=this.enclosingFnc;if(t)while(n&&n.type.symbol!=t.container)n.addJumpRef(t),n=n.enclosingFnc;return this.envids.length-1},n.prototype.addJumpRef=function(e){this.jumpRefs==null&&(this.jumpRefs=new Array);var t=new i(e.name);this.jumpRefs[this.jumpRefs.length]=t,t.sym=e,t.cloId=this.addCloRef(t,null)},n.prototype.buildControlFlow=function(){var t=new e.BasicBlock,n=new e.BasicBlock,r=new e.ControlFlowContext(t,n),i=function(e,t,n){return e.addToControlFlow(n.state),e},s=e.getAstWalkerFactory().getWalker(i,null,null,r);return r.walker=s,s.walk(this.bod,this),r},n.prototype.typeCheck=function(e){return e.typeCheckFunction(this)},n.prototype.emit=function(e,t,n,r){e.emitJavascriptFunction(this,r)},n.prototype.getNameText=function(){return this.name?this.name.text:this.hint},n.prototype.isMethod=function(){return(this.fncFlags&e.FncFlags.Method)!=e.FncFlags.None},n.prototype.isCallMember=function(){return e.hasFlag(this.fncFlags,e.FncFlags.CallMember)},n.prototype.isConstructMember=function(){return e.hasFlag(this.fncFlags,e.FncFlags.ConstructMember)},n.prototype.isIndexerMember=function(){return e.hasFlag(this.fncFlags,e.FncFlags.IndexerMember)},n.prototype.isSpecialFn=function(){return this.isCallMember()||this.isIndexerMember()||this.isConstructMember()},n.prototype.isAnonymousFn=function(){return this.name===null},n.prototype.isAccessor=function(){return e.hasFlag(this.fncFlags,e.FncFlags.GetAccessor)||e.hasFlag(this.fncFlags,e.FncFlags.SetAccessor)},n.prototype.isGetAccessor=function(){return e.hasFlag(this.fncFlags,e.FncFlags.GetAccessor)},n.prototype.isSetAccessor=function(){return e.hasFlag(this.fncFlags,e.FncFlags.SetAccessor)},n.prototype.isAmbient=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Ambient)},n.prototype.isExported=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Exported)},n.prototype.isPrivate=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Private)},n.prototype.isPublic=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Public)},n.prototype.isStatic=function(){return e.hasFlag(this.fncFlags,e.FncFlags.Static)},n.prototype.treeViewLabel=function(){return this.name==null?"funcExpr":"func: "+this.name.text},n.prototype.ClearFlags=function(){this.fncFlags=e.FncFlags.None},n.prototype.isSignature=function(){return(this.fncFlags&e.FncFlags.Signature)!=e.FncFlags.None},n.prototype.hasStaticDeclarations=function(){return!this.isConstructor&&(this.statics.members.length>0||this.innerStaticFuncs.length>0)},n}(t);e.FuncDecl=b;var w=function(){function e(e,t,n){this.filename=e,this.lineMap=t,this.unitIndex=n}return e}();e.LocationInfo=w,e.unknownLocationInfo=new w("unknown",null,-1);var E=function(t){function n(n,r){t.call(this,new i("script"),null,!1,null,n,r,null,e.NodeType.Script),this.locationInfo=null,this.requiresGlobal=!1,this.requiresInherits=!1,this.isResident=!1,this.isDeclareFile=!1,this.hasBeenTypeChecked=!1,this.topLevelMod=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.vars=n,this.scopes=r}return __extends(n,t),n.prototype.typeCheck=function(e){return e.typeCheckScript(this)},n.prototype.treeViewLabel=function(){return"Script"},n.prototype.emitRequired=function(){if(!this.isDeclareFile&&!this.isResident&&this.bod)for(var t=0,n=this.bod.members.length;t<n;t++){var r=this.bod.members[t];if(r.nodeType==e.NodeType.Module){if(!e.hasFlag(r.modFlags,e.ModuleFlags.ShouldEmitModuleDecl|e.ModuleFlags.Ambient))return!0}else if(r.nodeType==e.NodeType.Class){if(!e.hasFlag(r.varFlags,e.VarFlags.Ambient))return!0}else if(r.nodeType==e.NodeType.VarDecl){if(!e.hasFlag(r.varFlags,e.VarFlags.Ambient))return!0}else if(r.nodeType==e.NodeType.FuncDecl){if(!r.isSignature())return!0}else if(r.nodeType!=e.NodeType.Interface&&r.nodeType!=e.NodeType.Empty)return!0}return!1},n.prototype.emit=function(t,n,r,i){if(this.emitRequired()){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitPrologue(this.requiresInherits);var s=i?t.setDeclContainingAST(this):null;t.emitJavascriptList(this.bod,null,e.TokenID.SColon,!0,!1,!1,i),i&&t.setDeclContainingAST(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)}},n}(b);e.Script=E;var S=function(e){function t(t,n,r){e.call(this,t),this.name=n,this.members=r,this.nty=t}return __extends(t,e),t}(t);e.Record=S;var x=function(t){function n(n,r,i,s){t.call(this,e.NodeType.Module,n,r),this.modFlags=e.ModuleFlags.ShouldEmitModuleDecl,this.alias=null,this.leftCurlyCount=0,this.rightCurlyCount=0,this.amdDependencies=[],this.members=r,this.vars=i,this.name=n,this.scopes=s,this.prettyName=this.name.text}return __extends(n,t),n.prototype.isExported=function(){return e.hasFlag(this.modFlags,e.ModuleFlags.Exported)},n.prototype.isAmbient=function(){return e.hasFlag(this.modFlags,e.ModuleFlags.Ambient)},n.prototype.isEnum=function(){return e.hasFlag(this.modFlags,e.ModuleFlags.IsEnum)},n.prototype.recordNonInterface=function(){this.modFlags&=~e.ModuleFlags.ShouldEmitModuleDecl},n.prototype.typeCheck=function(e){return e.typeCheckModule(this)},n.prototype.emit=function(t,n,r,i){e.hasFlag(this.modFlags,e.ModuleFlags.ShouldEmitModuleDecl)?i&&t.emitModuleSignature(this):(t.emitParensAndCommentsInPlace(this,!0),t.emitJavascriptModule(this,i),t.emitParensAndCommentsInPlace(this,!1))},n}(S);e.ModuleDecl=x;var T=function(e){function t(t,n,r,i,s){e.call(this,t,n,s),this.extendsList=r,this.implementsList=i,this.name=n,this.members=s}return __extends(t,e),t}(S);e.NamedType=T;var N=function(t){function n(n,i,s,o){t.call(this,e.NodeType.Class,n,s,o,i),this.varFlags=e.VarFlags.None,this.leftCurlyCount=0,this.rightCurlyCount=0,this.knownMemberNames={},this.constructorDecl=null,this.constructorNestingLevel=0,this.allMemberDefinitions=new r,this.name=n,this.baseClass=s,this.implementsList=o,this.definitionMembers=i}return __extends(n,t),n.prototype.isExported=function(){return e.hasFlag(this.varFlags,e.VarFlags.Exported)},n.prototype.isAmbient=function(){return e.hasFlag(this.varFlags,e.VarFlags.Ambient)},n.prototype.typeCheck=function(e){return e.typeCheckClass(this)},n.prototype.emit=function(e,t,n,r){e.emitJavascriptClass(this,r)},n}(T);e.ClassDecl=N;var C=function(t){function n(n,r,i,s,o,u){t.call(this,n,r,o,u,i),this.args=s,this.varFlags=e.VarFlags.None,this.isOverload=!1,this.leftCurlyCount=0,this.rightCurlyCount=0,this.nty=n,this.name=r,this.extendsList=o,this.implementsList=u,this.members=i}return __extends(n,t),n.prototype.isExported=function(){return e.hasFlag(this.varFlags,e.VarFlags.Exported)},n.prototype.isAmbient=function(){return e.hasFlag(this.varFlags,e.VarFlags.Ambient)},n.prototype.typeCheck=function(t){if(this.nty==e.NodeType.Interface)return t.typeCheckInterface(this);throw new Error("please implement type check for node type"+this.nty)},n.prototype.emit=function(t,n,r,i){if(this.nty!=e.NodeType.Interface)throw new Error("please implement emit for node type"+this.nty);i&&t.emitInterfaceDeclaration(this)},n}(T);e.TypeDecl=C;var k=function(t){function n(n){t.call(this,n),this.flags|=e.ASTFlags.IsStatement}return __extends(n,t),n.prototype.isLoop=function(){return!1},n.prototype.isCompoundStatement=function(){return this.isLoop()},n.prototype.typeCheck=function(e){return this.type=e.voidType,this},n}(t);e.Statement=k;var L=function(t){function n(n,r){t.call(this,e.NodeType.LabeledStatement),this.labels=n,this.stmt=r}return __extends(n,t),n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this);if(this.labels){var i=this.labels.members.length;for(var s=0;s<i;s++)this.labels.members[s].emit(e,t,n,r)}this.stmt.emit(e,t,!0,r),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.typeCheck(this.labels),this.stmt=this.stmt.typeCheck(e),this},n.prototype.addToControlFlow=function(t){var n=t.current,r=new e.BasicBlock;t.current=r,n.addSuccessor(r)},n}(k);e.LabeledStatement=L;var A=function(t){function n(n,r){t.call(this,e.NodeType.Block),this.stmts=n,this.visible=r}return __extends(n,t),n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.visible&&(t.writeLineToOutput(" {"),t.increaseIndent());var s=t.setInObjectLiteral(!1);this.stmts&&t.emitJavascriptList(this.stmts,null,e.TokenID.SColon,!0,!1,!1),this.visible&&(t.decreaseIndent(),t.emitIndent(),t.writeToOutput("}")),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.addToControlFlow=function(t){var n=new e.BasicBlock;t.pushStatement(this,t.current,n),this.stmts&&t.walk(this.stmts,this),t.walker.options.goChildren=!1,t.popStatement(),n.predecessors.length>0&&(t.current.addSuccessor(n),t.current=n)},n.prototype.typeCheck=function(e){return e.checker.styleSettings.emptyBlocks||(this.stmts===null||this.stmts.members.length==0)&&e.checker.errorReporter.styleError(this,"empty block"),e.typeCheck(this.stmts),this},n}(k);e.Block=A;var O=function(t){function n(e){t.call(this,e),this.target=null,this.resolvedTarget=null,this.nty=e}return __extends(n,t),n.prototype.hasExplicitTarget=function(){return this.target},n.prototype.setResolvedTarget=function(t,n){return n.isLoop()?(this.resolvedTarget=n,!0):this.nty===e.NodeType.Continue?(t.reportParseError("continue statement applies only to loops"),!1):n.nodeType==e.NodeType.Switch||this.hasExplicitTarget()?(this.resolvedTarget=n,!0):(t.reportParseError("break statement with no label can apply only to a loop or switch statement"),!1)},n.prototype.addToControlFlow=function(n){t.prototype.addToControlFlow.call(this,n),n.unconditionalBranch(this.resolvedTarget,this.nty==e.NodeType.Continue)},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.nty==e.NodeType.Break?t.writeToOutput("break"):t.writeToOutput("continue"),this.hasExplicitTarget()&&t.writeToOutput(" "+this.target),t.writeToOutput(";"),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n}(k);e.Jump=O;var M=function(t){function n(n){t.call(this,e.NodeType.While),this.cond=n,this.body=null}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isLoop=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var s=t.setInObjectLiteral(!1);t.writeToOutput("while("),t.emitJavascript(this.cond,e.TokenID.WHILE,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!1,!1),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.typeCheckWhile(this)},n.prototype.addToControlFlow=function(t){var n=t.current,r=new e.BasicBlock,i=new e.BasicBlock;n.addSuccessor(r),t.current=r,t.addContent(this.cond);var s=t.current,o=null;this.body&&(t.current=new e.BasicBlock,s.addSuccessor(t.current),t.pushStatement(this,r,i),t.walk(this.body,this),o=t.popStatement());if(!t.noContinuation){var u=t.current;u.addSuccessor(r)}t.current=i,s.addSuccessor(i),t.noContinuation=!1,t.walker.options.goChildren=!1},n}(k);e.WhileStatement=M;var _=function(t){function n(){t.call(this,e.NodeType.DoWhile),this.body=null,this.whileAST=null,this.cond=null}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isLoop=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var s=t.setInObjectLiteral(!1);t.writeToOutput("do"),t.emitJavascriptStatements(this.body,!0,!1),t.recordSourceMappingStart(this.whileAST),t.writeToOutput("while"),t.recordSourceMappingEnd(this.whileAST),t.writeToOutput("("),t.emitJavascript(this.cond,e.TokenID.RParen,!1),t.writeToOutput(")"),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.typeCheckDoWhile(this)},n.prototype.addToControlFlow=function(t){var n=t.current,r=new e.BasicBlock,i=new e.BasicBlock;n.addSuccessor(r),t.current=r;var s=null;this.body&&(t.pushStatement(this,r,i),t.walk(this.body,this),s=t.popStatement());if(!t.noContinuation){var o=t.current;o.addSuccessor(r),t.addContent(this.cond),t.current=i,o.addSuccessor(i)}else t.addUnreachable(this.cond);t.walker.options.goChildren=!1},n}(k);e.DoWhileStatement=_;var D=function(t){function n(n){t.call(this,e.NodeType.If),this.cond=n,this.elseBod=null}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isCompoundStatement=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var s=t.setInObjectLiteral(!1);t.writeToOutput("if("),t.emitJavascript(this.cond,e.TokenID.IF,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.thenBod,!0,!1),this.elseBod&&(t.writeToOutput(" else"),t.emitJavascriptStatements(this.elseBod,!0,!0)),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.typeCheckIf(this)},n.prototype.addToControlFlow=function(t){this.cond.addToControlFlow(t);var n=new e.BasicBlock,r=t.current;t.pushStatement(this,r,n);var i=!1;t.current=new e.BasicBlock,r.addSuccessor(t.current),t.walk(this.thenBod,this),t.noContinuation||(i=!0,t.current.addSuccessor(n)),this.elseBod?(t.current=new e.BasicBlock,t.noContinuation=!1,r.addSuccessor(t.current),t.walk(this.elseBod,this),t.noContinuation?i&&(t.noContinuation=!1):(i=!0,t.current.addSuccessor(n))):(r.addSuccessor(n),t.noContinuation=!1,i=!0);var s=t.popStatement();n.predecessors.length>0&&(t.noContinuation=!1,i=!0),i&&(t.current=n),t.walker.options.goChildren=!1},n}(k);e.IfStatement=D;var P=function(t){function n(){t.call(this,e.NodeType.Return),this.returnExpression=null}return __extends(n,t),n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var s=t.setInObjectLiteral(!1);this.returnExpression?(t.writeToOutput("return "),t.emitJavascript(this.returnExpression,e.TokenID.SColon,!1)):t.writeToOutput("return;"),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.addToControlFlow=function(e){t.prototype.addToControlFlow.call(this,e),e.returnStmt()},n.prototype.typeCheck=function(e){return e.typeCheckReturn(this)},n}(k);e.ReturnStatement=P;var H=function(t){function n(){t.call(this,e.NodeType.EndCode)}return __extends(n,t),n}(t);e.EndCode=H;var B=function(t){function n(n,r){t.call(this,e.NodeType.ForIn),this.lval=n,this.obj=r,this.lval&&this.lval.nodeType==e.NodeType.VarDecl&&(this.lval.varFlags|=e.VarFlags.AutoInit)}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isLoop=function(){return!0},n.prototype.isFiltered=function(){if(this.body){var t=null;if(this.body.nodeType==e.NodeType.List){var n=this.body;n.members.length==1&&(t=n.members[0])}else t=this.body;if(t!==null){if(t.nodeType==e.NodeType.Block){var r=t;r.stmts!==null&&r.stmts.members.length==1&&(t=r.stmts.members[0])}if(t.nodeType==e.NodeType.If){var i=t.cond;if(i.nodeType==e.NodeType.Call){var s=i.target;if(s.nodeType==e.NodeType.Dot){var o=s;if(o.operand1.nodeType==e.NodeType.Name&&this.obj.nodeType==e.NodeType.Name&&o.operand1.text==this.obj.text){var u=o.operand2;if(u.text=="hasOwnProperty"){var a=i.args;if(a!==null&&a.members.length==1){var f=a.members[0];if(f.nodeType==e.NodeType.Name&&this.lval.nodeType==e.NodeType.Name&&this.lval.text==f.text)return!0}}}}}}}}return!1},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var s=t.setInObjectLiteral(!1);t.writeToOutput("for("),t.emitJavascript(this.lval,e.TokenID.FOR,!1),t.writeToOutput(" in "),t.emitJavascript(this.obj,e.TokenID.FOR,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0,!1),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.checker.styleSettings.forin&&(this.isFiltered()||e.checker.errorReporter.styleError(this,"no hasOwnProperty filter")),e.typeCheckForIn(this)},n.prototype.addToControlFlow=function(t){this.lval&&t.addContent(this.lval),this.obj&&t.addContent(this.obj);var n=t.current,r=new e.BasicBlock,i=new e.BasicBlock;n.addSuccessor(r),t.current=r,this.body&&(t.pushStatement(this,r,i),t.walk(this.body,this),t.popStatement());if(!t.noContinuation){var s=t.current;s.addSuccessor(r)}t.current=i,t.noContinuation=!1,n.addSuccessor(i),t.walker.options.goChildren=!1},n}(k);e.ForInStatement=B;var j=function(t){function n(n){t.call(this,e.NodeType.For),this.init=n}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isLoop=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var s=t.setInObjectLiteral(!1);t.writeToOutput("for("),this.init&&(this.init.nodeType!=e.NodeType.List?t.emitJavascript(this.init,e.TokenID.FOR,!1):t.emitForVarList(this.init)),t.writeToOutput("; "),t.emitJavascript(this.cond,e.TokenID.FOR,!1),t.writeToOutput("; "),t.emitJavascript(this.incr,e.TokenID.FOR,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0,!1),t.setInObjectLiteral(s),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.typeCheckFor(this)},n.prototype.addToControlFlow=function(t){this.init&&t.addContent(this.init);var n=t.current,r=new e.BasicBlock,i=new e.BasicBlock;n.addSuccessor(r),t.current=r;var s=null,o=r,u=null;this.incr&&(u=new e.BasicBlock,o=u),this.cond&&(s=t.current,t.addContent(this.cond),t.current=new e.BasicBlock,s.addSuccessor(t.current));var a=null;this.body&&(t.pushStatement(this,o,i),t.walk(this.body,this),a=t.popStatement()),this.incr&&(t.noContinuation?u.predecessors.length==0&&t.addUnreachable(this.incr):(t.current.addSuccessor(u),t.current=u,t.addContent(this.incr)));var f=t.current;t.noContinuation||f.addSuccessor(r),s&&(s.addSuccessor(i),t.noContinuation=!1),i.predecessors.length>0&&(t.noContinuation=!1,t.current=i),t.walker.options.goChildren=!1},n}(k);e.ForStatement=j;var F=function(t){function n(n){t.call(this,e.NodeType.With),this.expr=n,this.withSym=null}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isCompoundStatement=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("with ("),this.expr&&t.emitJavascript(this.expr,e.TokenID.WITH,!1),t.writeToOutput(")"),t.emitJavascriptStatements(this.body,!0,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return e.typeCheckWith(this)},n}(k);e.WithStatement=F;var I=function(t){function n(n){t.call(this,e.NodeType.Switch),this.val=n,this.defaultCase=null}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isCompoundStatement=function(){return!0},n.prototype.emit=function(t,n,r){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this);var i=t.setInObjectLiteral(!1);t.writeToOutput("switch("),t.emitJavascript(this.val,e.TokenID.ID,!1),t.writeLineToOutput(") {"),t.increaseIndent();var s=this.caseList.members.length;for(var o=0;o<s;o++){var u=this.caseList.members[o];t.emitJavascript(u,e.TokenID.CASE,!0),t.writeLineToOutput("")}t.decreaseIndent(),t.emitIndent(),t.writeToOutput("}"),t.setInObjectLiteral(i),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){var t=this.caseList.members.length;this.val=e.typeCheck(this.val);for(var n=0;n<t;n++)this.caseList.members[n]=e.typeCheck(this.caseList.members[n]);return this.defaultCase=e.typeCheck(this.defaultCase),this.type=e.voidType,this},n.prototype.addToControlFlow=function(t){var n=t.current;t.addContent(this.val);var r=new e.BasicBlock,i=new e.BasicBlock;n.addSuccessor(r),t.pushSwitch(r),t.current=r,t.pushStatement(this,r,i),t.walk(this.caseList,this),t.popSwitch();var s=t.popStatement(),o=this.defaultCase==null;this.defaultCase==null&&n.addSuccessor(i),i.predecessors.length>0?(t.noContinuation=!1,t.current=i):t.noContinuation=!0,t.walker.options.goChildren=!1},n}(k);e.SwitchStatement=I;var q=function(t){function n(){t.call(this,e.NodeType.Case),this.expr=null}return __extends(n,t),n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),this.expr?(t.writeToOutput("case "),t.emitJavascript(this.expr,e.TokenID.ID,!1)):t.writeToOutput("default"),t.writeToOutput(":"),t.emitJavascriptStatements(this.body,!1,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return this.expr=e.typeCheck(this.expr),e.typeCheck(this.body),this.type=e.voidType,this},n.prototype.addToControlFlow=function(t){var n=new e.BasicBlock,r=t.currentSwitch[t.currentSwitch.length-1];if(this.expr){var i=new e.BasicBlock;t.current=i,r.addSuccessor(i),t.addContent(this.expr),i.addSuccessor(n)}else r.addSuccessor(n);t.current=n,this.body&&t.walk(this.body,this),t.noContinuation=!1,t.walker.options.goChildren=!1},n}(k);e.CaseStatement=q;var R=function(t){function n(n,r){t.call(this,e.NodeType.TypeRef),this.term=n,this.arrayCount=r}return __extends(n,t),n.prototype.emit=function(e,t,n,r){throw new Error("should not emit a type ref")},n.prototype.typeCheck=function(t){var n=t.inTypeRefTypeCheck;t.inTypeRefTypeCheck=!0;var r=e.getTypeLink(this,t.checker,!0);return t.checker.resolveTypeLink(t.scope,r,!1),t.checkForVoidConstructor(r.type,this),this.type=r.type,this.term&&(this.term.type=this.type),t.inTypeRefTypeCheck=n,this},n}(t);e.TypeReference=R;var U=function(t){function n(n,r){t.call(this,e.NodeType.TryFinally),this.tryNode=n,this.finallyNode=r}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isCompoundStatement=function(){return!0},n.prototype.emit=function(t,n,r){t.recordSourceMappingStart(this),t.emitJavascript(this.tryNode,e.TokenID.TRY,!1),t.emitJavascript(this.finallyNode,e.TokenID.FINALLY,!1),t.recordSourceMappingEnd(this)},n.prototype.typeCheck=function(e){return this.tryNode=e.typeCheck(this.tryNode),this.finallyNode=e.typeCheck(this.finallyNode),this.type=e.voidType,this},n.prototype.addToControlFlow=function(t){var n=new e.BasicBlock;t.walk(this.tryNode,this);var r=new e.BasicBlock;t.current&&t.current.addSuccessor(r),t.current=r,t.pushStatement(this,null,n),t.walk(this.finallyNode,this),!t.noContinuation&&t.current&&t.current.addSuccessor(n),n.predecessors.length>0?t.current=n:t.noContinuation=!0,t.popStatement(),t.walker.options.goChildren=!1},n}(k);e.TryFinally=U;var z=function(t){function n(n,r){t.call(this,e.NodeType.TryCatch),this.tryNode=n,this.catchNode=r}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.isCompoundStatement=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.emitJavascript(this.tryNode,e.TokenID.TRY,!1),t.emitJavascript(this.catchNode,e.TokenID.CATCH,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.addToControlFlow=function(t){var n=t.current,r=new e.BasicBlock;n.addSuccessor(r),t.current=r;var i=new e.BasicBlock;t.pushStatement(this,null,i),t.walk(this.tryNode,this),t.noContinuation||t.current&&t.current.addSuccessor(i),t.current=new e.BasicBlock,n.addSuccessor(t.current),t.walk(this.catchNode,this),t.popStatement(),t.noContinuation||t.current&&t.current.addSuccessor(i),t.current=i,t.walker.options.goChildren=!1},n.prototype.typeCheck=function(e){return this.tryNode=e.typeCheck(this.tryNode),this.catchNode=e.typeCheck(this.catchNode),this.type=e.voidType,this},n}(k);e.TryCatch=z;var W=function(t){function n(n){t.call(this,e.NodeType.Try),this.body=n}return __extends(n,t),n.prototype.isStatementOrExpression=function(){return!0},n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("try "),t.emitJavascript(this.body,e.TokenID.TRY,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.typeCheck=function(e){return this.body=e.typeCheck(this.body),this},n.prototype.addToControlFlow=function(e){this.body&&e.walk(this.body,this),e.walker.options.goChildren=!1,e.noContinuation=!1},n}(k);e.Try=W;var X=function(t){function n(n,r){t.call(this,e.NodeType.Catch),this.param=n,this.body=r,this.containedScope=null,this.param&&(this.param.varFlags|=e.VarFlags.AutoInit)}return __extends(n,t),n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput(" catch ("),t.emitJavascript(this.param,e.TokenID.LParen,!1),t.writeToOutput(")"),t.emitJavascript(this.body,e.TokenID.CATCH,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.addToControlFlow=function(t){if(this.param){t.addContent(this.param);var n=new e.BasicBlock;t.current.addSuccessor(n),t.current=n}this.body&&t.walk(this.body,this),t.noContinuation=!1,t.walker.options.goChildren=!1},n.prototype.typeCheck=function(t){var n=t.scope;t.scope=this.containedScope,this.param=t.typeCheck(this.param);var r=new e.ValueLocation,i=new e.VariableSymbol(this.param.id.text,this.param.minChar,t.checker.locationInfo.unitIndex,r);r.symbol=i,r.typeLink=new e.TypeLink,r.typeLink.type=t.anyType;var s=t.thisFnc;s&&s.type?r.symbol.container=s.type.symbol:r.symbol.container=null,this.param.sym=r.symbol,t.scope.enter(r.symbol.container,this.param,r.symbol,t.checker.errorReporter,!1,!1,!1),this.body=t.typeCheck(this.body);if(t.checker.inProvisionalTypecheckMode()){var o=t.scope.getTable();o.secondaryTable.table[r.symbol.name]=undefined}return this.type=t.voidType,t.scope=n,this},n}(k);e.Catch=X;var V=function(t){function n(n){t.call(this,e.NodeType.Finally),this.body=n}return __extends(n,t),n.prototype.emit=function(t,n,r,i){t.emitParensAndCommentsInPlace(this,!0),t.recordSourceMappingStart(this),t.writeToOutput("finally"),t.emitJavascript(this.body,e.TokenID.FINALLY,!1),t.recordSourceMappingEnd(this),t.emitParensAndCommentsInPlace(this,!1)},n.prototype.addToControlFlow=function(e){this.body&&e.walk(this.body,this),e.walker.options.goChildren=!1,e.noContinuation=!1},n.prototype.typeCheck=function(e){return this.body=e.typeCheck(this.body),this},n}(k);e.Finally=V;var $=function(t){function n(n,r,i){t.call(this,e.NodeType.Comment),this.content=n,this.isBlockComment=r,this.endsLine=i,this.text=null}return __extends(n,t),n.prototype.getText=function(){if(this.text==null)if(this.isBlockComment){this.text=this.content.split("\n");for(var e=0;e<this.text.length;e++)this.text[e]=this.text[e].replace(/^\s+|\s+$/g,"")}else this.text=[this.content.replace(/^\s+|\s+$/g,"")];return this.text},n}(t);e.Comment=$;var J=function(t){function n(){t.call(this,e.NodeType.Debugger)}return __extends(n,t),n.prototype.emit=function(e,t,n,r){e.emitParensAndCommentsInPlace(this,!0),e.recordSourceMappingStart(this),e.writeLineToOutput("debugger;"),e.recordSourceMappingEnd(this),e.emitParensAndCommentsInPlace(this,!1)},n}(k);e.DebuggerStatement=J})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(){return i||(i=new r),i}var t=function(){function e(){this.goChildren=!0,this.goNextSibling=!0,this.reverseSiblings=!1}return e.prototype.stopWalk=function(e){typeof e=="undefined"&&(e=!0),this.goChildren=!e,this.goNextSibling=!e},e}();e.AstWalkOptions=t;var n=function(){function e(e,t,n,r,i){this.childrenWalkers=e,this.pre=t,this.post=n,this.options=r,this.state=i}return e.prototype.walk=function(e,t){var n=this.pre(e,t,this);n===undefined&&(n=e);if(this.options.goChildren){var r=this.options.goNextSibling;this.options.goNextSibling=!0,this.childrenWalkers[e.nodeType](e,t,this),this.options.goNextSibling=r}else this.options.goChildren=!0;if(this.post){var i=this.post(n,t,this);return i===undefined&&(i=n),i}return n},e}(),r=function(){function r(){this.childrenWalkers=[],this.initChildrenWalkers()}return r.prototype.walk=function(e,t,n,r,i){return this.getWalker(t,n,r,i).walk(e,null)},r.prototype.getWalker=function(e,t,n,r){return this.getSlowWalker(e,t,n,r)},r.prototype.getSlowWalker=function(e,r,i,s){return i||(i=new t),new n(this.childrenWalkers,e,r,i,s)},r.prototype.initChildrenWalkers=function(){this.childrenWalkers[e.NodeType.None]=o.walkNone,this.childrenWalkers[e.NodeType.Empty]=o.walkNone,this.childrenWalkers[e.NodeType.EmptyExpr]=o.walkNone,this.childrenWalkers[e.NodeType.True]=o.walkNone,this.childrenWalkers[e.NodeType.False]=o.walkNone,this.childrenWalkers[e.NodeType.This]=o.walkNone,this.childrenWalkers[e.NodeType.Super]=o.walkNone,this.childrenWalkers[e.NodeType.QString]=o.walkNone,this.childrenWalkers[e.NodeType.Regex]=o.walkNone,this.childrenWalkers[e.NodeType.Null]=o.walkNone,this.childrenWalkers[e.NodeType.ArrayLit]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.ObjectLit]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.Void]=o.walkNone,this.childrenWalkers[e.NodeType.Comma]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Pos]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.Neg]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.Delete]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.Await]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.In]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Dot]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.From]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Is]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.InstOf]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Typeof]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.NumberLit]=o.walkNone,this.childrenWalkers[e.NodeType.Name]=o.walkNone,this.childrenWalkers[e.NodeType.TypeRef]=o.walkTypeReferenceChildren,this.childrenWalkers[e.NodeType.Index]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Call]=o.walkCallExpressionChildren,this.childrenWalkers[e.NodeType.New]=o.walkCallExpressionChildren,this.childrenWalkers[e.NodeType.Asg]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgAdd]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgSub]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgDiv]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgMul]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgMod]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgAnd]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgXor]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgOr]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgLsh]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgRsh]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.AsgRs2]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.QMark]=o.walkTrinaryExpressionChildren,this.childrenWalkers[e.NodeType.LogOr]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.LogAnd]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Or]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Xor]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.And]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Eq]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Ne]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Eqv]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.NEqv]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Lt]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Le]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Gt]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Ge]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Add]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Sub]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Mul]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Div]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Mod]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Lsh]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Rsh]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Rs2]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.Not]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.LogNot]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.IncPre]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.DecPre]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.IncPost]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.DecPost]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.TypeAssertion]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.FuncDecl]=o.walkFuncDeclChildren,this.childrenWalkers[e.NodeType.Member]=o.walkBinaryExpressionChildren,this.childrenWalkers[e.NodeType.VarDecl]=o.walkBoundDeclChildren,this.childrenWalkers[e.NodeType.ArgDecl]=o.walkBoundDeclChildren,this.childrenWalkers[e.NodeType.Return]=o.walkReturnStatementChildren,this.childrenWalkers[e.NodeType.Break]=o.walkNone,this.childrenWalkers[e.NodeType.Continue]=o.walkNone,this.childrenWalkers[e.NodeType.Throw]=o.walkUnaryExpressionChildren,this.childrenWalkers[e.NodeType.For]=o.walkForStatementChildren,this.childrenWalkers[e.NodeType.ForIn]=o.walkForInStatementChildren,this.childrenWalkers[e.NodeType.If]=o.walkIfStatementChildren,this.childrenWalkers[e.NodeType.While]=o.walkWhileStatementChildren,this.childrenWalkers[e.NodeType.DoWhile]=o.walkDoWhileStatementChildren,this.childrenWalkers[e.NodeType.Block]=o.walkBlockChildren,this.childrenWalkers[e.NodeType.Case]=o.walkCaseStatementChildren,this.childrenWalkers[e.NodeType.Switch]=o.walkSwitchStatementChildren,this.childrenWalkers[e.NodeType.Try]=o.walkTryChildren,this.childrenWalkers[e.NodeType.TryCatch]=o.walkTryCatchChildren,this.childrenWalkers[e.NodeType.TryFinally]=o.walkTryFinallyChildren,this.childrenWalkers[e.NodeType.Finally]=o.walkFinallyChildren,this.childrenWalkers[e.NodeType.Catch]=o.walkCatchChildren,this.childrenWalkers[e.NodeType.List]=o.walkListChildren,this.childrenWalkers[e.NodeType.Script]=o.walkScriptChildren,this.childrenWalkers[e.NodeType.Class]=o.walkClassDeclChildren,this.childrenWalkers[e.NodeType.Interface]=o.walkTypeDeclChildren,this.childrenWalkers[e.NodeType.Module]=o.walkModuleDeclChildren,this.childrenWalkers[e.NodeType.Import]=o.walkImportDeclChildren,this.childrenWalkers[e.NodeType.With]=o.walkWithStatementChildren,this.childrenWalkers[e.NodeType.Label]=o.walkLabelChildren,this.childrenWalkers[e.NodeType.LabeledStatement]=o.walkLabeledStatementChildren,this.childrenWalkers[e.NodeType.EBStart]=o.walkNone,this.childrenWalkers[e.NodeType.GotoEB]=o.walkNone,this.childrenWalkers[e.NodeType.EndCode]=o.walkNone,this.childrenWalkers[e.NodeType.Error]=o.walkNone,this.childrenWalkers[e.NodeType.Comment]=o.walkNone,this.childrenWalkers[e.NodeType.Debugger]=o.walkNone;for(var t in e.NodeType._map)if(this.childrenWalkers[t]===undefined)throw new Error("initWalkers function is not up to date with enum content!")},r}();e.AstWalkerFactory=r;var i;e.getAstWalkerFactory=s;var o;(function(e){function t(e,t,n){}function n(e,t,n){var r=e.members.length;if(n.options.reverseSiblings)for(var i=r-1;i>=0;i--)n.options.goNextSibling&&(e.members[i]=n.walk(e.members[i],e));else for(var i=0;i<r;i++)n.options.goNextSibling&&(e.members[i]=n.walk(e.members[i],e))}function r(e,t,n){e.castTerm&&(e.castTerm=n.walk(e.castTerm,e)),e.operand&&(e.operand=n.walk(e.operand,e))}function i(e,t,n){n.options.reverseSiblings?(e.operand2&&(e.operand2=n.walk(e.operand2,e)),e.operand1&&n.options.goNextSibling&&(e.operand1=n.walk(e.operand1,e))):(e.operand1&&(e.operand1=n.walk(e.operand1,e)),e.operand2&&n.options.goNextSibling&&(e.operand2=n.walk(e.operand2,e)))}function s(e,t,n){e.term&&(e.term=n.walk(e.term,e))}function o(e,t,n){n.options.reverseSiblings||(e.target=n.walk(e.target,e)),e.args&&n.options.goNextSibling&&(e.args=n.walk(e.args,e)),n.options.reverseSiblings&&n.options.goNextSibling&&(e.target=n.walk(e.target,e))}function u(e,t,n){e.operand1&&(e.operand1=n.walk(e.operand1,e)),e.operand2&&n.options.goNextSibling&&(e.operand2=n.walk(e.operand2,e)),e.operand3&&n.options.goNextSibling&&(e.operand3=n.walk(e.operand3,e))}function a(e,t,n){e.name&&(e.name=n.walk(e.name,e)),e.args&&e.args.members.length>0&&n.options.goNextSibling&&(e.args=n.walk(e.args,e)),e.returnTypeAnnotation&&n.options.goNextSibling&&(e.returnTypeAnnotation=n.walk(e.returnTypeAnnotation,e)),e.bod&&e.bod.members.length>0&&n.options.goNextSibling&&(e.bod=n.walk(e.bod,e))}function f(e,t,n){e.id&&(e.id=n.walk(e.id,e)),e.init&&(e.init=n.walk(e.init,e)),e.typeExpr&&n.options.goNextSibling&&(e.typeExpr=n.walk(e.typeExpr,e))}function l(e,t,n){e.returnExpression&&(e.returnExpression=n.walk(e.returnExpression,e))}function c(e,t,n){e.init&&(e.init=n.walk(e.init,e)),e.cond&&n.options.goNextSibling&&(e.cond=n.walk(e.cond,e)),e.incr&&n.options.goNextSibling&&(e.incr=n.walk(e.incr,e)),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function h(e,t,n){e.lval=n.walk(e.lval,e),n.options.goNextSibling&&(e.obj=n.walk(e.obj,e)),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function p(e,t,n){e.cond=n.walk(e.cond,e),e.thenBod&&n.options.goNextSibling&&(e.thenBod=n.walk(e.thenBod,e)),e.elseBod&&n.options.goNextSibling&&(e.elseBod=n.walk(e.elseBod,e))}function d(e,t,n){e.cond=n.walk(e.cond,e),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function v(e,t,n){e.cond=n.walk(e.cond,e),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function m(e,t,n){e.stmts&&(e.stmts=n.walk(e.stmts,e))}function g(e,t,n){e.expr&&(e.expr=n.walk(e.expr,e)),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function y(e,t,n){e.val&&(e.val=n.walk(e.val,e)),e.caseList&&n.options.goNextSibling&&(e.caseList=n.walk(e.caseList,e))}function b(e,t,n){e.body&&(e.body=n.walk(e.body,e))}function w(e,t,n){e.tryNode&&(e.tryNode=n.walk(e.tryNode,e)),e.catchNode&&n.options.goNextSibling&&(e.catchNode=n.walk(e.catchNode,e))}function E(e,t,n){e.tryNode&&(e.tryNode=n.walk(e.tryNode,e)),e.finallyNode&&n.options.goNextSibling&&(e.finallyNode=n.walk(e.finallyNode,e))}function S(e,t,n){e.body&&(e.body=n.walk(e.body,e))}function x(e,t,n){e.param&&(e.param=n.walk(e.param,e)),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function T(e,t,n){e.name=n.walk(e.name,e),n.options.goNextSibling&&e.members&&(e.members=n.walk(e.members,e))}function N(e,t,n){T(e,t,n)}function C(e,t,n){N(e,t,n),n.options.goNextSibling&&e.baseClass&&(e.baseClass=n.walk(e.baseClass,e)),n.options.goNextSibling&&e.implementsList&&(e.implementsList=n.walk(e.implementsList,e))}function k(e,t,n){e.bod&&(e.bod=n.walk(e.bod,e))}function L(e,t,n){N(e,t,n),n.options.goNextSibling&&e.extendsList&&(e.extendsList=n.walk(e.extendsList,e)),n.options.goNextSibling&&e.implementsList&&(e.implementsList=n.walk(e.implementsList,e))}function A(e,t,n){T(e,t,n),n.options.goNextSibling&&e.alias&&(e.alias=n.walk(e.alias,e))}function O(e,t,n){e.id&&(e.id=n.walk(e.id,e)),e.alias&&(e.alias=n.walk(e.alias,e))}function M(e,t,n){e.expr&&(e.expr=n.walk(e.expr,e)),e.body&&n.options.goNextSibling&&(e.body=n.walk(e.body,e))}function _(e,t,n){}function D(e,t,n){e.labels=n.walk(e.labels,e),n.options.goNextSibling&&(e.stmt=n.walk(e.stmt,e))}e.walkNone=t,e.walkListChildren=n,e.walkUnaryExpressionChildren=r,e.walkBinaryExpressionChildren=i,e.walkTypeReferenceChildren=s,e.walkCallExpressionChildren=o,e.walkTrinaryExpressionChildren=u,e.walkFuncDeclChildren=a,e.walkBoundDeclChildren=f,e.walkReturnStatementChildren=l,e.walkForStatementChildren=c,e.walkForInStatementChildren=h,e.walkIfStatementChildren=p,e.walkWhileStatementChildren=d,e.walkDoWhileStatementChildren=v,e.walkBlockChildren=m,e.walkCaseStatementChildren=g,e.walkSwitchStatementChildren=y,e.walkTryChildren=b,e.walkTryCatchChildren=w,e.walkTryFinallyChildren=E,e.walkFinallyChildren=S,e.walkCatchChildren=x,e.walkRecordChildren=T,e.walkNamedTypeChildren=N,e.walkClassDeclChildren=C,e.walkScriptChildren=k,e.walkTypeDeclChildren=L,e.walkModuleDeclChildren=A,e.walkImportDeclChildren=O,e.walkWithStatementChildren=M,e.walkLabelChildren=_,e.walkLabeledStatementChildren=D})(o||(o={}))})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function t(e){return e===null||e.length===0?null:e[e.length-1]}function n(e,t){return e>=t?e:t}function r(e,t){return e<=t?e:t}function s(e){return e===null?!1:e.minChar===-1||e.limChar===-1?!1:!0}function a(t,n,r){typeof r=="undefined"&&(r=u.Default);var i=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++){var r=e[t].minChar,i=e[t].limChar;e[t].isBlockComment||i++,n>=r&&n<i&&f.path.push(e[t])}},a=function(o,a,l){if(s(o)){var c=e.hasFlag(r,u.EdgeInclusive)||o.nodeType===e.NodeType.Name||n===t.limChar,h=o.minChar,p=o.limChar+(c?1:0);if(n>=h&&n<p){var d=f.path.ast();(d==null||o.minChar>=d.minChar&&o.limChar<=d.limChar)&&f.path.push(o)}n<p&&i(o.preComments),n>=h&&i(o.postComments),e.hasFlag(r,u.DontPruneSearchBasedOnPosition)||(l.options.goChildren=h<=n&&n<=p)}return o},f=new o;return e.getAstWalkerFactory().walk(t,a,null,null,f),f.path}function f(t,r){var i=0,s=function(t,s,o){if(e.isValidAstNode(t)){t.minChar<=r&&(i=n(i,t.minChar));if(t.minChar>r||t.limChar<i)o.options.goChildren=!1}return t};return e.getAstWalkerFactory().walk(t,s),i}function l(t,n){var r=function(e,t,r){var i=r.state;return i.push(e),n(i,r),e},s=function(e,t,n){var r=n.state;return r.pop(),e},o=new i;e.getAstWalkerFactory().walk(t,r,s,null,o)}e.lastOf=t,e.max=n,e.min=r;var i=function(){function n(){this.asts=[],this.top=-1}return n.reverseIndexOf=function(t,n){return t===null||t.length<=n?null:t[t.length-n-1]},n.prototype.clone=function(){var e=new n;return e.asts=this.asts.map(function(e){return e}),e.top=this.top,e},n.prototype.pop=function(){var e=this.ast();this.up();while(this.asts.length>this.count())this.asts.pop();return e},n.prototype.push=function(e){while(this.asts.length>this.count())this.asts.pop();this.top=this.asts.length,this.asts.push(e)},n.prototype.up=function(){if(this.top<=-1)throw new Error("Invalid call to 'up'");this.top--},n.prototype.down=function(){if(this.top==this.ast.length-1)throw new Error("Invalid call to 'down'");this.top++},n.prototype.nodeType=function(){return this.ast()==null?e.NodeType.None:this.ast().nodeType},n.prototype.ast=function(){return n.reverseIndexOf(this.asts,this.asts.length-(this.top+1))},n.prototype.parent=function(){return n.reverseIndexOf(this.asts,this.asts.length-this.top)},n.prototype.count=function(){return this.top+1},n.prototype.get=function(e){return this.asts[e]},n.prototype.isNameOfClass=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.Class&&this.parent().name===this.ast()},n.prototype.isNameOfInterface=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.Interface&&this.parent().name===this.ast()},n.prototype.isNameOfArgument=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.ArgDecl&&this.parent().id===this.ast()},n.prototype.isNameOfVariable=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.VarDecl&&this.parent().id===this.ast()},n.prototype.isNameOfModule=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.Module&&this.parent().name===this.ast()},n.prototype.isNameOfFunction=function(){return this.ast()===null||this.parent()===null?!1:this.ast().nodeType===e.NodeType.Name&&this.parent().nodeType===e.NodeType.FuncDecl&&this.parent().name===this.ast()},n.prototype.isChildOfScript=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.Script},n.prototype.isChildOfModule=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.Module},n.prototype.isChildOfClass=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.Class},n.prototype.isArgumentOfClassConstructor=function(){var n=t(this.asts);return this.count()>=5&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-3].nodeType===e.NodeType.List&&this.asts[this.top-4].nodeType===e.NodeType.Class&&this.asts[this.top-2].isConstructor&&this.asts[this.top-2].args===this.asts[this.top-1]&&this.asts[this.top-4].constructorDecl===this.asts[this.top-2]},n.prototype.isChildOfInterface=function(){var n=t(this.asts);return this.count()>=3&&this.asts[this.top]===n&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.Interface},n.prototype.isTopLevelImplicitModule=function(){return this.count()>=1&&this.asts[this.top].nodeType===e.NodeType.Module&&e.hasFlag(this.asts[this.top].modFlags,e.ModuleFlags.IsWholeFile)},n.prototype.isBodyOfTopLevelImplicitModule=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.Module&&this.asts[this.top-1].members==this.asts[this.top-0]&&e.hasFlag(this.asts[this.top-1].modFlags,e.ModuleFlags.IsWholeFile)},n.prototype.isBodyOfScript=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Script&&this.asts[this.top-1].bod==this.asts[this.top-0]},n.prototype.isBodyOfSwitch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Switch&&this.asts[this.top-1].caseList==this.asts[this.top-0]},n.prototype.isBodyOfModule=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Module&&this.asts[this.top-1].members==this.asts[this.top-0]},n.prototype.isBodyOfClass=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Class&&this.asts[this.top-1].members==this.asts[this.top-0]},n.prototype.isBodyOfFunction=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-1].bod==this.asts[this.top-0]},n.prototype.isBodyOfInterface=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Interface&&this.asts[this.top-1].members==this.asts[this.top-0]},n.prototype.isBodyOfBlock=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Block&&this.asts[this.top-1].stmts==this.asts[this.top-0]},n.prototype.isBodyOfFor=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.For&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfCase=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Case&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfTry=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Try&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfCatch=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Catch&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfDoWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.DoWhile&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfWhile=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.While&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfForIn=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ForIn&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfWith=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.With&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isBodyOfFinally=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Finally&&this.asts[this.top-1].body==this.asts[this.top-0]},n.prototype.isCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===e.NodeType.Switch&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]},n.prototype.isDefaultCaseOfSwitch=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===e.NodeType.Switch&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].caseList==this.asts[this.top-1]&&this.asts[this.top-2].defaultCase==this.asts[this.top-0]},n.prototype.isListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},n.prototype.isBodyOfObjectLit=function(){return this.isListOfObjectLit()},n.prototype.isEmptyListOfObjectLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]&&this.asts[this.top-0].members.length==0},n.prototype.isMemberOfObjectLit=function(){return this.count()>=3&&this.asts[this.top-2].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-0].nodeType===e.NodeType.Member&&this.asts[this.top-2].operand==this.asts[this.top-1]},n.prototype.isNameOfMemberOfObjectLit=function(){return this.count()>=4&&this.asts[this.top-3].nodeType===e.NodeType.ObjectLit&&this.asts[this.top-2].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.Member&&this.asts[this.top-0].nodeType===e.NodeType.Name&&this.asts[this.top-3].operand==this.asts[this.top-2]},n.prototype.isListOfArrayLit=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.ArrayLit&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].operand==this.asts[this.top-0]},n.prototype.isTargetOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Member&&this.asts[this.top-1].operand1===this.asts[this.top-0]},n.prototype.isMemberOfMember=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.Member&&this.asts[this.top-1].operand2===this.asts[this.top-0]},n.prototype.isItemOfList=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.List},n.prototype.isThenOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.If&&this.asts[this.top-1].thenBod==this.asts[this.top-0]},n.prototype.isElseOfIf=function(){return this.count()>=2&&this.asts[this.top-1].nodeType===e.NodeType.If&&this.asts[this.top-1].elseBod==this.asts[this.top-0]},n.prototype.isBodyOfDefaultCase=function(){return this.isBodyOfCase()},n.prototype.isSingleStatementList=function(){return this.count()>=1&&this.asts[this.top].nodeType===e.NodeType.List&&this.asts[this.top].members.length===1},n.prototype.isArgumentListOfFunction=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-1].args===this.asts[this.top-0]},n.prototype.isArgumentOfFunction=function(){return this.count()>=3&&this.asts[this.top-1].nodeType===e.NodeType.List&&this.asts[this.top-2].nodeType===e.NodeType.FuncDecl&&this.asts[this.top-2].args===this.asts[this.top-1]},n.prototype.isArgumentListOfCall=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.Call&&this.asts[this.top-1].args===this.asts[this.top-0]},n.prototype.isArgumentListOfNew=function(){return this.count()>=2&&this.asts[this.top-0].nodeType===e.NodeType.List&&this.asts[this.top-1].nodeType===e.NodeType.New&&this.asts[this.top-1].args===this.asts[this.top-0]},n.prototype.isSynthesizedBlock=function(){return this.count()>=1&&this.asts[this.top-0].nodeType===e.NodeType.Block&&this.asts[this.top-0].visible===!1},n}();e.AstPath=i,e.isValidAstNode=s;var o=function(){function t(){this.path=new e.AstPath}return t}();e.AstPathContext=o,function(e){e._map=[],e.Default=0,e.EdgeInclusive=1,e.DontPruneSearchBasedOnPosition=2}(e.GetAstPathOptions||(e.GetAstPathOptions={}));var u=e.GetAstPathOptions;e.getAstPathToPosition=a,e.getTokenizationOffset=f,e.walkAST=l})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(e){this.logger=e}return t.prototype.logScript=function(t){var n=this;this.logLinemap(t.locationInfo.lineMap);var r=[],i=function(e,i){r.push(e);var s=(r.length-1)*2;return n.logComments(t,e.preComments,s),n.logNode(t,e,s),n.logComments(t,e.postComments,s),e},s=function(e,t){return r.pop(),e};e.getAstWalkerFactory().walk(t,i,s)},t.prototype.logNode=function(e,t,n){var r=this.addPadding("",n,"| ",!0);r=r.concat("+ "+t.treeViewLabel()),r=this.addPadding(r,70," ",!1),r+=this.addLineColumn(e,t.minChar),r=this.addPadding(r,80," ",!1),r+="=> ",r+=this.addLineColumn(e,t.limChar),r=this.addPadding(r,102," ",!1),r=r.concat("["+this.addPadding(t.minChar.toString(),1," ",!0)+", "+this.addPadding(t.limChar.toString(),1," ",!0)+"]"),r=this.addPadding(r,115," ",!1),r=r.concat("sym="+t.sym),r=this.addPadding(r,135," ",!1),r=r.concat("type="+(t.type===null?"null":t.type.getTypeName())),this.logger.log(r)},t.prototype.logComments=function(e,t,n){if(t==null)return;for(var r=0;r<t.length;r++)this.logNode(e,t[r],n)},t.prototype.logLinemap=function(e){var t="[";for(var n=0;n<e.length;n++)n>0&&(t+=","),t+=e[n];t+="]",this.logger.log("linemap: "+t)},t.prototype.addPadding=function(e,t,n,r){var i=r?"":e;for(var s=e.length;s<t;s++)i+=n;return i+=r?e:"",i},t.prototype.addLineColumn=function(t,n){var r={line:-1,col:-1};return e.getSourceLineColFromMap(r,n,t.locationInfo.lineMap),r.col!==-1&&r.col++,"("+r.line+", "+r.col+")"},t}();e.AstLogger=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(e){this.checker=e}return t.prototype.resolveBaseTypeLinks=function(e,t){var n=null;if(e){n=new Array;for(var r=0,i=e.length;r<i;r++){var s=e[r];this.checker.resolvingBases=!0,this.checker.resolveTypeLink(t,s,!0),this.checker.resolvingBases=!1,s.type.isClass()?n[r]=s.type.instanceType:n[r]=s.type}}return n},t.prototype.resolveBases=function(e,t){t.extendsList=this.resolveBaseTypeLinks(t.extendsTypeLinks,e);var n=0,r=t.extendsList.length,i=t.isClassInstance();for(;n<r;n++){var s=t.extendsList[n].isClassInstance();t.extendsList[n]!=this.checker.anyType&&(i?s||this.checker.errorReporter.simpleErrorFromSym(t.symbol,"A export class may only extend other classes, "+t.extendsList[n].symbol.fullName()+" is an interface."):s&&this.checker.errorReporter.simpleErrorFromSym(t.symbol,"An interface may only extend other interfaces, "+t.extendsList[n].symbol.fullName()+" is a class."))}t.implementsList=this.resolveBaseTypeLinks(t.implementsTypeLinks,e);if(t.implementsList)for(n=0,r=t.implementsList.length;n<r;n++){var o=t.implementsList[n];o.isClassInstance()&&i&&this.checker.errorReporter.simpleErrorFromSym(t.symbol,"A class may only implement an interface; "+o.symbol.fullName()+" is a class.")}},t.prototype.resolveSignatureGroup=function(e,t,n){var r=!e.hasImplementation;for(var i=0,s=e.signatures.length;i<s;i++){var o=e.signatures[i];n?o.returnType.type=n:this.checker.resolveTypeLink(t,o.returnType,r);var u=o.parameters.length;for(var a=0;a<u;a++)this.bindSymbol(t,o.parameters[a]);if(o.hasVariableArgList){var f=o.parameters[u-1];f.argsOffset=u-1,f.getType().isArray()||(this.checker.errorReporter.simpleErrorFromSym(f,"... parameter must have array type"),f.parameter.typeLink.type=this.checker.makeArrayType(f.parameter.typeLink.type))}}},t.prototype.bindType=function(t,n,r){r&&this.bindType(t,r,null);if(n.hasMembers()){var i=n.members,s=n.ambientMembers,o=n.getAllEnclosedTypes(),u=n.getAllAmbientEnclosedTypes(),a=new e.SymbolTableScope(i,s,o,u,n.symbol),f=new e.SymbolAggregateScope(n.symbol),l=this.checker.currentModDecl,c=this.checker.inBind;f.addParentScope(a),f.addParentScope(t),n.isModuleType()&&(this.checker.currentModDecl=n.symbol.declAST,this.checker.inBind=!0),i&&this.bind(f,n.members.allMembers),o&&this.bind(f,o.allMembers),s&&this.bind(f,s.allMembers),u&&this.bind(f,u.allMembers),this.checker.currentModDecl=l,this.checker.inBind=c}n.extendsTypeLinks&&this.resolveBases(t,n),n.construct&&this.resolveSignatureGroup(n.construct,t,r),n.call&&this.resolveSignatureGroup(n.call,t,null),n.index&&this.resolveSignatureGroup(n.index,t,null),n.elementType&&this.bindType(t,n.elementType,null)},t.prototype.bindSymbol=function(t,n){if(!n.bound){var r=this.checker.locationInfo;this.checker.units&&n.unitIndex>=0&&n.unitIndex<this.checker.units.length&&(this.checker.locationInfo=this.checker.units[n.unitIndex]);switch(n.kind()){case e.SymbolKind.Type:if(n.flags&e.SymbolFlags.Bound)break;var i=n;i.flags|=e.SymbolFlags.Bound;if(i.aliasLink&&!i.type&&i.aliasLink.alias.nodeType==e.NodeType.Name){var s=i.aliasLink.alias.text,o=this.checker.findSymbolForDynamicModule(s,this.checker.locationInfo.filename,function(e){return t.find(e,!1,!0)});o&&(i.type=o.getType())}if(i.type&&i.type!=this.checker.gloModType){this.bindType(t,i.type,i.instanceType);if(i.type.isModuleType())for(var u=0;u<i.expansions.length;u++)this.bindType(t,i.expansions[u],i.instanceType)}break;case e.SymbolKind.Field:this.checker.resolveTypeLink(t,n.field.typeLink,!1);break;case e.SymbolKind.Parameter:this.checker.resolveTypeLink(t,n.parameter.typeLink,!0)}this.checker.locationInfo=r}n.bound=!0},t.prototype.bind=function(e,t){t.map(function(t,n,r){r.bindSymbol(e,n)},this)},t}();e.Binder=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(){}return e.encodedValues="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e.encode=function(n){if(n<64)return e.encodedValues.charAt(n);throw TypeError(n+": not a 64 based value")},e.decodeChar=function(n){if(n.length===1)return e.encodedValues.indexOf(n);throw TypeError('"'+n+'" must have length 1')},e}(),n=function(){function e(){}return e.encode=function(n){n<0?n=(-n<<1)+1:n<<=1;var r="";do{var i=n&31;n>>=5,n>0&&(i|=32),r+=t.encode(i)}while(n>0);return r},e.decode=function(n){var r=0,i=!1,s=0;for(var o=0;o<n.length;o++){var u=t.decodeChar(n[o]);o===0?((u&1)===1&&(i=!0),r=u>>1&15):r|=(u&31)<<s,s+=o==0?4:5;if((u&32)!==32)return{value:i?-r:r,rest:n.substr(o+1)}}throw new Error('Base64 value "'+n+'" finished with a continuation bit')},e}();e.Base64VLQFormat=n})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(e){this.parent=-1,this.firstChild=-1}return e}();e.SourceMapping=t;var n=function(){function t(t,n,r,i){this.jsFile=r,this.sourceMapOut=i,this.sourceMappings=new Array,this.currentMapping=-1,this.jsFileName=e.getPrettyName(n,!1,!0),this.tsFileName=e.getPrettyName(t,!1,!0)}return t.MapFileExtension=".map",t.CanEmitMapping=function(t,n){if(n.firstChild!==-1){var r=t[n.firstChild];if(r.emittedStartLine===n.emittedStartLine&&r.emittedStartColumn===n.emittedStartColumn)return!1}return!0},t.EmitSourceMapping=function(r){var i=r[0];i.jsFile.WriteLine("//@ sourceMappingURL="+i.jsFileName+t.MapFileExtension);var s=i.sourceMapOut,o="",u=[],a=0,f=0,l=0,c=0,h=0,p=!1;for(var d=0;d<r.length;d++){i=r[d];if(i.sourceMappings){var v=u.length;u.push(i.tsFileName);var m=i.sourceMappings;for(var g=0,y=m.length;g<y;g++){var b=m[g];if(!t.CanEmitMapping(m,b))continue;if(f!==b.emittedStartLine){while(f<b.emittedStartLine)a=0,o+=";",f++;p=!1}else p&&(o+=",");o+=e.Base64VLQFormat.encode(b.emittedStartColumn-a),a=b.emittedStartColumn,o+=e.Base64VLQFormat.encode(v-h),h=v,o+=e.Base64VLQFormat.encode(b.sourceStartLine-1-c),c=b.sourceStartLine-1,o+=e.Base64VLQFormat.encode(b.sourceStartColumn-l),l=b.sourceStartColumn,p=!0}}}o!=""&&(s.Write("{"),s.Write('"version":3,'),s.Write('"file":"'+i.jsFileName+'",'),s.Write('"sources":["'+u.join('","')+'"],'),s.Write('"names":[],'),s.Write('"mappings":"'+o),s.Write('"'),s.Write("}")),s.Close()},t}();e.SourceMapper=n})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(e){e._map=[],e._map[0]="Prog",e.Prog=0,e._map[1]="Module",e.Module=1,e._map[2]="DynamicModule",e.DynamicModule=2,e._map[3]="Class",e.Class=3,e._map[4]="Constructor",e.Constructor=4,e._map[5]="Function",e.Function=5,e._map[6]="Args",e.Args=6,e._map[7]="Interface",e.Interface=7})(e.EmitContainer||(e.EmitContainer={}));var t=e.EmitContainer,n=function(){function e(){this.indentAmt=0,this.column=0,this.line=0,this.pretty=!1,this.inObjectLiteral=!1,this.container=t.Prog}return e}();e.EmitState=n;var r=function(){function r(e,t,r){this.checker=e,this.outfile=t,this.emitOptions=r,this.prologueEmitted=!1,this.indentStep=4,this.thisClassNode=null,this.thisFnc=null,this.moduleDeclList=[],this.moduleName="",this.emitState=new n,this.indentStrings=[],this.ambientModule=!1,this.modAliasId=null,this.firstModAlias=null,this.allSourceMappers=[],this.sourceMapper=null,this.declDottedModuleName=!1,this.declIndentDelta=0,this.declFile=null,this.declContainingAST=null}return r.prototype.canWriteDeclFile=function(){return this.declFile!=null},r.prototype.setSourceMappings=function(e){this.allSourceMappers.push(e),this.sourceMapper=e},r.prototype.setDeclarationFile=function(e){this.declFile=e},r.prototype.increaseIndent=function(){this.emitState.indentAmt+=this.indentStep,this.declDottedModuleName&&this.addDeclIndentDelta()},r.prototype.decreaseIndent=function(){this.emitState.indentAmt-=this.indentStep},r.prototype.addDeclIndentDelta=function(){this.declIndentDelta+=this.indentStep},r.prototype.reduceDeclIndentDelta=function(){this.declIndentDelta-=this.indentStep},r.prototype.writeToOutput=function(e){this.outfile.Write(e),this.emitState.column+=e.length},r.prototype.writeToOutputTrimmable=function(e){this.emitOptions.minWhitespace&&(e=e.replace(/[\s]*/g,"")),this.writeToOutput(e)},r.prototype.writeLineToOutput=function(t){if(this.emitOptions.minWhitespace){this.writeToOutput(t);var n=t.charCodeAt(t.length-1);n!=e.LexCodeSpace&&n!=e.LexCodeSMC&&n!=e.LexCodeLBR&&this.writeToOutput(" ")}else this.outfile.WriteLine(t),this.emitState.column=0,this.emitState.line++},r.prototype.setInObjectLiteral=function(e){var t=this.emitState.inObjectLiteral;return this.emitState.inObjectLiteral=e,t},r.prototype.setContainer=function(e){var t=this.emitState.container;return this.emitState.container=e,t},r.prototype.setDeclContainingAST=function(e){var t=this.declContainingAST;return this.declContainingAST=e,t},r.prototype.getIndentString=function(e){typeof e=="undefined"&&(e=!1);if(this.emitOptions.minWhitespace)return"";var t=this.emitState.indentAmt-(e?this.declIndentDelta:0),n=this.indentStrings[t];if(n===undefined){n="";for(var r=0;r<t;r++)n+=" ";this.indentStrings[t]=n}return n},r.prototype.emitIndent=function(){this.writeToOutput(this.getIndentString())},r.prototype.emitIndentToDeclFile=function(){this.declFile.Write(this.getIndentString(!0))},r.prototype.emitCommentInPlace=function(e){this.recordSourceMappingStart(e);var t=e.getText(),n=!1;if(e.isBlockComment){this.emitState.column==0&&this.emitIndent(),this.writeToOutput(t[0]);if(t.length>1||e.endsLine){this.writeLineToOutput("");for(var r=1;r<t.length;r++)this.emitIndent(),this.writeLineToOutput(t[r]);n=!0}}else this.emitState.column==0&&this.emitIndent(),this.writeLineToOutput(t[0]),n=!0;n?this.emitIndent():this.writeToOutput(" "),this.recordSourceMappingEnd(e)},r.prototype.emitParensAndCommentsInPlace=function(e,t){var n=t?e.preComments:e.postComments;e.isParenthesized&&!t&&this.writeToOutput(")");if(this.emitOptions.emitComments&&n&&n.length!=0)for(var r=0;r<n.length;r++)this.emitCommentInPlace(n[r]);e.isParenthesized&&t&&this.writeToOutput("(")},r.prototype.emitObjectLiteral=function(t){this.writeLineToOutput("{"),this.increaseIndent();var n=this.setInObjectLiteral(!0);this.emitJavascriptList(t,",",e.TokenID.Comma,!0,!1,!1),this.setInObjectLiteral(n),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")},r.prototype.emitArrayLiteral=function(t){this.writeToOutput("["),t&&(this.writeLineToOutput(""),this.increaseIndent(),this.emitJavascriptList(t,", ",e.TokenID.Comma,!0,!1,!1),this.decreaseIndent(),this.emitIndent()),this.writeToOutput("]")},r.prototype.emitNew=function(t,n){this.recordSourceMappingStart(t),this.writeToOutput("new "),t.nodeType==e.NodeType.TypeRef?this.writeToOutput("Array()"):(this.emitJavascript(t,e.TokenID.Tilde,!1),this.writeToOutput("("),this.emitJavascriptList(n,", ",e.TokenID.Comma,!1,!1,!1),this.writeToOutput(")")),this.recordSourceMappingEnd(t)},r.prototype.tryEmitConstant=function(t){if(!this.emitOptions.propagateConstants)return!1;var n=t.operand2;if(n&&n.sym&&n.sym.isVariable()&&e.hasFlag(n.sym.flags,e.SymbolFlags.Constant)&&n.sym.declAST){var r=n.sym.declAST;if(r.init&&r.init.nodeType==e.NodeType.NumberLit){var i=r.init;this.writeToOutput(i.value.toString());var s=" /* ";return s+=n.text,s+=" */ ",this.writeToOutput(s),!0}}return!1},r.prototype.emitCall=function(t,n,r){if(!this.emitSuperCall(t))if(!e.hasFlag(t.flags,e.ASTFlags.ClassBaseConstructorCall))n.nodeType==e.NodeType.FuncDecl&&!n.isParenthesized&&this.writeToOutput("("),this.emitJavascript(n,e.TokenID.LParen,!1),n.nodeType==e.NodeType.FuncDecl&&!n.isParenthesized&&this.writeToOutput(")"),this.writeToOutput("("),this.emitJavascriptList(r,", ",e.TokenID.Comma,!1,!1,!1),this.writeToOutput(")");else{this.decreaseIndent(),this.decreaseIndent();var i=new e.ASTList;i.members[0]=t,this.emitConstructorCalls(i,this.thisClassNode),this.increaseIndent(),this.increaseIndent()}},r.prototype.defaultValue=function(e){return e==this.checker.anyType?"undefined":e==this.checker.numberType?"0":e==this.checker.stringType?'""':e==this.checker.booleanType?"false":"null"},r.prototype.emitConstructorCalls=function(t,n){if(t==null)return;var r=t.members.length;this.recordSourceMappingStart(n);for(var i=0;i<r;i++){var s=t.members[i],o=null;s.nodeType==e.NodeType.Call?o=s.target.type.symbol:o=s.type.symbol;var u=o.name;o.declModule!=n.type.symbol.declModule&&(u=o.fullName());if(s.nodeType==e.NodeType.Call){this.emitIndent(),this.writeToOutput("_super.call(this");var a=s.args;a&&a.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(a,", ",e.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")")}else s.type&&s.type.isClassInstance()&&(this.emitIndent(),this.writeToOutput(n.name.text+"._super.constructor"),this.writeToOutput(".call(this)"))}this.recordSourceMappingEnd(n)},r.prototype.emitInnerFunction=function(n,r,i,s,o,u,a,f){typeof a=="undefined"&&(a=!1),typeof f=="undefined"&&(f=this.emitState.container);var l=n.isConstructor&&e.hasFlag(n.fncFlags,e.FncFlags.ClassMethod),c=l&&e.hasFlag(this.thisClassNode.type.instanceType.typeFlags,e.TypeFlags.HasBaseType)&&!e.hasFlag(this.thisClassNode.type.instanceType.typeFlags,e.TypeFlags.HasBaseTypeOfObject),h=c&&e.hasFlag(this.thisClassNode.varFlags,e.VarFlags.ClassSuperMustBeFirstCallInConstructor);this.emitParensAndCommentsInPlace(n,!0),this.recordSourceMappingStart(n),(!n.isAccessor()||!n.accessorSymbol.isObjectLitField)&&this.writeToOutput("function ");if(r){var p=n.getNameText();p&&!n.isAccessor()&&this.writeToOutput(p)}this.writeToOutput("("),a&&(a=this.emitFuncSignatureIdentifier(n,!1,f));var d=0,v=0,m,g=[];if(n.args){var y=this.setContainer(t.Args);d=n.args.members.length;var b=d;n.variableArgList&&b--;for(v=0;v<b;v++)m=n.args.members[v],m.init&&g.push(m),this.emitJavascript(m,e.TokenID.LParen,!1,a),v<b-1&&(this.writeToOutput(", "),a&&this.declFile.Write(", "));this.setContainer(y)}this.writeLineToOutput(") {");var w=null;a&&(this.emitFuncSignatureVariableArg(n),n.hasStaticDeclarations()&&(w=this.setDeclContainingAST(n))),this.increaseIndent();for(v=0;v<g.length;v++){var m=g[v];this.emitIndent(),this.recordSourceMappingStart(m),this.writeToOutput("if (typeof "+m.id.text+' === "undefined") { '),this.recordSourceMappingStart(m.id),this.writeToOutput(m.id.text),this.recordSourceMappingEnd(m.id),this.writeToOutput(" = "),this.emitJavascript(m.init,e.TokenID.LParen,!1),this.writeLineToOutput("; }"),this.recordSourceMappingEnd(m)}if(n.isConstructor&&!h){if(n.args){d=n.args.members.length;for(v=0;v<d;v++)m=n.args.members[v],(m.varFlags&e.VarFlags.Property)!=e.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(m),this.recordSourceMappingStart(m.id),this.writeToOutput("this."+m.id.text),this.recordSourceMappingEnd(m.id),this.writeToOutput(" = "),this.recordSourceMappingStart(m.id),this.writeToOutput(m.id.text),this.recordSourceMappingEnd(m.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(m))}e.hasFlag(n.fncFlags,e.FncFlags.ClassMethod)||this.emitConstructorCalls(s,u)}o&&(this.emitIndent(),this.writeLineToOutput("var _this = this;"));if(n.variableArgList){d=n.args.members.length;var E=n.args.members[d-1];this.emitIndent(),this.recordSourceMappingStart(E),this.writeToOutput("var "),this.recordSourceMappingStart(E.id),this.writeToOutput(E.id.text),this.recordSourceMappingEnd(E.id),this.writeLineToOutput(" = [];"),this.recordSourceMappingEnd(E),this.emitIndent(),this.writeLineToOutput("for (var _i = 0; _i < (arguments.length - "+(d-1)+"); _i++) {"),this.increaseIndent(),this.emitIndent(),this.writeLineToOutput(E.id.text+"[_i] = arguments[_i + "+(d-1)+"];"),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")}if(n.isConstructor&&e.hasFlag(n.fncFlags,e.FncFlags.ClassMethod)&&!h){var S=this.thisClassNode.members.members.length;for(var v=0;v<S;v++)if(this.thisClassNode.members.members[v].nodeType==e.NodeType.VarDecl){var x=this.thisClassNode.members.members[v];!e.hasFlag(x.varFlags,e.VarFlags.Static)&&x.init&&(this.emitIndent(),this.emitJavascriptVarDecl(x,e.TokenID.Tilde),this.writeLineToOutput(""))}}this.emitBareJavascriptStatements(n.bod,h),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}"),!i&&!e.hasFlag(n.fncFlags,e.FncFlags.IsFunctionExpression)&&(e.hasFlag(n.fncFlags,e.FncFlags.Definition)||n.isConstructor)&&this.writeLineToOutput("");if(n.hasStaticDeclarations()){this.writeLineToOutput(""),this.emitIndent();var T=n.getNameText();this.writeLineToOutput("(function ("+T+") {"),this.increaseIndent();var N=0,v=0;N=n.innerStaticFuncs.length;for(v=0;v<N;v++){var C=n.innerStaticFuncs[v];if(C.isOverload){a&&this.emitFuncSignature(C);continue}this.emitIndent(),C.isAccessor()?this.emitPropertyAccessor(C,n.name.text,!1,a):(this.writeToOutput(T+"."+C.name.text+" = "),this.emitInnerFunction(C,C.name&&!C.name.isMissing(),!1,null,C.hasSelfReference(),null,a))}if(n.statics){this.recordSourceMappingStart(n.statics),N=n.statics.members.length;for(v=0;v<N;v++)this.emitIndent(),this.writeToOutput(T),this.emitJavascript(n.statics.members[v],e.TokenID.Tilde,!1,a),this.writeLineToOutput("");this.recordSourceMappingEnd(n.statics)}this.decreaseIndent(),this.emitIndent();var k=i&&this.thisClassNode,L=k?this.thisClassNode.name.text+".prototype.":"";this.writeLineToOutput("})("+L+T+");"),a&&(this.setDeclContainingAST(w),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))}this.recordSourceMappingEnd(n),this.emitParensAndCommentsInPlace(n,!1)},r.prototype.emitArgDecl=function(e){this.declFile.Write(e.id.text),e.isOptionalArg()&&this.declFile.Write("?"),(e.typeExpr||e.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(e.type)&&this.declFile.Write(": "+this.getTypeSignature(e.type))},r.prototype.emitFuncSignatureIdentifier=function(t,n,r){typeof n=="undefined"&&(n=!1),typeof r=="undefined"&&(r=this.emitState.container);if(!n&&!t.isOverload)if(t.isConstructor){if(t.type.construct.signatures.length>1)return!1}else if(t.type.call.signatures.length>1)return!1;if(!this.canEmitSignature(e.ToDeclFlags(t.fncFlags),r))return!1;if(t.isConstructor)this.emitIndentToDeclFile(),this.declFile.Write("constructor ");else{var i=t.getNameText();n?(this.emitIndentToDeclFile(),t.isConstructMember()?this.declFile.Write("new"):!t.isCallMember()&&!t.isIndexerMember()&&(this.declFile.Write(i),e.hasFlag(t.name.flags,e.ASTFlags.OptionalName)&&this.declFile.Write("? "))):(this.emitDeclFlags(e.ToDeclFlags(t.fncFlags),"function"),this.declFile.Write(i))}return t.isIndexerMember()?this.declFile.Write("["):this.declFile.Write("("),!0},r.prototype.emitFuncSignatureVariableArg=function(e){if(e.variableArgList){var t=e.args.members[e.args.members.length-1];e.args.members.length>1?this.declFile.Write(", ..."):this.declFile.Write("..."),this.emitArgDecl(t)}e.isIndexerMember()?this.declFile.Write("]"):this.declFile.Write(")"),!e.isConstructor&&(e.returnTypeAnnotation||e.signature.returnType.type!=this.checker.anyType)&&this.canEmitTypeAnnotationSignature(e.signature.returnType.type)&&this.declFile.Write(": "+this.getTypeSignature(e.signature.returnType.type)),e.hasStaticDeclarations()?this.declFile.WriteLine(" {"):this.declFile.WriteLine(";")},r.prototype.emitFuncSignature=function(e,t){typeof t=="undefined"&&(t=!1);var n=this.emitFuncSignatureIdentifier(e,t);if(n){if(e.args){var r=e.args.members.length;e.variableArgList&&r--;for(var i=0;i<r;i++){var s=e.args.members[i];this.emitArgDecl(s),i<r-1&&this.declFile.Write(", ")}}this.emitFuncSignatureVariableArg(e)}},r.prototype.emitPropertyAccessorSignature=function(t){var n=t.accessorSymbol;this.emitDeclFlags(e.ToDeclFlags(n.flags),"var"),this.declFile.WriteLine(t.name.text+" : "+this.getTypeSignature(n.getType())+";")},r.prototype.emitDeclFlags=function(t,n){this.emitIndentToDeclFile();var r="";e.hasFlag(t,e.DeclFlags.GetAccessor)?r="get ":e.hasFlag(t,e.DeclFlags.SetAccessor)&&(r="set "),e.hasFlag(t,e.DeclFlags.Exported)&&this.declFile.Write("export "),e.hasFlag(t,e.DeclFlags.LocalStatic)||e.hasFlag(t,e.DeclFlags.Static)?this.declFile.Write("static "+r):e.hasFlag(t,e.DeclFlags.Private)?this.declFile.Write("private "+r):e.hasFlag(t,e.DeclFlags.Public)?this.declFile.Write("public "+r):r==""?this.declFile.Write(n+" "):this.declFile.Write(r)},r.prototype.canEmitTypeAnnotationSignature=function(t,n){typeof n=="undefined"&&(n=e.DeclFlags.None);if(t==null)return!1;if(t.primitiveTypeClass==e.Primitive.None&&t.symbol&&t.symbol.container!=undefined&&t.symbol.container!=this.checker.gloMod){if(e.hasFlag(n,e.DeclFlags.Private))return!1;if(e.hasFlag(t.symbol.container.flags,e.SymbolFlags.Exported))return!0;if(t.symbol.declAST)switch(t.symbol.declAST.nodeType){case e.NodeType.Module:if(!e.hasFlag(t.symbol.declAST.modFlags,e.ModuleFlags.Exported))return!1;break;case e.NodeType.Class:if(!e.hasFlag(t.symbol.declAST.varFlags,e.VarFlags.Exported))return!1;break;case e.NodeType.Interface:if(!e.hasFlag(t.symbol.declAST.varFlags,e.VarFlags.Exported))return!1;break;case e.NodeType.FuncDecl:if(!e.hasFlag(t.symbol.declAST.fncFlags,e.FncFlags.Exported))return!1;break;default:throw Error("Catch this unhandled type container")}}return!0},r.prototype.getTypeSignature=function(t){var n=null;if(this.declContainingAST)switch(this.declContainingAST.nodeType){case e.NodeType.Module:case e.NodeType.Interface:case e.NodeType.FuncDecl:this.declContainingAST.type&&(n=this.declContainingAST.type.containedScope);break;case e.NodeType.Script:var r=this.declContainingAST;r.bod&&(n=r.bod.enclosingScope);break;case e.NodeType.Class:this.declContainingAST.type&&(n=this.declContainingAST.type.instanceType.containedScope);break;default:throw Error("Unknown containing scope")}return t.getScopedTypeName(n)},r.prototype.canEmitSignature=function(n,r){return typeof r=="undefined"&&(r=this.emitState.container),r==t.Module&&!e.hasFlag(n,e.DeclFlags.Exported)?!1:!0},r.prototype.emitVarSignature=function(t,n){typeof n=="undefined"&&(n=!1);if(this.canEmitSignature(e.ToDeclFlags(t.varFlags))){n?(this.emitIndentToDeclFile(),this.declFile.Write(t.id.text),e.hasFlag(t.id.flags,e.ASTFlags.OptionalName)&&this.declFile.Write("?")):(this.emitDeclFlags(e.ToDeclFlags(t.varFlags),"var"),this.declFile.Write(t.id.text));var r=null;t.typeExpr&&t.typeExpr.type?r=t.typeExpr.type:t.sym&&(r=t.sym.getType(),r==this.checker.anyType&&(r=null));if(this.canEmitTypeAnnotationSignature(r,e.ToDeclFlags(t.varFlags))){var i=this.getTypeSignature(r);this.declFile.WriteLine(": "+i+";")}else this.declFile.WriteLine(";")}},r.prototype.emitBaseList=function(e,t){if(e&&e.members.length>0){this.declFile.Write(" "+t+" ");var n=e.members.length;for(var r=0;r<n;r++){var i=e.members[r],s=i.type.symbol,o=i.type,u=this.getTypeSignature(o);r>0&&this.declFile.Write(", "),this.declFile.Write(u)}}},r.prototype.emitClassSignatureIdentifierAndHeritage=function(t){if(!this.canEmitSignature(e.ToDeclFlags(t.varFlags)))return!1;var n=t.name.text;return this.emitDeclFlags(e.ToDeclFlags(t.varFlags),"class"),this.declFile.Write(n),this.emitBaseList(t.baseClass,"extends"),this.emitBaseList(t.implementsList,"implements"),this.declFile.WriteLine(" {"),!0},r.prototype.emitClassSignatureClassBodyOfAmbientClass=function(t){var n=t.definitionMembers.members.length;for(var r=0;r<n;r++){var i=t.definitionMembers.members[r];if(i.nodeType==e.NodeType.FuncDecl){var s=i;s.isAccessor()||this.emitFuncSignature(s)}else{if(i.nodeType!=e.NodeType.VarDecl)throw Error("We want to catch this");this.emitVarSignature(i)}}},r.prototype.emitMembersFromConstructorDefinition=function(t){if(t.args){var n=t.args.members.length;t.variableArgList&&n--;for(var r=0;r<n;r++){var i=t.args.members[r];e.hasFlag(i.varFlags,e.VarFlags.Property)&&(this.emitDeclFlags(e.ToDeclFlags(i.varFlags),"var"),this.declFile.Write(i.id.text),i.typeExpr&&this.declFile.Write(": "+this.getTypeSignature(i.type)),this.declFile.WriteLine(";"))}}},r.prototype.emitClassSignature=function(e){var t=this.emitClassSignatureIdentifierAndHeritage(e);if(t){var n=this.setDeclContainingAST(e);this.increaseIndent(),this.emitClassSignatureClassBodyOfAmbientClass(e),this.decreaseIndent(),this.setDeclContainingAST(n),this.emitIndentToDeclFile(),this.declFile.WriteLine("}")}},r.prototype.emitImportDecl=function(t){this.canEmitSignature(e.ToDeclFlags(t.varFlags))&&(this.emitDeclFlags(e.ToDeclFlags(t.varFlags),"import"),this.declFile.Write(t.id.text+" = "),t.isDynamicImport?this.declFile.WriteLine("module ("+t.getAliasName()+");"):this.declFile.WriteLine(t.getAliasName()+";"))},r.prototype.emitModuleIdentification=function(t){return this.canEmitSignature(e.ToDeclFlags(t.modFlags))?(this.declDottedModuleName?this.declFile.Write("."):this.emitDeclFlags(e.ToDeclFlags(t.modFlags),"module"),this.declFile.Write(t.name.text),t.members.members.length==1&&t.members.members[0].nodeType==e.NodeType.Module&&!t.members.members[0].isEnum()&&e.hasFlag(t.members.members[0].modFlags,e.ModuleFlags.Exported)?this.declDottedModuleName=!0:(this.declDottedModuleName=!1,this.declFile.WriteLine(" {")),!0):!1},r.prototype.emitModuleBodyOfAmbientModule=function(t){var n=t.members.members.length;for(var r=0;r<n;r++){var i=t.members.members[r];switch(i.nodeType){case e.NodeType.VarDecl:this.emitVarSignature(i);break;case e.NodeType.FuncDecl:this.emitFuncSignature(i);break;case e.NodeType.Class:this.emitClassSignature(i);break;case e.NodeType.Interface:this.emitInterfaceDeclaration(i);break;case e.NodeType.Module:this.emitModuleSignature(i);break;case e.NodeType.Import:this.emitImportDecl(i);break;case e.NodeType.Empty:break;default:throw Error("We want to catch this")}}},r.prototype.emitModuleSignature=function(e){if(e.isEnum())this.emitEnumSignature(e);else{var n=this.declIndentDelta,r=this.declDottedModuleName,i=this.emitModuleIdentification(e);if(i){var s=this.setDeclContainingAST(e);this.increaseIndent();var o=this.setContainer(t.Module);this.emitModuleBodyOfAmbientModule(e),this.setContainer(o),this.decreaseIndent(),this.setDeclContainingAST(s),r||(this.declIndentDelta=n,this.emitIndentToDeclFile(),this.declFile.WriteLine("}"))}}},r.prototype.emitEnumBodyOfAmbientEnum=function(t){var n=t.members.members.length;for(var r=1;r<n;r++){var i=t.members.members[r];if(i.nodeType==e.NodeType.VarDecl)this.emitIndentToDeclFile(),this.declFile.WriteLine(i.id.text+",");else if(i.nodeType!=e.NodeType.Asg)throw Error("We want to catch this")}},r.prototype.emitEnumSignature=function(t){return this.canEmitSignature(e.ToDeclFlags(t.modFlags))?(this.emitDeclFlags(e.ToDeclFlags(t.modFlags),"enum"),this.declFile.WriteLine(t.name.text+" {"),this.increaseIndent(),this.emitEnumBodyOfAmbientEnum(t),this.decreaseIndent(),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"),!0):!1},r.prototype.emitInterfaceBody=function(t){for(var n=0;n<t.members.length;n++){var r=t.members[n];switch(r.nodeType){case e.NodeType.FuncDecl:this.emitFuncSignature(r,!0);break;case e.NodeType.VarDecl:this.emitVarSignature(r,!0);break;default:throw Error("Not allowed")}}},r.prototype.emitInterfaceDeclaration=function(n){if(this.canEmitSignature(e.ToDeclFlags(n.varFlags))){var r=this.setContainer(t.Interface),i=n.name.text;this.emitDeclFlags(e.ToDeclFlags(n.varFlags),"interface"),this.declFile.Write(i),this.emitBaseList(n.extendsList,"extends"),this.declFile.WriteLine(" {"),this.increaseIndent();var s=this.setDeclContainingAST(n);this.emitInterfaceBody(n.members),this.setDeclContainingAST(s),this.decreaseIndent(),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"),this.setContainer(r)}},r.prototype.emitJavascriptModule=function(n,r){var i=n.name.text;e.isTSFile(i)?n.name.text=i.substring(0,i.length-3):e.isSTRFile(i)&&(n.name.text=i.substring(0,i.length-4));if(!e.hasFlag(n.modFlags,e.ModuleFlags.Ambient)){var s=e.hasFlag(n.modFlags,e.ModuleFlags.IsDynamic),o=this.declIndentDelta,u=this.declDottedModuleName,a=null,f=this.outfile;r&&(s||(n.isEnum()?r=this.emitEnumSignature(n):r=this.emitModuleIdentification(n)),r&&(a=this.setDeclContainingAST(n)));var l=this.setContainer(t.Module),c=this.moduleName,h=e.hasFlag(n.modFlags,e.ModuleFlags.Exported);this.moduleDeclList[this.moduleDeclList.length]=n,this.moduleName=n.name.text,this.recordSourceMappingStart(n);if(s){var p=e.stripQuotes(e.trimModName(n.name.text))+".js";this.emitOptions.createFile&&(p!=this.emitOptions.path?this.outfile=this.emitOptions.createFile(p):this.emitOptions.outputMany||this.checker.errorReporter.emitterError(n,"Module emit collides with emitted script: "+p)),this.setContainer(t.DynamicModule);if(e.moduleGenTarget==e.ModuleGenTarget.Asynchronous){var d='["require", "exports"',v="require, exports",m=null;for(var g=0;g<n.mod.importedModules.length;g++)m=n.mod.importedModules[g],m.id.sym&&!m.id.sym.onlyReferencedAsTypeRef&&(g<=n.mod.importedModules.length-1&&(d+=", ",v+=", "),v+="__"+m.id.text+"__",d+=m.firstAliasedModToString());for(var g=0;g<n.amdDependencies.length;g++)d+=', "'+n.amdDependencies[g]+'"';d+="]",this.writeLineToOutput("define("+d+","+" function("+v+") {")}}else h||(this.writeLineToOutput("var "+this.moduleName+";"),this.emitIndent()),this.writeLineToOutput("(function ("+this.moduleName+") {");if(!s||e.moduleGenTarget==e.ModuleGenTarget.Asynchronous)this.increaseIndent(),s&&this.addDeclIndentDelta();this.emitJavascriptList(n.members,null,e.TokenID.SColon,!0,!1,!1,r&&!n.isEnum());if(!s||e.moduleGenTarget==e.ModuleGenTarget.Asynchronous)this.decreaseIndent(),s&&this.reduceDeclIndentDelta();this.emitIndent();if(s)r&&this.setDeclContainingAST(a),e.moduleGenTarget==e.ModuleGenTarget.Asynchronous&&this.writeLineToOutput("})"),this.outfile!=f&&(this.outfile.Close(),this.outfile=f);else{r&&(this.setDeclContainingAST(a),!n.isEnum()&&!u&&(this.declIndentDelta=o,this.emitIndentToDeclFile(),this.declFile.WriteLine("}")));var y=null;n.type&&n.type.symbol.container&&n.type.symbol.container.declAST&&(y=n.type.symbol.container.declAST);var b=y&&e.hasFlag(y.modFlags,e.ModuleFlags.IsDynamic);if(l==t.Prog&&h)this.writeLineToOutput("})(this."+this.moduleName+" || (this."+this.moduleName+" = {}));");else if(h||l==t.Prog){var w=c!=""?(b?"exports":c)+".":c;this.writeLineToOutput("})("+w+this.moduleName+" || ("+w+this.moduleName+" = {}));")}else!h&&l!=t.Prog?this.writeLineToOutput("})("+this.moduleName+" || ("+this.moduleName+" = {}));"):this.writeLineToOutput("})();");l!=t.Prog&&!b&&h&&(this.emitIndent(),this.writeLineToOutput("var "+this.moduleName+" = "+c+"."+this.moduleName+";"))}this.recordSourceMappingEnd(n),this.setContainer(l),this.moduleName=c,this.moduleDeclList.length--}else r&&this.emitModuleSignature(n)},r.prototype.emitIndex=function(t,n){var r=this.setInObjectLiteral(!1);this.emitJavascript(t,e.TokenID.Tilde,!1),this.writeToOutput("["),this.emitJavascriptList(n,", ",e.TokenID.Comma,!1,!1,!1),this.writeToOutput("]"),this.setInObjectLiteral(r)},r.prototype.emitStringLiteral=function(e){this.writeToOutput(e)},r.prototype.emitJavascriptFunction=function(n,r){if(e.hasFlag(n.fncFlags,e.FncFlags.Signature)||n.isOverload){r&&this.emitFuncSignature(n);return}var i,s=this.thisFnc;this.thisFnc=n,n.isConstructor?i=this.setContainer(t.Constructor):i=this.setContainer(t.Function);var o=null,u=!1,a=n.getNameText();if((this.emitState.inObjectLiteral||!n.isAccessor())&&(i!=t.Constructor||(n.fncFlags&e.FncFlags.Method)==e.FncFlags.None)){var f=this.setInObjectLiteral(!1);this.thisClassNode&&(o=this.thisClassNode.extendsList),u=n.hasSelfReference(),this.recordSourceMappingStart(n),e.hasFlag(n.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported)&&n.type.symbol.container==this.checker.gloMod&&!n.isConstructor?(this.writeToOutput("this."+a+" = "),this.emitInnerFunction(n,!1,!1,o,u,this.thisClassNode,r,i)):this.emitInnerFunction(n,n.name&&!n.name.isMissing(),!1,o,u,this.thisClassNode,r,i),this.recordSourceMappingEnd(n),this.setInObjectLiteral(f)}this.setContainer(i),this.thisFnc=s;if(e.hasFlag(n.fncFlags,e.FncFlags.Definition))if(e.hasFlag(n.fncFlags,e.FncFlags.Static))this.thisClassNode&&(n.isAccessor()?this.emitPropertyAccessor(n,this.thisClassNode.name.text,!1,!1):(this.emitIndent(),this.recordSourceMappingStart(n),this.writeLineToOutput(this.thisClassNode.name.text+"."+a+" = "+a+";"),this.recordSourceMappingEnd(n)));else if((this.emitState.container==t.Module||this.emitState.container==t.DynamicModule)&&e.hasFlag(n.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported)){this.emitIndent();var l=this.emitState.container==t.Module?this.moduleName:"exports";this.recordSourceMappingStart(n),this.writeLineToOutput(l+"."+a+" = "+a+";"),this.recordSourceMappingEnd(n)}},r.prototype.emitAmbientVarDecl=function(t){t.init&&(this.emitParensAndCommentsInPlace(t,!0),this.recordSourceMappingStart(t),this.recordSourceMappingStart(t.id),this.writeToOutput(t.id.text),this.recordSourceMappingEnd(t.id),this.writeToOutput(" = "),this.emitJavascript(t.init,e.TokenID.Comma,!1),this.recordSourceMappingEnd(t),this.writeToOutput(";"),this.emitParensAndCommentsInPlace(t,!1))},r.prototype.emitForVarList=function(t){if(t){this.recordSourceMappingStart(t);var n=t.members.length;for(var r=0;r<n;r++){var i=t.members[r];this.emitJavascriptVarDecl(i,r==0?e.TokenID.FOR:e.TokenID.LParen),r<n-1&&this.writeToOutput(", ")}this.recordSourceMappingEnd(t)}},r.prototype.emitJavascriptVarDecl=function(n,r,i){typeof i=="undefined"&&(i=!1);if((n.varFlags&e.VarFlags.Ambient)==e.VarFlags.Ambient)this.emitAmbientVarDecl(n);else{var s=n.sym,o=n.init!=null;this.emitParensAndCommentsInPlace(n,!0),this.recordSourceMappingStart(n);if(s&&s.isMember()&&s.container&&s.container.kind()==e.SymbolKind.Type){var u=s.container.type;u.isClass()&&!e.hasFlag(s.flags,e.SymbolFlags.ModuleMember)?this.emitState.container!=t.Args&&(e.hasFlag(s.flags,e.SymbolFlags.Static)?this.writeToOutput(s.container.name+"."):this.writeToOutput("this.")):u.hasImplementation()?!e.hasFlag(s.flags,e.SymbolFlags.Exported)&&(s.container==this.checker.gloMod||!e.hasFlag(s.flags,e.SymbolFlags.Property))?this.writeToOutput("var "):e.hasFlag(n.varFlags,e.VarFlags.LocalStatic)?this.writeToOutput("."):this.emitState.container==t.DynamicModule?this.writeToOutput("exports."):this.writeToOutput(this.moduleName+"."):r!=e.TokenID.LParen&&(e.hasFlag(s.flags,e.SymbolFlags.Exported)&&s.container==this.checker.gloMod?this.writeToOutput("this."):this.writeToOutput("var "))}else r!=e.TokenID.LParen&&this.writeToOutput("var ");this.recordSourceMappingStart(n.id),this.writeToOutput(n.id.text),this.recordSourceMappingEnd(n.id),o?(this.writeToOutputTrimmable(" = "),this.emitJavascript(n.init,e.TokenID.Comma,!1)):s&&s.isMember()&&this.emitState.container==t.Constructor&&(this.writeToOutputTrimmable(" = "),this.writeToOutput(this.defaultValue(n.type))),r!=e.TokenID.FOR&&r!=e.TokenID.LParen&&this.writeToOutputTrimmable(";"),this.recordSourceMappingEnd(n),this.emitParensAndCommentsInPlace(n,!1)}i&&this.emitVarSignature(n)},r.prototype.declEnclosed=function(e){if(e==null)return!0;for(var t=0,n=this.moduleDeclList.length;t<n;t++)if(this.moduleDeclList[t]==e)return!0;return!1},r.prototype.emitJavascriptName=function(n,r){var i=n.sym;this.emitParensAndCommentsInPlace(n,!0),this.recordSourceMappingStart(n);if(!n.isMissing()){if(r&&this.emitState.container!=t.Args&&i)if(i.container&&i.container.name!=e.globalId){if(e.hasFlag(i.flags,e.SymbolFlags.Static)&&e.hasFlag(i.flags,e.SymbolFlags.Property))i.declModule&&e.hasFlag(i.declModule.modFlags,e.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(i.container.name+".");else if(i.kind()==e.SymbolKind.Field){var s=i;e.hasFlag(s.flags,e.SymbolFlags.ModuleMember)?i.container!=this.checker.gloMod&&(e.hasFlag(i.flags,e.SymbolFlags.Property)||e.hasFlag(i.flags,e.SymbolFlags.Exported))&&(e.hasFlag(i.declModule.modFlags,e.ModuleFlags.IsDynamic)?this.writeToOutput("exports."):this.writeToOutput(i.container.name+".")):i.isInstanceProperty()&&(this.thisFnc&&!this.thisFnc.isMethod()&&!this.thisFnc.isConstructor?this.writeToOutput("_this."):this.writeToOutput("this."))}else if(i.kind()==e.SymbolKind.Type)if(i.isInstanceProperty()){var o=i,u=o.type;u.call&&!e.hasFlag(i.flags,e.SymbolFlags.ModuleMember)&&(this.thisFnc&&!this.thisFnc.isMethod()&&!this.thisFnc.isConstructor?this.writeToOutput("_this."):this.writeToOutput("this."))}else(i.unitIndex!=this.checker.locationInfo.unitIndex||!this.declEnclosed(i.declModule))&&this.writeToOutput(i.container.name+".")}else i.container==this.checker.gloMod&&e.hasFlag(i.flags,e.SymbolFlags.Exported)&&!e.hasFlag(i.flags,e.SymbolFlags.Ambient)&&(!i.isType()&&!i.isMember()||!i.declModule||!e.hasFlag(i.declModule.modFlags,e.ModuleFlags.Ambient))&&this.emitState.container==t.Prog&&i.declAST.nodeType!=e.NodeType.FuncDecl&&this.writeToOutput("this.");if(i&&i.declAST&&i.declAST.nodeType==e.NodeType.Module&&e.hasFlag(i.declAST.modFlags,e.ModuleFlags.IsDynamic)){var a=i.declAST;if(e.moduleGenTarget==e.ModuleGenTarget.Asynchronous)this.writeLineToOutput("__"+this.modAliasId+"__;");else{var f=n.text,l=a.mod.symbol.declAST&&e.hasFlag(a.mod.symbol.declAST.modFlags,e.ModuleFlags.Ambient);f=l?f:this.firstModAlias?this.firstModAlias:e.quoteBaseName(f),f=l?f:e.isRelative(e.stripQuotes(f))?f:e.quoteStr("./"+e.stripQuotes(f)),this.writeToOutput("require("+f+")")}}else this.writeToOutput(n.text)}this.recordSourceMappingEnd(n),this.emitParensAndCommentsInPlace(n,!1)},r.prototype.emitJavascriptStatements=function(t,n,r){if(t)if(t.nodeType!=e.NodeType.Block){var i=t&&(t.nodeType!=e.NodeType.List||t.members.length>0);if(n||i){var s=t.nodeType==e.NodeType.Block||t.nodeType==e.NodeType.List&&t.members.length==1&&t.members[0].nodeType==e.NodeType.Block;this.recordSourceMappingStart(t),s||(this.writeLineToOutput(" {"),this.increaseIndent()),this.emitJavascriptList(t,null,e.TokenID.SColon,!0,!1,!1),s||(this.writeLineToOutput(""),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("}")),this.recordSourceMappingEnd(t)}}else this.emitJavascript(t,e.TokenID.SColon,!0);else n&&this.writeToOutput("{ }")},r.prototype.emitBareJavascriptStatements=function(t,n){if(t.nodeType!=e.NodeType.Block)if(t.nodeType==e.NodeType.List){var r=t;r.members.length==2&&r.members[0].nodeType==e.NodeType.Block&&r.members[1].nodeType==e.NodeType.EndCode?(this.emitJavascript(r.members[0],e.TokenID.SColon,!0),this.writeLineToOutput("")):this.emitJavascriptList(t,null,e.TokenID.SColon,!0,!1,n)}else this.emitJavascript(t,e.TokenID.SColon,!0);else this.emitJavascript(t,e.TokenID.SColon,!0)},r.prototype.recordSourceMappingStart=function(t){if(this.sourceMapper&&t){var n={line:-1,col:-1},r=new e.SourceMapping(t);r.emittedStartColumn=this.emitState.column,r.emittedStartLine=this.emitState.line,e.getSourceLineColFromMap(n,t.minChar,this.checker.locationInfo.lineMap),r.sourceStartColumn=n.col,r.sourceStartLine=n.line,e.getSourceLineColFromMap(n,t.limChar,this.checker.locationInfo.lineMap),r.sourceEndColumn=n.col,r.sourceEndLine=n.line,r.parent=this.sourceMapper.currentMapping,this.sourceMapper.currentMapping=this.sourceMapper.sourceMappings.length,this.sourceMapper.sourceMappings.push(r);if(r.parent>=0){var i=this.sourceMapper.sourceMappings[r.parent];i.firstChild==-1&&(i.firstChild=this.sourceMapper.currentMapping)}}},r.prototype.recordSourceMappingEnd=function(e){if(this.sourceMapper&&e){var t=this.sourceMapper.currentMapping,n=this.sourceMapper.sourceMappings[t];n.emittedEndColumn=this.emitState.column,n.emittedEndLine=this.emitState.line,this.sourceMapper.currentMapping=n.parent}},r.prototype.emitSourceMappings=function(){e.SourceMapper.EmitSourceMapping(this.allSourceMappers)},r.prototype.emitJavascriptList=function(t,n,r,i,s,o,u){if(t==null)return;if(t.nodeType!=e.NodeType.List)this.emitJavascript(t,r,i,u);else{var a=t;if(a.members.length==0)return;this.emitParensAndCommentsInPlace(t,!0);var f=a.members.length;for(var l=0;l<f;l++){if(l==1&&o){var c=this.thisClassNode.constructorDecl;if(c&&c.args){var h=c.args.members.length;for(var p=0;p<h;p++){var d=c.args.members[p];(d.varFlags&e.VarFlags.Property)!=e.VarFlags.None&&(this.emitIndent(),this.recordSourceMappingStart(d),this.recordSourceMappingStart(d.id),this.writeToOutput("this."+d.id.text),this.recordSourceMappingEnd(d.id),this.writeToOutput(" = "),this.recordSourceMappingStart(d.id),this.writeToOutput(d.id.text),this.recordSourceMappingEnd(d.id),this.writeLineToOutput(";"),this.recordSourceMappingEnd(d))}}var v=this.thisClassNode.members.members.length;for(var m=0;m<v;m++)if(this.thisClassNode.members.members[m].nodeType==e.NodeType.VarDecl){var g=this.thisClassNode.members.members[m];!e.hasFlag(g.varFlags,e.VarFlags.Static)&&g.init&&(this.emitIndent(),this.emitJavascriptVarDecl(g,e.TokenID.Tilde),this.writeLineToOutput(""))}}var y=a.members[l],b=y.nodeType==e.NodeType.FuncDecl&&e.hasFlag(y.fncFlags,e.FncFlags.Static)||y.nodeType==e.NodeType.VarDecl&&e.hasFlag(y.varFlags,e.VarFlags.Static);if(s?!b:b)continue;this.emitJavascript(y,r,i,u),n&&l<f-1?i?this.writeLineToOutput(n):this.writeToOutput(n):i&&y.nodeType!=e.NodeType.Interface&&(y.nodeType!=e.NodeType.VarDecl||(y.varFlags&e.VarFlags.Ambient)!=e.VarFlags.Ambient||y.init!=null)&&y.nodeType!=e.NodeType.EndCode&&y.nodeType!=e.NodeType.FuncDecl&&this.writeLineToOutput("")}this.emitParensAndCommentsInPlace(t,!1)}},r.prototype.emitJavascript=function(n,r,i,s){typeof s=="undefined"&&(s=!1);if(n==null)return;var o=!1;i&&this.emitState.indentAmt>0&&n.nodeType!=e.NodeType.List&&n.nodeType!=e.NodeType.Block&&n.nodeType!=e.NodeType.Interface&&(n.nodeType!=e.NodeType.VarDecl||(n.varFlags&e.VarFlags.Ambient)!=e.VarFlags.Ambient||n.init!=null)&&n.nodeType!=e.NodeType.EndCode&&(n.nodeType!=e.NodeType.FuncDecl||this.emitState.container!=t.Constructor)&&this.emitIndent(),o&&this.writeToOutput("("),n.emit(this,r,i,s),o&&this.writeToOutput(")"),r==e.TokenID.SColon&&n.nodeType<e.NodeType.GeneralNode&&this.writeToOutput(";")},r.prototype.emitPropertyAccessor=function(e,t,n,r){if(!e.accessorSymbol.hasBeenEmitted){var i=e.accessorSymbol;this.emitIndent(),this.recordSourceMappingStart(e),this.writeLineToOutput("Object.defineProperty("+t+(n?'.prototype, "':', "')+e.name.text+'"'+", {"),this.increaseIndent();if(i.getter){var s=i.getter.declAST;this.emitIndent(),this.writeToOutput("get: "),this.emitInnerFunction(s,!1,n,null,e.hasSelfReference(),null),this.writeLineToOutput(",")}if(i.setter){var o=i.setter.declAST;this.emitIndent(),this.writeToOutput("set: "),this.emitInnerFunction(o,!1,n,null,e.hasSelfReference(),null),this.writeLineToOutput(",")}this.emitIndent(),this.writeLineToOutput("enumerable: true,"),this.emitIndent(),this.writeLineToOutput("configurable: true"),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("});"),this.recordSourceMappingEnd(e),r&&this.emitPropertyAccessorSignature(e),i.hasBeenEmitted=!0}},r.prototype.emitPrototypeMember=function(t,n,r){if(t.nodeType==e.NodeType.FuncDecl){var i=t;i.isAccessor()?this.emitPropertyAccessor(i,n,!0,r):(this.emitIndent(),this.recordSourceMappingStart(i),this.writeToOutput(n+".prototype."+i.getNameText()+" = "),this.emitInnerFunction(i,!1,!0,null,i.hasSelfReference(),null,r),this.recordSourceMappingEnd(i),this.writeLineToOutput(";"))}else if(t.nodeType==e.NodeType.VarDecl){var s=t;s.init&&(this.emitIndent(),this.recordSourceMappingStart(s),this.recordSourceMappingStart(s.id),this.writeToOutput(n+".prototype."+s.id.text),this.recordSourceMappingEnd(s.id),this.writeToOutput(" = "),this.emitJavascript(s.init,e.TokenID.Asg,!1),this.recordSourceMappingEnd(s),this.writeLineToOutput(";")),r&&this.emitVarSignature(s)}},r.prototype.emitAddBaseMethods=function(t,n,r){if(n.members){var i=n.symbol,s=i.name;i.declModule!=r.type.symbol.declModule&&(s=i.fullName()),n.members.allMembers.map(function(n,r,i){var o=r;o.kind()==e.SymbolKind.Type&&o.type.call&&(this.recordSourceMappingStart(o.declAST),this.writeLineToOutput(t+".prototype."+o.name+" = "+s+".prototype."+o.name+";"),this.recordSourceMappingEnd(o.declAST))},null)}if(n.extendsList)for(var o=0,u=n.extendsList.length;o<u;o++)this.emitAddBaseMethods(t,n.extendsList[o],r)},r.prototype.emitJavascriptClass=function(n,r){if(!e.hasFlag(n.varFlags,e.VarFlags.Ambient)){var i=this.thisClassNode,s=0;this.thisClassNode=n;var o=n.name.text;this.emitParensAndCommentsInPlace(n,!0);var u=null;r&&(r=this.emitClassSignatureIdentifierAndHeritage(n),r&&(u=this.setDeclContainingAST(n)));var a=this.setContainer(t.Class);this.recordSourceMappingStart(n),e.hasFlag(n.varFlags,e.VarFlags.Exported)&&n.type.symbol.container==this.checker.gloMod?this.writeToOutput("this."+o):this.writeToOutput("var "+o);var f=n.type,l=f.instanceType,c=l?l.baseClass():null,h=null,p=null;c?this.writeLineToOutput(" = (function (_super) {"):this.writeLineToOutput(" = (function () {"),this.increaseIndent();if(c){h=n.extendsList.members[0],p=h.nodeType==e.NodeType.Call?h.target:h,this.emitIndent(),this.writeLineToOutput("__extends("+o+", _super);");var d=l.extendsList.length;if(d>1)for(var s=1;s<d;s++){var v=l.extendsList[s];this.emitAddBaseMethods(o,v,n)}}this.emitIndent();var m=n.constructorDecl;if(m)this.emitJavascript(n.constructorDecl,e.TokenID.LParen,!1,!1),r&&this.emitMembersFromConstructorDefinition(n.constructorDecl);else{var g=0;this.recordSourceMappingStart(n),this.increaseIndent(),this.writeToOutput("function "+n.name.text+"() {"),c&&(this.writeLineToOutput(""),this.emitIndent(),this.writeLineToOutput("_super.apply(this, arguments);"),g++);var y=this.thisClassNode.members.members;for(var s=0;s<y.length;s++)if(y[s].nodeType==e.NodeType.VarDecl){var b=y[s];!e.hasFlag(b.varFlags,e.VarFlags.Static)&&b.init&&(this.writeLineToOutput(""),this.emitIndent(),this.emitJavascriptVarDecl(b,e.TokenID.Tilde),g++)}g?(this.writeLineToOutput(""),this.decreaseIndent(),this.emitIndent(),this.writeLineToOutput("}")):(this.writeLineToOutput(" }"),this.decreaseIndent()),this.recordSourceMappingEnd(n)}var w=n.definitionMembers.members.length;for(var E=0;E<w;E++){var S=n.definitionMembers.members[E];if(S.nodeType==e.NodeType.FuncDecl){var x=S;e.hasFlag(x.fncFlags,e.FncFlags.Method)&&!x.isSignature()?e.hasFlag(x.fncFlags,e.FncFlags.Static)?x.isAccessor()?this.emitPropertyAccessor(x,this.thisClassNode.name.text,!1,r):(this.emitIndent(),this.recordSourceMappingStart(x),this.writeToOutput(n.name.text+"."+x.name.text+" = "),this.emitInnerFunction(x,x.name&&!x.name.isMissing(),!1,null,x.hasSelfReference(),null,r),this.recordSourceMappingEnd(x)):this.emitPrototypeMember(x,o,r):r&&this.emitFuncSignature(x)}else{if(S.nodeType!=e.NodeType.VarDecl)throw Error("We want to catch this");var b=S;e.hasFlag(b.varFlags,e.VarFlags.Static)?(this.emitIndent(),this.recordSourceMappingStart(b),this.writeToOutput(n.name.text+"."+b.id.text+" = "),b.init?(this.emitJavascript(b.init,e.TokenID.Asg,!1),this.writeLineToOutput(";")):this.writeLineToOutput(this.defaultValue(b.type)+";"),r&&this.emitVarSignature(b),this.recordSourceMappingEnd(b)):r&&this.emitVarSignature(b)}}this.emitIndent(),this.recordSourceMappingStart(n),this.writeLineToOutput("return "+o+";"),this.recordSourceMappingEnd(n),this.decreaseIndent(),this.emitIndent(),this.writeToOutput("})("),c&&this.emitJavascript(p,e.TokenID.Tilde,!1),this.writeToOutput(");"),r&&(this.setDeclContainingAST(u),this.emitIndentToDeclFile(),this.declFile.WriteLine("}"));if((a==t.Module||a==t.DynamicModule)&&e.hasFlag(n.varFlags,e.VarFlags.Exported)){this.writeLineToOutput(""),this.emitIndent();var T=a==t.Module?this.moduleName:"exports";this.recordSourceMappingStart(n),this.writeToOutput(T+"."+o+" = "+o+";"),this.recordSourceMappingEnd(n)}this.emitIndent(),this.recordSourceMappingEnd(n),this.emitParensAndCommentsInPlace(n,!1),this.setContainer(a),this.thisClassNode=i}else r&&this.emitClassSignature(n)},r.prototype.emitPrologue=function(e){this.prologueEmitted||e&&(this.prologueEmitted=!0,this.writeLineToOutput("var __extends = this.__extends || function (d, b) {"),this.writeLineToOutput("    function __() { this.constructor = d; }"),this.writeLineToOutput("    __.prototype = b.prototype;"),this.writeLineToOutput("    d.prototype = new __();"),this.writeLineToOutput("}"))},r.prototype.emitSuperReference=function(){this.writeToOutput("_super.prototype")},r.prototype.emitSuperCall=function(t){if(t.target.nodeType==e.NodeType.Dot){var n=t.target;if(n.operand1.nodeType==e.NodeType.Super)return this.emitJavascript(n,e.TokenID.LParen,!1),this.writeToOutput(".call(this"),t.args&&t.args.members.length>0&&(this.writeToOutput(", "),this.emitJavascriptList(t.args,", ",e.TokenID.Comma,!1,!1,!1)),this.writeToOutput(")"),!0}return!1},r}();e.Emitter=r})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(e){this.outfile=e,this.parser=null,this.checker=null,this.lineCol={line:0,col:0},this.emitAsComments=!0,this.hasErrors=!1,this.pushToErrorSink=!1,this.errorSink=[]}return t.prototype.getCapturedErrors=function(){return this.errorSink},t.prototype.freeCapturedErrors=function(){this.errorSink=[]},t.prototype.captureError=function(e){this.errorSink[this.errorSink.length]=e},t.prototype.setErrOut=function(e){this.outfile=e,this.emitAsComments=!1},t.prototype.emitPrefix=function(){this.emitAsComments&&this.outfile.Write("// "),this.outfile.Write(this.checker.locationInfo.filename+"("+this.lineCol.line+","+this.lineCol.col+"): ")},t.prototype.writePrefix=function(e){e?this.setError(e):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},t.prototype.writePrefixFromSym=function(t){t&&this.checker.locationInfo.lineMap?e.getSourceLineColFromMap(this.lineCol,t.location,this.checker.locationInfo.lineMap):(this.lineCol.line=-1,this.lineCol.col=-1),this.emitPrefix()},t.prototype.setError=function(t){t&&(t.flags|=e.ASTFlags.Error,this.checker.locationInfo.lineMap&&e.getSourceLineColFromMap(this.lineCol,t.minChar,this.checker.locationInfo.lineMap))},t.prototype.reportError=function(e,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=!0;var n=e.limChar-e.minChar;this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(e.minChar,n,t,this.checker.locationInfo.unitIndex):(this.writePrefix(e),this.outfile.WriteLine(t))},t.prototype.reportErrorFromSym=function(e,t){if(this.pushToErrorSink){this.captureError(t);return}this.hasErrors=!0,this.parser.errorRecovery&&this.parser.errorCallback?this.parser.errorCallback(e.location,1,t,this.checker.locationInfo.unitIndex):(this.writePrefixFromSym(e),this.outfile.WriteLine(t))},t.prototype.emitterError=function(e,t){throw this.reportError(e,t),Error("EmitError")},t.prototype.duplicateIdentifier=function(e,t){this.reportError(e,"Duplicate identifier '"+t+"'")},t.prototype.showRef=function(e,t,n){var r={line:-1,col:-1};this.parser.getSourceLineCol(r,n.location),this.reportError(e,"symbol "+t+" defined at ("+r.line+","+r.col+")")},t.prototype.unresolvedSymbol=function(e,t){this.reportError(e,"The name '"+t+"' does not exist in the current scope")},t.prototype.symbolDoesNotReferToAValue=function(e,t){this.reportError(e,"The name '"+t+"' does not refer to a value")},t.prototype.styleError=function(e,t){var n=this.pushToErrorSink;this.pushToErrorSink=!1,this.reportError(e,"STYLE: "+t),this.pushToErrorSink=n},t.prototype.simpleError=function(e,t){this.reportError(e,t)},t.prototype.simpleErrorFromSym=function(e,t){this.reportErrorFromSym(e,t)},t.prototype.invalidSuperReference=function(e){this.simpleError(e,"Keyword 'super' can only be used inside a class instance method")},t.prototype.valueCannotBeModified=function(e){this.simpleError(e,"The left-hand side of an assignment expression must be a variable, property or indexer")},t.prototype.invalidCall=function(t,n,r){var i=t.target.type,s=i.getScopedTypeName(r);if(i.construct&&n==e.NodeType.Call)this.reportError(t,"Value of type '"+s+"' is not callable.  Did you mean to include 'new'?");else{var o=n==e.NodeType.Call?"callable":"newable";this.reportError(t,"Value of type '"+s+"' is not "+o)}},t.prototype.indexLHS=function(e,t){var n=e.operand1.type.getScopedTypeName(t),r=e.operand2.type.getScopedTypeName(t);this.simpleError(e,"Value of type '"+n+"' is not indexable by type '"+r+"'")},t.prototype.incompatibleTypes=function(e,t,n,r,i,s){t||(t=this.checker.anyType),n||(n=this.checker.anyType);var o=s?s.message:"";r?this.reportError(e,"Operator '"+r+"' cannot be applied to types '"+t.getScopedTypeName(i)+"' and '"+n.getScopedTypeName(i)+"'"+(o?": "+o:"")):this.reportError(e,"Cannot convert '"+t.getScopedTypeName(i)+"' to '"+n.getScopedTypeName(i)+"'"+(o?": "+o:""))},t.prototype.expectedClassOrInterface=function(e){this.simpleError(e,"Expected var, class, interface, or module")},t.prototype.unaryOperatorTypeError=function(e,t,n){this.reportError(e,"Operator '"+t+"' cannot be applied to type '"+n.getTypeName()+"'")},t}();e.ErrorReporter=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(t,n,r,s,o,u){var a=r.getText(s,o);t.log("Quick parse range ("+s+","+o+'): "'+e.stringToLiteral(a,100)+'"');var f=new i;f.setErrorRecovery(null,-1,-1),f.errorCallback=u;var l=new e.TypeDecl(e.NodeType.Class,null,null,null,null,null);f.currentClassDecl=l;var c=f.quickParse(new e.StringSourceText(a),"",0);return c}(function(e){e._map=[],e.NoTypes=0,e.ArraySuffix=1,e.Primitive=2,e.Named=4,e.AllSimpleTypes=e.Primitive|e.Named,e.AllTypes=e.Primitive|e.Named|e.ArraySuffix})(e.TypeContext||(e.TypeContext={}));var t=e.TypeContext;(function(e){e._map=[],e._map[0]="None",e.None=0,e._map[1]="StartScript",e.StartScript=1,e._map[2]="StartStmtList",e.StartStmtList=2,e._map[3]="StartStatement",e.StartStatement=3,e._map[4]="StartFncDecl",e.StartFncDecl=4,e._map[5]="FncDeclName",e.FncDeclName=5,e._map[6]="FncDeclArgs",e.FncDeclArgs=6,e._map[7]="FncDeclReturnType",e.FncDeclReturnType=7,e._map[8]="ForInit",e.ForInit=8,e._map[9]="ForInitAfterVar",e.ForInitAfterVar=9,e._map[10]="ForCondStart",e.ForCondStart=10,e._map[11]="EndStmtList",e.EndStmtList=11,e._map[12]="EndScript",e.EndScript=12})(e.ParseState||(e.ParseState={}));var n=e.ParseState,r=function(){function e(e,t){this.Script=e,this.endLexState=t}return e}();e.QuickParseResult=r;var i=function(){function i(){this.varLists=[],this.scopeLists=[],this.staticsLists=[],this.scanner=new e.Scanner,this.tok=null,this.needTerminator=!1,this.inFnc=!1,this.inStaticFnc=!1,this.inInterfaceDecl=!1,this.currentClassDecl=null,this.inFncDecl=!1,this.anonId=new e.Identifier("_anonymous"),this.style_requireSemi=!1,this.style_funcInLoop=!0,this.incremental=!1,this.errorRecovery=!1,this.outfile=undefined,this.errorCallback=null,this.state=n.StartStmtList,this.cursorLine=-1,this.cursorColumn=-1,this.cursorState=n.None,this.errorMessage="",this.ambientModule=!1,this.ambientClass=!1,this.topLevel=!0,this.currentUnitIndex=-1,this.prevIDTok=null,this.stmtStack=new Array,this.hasTopLevelImportOrExport=!1,this.strictMode=!1,this.nestingLevel=0,this.prevExpr=null,this.currentClassDefinition=null,this.parsingClassConstructorDefinition=!1,this.parsingDeclareFile=!1,this.amdDependencies=[],this.inferPropertiesFromThisAssignment=!1,this.fname="",this.parseError=!1}return i.prototype.resetStmtStack=function(){this.stmtStack=new Array},i.prototype.inLoop=function(){for(var e=this.stmtStack.length-1;e>=0;e--)if(this.stmtStack[e].stmt.isLoop())return!0;return!1},i.prototype.pushStmt=function(e,t){var n={stmt:e,labels:t};this.stmtStack.push(n)},i.prototype.popStmt=function(){return this.stmtStack.pop()},i.prototype.resolveJumpTarget=function(t){var n=this.stmtStack.length;for(var r=n-1;r>=0;r--){var i=this.stmtStack[r];if(t.target){if(i.labels&&i.labels.members.length>0)for(var s=0,o=i.labels.members.length;s<o;s++){var u=i.labels.members[s];if(u.id.text==t.target){t.setResolvedTarget(this,i.stmt);return}}}else{if(i.stmt.isLoop()){t.setResolvedTarget(this,i.stmt);return}if(i.stmt.nodeType==e.NodeType.Switch&&t.nodeType==e.NodeType.Break){t.setResolvedTarget(this,i.stmt);return}}}t.target?this.reportParseError("could not find enclosing statement with label "+t.target):t.nodeType==e.NodeType.Break?this.reportParseError("break statement requires enclosing loop or switch"):this.reportParseError("continue statement requires enclosing loop")},i.prototype.setNonInteractive=function(){this.errorRecovery=!1},i.prototype.setErrorRecovery=function(e,t,r){this.outfile=e,this.cursorLine=t,this.cursorColumn=r,this.cursorState=n.None,this.errorRecovery=!0},i.prototype.posMatchesCursor=function(e){var t={line:-1,col:-1};return this.getSourceLineCol(t,e),t.line==this.cursorLine&&t.col==this.cursorColumn},i.prototype.getSourceLineCol=function(t,n){e.getSourceLineColFromMap(t,n,this.scanner.lineMap)},i.prototype.createRef=function(t,n){var r=new e.Identifier(t);return r.minChar=n,r},i.prototype.reportParseStyleError=function(e){this.reportParseError("STYLE: "+e)},i.prototype.reportParseError=function(e,t,n){typeof t=="undefined"&&(t=this.scanner.startPos),typeof n=="undefined"&&(n=this.scanner.pos);var r=Math.max(1,n-t);if(this.errorCallback)this.errorCallback(t,r,e,this.currentUnitIndex);else{if(!this.errorRecovery)throw new SyntaxError(this.fname+" ("+this.scanner.line+","+this.scanner.col+"): "+e);var i={line:-1,col:-1};this.getSourceLineCol(i,t),this.outfile&&this.outfile.WriteLine("// "+this.fname+" ("+i.line+","+i.col+"): "+e)}},i.prototype.chkNxtTok=function(e,t,n){this.tok=this.scanner.scan(),this.chkCurTok(e,t,n)},i.prototype.skip=function(t){t|=e.ErrorRecoverySet.EOF;var n=e.ErrorRecoverySet.None,r=e.lookupToken(this.tok.tokenId);r!=undefined&&(n=r.ers);var i=0;while((n&t)==e.ErrorRecoverySet.None||this.tok.tokenId==e.TokenID.RCurly&&i>0)this.tok.tokenId==e.TokenID.LCurly?i++:this.tok.tokenId==e.TokenID.RCurly&&i--,this.tok=this.scanner.scan(),n=e.ErrorRecoverySet.None,r=e.lookupToken(this.tok.tokenId),r!=undefined&&(n=r.ers)},i.prototype.chkCurTok=function(e,t,n){this.tok.tokenId!=e?(this.reportParseError(t),this.errorRecovery&&this.skip(n)):this.tok=this.scanner.scan()},i.prototype.pushDeclLists=function(){this.staticsLists.push(new e.ASTList),this.varLists.push(new e.ASTList),this.scopeLists.push(new e.ASTList)},i.prototype.popDeclLists=function(){this.staticsLists.pop(),this.varLists.pop(),this.scopeLists.pop()},i.prototype.topVarList=function(){return this.varLists[this.varLists.length-1]},i.prototype.topScopeList=function(){return this.scopeLists[this.scopeLists.length-1]},i.prototype.topStaticsList=function(){return this.staticsLists[this.staticsLists.length-1]},i.prototype.parseComment=function(t){if(t){var n=new e.Comment(t.value,t.isBlock,t.endsLine);n.minChar=t.startPos,n.limChar=t.startPos+t.value.length;if(!t.isBlock&&t.value.length>3&&t.value.substring(0,3)=="///"){var r=e.getAdditionalDependencyPath(t.value);r&&this.amdDependencies.push(r)}return n}return null},i.prototype.parseCommentsInner=function(e){if(e){var t=new Array;for(var n=0;n<e.length;n++)t.push(this.parseComment(e[n]));return t}return null},i.prototype.parseComments=function(){var e=this.scanner.getComments();return this.parseCommentsInner(e)},i.prototype.parseCommentsForLine=function(e){var t=this.scanner.getCommentsForLine(e);return this.parseCommentsInner(t)},i.prototype.combineComments=function(e,t){return e==null?t:t==null?e:e.concat(t)},i.prototype.parseEnumDecl=function(n,r){var i=this.scanner.leftCurlyCount,s=this.scanner.rightCurlyCount,o=null;this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)?(o=new e.Identifier(this.tok.getText()),o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("Enum declaration requires identifier"),this.errorRecovery&&(o=new e.MissingIdentifier,o.minChar=this.scanner.startPos,o.limChar=this.scanner.startPos,o.flags|=e.ASTFlags.Error));var u=this.scanner.startPos;this.chkCurTok(e.TokenID.LCurly,"Expected '{'",n|e.ErrorRecoverySet.ID),this.pushDeclLists();var a=new e.ASTList;a.minChar=u;var f=new e.VarDecl(new e.Identifier("_map"),0);f.varFlags|=e.VarFlags.Exported,f.varFlags|=e.VarFlags.Private,f.varFlags|=e.VarFlags.Property|e.VarFlags.Public,f.init=new e.UnaryExpression(e.NodeType.ArrayLit,null),a.append(f);var l=null;for(;;){var c=this.scanner.startPos,h,p=null,d=null,v=null,m=null;if(this.tok.tokenId==e.TokenID.ID||e.convertTokToIDName(this.tok))p=new e.Identifier(this.tok.getText()),p.minChar=this.scanner.startPos,p.limChar=this.scanner.pos;else{if(this.tok.tokenId==e.TokenID.RCurly)break;this.reportParseError("Expected identifer of enum member"),this.errorRecovery&&(p=new e.MissingIdentifier,p.minChar=this.scanner.startPos,p.limChar=this.scanner.startPos,p.flags|=e.ASTFlags.Error)}h=this.scanner.pos,v=this.parseComments(),this.tok=this.scanner.scan(),m=this.parseComments();if(this.tok.tokenId==e.TokenID.Asg)this.tok=this.scanner.scan(),d=this.parseExpr(n,e.OperatorPrecedence.Cma,!0,t.NoTypes),l=d,h=d.limChar;else{l==null?(d=new e.NumberLiteral(0),l=d):(d=new e.NumberLiteral(l.value+1),l=d);var g=new e.BinaryExpression(e.NodeType.Asg,new e.BinaryExpression(e.NodeType.Index,new e.Identifier("_map"),d),new e.StringLiteral('"'+p.text+'"'));a.append(g)}var y=new e.VarDecl(p,this.nestingLevel);y.minChar=c,y.limChar=h,y.init=d,y.typeExpr=new e.TypeReference(this.createRef(o.text,-1),0),y.varFlags|=e.VarFlags.Readonly|e.VarFlags.Property,d.nodeType==e.NodeType.NumberLit&&(y.varFlags|=e.VarFlags.Constant),y.preComments=v,a.append(y),y.postComments=m,y.varFlags|=e.VarFlags.Exported;if(this.tok.tokenId==e.TokenID.Comma){this.tok=this.scanner.scan(),y.postComments=this.combineComments(y.postComments,this.parseCommentsForLine(this.scanner.prevLine));if(this.tok.tokenId==e.TokenID.ID||e.convertTokToIDName(this.tok))continue}break}this.chkCurTok(e.TokenID.RCurly,"Expected '}'",n),a.limChar=this.scanner.lastTokenLimChar();var b=new e.ModuleDecl(o,a,this.topVarList(),this.topScopeList());return b.modFlags|=e.ModuleFlags.IsEnum,this.popDeclLists(),b.leftCurlyCount=this.scanner.leftCurlyCount-i,b.rightCurlyCount=this.scanner.rightCurlyCount-s,b},i.prototype.parseDottedName=function(t){this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)){var n=new e.Identifier(this.tok.getText());n.preComments=this.parseComments(),t[t.length]=n,n.minChar=this.scanner.startPos,n.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.Dot&&this.parseDottedName(t)}else this.reportParseError("need identifier after '.'")},i.prototype.isValidImportPath=function(t){return t=e.stripQuotes(t),!t||t.indexOf(":")!=-1||t.indexOf("\\")!=-1||t.charAt(0)=="/"?!1:!0},i.prototype.parseImportDecl=function(n,r){var i=null,s=null,o=null,u=this.scanner.startPos,a=!1;this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)?i=new e.Identifier(this.tok.getText()):(this.reportParseError("Expected identifer after 'import'"),i=new e.MissingIdentifier),i.minChar=this.scanner.startPos,i.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.chkCurTok(e.TokenID.Asg,"Expected =",n|e.ErrorRecoverySet.ID);var f=this.parseComments(),l;if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))if(this.tok.tokenId==e.TokenID.MODULE){l=this.scanner.pos,this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.LParen){this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.QString||this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))if(this.tok.tokenId==e.TokenID.QString){this.topLevel&&(this.hasTopLevelImportOrExport=!0);var c=this.tok.getText();this.isValidImportPath(c)||this.reportParseError("Invalid import path"),s=new e.Identifier(c),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos,a=!0,this.tok=this.scanner.scan(),s.preComments=f}else s=this.parseExpr(n|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.Asg,!0,t.NoTypes),s.preComments=f;l=this.scanner.pos,this.chkCurTok(e.TokenID.RParen,"Expected ')'",n|e.ErrorRecoverySet.ID),s&&(s.postComments=this.parseComments()),this.tok.tokenId==e.TokenID.SColon&&(l=this.scanner.pos,this.tok=this.scanner.scan())}}else s=this.parseExpr(n|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.Asg,!0,t.NoTypes),l=this.scanner.pos;else this.reportParseError("Expected module name"),s=new e.MissingIdentifier,s.minChar=this.scanner.startPos,s.limChar=this.scanner.startPos,s.flags|=e.ASTFlags.Error,l=s.limChar;return o=new e.ImportDecl(i,s),o.isDynamicImport=a,e.hasFlag(r,e.Modifiers.Exported)&&(o.varFlags|=e.VarFlags.Exported),o.minChar=u,o.limChar=l,o},i.prototype.parseModuleDecl=function(t,n){var r=this.scanner.leftCurlyCount,i=this.scanner.rightCurlyCount,s=this.ambientModule,o=this.topLevel;this.topLevel=!1;if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient))this.ambientModule=!0;this.tok=this.scanner.scan();var u=null,a=null;this.pushDeclLists();var f=this.parseComments(),l=this.scanner.startPos,c=!1;if(this.tok.tokenId==e.TokenID.ID||this.tok.tokenId==e.TokenID.QString||e.convertTokToID(this.tok,this.strictMode)){var h=this.tok.getText();this.tok.tokenId==e.TokenID.QString&&(c=!0,this.ambientModule||this.reportParseError("Only ambient dynamic modules may have string literal names")),u=new e.Identifier(h),u.minChar=this.scanner.startPos,u.limChar=this.scanner.pos,this.tok=this.scanner.scan()}else this.tok.tokenId==e.TokenID.LCurly&&(this.reportParseError("Module name missing"),u=new e.Identifier(""),u.minChar=l,u.limChar=l);this.tok.tokenId==e.TokenID.Dot&&(a=new Array,this.parseDottedName(a)),u==null&&(u=new e.MissingIdentifier);var p=new e.ASTList,d=this.scanner.startPos;this.chkCurTok(e.TokenID.LCurly,"Expected '{'",t|e.ErrorRecoverySet.ID),this.parseStmtList(t|e.ErrorRecoverySet.RCurly,p,!0,!0,e.AllowedElements.ModuleMembers,n),p.minChar=d,p.limChar=this.scanner.pos,this.chkCurTok(e.TokenID.RCurly,"Expected '}'",t);var v=this.scanner.pos,m;if(a&&a.length>0){var g=a.length,y=a[g-1],b=new e.ModuleDecl(y,p,this.topVarList(),this.topScopeList());if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient))b.modFlags|=e.ModuleFlags.Ambient;b.modFlags|=e.ModuleFlags.Exported,b.minChar=l,b.limChar=v,this.popDeclLists();var w;for(var E=g-2;E>=0;E--){w=new e.ASTList,w.append(b),y=a[E],b=new e.ModuleDecl(y,w,new e.ASTList,new e.ASTList),w.minChar=b.minChar=l,w.limChar=b.limChar=v;if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient))b.modFlags|=e.ModuleFlags.Ambient;b.modFlags|=e.ModuleFlags.Exported}w=new e.ASTList,w.append(b),w.minChar=l,w.limChar=v,m=new e.ModuleDecl(u,w,new e.ASTList,new e.ASTList)}else m=new e.ModuleDecl(u,p,this.topVarList(),this.topScopeList()),this.popDeclLists();if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Ambient))m.modFlags|=e.ModuleFlags.Ambient;return e.hasFlag(n,e.Modifiers.Exported)&&(m.modFlags|=e.ModuleFlags.Exported),c&&(m.modFlags|=e.ModuleFlags.IsDynamic),m.preComments=f,m.postComments=this.parseComments(),this.ambientModule=s,this.topLevel=o,m.leftCurlyCount=this.scanner.leftCurlyCount-r,m.rightCurlyCount=this.scanner.rightCurlyCount-i,m},i.prototype.parseTypeReferenceTail=function(t,n,r){var i=new e.TypeReference(r,0);i.minChar=n;while(this.tok.tokenId==e.TokenID.LBrack)this.tok=this.scanner.scan(),i.arrayCount++,this.chkCurTok(e.TokenID.RBrack,"Expected ']'",t|e.ErrorRecoverySet.LBrack);return i.limChar=this.scanner.lastTokenLimChar(),i},i.prototype.parseNamedType=function(t,n,r,i){this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.Dot){var s=this.scanner.pos;this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)){var o=new e.Identifier(this.tok.getText());o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos;var u=new e.BinaryExpression(e.NodeType.Dot,r,o);return u.minChar=r.minChar,u.limChar=o.limChar,this.parseNamedType(t,n,u,i)}this.reportParseError("need identifier after '.'");if(this.errorRecovery)return r.flags|=e.ASTFlags.DotLHS,r.limChar=this.scanner.lastTokenLimChar(),r;var a=new e.MissingIdentifier;a.minChar=this.scanner.pos,a.limChar=this.scanner.pos;var f=new e.BinaryExpression(e.NodeType.Dot,r,a);return f.flags|=e.ASTFlags.Error,f.minChar=r.minChar,f.limChar=a.limChar,this.parseNamedType(t,n,f,i)}return i?this.parseTypeReferenceTail(t,n,r):r},i.prototype.parseTypeReference=function(t,n){var r=this.scanner.startPos,i=!1;switch(this.tok.tokenId){case e.TokenID.VOID:n||this.reportParseError("void not a valid type in this context");case e.TokenID.NUMBER:case e.TokenID.BOOL:case e.TokenID.ANY:case e.TokenID.STRING:var s=e.tokenTable[this.tok.tokenId].text,o=new e.Identifier(s);return o.minChar=r,o.limChar=this.scanner.pos,this.tok=this.scanner.scan(),this.parseTypeReferenceTail(t,r,o);case e.TokenID.ID:var u=this.createRef(this.tok.getText(),r);return u.limChar=this.scanner.pos,this.parseNamedType(t,r,u,!0);case e.TokenID.LCurly:this.tok=this.scanner.scan();var a=new e.ASTList;a.minChar=r;var f=this.inInterfaceDecl;this.inInterfaceDecl=!0,this.parseInterfaceMembers(t|e.ErrorRecoverySet.RCurly,a),this.inInterfaceDecl=f,this.chkCurTok(e.TokenID.RCurly,"Expected '}'",t);var l=new e.TypeDecl(e.NodeType.Interface,this.anonId,a,null,null,null);return l.minChar=r,l.limChar=a.limChar,this.parseTypeReferenceTail(t,r,l);case e.TokenID.NEW:this.tok=this.scanner.scan(),this.tok.tokenId!=e.TokenID.LParen?this.reportParseError("Expected '('"):i=!0;case e.TokenID.LParen:var c=new e.ASTList,h=this.parseFormalParameterList(t|e.ErrorRecoverySet.RParen,c,!1,!0,!1,!1,!1,null);this.chkCurTok(e.TokenID.Arrow,"Expected '=>'",t);var p=this.parseTypeReference(t,!0),d=new e.FuncDecl(null,null,!1,c,null,null,null,e.NodeType.FuncDecl);return d.returnTypeAnnotation=p,d.variableArgList=h,d.fncFlags|=e.FncFlags.Signature,i&&(d.fncFlags|=e.FncFlags.ConstructMember,d.hint="_construct",d.classDecl=null),d.minChar=r,this.parseTypeReferenceTail(t,r,d);default:this.reportParseError("Expected type name");var v=new e.TypeReference(null,0);return v.flags|=e.ASTFlags.Error,v.minChar=this.scanner.pos,v.limChar=this.scanner.pos,v}},i.prototype.parseFunctionStatements=function(r,i,s,o,u,a,f,l,c){this.pushDeclLists();var h=this.stmtStack;this.resetStmtStack();var p=null,d=!1,v=!1;if(!l){p=new e.ASTList;var m=this.scanner.startPos;this.tok.tokenId==e.TokenID.Arrow&&(o&&this.reportParseError("'=>' may not be used for class methods"),d=!0,this.tok=this.scanner.scan());if(d&&this.tok.tokenId!=e.TokenID.LCurly){var g=this.parseExpr(r|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.Asg,!0,t.NoTypes),y=new e.ReturnStatement;y.returnExpression=g,p.minChar=m,p.append(y)}else{this.state=n.StartStmtList,this.chkCurTok(e.TokenID.LCurly,"Expected '{'",r|e.ErrorRecoverySet.StmtStart);var b=this.inFnc;v=d,this.inFnc=!0,this.parseStmtList(r|e.ErrorRecoverySet.RCurly|e.ErrorRecoverySet.StmtStart,p,!0,!1,a,c),p.minChar=m,p.limChar=this.scanner.pos,this.inFnc=b;var w=new e.EndCode;w.minChar=p.limChar,w.limChar=w.minChar,p.append(w)}}var E=new e.FuncDecl(i,p,s,u,this.topVarList(),this.topScopeList(),this.topStaticsList(),e.NodeType.FuncDecl);this.popDeclLists();var S=this.topScopeList();S.append(E);var x=!1,T=this.scanner.pos;return l?this.chkCurTok(e.TokenID.SColon,"Expected ';'",r):!d||v?(this.chkCurTok(e.TokenID.RCurly,"Expected '}'",r),v&&(E.fncFlags|=e.FncFlags.IsFatArrowFunction)):(E.fncFlags|=e.FncFlags.IsFatArrowFunction,this.tok.tokenId==e.TokenID.SColon&&(this.tok=this.scanner.scan())),E.minChar=f,E.limChar=T,l||(E.fncFlags|=e.FncFlags.Definition),this.stmtStack=h,E},i.prototype.transformAnonymousArgsIntoFormals=function(t,n){var r=this,i=function(n){if(n.nodeType==e.NodeType.Comma)r.transformAnonymousArgsIntoFormals(t,n);else if(n.nodeType==e.NodeType.Name||n.nodeType==e.NodeType.Asg){var i=n.nodeType==e.NodeType.Asg?n.operand1:n,s=new e.ArgDecl(i);s.preComments=i.preComments,s.postComments=i.postComments,s.minChar=i.minChar,s.limChar=i.limChar,e.hasFlag(i.flags,e.ASTFlags.PossibleOptionalParameter)&&(s.isOptional=!0),n.nodeType==e.NodeType.Asg&&(s.init=n.operand2),t.append(s)}else r.reportParseError("Invalid lambda argument")};if(n)if(n.nodeType==e.NodeType.Comma){var s=n;i(s.operand1),i(s.operand2)}else i(n)},i.prototype.parseFormalParameterList=function(n,r,i,s,o,u,a,f){r.minChar=this.scanner.startPos,o?this.tok=this.scanner.scan():f||this.chkCurTok(e.TokenID.LParen,"Expected '('",n|e.ErrorRecoverySet.RParen);var l=!1,c=!0,h=!1,p=!1,d=!1;f&&(this.transformAnonymousArgsIntoFormals(r,f),p=!0);for(;;){var v=!1,m=e.VarFlags.None,g=this.scanner.startPos;this.inferPropertiesFromThisAssignment&&this.tok.tokenId==e.TokenID.THIS&&(i||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.tok=this.scanner.scan(),m|=e.VarFlags.Public|e.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor)),this.tok.tokenId==e.TokenID.PUBLIC?(m|=e.VarFlags.Public|e.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor)):this.tok.tokenId==e.TokenID.PRIVATE&&(m|=e.VarFlags.Private|e.VarFlags.Property,this.currentClassDefinition&&(this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor)),m!=e.VarFlags.None?(i||this.reportParseError("only constructor parameters can be properties"),this.tok=this.scanner.scan(),this.inferPropertiesFromThisAssignment&&this.tok.tokenId==e.TokenID.THIS&&(i||this.reportParseError("Instance property declarations using 'this' may only be used in class constructors"),this.tok=this.scanner.scan(),this.tok=this.scanner.scan())):this.tok.tokenId==e.TokenID.Ellipsis&&(l=!0,this.tok=this.scanner.scan());var y=null;if(!p&&this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))y=new e.Identifier(this.tok.getText()),y.minChar=this.scanner.startPos,y.limChar=this.scanner.pos;if(p||y){v=!0;var b=null,w=null;p&&r.members.length?(w=r.members[r.members.length-1],w.isOptional&&(h=!0,d=!0)):(w=new e.ArgDecl(y),u&&this.reportParseError("Property getters may not take any arguments"),a&&!c&&this.reportParseError("Property setters may only take one argument"),w.minChar=g,w.preComments=this.parseComments(),this.tok=this.scanner.scan()),this.tok.tokenId==e.TokenID.QMark&&(w.isOptional=!0,h=!0,this.tok=this.scanner.scan()),this.tok.tokenId==e.TokenID.Colon&&(this.tok=this.scanner.scan(),b=this.parseTypeReference(n,!1),f&&(d=!0)),this.tok.tokenId==e.TokenID.Asg&&(s&&this.reportParseError("Arguments in signatures may not have default values"),h=!0,this.tok=this.scanner.scan(),w.init=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Cma,!1,t.NoTypes)),h&&!w.isOptionalArg()&&!l&&this.reportParseError("Optional parameters may only be followed by other optional parameters"),l&&w.isOptionalArg()&&this.reportParseError("Varargs may not be optional or have default parameters"),w.postComments=this.parseComments(),w.typeExpr=b,w.limChar=this.scanner.lastTokenLimChar(),w.varFlags|=m,p?p=!1:r.append(w)}c=!1;if(this.tok.tokenId!=e.TokenID.Comma)break;if(v&&!l){this.tok=this.scanner.scan();continue}this.reportParseError("Unexpected ',' in argument list");if(this.errorRecovery){this.tok=this.scanner.scan();continue}}return o?this.chkCurTok(e.TokenID.RBrack,"Expected ']'",n|e.ErrorRecoverySet.LCurly|e.ErrorRecoverySet.SColon):(!f||d)&&this.chkCurTok(e.TokenID.RParen,"Expected ')'",n|e.ErrorRecoverySet.LCurly|e.ErrorRecoverySet.SColon),r.limChar=this.scanner.lastTokenLimChar(),l},i.prototype.parseFncDecl=function(t,r,i,s,o,u,a,f,l,c){var h=this.scanner.leftCurlyCount,p=this.scanner.rightCurlyCount,d=this.parsingClassConstructorDefinition;this.parsingClassConstructorDefinition=!1;var v=null,m=this.scanner.startPos,g=this.scanner.pos,y=this.nestingLevel;this.nestingLevel=0,!this.style_funcInLoop&&this.inLoop()&&this.reportParseStyleError("function declaration in loop");if(!s&&!a&&!u&&!c){this.tok=this.scanner.scan(),this.state=n.StartFncDecl;if(this.tok.tokenId!=e.TokenID.ID&&!e.convertTokToID(this.tok,this.strictMode)){if(r)return this.reportParseError("Function declaration must include identifier"),this.nestingLevel=y,new e.IncompleteAST(m,this.scanner.pos)}else v=new e.Identifier(this.tok.getText()),v.minChar=this.scanner.startPos,v.limChar=this.scanner.pos,this.tok=this.scanner.scan()}else o&&(v=o);this.state=n.FncDeclName;var b=new e.ASTList,w=!1,E=!1,S=e.hasFlag(l,e.Modifiers.Getter),x=e.hasFlag(l,e.Modifiers.Setter);if(this.tok.tokenId==e.TokenID.LParen||u&&this.tok.tokenId==e.TokenID.LBrack||c&&c.preProcessedLambdaArgs)w=this.parseFormalParameterList(t,b,!1,i,u,S,x,c?c.preProcessedLambdaArgs:null);this.state=n.FncDeclArgs;var T=null;this.tok.tokenId==e.TokenID.Colon&&(this.tok=this.scanner.scan(),e.hasFlag(l,e.Modifiers.Setter)&&this.reportParseError("Property setters may not declare a return type"),T=this.parseTypeReference(t,!0)),u&&b.members.length==0&&this.reportParseError("Index signatures require a parameter type to be specified"),this.state=n.FncDeclReturnType,r&&!this.parsingDeclareFile&&!f&&(!s||!(this.ambientModule||this.ambientClass||this.inInterfaceDecl))&&this.tok.tokenId==e.TokenID.SColon&&(E=!0,r=!1,i=!0);var N=this.inFncDecl;this.inFncDecl=!0;var C=this.parseFunctionStatements(t|e.ErrorRecoverySet.RCurly,v,!1,s,b,e.AllowedElements.FunctionBody,g,i,e.Modifiers.None);return this.inFncDecl=N,C.variableArgList=w,C.isOverload=E,i||(C.fncFlags|=e.FncFlags.Definition),a&&(C.fncFlags|=e.FncFlags.Static),i&&(C.fncFlags|=e.FncFlags.Signature),u&&(C.fncFlags|=e.FncFlags.IndexerMember),C.returnTypeAnnotation=T,s&&(C.fncFlags|=e.FncFlags.Method,C.fncFlags|=e.FncFlags.ClassPropertyMethodExported),C.leftCurlyCount=this.scanner.leftCurlyCount-h,C.rightCurlyCount=this.scanner.rightCurlyCount-p,this.nestingLevel=y,this.parsingClassConstructorDefinition=d,C},i.prototype.convertToTypeReference=function(t){var n;switch(t.nodeType){case e.NodeType.TypeRef:return t;case e.NodeType.Name:return n=new e.TypeReference(t,0),n.minChar=t.minChar,n.limChar=t.limChar,n;case e.NodeType.Index:var r=t;n=this.convertToTypeReference(r.operand1);if(n)return n.arrayCount++,n.minChar=r.minChar,n.limChar=r.limChar,n;var i=new e.AST(e.NodeType.Error);return i}return null},i.prototype.parseArgList=function(n){var r=new e.ASTList;r.minChar=this.scanner.startPos,this.tok=this.scanner.scan();if(this.tok.tokenId!==e.TokenID.RParen)for(;;){if(r.members.length>65535){this.reportParseError("max number of args exceeded");break}var i=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Cma,!1,t.NoTypes);r.append(i);if(this.tok.tokenId!=e.TokenID.Comma)break;this.tok=this.scanner.scan()}return r.limChar=this.scanner.pos,r},i.prototype.parseBaseList=function(t,n,r,i,s){var o=!0,u=t;for(;;){o&&(this.tok.tokenId==e.TokenID.IMPLEMENTS&&(i&&this.reportParseError("interfaces can not implement other types"),u=n),this.tok=this.scanner.scan(),o=!1);var a=null;if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)){var f=this.scanner.startPos;a=new e.Identifier(this.tok.getText()),a.minChar=f,a.limChar=this.scanner.pos,a=this.parseNamedType(r|e.ErrorRecoverySet.LCurly,f,a,!1)}else this.reportParseError("Expected base name"),this.errorRecovery&&(a=new e.MissingIdentifier,a.minChar=this.scanner.pos,a.limChar=this.scanner.pos,a.flags|=e.ASTFlags.Error);if(this.tok.tokenId==e.TokenID.LParen){s&&this.reportParseError("Base classes may only be initialized via a 'super' call within the constructor body");var l=this.parseArgList(r|e.ErrorRecoverySet.RParen),c=new e.CallExpression(e.NodeType.Call,a,l);this.tok=this.scanner.scan(),c.limChar=this.scanner.pos,u.append(c)}else u.append(a);!i&&u==t&&t.members.length>1&&this.reportParseError("A class may only extend one other class");if(this.tok.tokenId==e.TokenID.Comma){this.tok=this.scanner.scan();continue}if(this.tok.tokenId==e.TokenID.EXTENDS||this.tok.tokenId==e.TokenID.IMPLEMENTS){u=t,o=!0;continue}break}},i.prototype.parseClassDecl=function(t,n,r){var i=this.scanner.leftCurlyCount,s=this.scanner.rightCurlyCount;(r&e.Modifiers.Readonly)!=e.Modifiers.None&&this.reportParseError("const modifier is implicit for class");if(this.parsingDeclareFile||this.ambientModule)r|=e.Modifiers.Ambient,r|=e.Modifiers.Exported;var o=this.parsingDeclareFile||(r&e.Modifiers.Ambient)!=e.Modifiers.None,u=this.ambientClass;this.ambientClass=o,this.tok=this.scanner.scan();var a=null;this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)?(a=new e.Identifier(this.tok.getText()),a.minChar=this.scanner.startPos,a.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("class missing name"),this.errorRecovery&&(a=new e.MissingIdentifier,a.minChar=this.scanner.pos,a.limChar=this.scanner.pos,a.flags|=e.ASTFlags.Error));var f=null,l=null,c=!1;if(this.tok.tokenId==e.TokenID.EXTENDS||this.tok.tokenId==e.TokenID.IMPLEMENTS)f=new e.ASTList,l=new e.ASTList,this.parseBaseList(f,l,t,!1,!0);var h=new e.ClassDecl(a,new e.ASTList,f,l);this.currentClassDefinition=h,this.parseClassElements(h,t,r);if(this.ambientModule||this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Exported))h.varFlags|=e.VarFlags.Exported;if(this.ambientModule||e.hasFlag(r,e.Modifiers.Ambient))h.varFlags|=e.VarFlags.Ambient;return h.varFlags|=e.VarFlags.Class,this.ambientClass=u,h.leftCurlyCount=this.scanner.leftCurlyCount-i,h.rightCurlyCount=this.scanner.rightCurlyCount-s,h},i.prototype.parseClassElements=function(t,n,r){var i=r,s=!1,o=this.scanner.startPos;this.chkCurTok(e.TokenID.LCurly,"Expected '{'",n),this.nestingLevel++;var u=this.scanner.startPos,a=!1;while(this.tok.tokenId!=e.TokenID.RCurly&&this.tok.tokenId!=e.TokenID.EOF){var f=!0,l=e.Modifiers.Public|e.Modifiers.Private;if(this.tok.tokenId==e.TokenID.GET)i&e.Modifiers.Getter&&this.reportParseError("Duplicate 'get' declaration in class body"),i&e.Modifiers.Setter&&this.reportParseError("Getter already marked as a setter"),i|=e.Modifiers.Getter;else if(this.tok.tokenId==e.TokenID.SET)i&e.Modifiers.Setter&&this.reportParseError("Duplicate 'set' declaration in class body"),i&e.Modifiers.Getter&&this.reportParseError("Setter already marked as a getter"),i|=e.Modifiers.Setter;else if(this.tok.tokenId==e.TokenID.PRIVATE)i&l&&this.reportParseError("Multiple modifiers may not be applied to class members"),i|=e.Modifiers.Private;else if(this.tok.tokenId==e.TokenID.PUBLIC)i&l&&this.reportParseError("Multiple modifiers may not be applied to class members"),i|=e.Modifiers.Public;else if(this.tok.tokenId==e.TokenID.STATIC)i&e.Modifiers.Static&&this.reportParseError("Multiple modifiers may not be applied to class members"),i|=e.Modifiers.Static;else if(this.tok.tokenId==e.TokenID.CONSTRUCTOR)i!=r&&this.reportParseError("Constructors may not have modifiers"),this.parseClassConstructorDeclaration(u,n,i),f=!1,s=!0;else if(a||this.tok.tokenId==e.TokenID.ID||e.convertTokToIDName(this.tok)){var c=a?i&e.Modifiers.Getter?"get":"set":this.tok.getText(),h=new e.Identifier(c);h.minChar=this.scanner.startPos,h.limChar=this.scanner.pos,a?(i^=i&e.Modifiers.Getter?e.Modifiers.Getter:e.Modifiers.Setter,a=!1):this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.LParen)this.parseClassMemberFunctionDeclaration(h,u,n,i),f=!1;else{(i&e.Modifiers.Getter||i&e.Modifiers.Setter)&&this.reportParseError("Property accessors must be functions");var p=this.parseClassMemberVariableDeclaration(h,u,!1,n,i);p.init&&p.init.nodeType==e.NodeType.FuncDecl?this.tok.tokenId==e.TokenID.RCurly&&(f=!1):p.init&&p.init.nodeType==e.NodeType.ObjectLit&&this.tok.tokenId!=e.TokenID.SColon?(f=!1,p.init.flags|=e.ASTFlags.AutomaticSemicolon):this.tok.tokenId!=e.TokenID.SColon&&(this.reportParseError("Expected ';'"),f=!1)}s=!0}else this.tok.tokenId==e.TokenID.SUPER?this.reportParseError("Base class initializers must be the first statement in a class definition"):!a&&(i&e.Modifiers.Getter||i&e.Modifiers.Setter)&&this.tok.tokenId==e.TokenID.LParen||this.tok.tokenId==e.TokenID.Asg?(a=!0,f=!1):this.tok.tokenId!=e.TokenID.SColon&&(this.reportParseError("Unexpected '"+this.tok.getText()+"' in class definition"),s=!0);f&&(this.tok=this.scanner.scan()),s&&(i=r,u=this.scanner.startPos,s=!1)}var d=this.scanner.pos;this.tok.tokenId==e.TokenID.RCurly&&(this.currentClassDefinition.definitionMembers.members.length||(this.currentClassDefinition.preComments=this.parseComments()),this.tok=this.scanner.scan()),this.nestingLevel--,this.currentClassDefinition.members.minChar=o,this.currentClassDefinition.members.limChar=d,this.currentClassDefinition.limChar=d,this.currentClassDefinition=null},i.prototype.parseClassConstructorDeclaration=function(t,n,r){this.parsingClassConstructorDefinition=!0;var i=this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient),s=new e.ASTList,o=!1,u=this.parseComments();this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.LParen){o=this.parseFormalParameterList(n,s,!0,i,!1,!1,!1,null);if(s.members.length>0)var a=s.members[s.members.length-1]}var f=i||this.tok.tokenId==e.TokenID.SColon;if(f)for(var l=0;l<s.members.length;l++){var c=s.members[l];e.hasFlag(c.varFlags,e.VarFlags.Property)&&this.reportParseError("Overload or ambient signatures may not specify parameter properties")}f||(this.currentClassDefinition.constructorNestingLevel=this.nestingLevel+1);var h=this.parseFunctionStatements(n|e.ErrorRecoverySet.RCurly,this.currentClassDefinition.name,!0,!1,s,e.AllowedElements.ClassMembers,t,f,r);h.preComments=u,f&&!i&&(h.isOverload=!0),h.variableArgList=o,this.currentClassDecl=null,h.returnTypeAnnotation=this.convertToTypeReference(this.currentClassDefinition.name),h.classDecl=this.currentClassDefinition,i&&(h.fncFlags|=e.FncFlags.Ambient),f&&(h.fncFlags|=e.FncFlags.Signature);if(this.ambientModule||e.hasFlag(r,e.Modifiers.Exported))h.fncFlags|=e.FncFlags.Exported;this.currentClassDefinition.constructorDecl&&!i&&!this.currentClassDefinition.constructorDecl.isSignature()&&!h.isSignature()&&this.reportParseError("Duplicate constructor definition");if(i||!h.isSignature())this.currentClassDefinition.constructorDecl=h;return h.fncFlags|=e.FncFlags.ClassMethod,this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=h,this.parsingClassConstructorDefinition=!1,h.postComments=this.parseComments(),h},i.prototype.parseClassMemberVariableDeclaration=function(n,r,i,s,o){var u=new e.VarDecl(n,this.nestingLevel);u.minChar=r;var a=!1;u.preComments=this.parseComments(),this.tok.tokenId==e.TokenID.Colon&&(this.tok=this.scanner.scan(),u.typeExpr=this.parseTypeReference(s|e.ErrorRecoverySet.Asg|e.ErrorRecoverySet.Comma,!1));if(this.tok.tokenId==e.TokenID.Asg){if(this.parsingDeclareFile||e.hasFlag(o,e.Modifiers.Ambient)){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery)return this.skip(s),u.flags|=e.ASTFlags.Error,u.limChar=this.scanner.lastTokenLimChar(),u}this.tok=this.scanner.scan(),u.init=this.parseExpr(e.ErrorRecoverySet.Comma|s,e.OperatorPrecedence.Cma,!0,t.NoTypes),u.limChar=u.init.limChar,this.currentClassDefinition.varFlags|=e.VarFlags.ClassSuperMustBeFirstCallInConstructor}else u.limChar=this.scanner.pos;return o&e.Modifiers.Static&&(u.varFlags|=e.VarFlags.Static,a=!0),(o&e.Modifiers.Private)!=e.Modifiers.None?u.varFlags|=e.VarFlags.Private:u.varFlags|=e.VarFlags.Public,u.varFlags|=e.VarFlags.Property,i&&(u.varFlags|=e.VarFlags.ClassConstructorProperty),!i&&!a&&(u.varFlags|=e.VarFlags.ClassBodyProperty),this.currentClassDefinition.knownMemberNames[n.text]=!0,i||(this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=u),this.currentClassDefinition.allMemberDefinitions.members[this.currentClassDefinition.allMemberDefinitions.members.length]=u,u.postComments=this.parseComments(),u},i.prototype.parseClassMemberFunctionDeclaration=function(t,n,r,i){var s=this.prevIDTok!=null,o=e.hasFlag(i,e.Modifiers.Getter)||e.hasFlag(i,e.Modifiers.Setter),u=e.hasFlag(i,e.Modifiers.Static),a=this.ambientModule||e.hasFlag(i,e.Modifiers.Ambient);r|=e.ErrorRecoverySet.RParen;var f=this.parseComments();o&&i&e.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient classes");var l=this.parseFncDecl(r,!0,a,!0,t,!1,u,a,i,null);if(l.nodeType==e.NodeType.Error)return l;var c=l;return c.preComments=f,c.minChar=n,c.bod!==null&&(c.limChar=c.bod.limChar),i&e.Modifiers.Private?c.fncFlags|=e.FncFlags.Private:c.fncFlags|=e.FncFlags.Public,u&&(c.fncFlags|=e.FncFlags.Static),o&&(e.hasFlag(i,e.Modifiers.Getter)?(c.fncFlags|=e.FncFlags.GetAccessor,c.hint="get"+c.name.text):(c.fncFlags|=e.FncFlags.SetAccessor,c.hint="set"+c.name.text),c.fncFlags|=e.FncFlags.IsFunctionExpression,e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")),c.fncFlags|=e.FncFlags.ClassMethod,this.currentClassDefinition.knownMemberNames[t.text]=!0,this.currentClassDefinition.definitionMembers.members[this.currentClassDefinition.definitionMembers.members.length]=c,c.postComments=this.parseComments(),c},i.prototype.parseInterfaceMember=function(t){var n=this.scanner.startPos,r=this.parsePropertyDecl(t,e.Modifiers.Public,!0,!1);return r.nodeType==e.NodeType.VarDecl&&this.chkCurTok(e.TokenID.SColon,"Expected ';'",t),r&&(r.minChar=n),r},i.prototype.parseInterfaceMembers=function(t,n){for(;;){switch(this.tok.tokenId){case e.TokenID.RCurly:case e.TokenID.EOF:n.limChar=this.scanner.pos;return}var r=this.parseInterfaceMember(t|e.ErrorRecoverySet.TypeScriptS);r&&n.append(r)}},i.prototype.parseInterfaceDecl=function(t,n){var r=this.scanner.leftCurlyCount,i=this.scanner.rightCurlyCount;this.tok=this.scanner.scan();var s=this.scanner.pos,o=null;this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)?(o=new e.Identifier(this.tok.getText()),o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,this.tok=this.scanner.scan()):(this.reportParseError("interface missing name"),this.errorRecovery&&(o=new e.MissingIdentifier,o.minChar=this.scanner.pos,o.limChar=this.scanner.pos,o.flags|=e.ASTFlags.Error));var u=null;this.tok.tokenId==e.TokenID.EXTENDS&&(u=new e.ASTList,u.minChar=this.scanner.startPos,this.parseBaseList(u,null,t,!0,!1));var a=this.scanner.startPos;this.chkCurTok(e.TokenID.LCurly,"Expected '{'",t|e.ErrorRecoverySet.TypeScriptS);var f=new e.ASTList;f.minChar=a;var l=this.inInterfaceDecl;this.inInterfaceDecl=!0,this.parseInterfaceMembers(t|e.ErrorRecoverySet.RCurly,f),this.inInterfaceDecl=l,this.chkCurTok(e.TokenID.RCurly,"Expected '}'",t);var c=new e.TypeDecl(e.NodeType.Interface,o,f,null,u,null);e.hasFlag(n,e.Modifiers.Private)&&(c.varFlags|=e.VarFlags.Private),e.hasFlag(n,e.Modifiers.Public)&&(c.varFlags|=e.VarFlags.Public);if(this.parsingDeclareFile||e.hasFlag(n,e.Modifiers.Exported))c.varFlags|=e.VarFlags.Exported;return c.leftCurlyCount=this.scanner.leftCurlyCount-r,c.rightCurlyCount=this.scanner.rightCurlyCount-i,c},i.prototype.makeVarDecl=function(t,n){var r=new e.VarDecl(t,n),i=this.topVarList();return i&&i.append(r),r},i.prototype.parsePropertyDecl=function(n,r,i,s){var o=null,u=this.scanner.startPos,a=u,f=!1,l=!1,c=this.prevIDTok!=null,h=e.hasFlag(r,e.Modifiers.Getter)||e.hasFlag(r,e.Modifiers.Setter);if(this.parsingDeclareFile||this.ambientModule||e.hasFlag(r,e.Modifiers.Ambient))i=!0;if(this.tok.tokenId==e.TokenID.LParen&&!c)!i&&!s&&(this.reportParseError("Expected identifier in property declaration"),this.errorRecovery&&(this.skip(n),o=new e.MissingIdentifier));else if(this.tok.tokenId==e.TokenID.NEW)i&&(this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.LParen&&(f=!0)),f||(i||(this.tok=this.scanner.scan()),o=new e.Identifier("new"),o.minChar=this.scanner.pos-3,o.limChar=this.scanner.pos,a=this.scanner.pos);else if(this.tok.tokenId==e.TokenID.LBrack&&i)l=!0,o=new e.Identifier("__item");else if(this.tok.tokenId!=e.TokenID.ID&&!e.convertTokToIDName(this.tok)&&!c){this.reportParseError("Expected identifier in property declaration");if(this.errorRecovery){var p=this.scanner.startPos,d=this.scanner.pos;this.skip(n&~e.ErrorRecoverySet.Comma),this.scanner.pos==d&&(this.tok=this.scanner.scan());var v=new e.VarDecl(new e.MissingIdentifier,this.nestingLevel);return v.flags|=e.ASTFlags.Error,v.minChar=p,v.limChar=this.scanner.lastTokenLimChar(),v}}else c?(o=new e.Identifier(this.prevIDTok.getText()),o.minChar=this.scanner.lastTokenLimChar()-3,o.limChar=this.scanner.lastTokenLimChar(),a=o.limChar,e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater"),this.tok.getText()==o.text&&this.tok!=this.prevIDTok&&(this.tok=this.scanner.scan()),this.prevIDTok=null):(o=new e.Identifier(this.tok.getText()),o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,a=this.scanner.pos,this.tok=this.scanner.scan());this.tok.tokenId==e.TokenID.QMark&&(this.inInterfaceDecl&&o?o.flags|=e.ASTFlags.OptionalName:this.reportParseError("Optional properties may only be declared on interface or object types"),this.tok=this.scanner.scan());if(this.tok.tokenId==e.TokenID.LParen||l&&this.tok.tokenId==e.TokenID.LBrack){var m=n|e.ErrorRecoverySet.RParen;l&&(m=n|e.ErrorRecoverySet.RBrack);var g=this.parseFncDecl(m,!0,i,!this.inFncDecl,o,l,s,this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient),r,null),y;if(g.nodeType==e.NodeType.Error)return g;y=g,y.name&&(y.name.minChar=u,y.name.limChar=a),(r&e.Modifiers.Public)!=e.Modifiers.None&&(y.fncFlags|=e.FncFlags.Public),(r&e.Modifiers.Private)!=e.Modifiers.None&&(y.fncFlags|=e.FncFlags.Private),s&&(y.fncFlags|=e.FncFlags.Static);if(this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient))y.fncFlags|=e.FncFlags.Ambient;return h&&(e.hasFlag(r,e.Modifiers.Getter)?(y.fncFlags|=e.FncFlags.GetAccessor,y.hint="get"+y.name.text):(y.fncFlags|=e.FncFlags.SetAccessor,y.hint="set"+y.name.text),y.fncFlags|=e.FncFlags.IsFunctionExpression,r&e.Modifiers.Ambient&&this.reportParseError("Property accessors may not be declared in ambient types")),o==null&&(f?(y.fncFlags|=e.FncFlags.ConstructMember,y.hint="_construct",y.classDecl=this.currentClassDecl):(y.hint="_call",y.fncFlags|=e.FncFlags.CallMember)),y}var b=new e.VarDecl(o,this.nestingLevel);b.minChar=u,this.tok.tokenId==e.TokenID.Colon&&(this.tok=this.scanner.scan(),b.typeExpr=this.parseTypeReference(n|e.ErrorRecoverySet.Asg|e.ErrorRecoverySet.Comma,!1));if(this.tok.tokenId==e.TokenID.Asg){if(i){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery)return this.skip(n),b.flags|=e.ASTFlags.Error,b.limChar=this.scanner.lastTokenLimChar(),b}this.tok=this.scanner.scan(),b.init=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Cma,!0,t.NoTypes),b.limChar=b.init.limChar;if(b.init.nodeType==e.NodeType.FuncDecl){var y=b.init;y.hint=b.id.text,y.boundToProperty=b}else h&&this.reportParseError("Accessors may only be functions")}else b.limChar=this.scanner.pos;return(r&e.Modifiers.Readonly)!=e.Modifiers.None&&(b.varFlags|=e.VarFlags.Readonly),s&&(b.varFlags|=e.VarFlags.Static),(r&e.Modifiers.Public)!=e.Modifiers.None&&(b.varFlags|=e.VarFlags.Public),(r&e.Modifiers.Private)!=e.Modifiers.None&&(b.varFlags|=e.VarFlags.Private),b.varFlags|=e.VarFlags.Property,b},i.prototype.parseVarDecl=function(n,r,i,s,o){var u=e.hasFlag(r,e.Modifiers.Readonly),a=this.scanner.startPos;this.tok=this.scanner.scan();var f=null,l=null,c=!1,h=this.parseComments();for(;;){if(this.tok.tokenId!=e.TokenID.ID&&!e.convertTokToID(this.tok,this.strictMode)){this.reportParseError("Expected identifier in variable declaration");if(this.errorRecovery)return f=new e.VarDecl(new e.MissingIdentifier,this.nestingLevel),f.minChar=a,this.skip(n),f.flags|=e.ASTFlags.Error,f.limChar=this.scanner.lastTokenLimChar(),f}var p=this.tok.getText();this.strictMode&&p=="eval"&&this.reportParseError("can not name a variable eval in strict mode"),f=this.makeVarDecl(new e.Identifier(p),this.nestingLevel),f.id.minChar=this.scanner.startPos,f.id.limChar=this.scanner.pos,f.preComments=h,o&&(f.varFlags|=e.VarFlags.Static),e.hasFlag(r,e.Modifiers.Readonly)&&(f.varFlags|=e.VarFlags.Readonly);if(this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Ambient))f.varFlags|=e.VarFlags.Ambient;if(this.parsingDeclareFile||e.hasFlag(r,e.Modifiers.Exported))f.varFlags|=e.VarFlags.Exported;f.minChar=a,l&&l.append(f),this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.Colon){this.tok=this.scanner.scan();var d=this.inFncDecl;this.inFncDecl=!1,f.typeExpr=this.parseTypeReference(n|e.ErrorRecoverySet.Asg|e.ErrorRecoverySet.Comma,!1),this.inFncDecl=d}if(this.tok.tokenId==e.TokenID.Asg){if(s){this.reportParseError("context does not permit variable initializer");if(this.errorRecovery)return this.skip(n),f.flags|=e.ASTFlags.Error,f}this.tok=this.scanner.scan(),f.init=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Cma,i,t.NoTypes),f.limChar=f.init.limChar;if(f.init.nodeType==e.NodeType.FuncDecl){var v=f.init;v.hint=f.id.text}}else u&&this.reportParseError("const declaration requires initializer"),f.limChar=this.scanner.pos;f.postComments=this.parseCommentsForLine(this.scanner.line);if(this.tok.tokenId!=e.TokenID.Comma)return l?(l.limChar=f.limChar,l):f;c||(l=new e.ASTList,l.minChar=f.minChar,l.append(f),c=!0),this.tok=this.scanner.scan(),a=this.scanner.startPos}},i.prototype.parseMemberList=function(n){var r=new e.ASTList;if(this.tok.tokenId==e.TokenID.RCurly)return r;var i=null,s=null,o=null,u=null,a=this.scanner.startPos,f=!1,l=!1,c=null,h=0,p=0;for(;;){var d=!1;if(this.tok.tokenId==e.TokenID.GET||this.tok.tokenId==e.TokenID.SET)f=this.tok.tokenId==e.TokenID.SET,c=this.tok,h=this.scanner.startPos,p=this.scanner.pos,this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.ID||e.convertTokToIDName(this.tok)?(i=f?"set":"get",i+=this.tok.getText(),s=new e.Identifier(this.tok.getText()),s.minChar=this.scanner.startPos,d=!0,e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater")):this.tok.tokenId!=e.TokenID.Colon?this.reportParseError("Expected identifier, string or number as accessor name"):(l=!0,s=new e.Identifier(c.getText()),s.minChar=h,s.limChar=p);else if(this.tok.tokenId==e.TokenID.ID||e.convertTokToIDName(this.tok))i=this.tok.getText(),s=new e.Identifier(i),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos;else if(this.tok.tokenId==e.TokenID.QString)i=this.tok.getText(),s=new e.StringLiteral(i),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos;else if(this.tok.tokenId==e.TokenID.NumberLit){var v=this.tok;i=v.value.toString(),s=new e.StringLiteral(i),s.minChar=this.scanner.startPos,s.limChar=this.scanner.pos}else this.reportParseError("Expected identifier, string or number as member name"),this.errorRecovery&&(s=new e.MissingIdentifier,s.minChar=this.scanner.startPos,s.flags|=e.ASTFlags.Error,this.skip(n|e.ErrorRecoverySet.Comma),s.limChar=this.scanner.lastTokenLimChar());l?l=!1:this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.QMark&&(s.flags|=e.ASTFlags.OptionalName,this.tok=this.scanner.scan());if(d){var m=new e.ASTList;this.parseFormalParameterList(n|e.ErrorRecoverySet.RParen,m,!1,!0,!1,!f,f,null);var g=this.parseFunctionStatements(n|e.ErrorRecoverySet.RCurly,s,!1,!0,m,e.AllowedElements.FunctionDecls,this.scanner.startPos,!1,e.Modifiers.None);f&&g.returnTypeAnnotation&&this.reportParseError("Property setters may not declare a return type"),g.fncFlags|=f?e.FncFlags.SetAccessor:e.FncFlags.GetAccessor,g.fncFlags|=e.FncFlags.IsFunctionExpression,g.hint=i,o=g,u=new e.BinaryExpression(e.NodeType.Member,s,o),u.minChar=s.minChar;if(o.nodeType==e.NodeType.FuncDecl){var g=o;g.hint=i}}else if(this.tok.tokenId==e.TokenID.Colon){this.tok=this.scanner.scan(),o=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Cma,!0,t.NoTypes),o.nodeType==e.NodeType.TypeRef&&this.reportParseError("Expected 'new' on array declaration in member definition"),u=new e.BinaryExpression(e.NodeType.Member,s,o),u.minChar=s.minChar;if(o.nodeType==e.NodeType.FuncDecl){var g=o;g.hint=i}}else{this.reportParseError("Expected ':' in member definition");if(this.errorRecovery)return this.skip(n),r.flags|=e.ASTFlags.Error,r.minChar=a,r.limChar=this.scanner.lastTokenLimChar(),r}i=null,r.append(u),u.limChar=this.scanner.lastTokenLimChar();if(this.tok.tokenId!=e.TokenID.Comma)break;this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.RCurly)break}return u&&(r.limChar=u.limChar),r.minChar=a,r},i.prototype.parseArrayList=function(n){var r=null;if(this.tok.tokenId==e.TokenID.RBrack)return r;r=new e.ASTList,r.minChar=this.scanner.startPos;var i;for(;;){this.tok.tokenId==e.TokenID.Comma||this.tok.tokenId==e.TokenID.RBrack?i=new e.AST(e.NodeType.EmptyExpr):i=this.parseExpr(e.ErrorRecoverySet.Comma|n,e.OperatorPrecedence.Cma,!0,t.NoTypes),r.append(i);if(this.tok.tokenId!=e.TokenID.Comma)break;this.tok=this.scanner.scan()}return r.limChar=this.scanner.lastTokenLimChar(),r},i.prototype.parseArrayLiteral=function(t){var n=null;return n=new e.UnaryExpression(e.NodeType.ArrayLit,this.parseArrayList(t)),n},i.prototype.parseTerm=function(n,r,i,s){var o=null,u=!1,a=!1,f=this.scanner.startPos,l=this.scanner.pos,c=!1;switch(this.tok.tokenId){case e.TokenID.NUMBER:case e.TokenID.BOOL:case e.TokenID.ANY:case e.TokenID.STRING:var h=new e.Identifier(e.tokenTable[this.tok.tokenId].text);e.hasFlag(i,t.Primitive)?(o=new e.TypeReference(h,0),u=!0):(o=h,u=!0),o.minChar=f,this.tok=this.scanner.scan(),l=this.scanner.lastTokenLimChar();break;case e.TokenID.THIS:o=new e.AST(e.NodeType.This),o.minChar=f,this.tok=this.scanner.scan(),l=this.scanner.lastTokenLimChar();break;case e.TokenID.SUPER:o=new e.AST(e.NodeType.Super),o.minChar=f,this.tok=this.scanner.scan(),l=this.scanner.lastTokenLimChar();break;case e.TokenID.TRUE:o=new e.AST(e.NodeType.True),this.tok=this.scanner.scan(),o.minChar=f;break;case e.TokenID.FALSE:o=new e.AST(e.NodeType.False),this.tok=this.scanner.scan(),o.minChar=f;break;case e.TokenID.NULL:o=new e.AST(e.NodeType.Null),this.tok=this.scanner.scan(),o.minChar=f;break;case e.TokenID.NEW:f=this.scanner.pos,this.tok=this.scanner.scan(),o=new e.CallExpression(e.NodeType.New,this.parseTerm(n,!1,t.AllSimpleTypes,s),null),o.minChar=f,l=this.scanner.lastTokenLimChar(),a=!0;break;case e.TokenID.FUNCTION:f=this.scanner.pos,o=this.parseFncDecl(n,!1,!1,!1,null,!1,!1,!1,e.Modifiers.None,null),o.fncFlags|=e.FncFlags.IsFunctionExpression,o.minChar=f,l=this.scanner.lastTokenLimChar(),o.limChar=l}if(o==null)if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)){var p=this.tok.getText();o=this.createRef(p,f),u=!0,o.minChar=f,this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.QMark?o.flags|=e.ASTFlags.PossibleOptionalParameter:this.tok.tokenId==e.TokenID.Arrow&&(c=!0),l=this.scanner.lastTokenLimChar()}s&&this.chkCurTok(e.TokenID.GT,"Expected '>'",n);if(o==null)switch(this.tok.tokenId){case e.TokenID.LParen:f=this.scanner.pos;var d=this.scanner.previousToken().tokenId;this.tok=this.scanner.scan();var v=d==e.TokenID.LParen||d==e.TokenID.Comma||d==e.TokenID.EQ||d==e.TokenID.Colon;v&&this.tok.tokenId==e.TokenID.RParen?(c=!0,this.tok=this.scanner.scan()):(o=this.parseExpr(n|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.No,!0,t.NoTypes),l=this.scanner.lastTokenLimChar(),c=v&&(o.nodeType==e.NodeType.Name||o.nodeType==e.NodeType.Comma)&&(this.tok.tokenId==e.TokenID.Colon||this.tok.tokenId==e.TokenID.QMark)),o&&!c&&(this.chkCurTok(e.TokenID.RParen,"Expected ')'",n),o.isParenthesized=!0);break;case e.TokenID.NumberLit:var m=this.tok;this.tok=this.scanner.scan(),o=new e.NumberLiteral(m.value),o.minChar=f,l=this.scanner.lastTokenLimChar();break;case e.TokenID.QString:o=new e.StringLiteral(this.tok.getText()),this.tok=this.scanner.scan(),o.minChar=f,l=this.scanner.lastTokenLimChar();break;case e.TokenID.Regex:var g=this.tok;o=new e.RegexLiteral(g.regex),this.tok=this.scanner.scan(),o.minChar=f,l=this.scanner.lastTokenLimChar();break;case e.TokenID.LBrack:f=this.scanner.startPos,this.tok=this.scanner.scan(),o=this.parseArrayLiteral(e.ErrorRecoverySet.RBrack|n),o.minChar=f,l=this.scanner.pos,this.chkCurTok(e.TokenID.RBrack,"Expected ']'",n);break;case e.TokenID.LCurly:f=this.scanner.startPos,this.tok=this.scanner.scan();var y=this.parseMemberList(e.ErrorRecoverySet.RCurly|n);this.chkCurTok(e.TokenID.RCurly,"Expected '}'",n),o=new e.UnaryExpression(e.NodeType.ObjectLit,y),o.minChar=f,l=this.scanner.lastTokenLimChar(),y.minChar=f,y.limChar=l;break;case e.TokenID.LT:f=this.scanner.startPos,this.tok=this.scanner.scan();var b=this.parseTypeReference(e.ErrorRecoverySet.BinOp,!1);this.chkCurTok(e.TokenID.GT,"Expected '>'",n),o=new e.UnaryExpression(e.NodeType.TypeAssertion,this.parseExpr(n,e.OperatorPrecedence.Uni,!1,t.NoTypes)),o.castTerm=b;break;default:if(this.prevExpr&&e.hasFlag(this.prevExpr.flags,e.ASTFlags.PossibleOptionalParameter))c=!0,o=this.prevExpr;else{this.reportParseError("Check format of expression term");if(this.errorRecovery){var w=new e.MissingIdentifier;w.minChar=f,w.flags|=e.ASTFlags.Error,this.skip(n|e.ErrorRecoverySet.Postfix),this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)?(w.text=this.tok.getText(),this.tok=this.scanner.scan(),l=this.scanner.lastTokenLimChar()):l=this.scanner.lastTokenLimChar(),o=w}}}c&&(this.tok.tokenId==e.TokenID.Arrow||this.tok.tokenId==e.TokenID.Colon||this.tok.tokenId==e.TokenID.Comma||this.tok.tokenId==e.TokenID.RParen?(o=this.parseFncDecl(n,!1,!1,!1,null,!1,!1,!1,e.Modifiers.None,{preProcessedLambdaArgs:o}),o.fncFlags|=e.FncFlags.IsFunctionExpression,o.fncFlags|=e.FncFlags.IsFatArrowFunction,o.minChar=f,l=this.scanner.lastTokenLimChar(),o.limChar=l):o&&(o.isParenthesized=!0)),u&&i!=t.NoTypes&&(i|=t.ArraySuffix);var E=this.parsePostfixOperators(n,o,r,a,i,f,l);if(E){if(u&&E.nodeType==e.NodeType.Index){var S=E;S.operand2==null&&(E=this.convertToTypeReference(E))}return E.minChar=f,E.limChar=e.max(E.limChar,this.scanner.lastTokenLimChar()),E}return new e.AST(e.NodeType.Error)},i.prototype.parseExpr=function(n,r,i,s){var o=null,u=e.lookupToken(this.tok.tokenId),a=!0,f=null,l=this.scanner.startPos,c=this.parseComments(),h=!1;if(u!=undefined&&u.unopNodeType!=e.NodeType.None){a=!1,this.tok=this.scanner.scan();var p=this.parseExpr(e.ErrorRecoverySet.BinOp|n,u.unopPrecedence,i,t.NoTypes);if(u.unopNodeType==e.NodeType.Pos&&p.nodeType==e.NodeType.NumberLit)o=p;else if(u.unopNodeType==e.NodeType.Neg&&p.nodeType==e.NodeType.NumberLit){var d=p;d.value=-d.value,d.value==0&&(d.isNegativeZero=!0),o=p}else o=new e.UnaryExpression(u.unopNodeType,p),o.limChar=p.limChar;o.minChar=l}else{o=this.parseTerm(e.ErrorRecoverySet.BinOp|e.ErrorRecoverySet.AddOp|n,!0,s,!1);var v,m;if(o.nodeType==e.NodeType.Name)v=o,f=v.text;else if(o.nodeType==e.NodeType.Dot){var g=!1;if(this.inferPropertiesFromThisAssignment&&(this.tok.tokenId==e.TokenID.Colon||this.tok.tokenId==e.TokenID.Asg)&&this.parsingClassConstructorDefinition&&this.nestingLevel==this.currentClassDefinition.constructorNestingLevel&&o.operand1.nodeType==e.NodeType.This&&o.operand2.nodeType==e.NodeType.Name){var y=o.operand2;this.currentClassDefinition.knownMemberNames[y.text]||(o=this.parseClassMemberVariableDeclaration(y,o.minChar,!0,n,e.Modifiers.Public),g=!0)}if(!g){m=o;while(m.nodeType==e.NodeType.Dot){var b=m;m=b.operand2}m.nodeType==e.NodeType.Name&&(v=m,f=v.text)}}if(!this.scanner.lastTokenHadNewline()&&(this.tok.tokenId==e.TokenID.Inc||this.tok.tokenId==e.TokenID.Dec)){a=!1;var w=o;o=new e.UnaryExpression(this.tok.tokenId==e.TokenID.Inc?e.NodeType.IncPost:e.NodeType.DecPost,w),o.limChar=this.scanner.pos,o.minChar=w.minChar,this.tok=this.scanner.scan()}}for(;;){u=e.lookupToken(this.tok.tokenId);if(u==undefined||u.binopNodeType==e.NodeType.None)break;if(!i&&u.binopNodeType==e.NodeType.In)break;if(u.binopPrecedence==e.OperatorPrecedence.Asg){if(u.binopPrecedence<r)break;a||this.reportParseError("illegal assignment")}else if(u.binopPrecedence<=r)break;this.tok=this.scanner.scan(),a=!1;if(u.binopNodeType==e.NodeType.QMark){this.prevExpr=o;var E=this.parseExpr(n|e.ErrorRecoverySet.Colon,e.OperatorPrecedence.Asg,i,t.NoTypes);this.prevExpr=null,E.nodeType!=e.NodeType.FuncDecl||!e.hasFlag(E.fncFlags,e.FncFlags.IsFatArrowFunction)?(this.chkCurTok(e.TokenID.Colon,"Expected :",n|e.ErrorRecoverySet.ExprStart),o=new e.TrinaryExpression(e.NodeType.QMark,o,E,this.parseExpr(n|e.ErrorRecoverySet.BinOp,e.OperatorPrecedence.Asg,i,t.NoTypes))):(o=E,h=!0)}else{var S=t.NoTypes,x;x=new e.BinaryExpression(u.binopNodeType,o,this.parseExpr(n|e.ErrorRecoverySet.BinOp,u.binopPrecedence,i,t.NoTypes));if(x.operand2.nodeType==e.NodeType.FuncDecl){var T=x.operand2;T.hint=f}x.minChar=o.minChar,x.limChar=this.scanner.lastTokenLimChar(),f=null,o=x}}return a&&(o.flags|=e.ASTFlags.Writeable),h||(o.minChar=l,o.limChar=e.max(o.limChar,this.scanner.lastTokenLimChar()),o.preComments=c,o.postComments=this.parseCommentsForLine(this.scanner.line)),o},i.prototype.parsePostfixOperators=function(n,r,i,s,o,u,a){var f=0;r||(r=new e.AST(e.NodeType.EmptyExpr),r.isParenthesized=!0),r.minChar=u,r.limChar=a;for(;;)switch(this.tok.tokenId){case e.TokenID.LParen:if(s){var l=r;l.args=this.parseArgList(n),s=!1}else{if(!i)return r;r=new e.CallExpression(e.NodeType.Call,r,this.parseArgList(n)),r.minChar=u}r.limChar=this.scanner.pos,this.chkCurTok(e.TokenID.RParen,"Expected ')'",n);break;case e.TokenID.LBrack:this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.RBrack&&e.hasFlag(o,t.ArraySuffix)){this.tok=this.scanner.scan();if(r.nodeType==e.NodeType.TypeRef){var c=r;c.arrayCount++}else r=new e.BinaryExpression(e.NodeType.Index,r,null);r.limChar=this.scanner.pos;break}r=new e.BinaryExpression(e.NodeType.Index,r,this.parseExpr(n|e.ErrorRecoverySet.RBrack,e.OperatorPrecedence.No,!0,t.NoTypes)),r.minChar=u,r.limChar=this.scanner.pos,this.chkCurTok(e.TokenID.RBrack,"Expected ']'",n);break;case e.TokenID.Dot:var h=null,p=this.scanner.pos;this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.ID||!this.scanner.lastTokenHadNewline()&&e.convertTokToIDName(this.tok))r.flags|=e.ASTFlags.DotLHS,h=this.createRef(this.tok.getText(),this.scanner.startPos),h.limChar=this.scanner.pos,this.tok=this.scanner.scan();else{this.reportParseError("Expected identifier following dot");if(this.errorRecovery)return this.skip(n),r.flags|=e.ASTFlags.Error|e.ASTFlags.DotLHS,r;h=new e.MissingIdentifier}r=new e.BinaryExpression(e.NodeType.Dot,r,h),r.minChar=u,r.limChar=this.scanner.lastTokenLimChar();break;case e.TokenID.Arrow:r=this.parseFncDecl(n,!1,!1,!1,null,!1,!1,!1,e.Modifiers.None,{preProcessedLambdaArgs:r}),r.fncFlags|=e.FncFlags.IsFunctionExpression,r.minChar=u,r.limChar=this.scanner.lastTokenLimChar();break;default:return r}},i.prototype.parseTry=function(t,n,r,i){var s=this.scanner.startPos,o=this.parseComments();this.tok=this.scanner.scan();if(this.tok.tokenId!=e.TokenID.LCurly){this.reportParseError("Expected '{'");if(this.errorRecovery){var u=t;return u.minChar=s,u.limChar=this.scanner.lastTokenLimChar(),u.flags|=e.ASTFlags.Error,u}}return t.body=this.parseStatement(n,r,i),t.minChar=s,t.limChar=t.body.limChar,t.preComments=o,t.postComments=this.parseComments(),t},i.prototype.parseCatch=function(t,n,r){var i=this.scanner.startPos,s=this.parseComments();this.tok=this.scanner.scan(),this.chkCurTok(e.TokenID.LParen,"Expected '('",t|e.ErrorRecoverySet.ExprStart);if(this.tok.tokenId!=e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode)){this.reportParseError("Expected identifier in catch header");if(this.errorRecovery){this.skip(t);var o=new e.Catch(new e.VarDecl(new e.MissingIdentifier,this.nestingLevel),new e.Statement(e.NodeType.Empty));return o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,o.flags|=e.ASTFlags.Error,o}}var u=new e.VarDecl(new e.Identifier(this.tok.getText()),this.nestingLevel);u.id.minChar=this.scanner.startPos,u.id.limChar=this.scanner.pos,u.minChar=u.id.minChar,u.limChar=u.id.limChar,this.tok=this.scanner.scan(),this.chkCurTok(e.TokenID.RParen,"Expected ')'",t|e.ErrorRecoverySet.StmtStart);if(this.tok.tokenId!=e.TokenID.LCurly){this.reportParseError("Expected '{' to start catch body");if(this.errorRecovery){this.skip(t);var o=new e.Catch(new e.VarDecl(new e.MissingIdentifier,this.nestingLevel),new e.Statement(e.NodeType.Empty));return o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,o.flags|=e.ASTFlags.Error,o}}var a=this.parseStatement(t,n,r),f=new e.Catch(u,a);return f.minChar=i,f.limChar=a.limChar,f.preComments=s,f.postComments=this.parseComments(),f},i.prototype.parseFinally=function(t,n,r){var i=this.scanner.startPos,s=this.parseComments();this.tok=this.scanner.scan();if(this.tok.tokenId!=e.TokenID.LCurly){this.reportParseError("Expected '{' to start body of finally statement");if(this.errorRecovery){this.skip(t);var o=new e.Finally(new e.Statement(e.NodeType.Empty));return o.flags|=e.ASTFlags.Error,o.minChar=this.scanner.startPos,o.limChar=this.scanner.pos,o}}var u=this.parseStatement(t,n,r),a=new e.Finally(u);return a.minChar=i,a.limChar=a.body.limChar,a.preComments=s,a.postComments=this.parseComments(),a},i.prototype.parseTryCatchFinally=function(t,n,r,i){var s=new e.Try(null),o=this.scanner.startPos;this.pushStmt(s,i),this.parseTry(s,t|e.ErrorRecoverySet.Catch,n,r),this.popStmt();var u=null,a=null;if(this.tok.tokenId==e.TokenID.CATCH){var f=this.parseCatch(t|e.ErrorRecoverySet.Catch,n,r);u=new e.TryCatch(s,f),u.minChar=s.minChar,u.limChar=f.limChar}if(this.tok.tokenId!=e.TokenID.FINALLY){if(u==null){this.reportParseError("try with neither catch nor finally");if(this.errorRecovery){var l=new e.TryFinally(s,new e.Finally(new e.AST(e.NodeType.Empty)));return l.flags|=e.ASTFlags.Error,l.minChar=this.scanner.startPos,l.limChar=this.scanner.pos,l}return new e.TryFinally(s,new e.Finally(new e.AST(e.NodeType.Empty)))}return u}u&&(s=u);var c=this.parseFinally(t,n,r);return a=new e.TryFinally(s,c),a.minChar=o,a.limChar=c.limChar,a},i.prototype.parseStatement=function(r,i,s){function m(){return e.hasFlag(l,e.Modifiers.Ambient)||e.hasFlag(s,e.Modifiers.Ambient)}function g(){e.hasFlag(l,e.Modifiers.Exported)&&this.reportError("Statement may not be exported")}var o=null,u=null,a=null,f,l=e.Modifiers.None,c=this.scanner.startPos,h=!1,p=!1,d=null,v=this.parseComments();this.state=n.StartStatement;for(;;){switch(this.tok.tokenId){case e.TokenID.EOF:o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.pos;break;case e.TokenID.FUNCTION:this.inStaticFnc&&this.reportParseError("Ambient static function delarations may only contain other ambient static function declarations"),this.parsingDeclareFile||m()||this.ambientModule?(this.tok=this.scanner.scan(),d=this.parsePropertyDecl(r|e.ErrorRecoverySet.SColon,l,!0,!1),d.nodeType==e.NodeType.VarDecl?this.reportParseError("function keyword can only introduce function declaration"):d.nodeType==e.NodeType.FuncDecl&&(d.fncFlags,e.FncFlags.IsFatArrowFunction)&&(p=!0),o=d):(o=this.parseFncDecl(r,!0,!1,!1,null,!1,!1,m(),l,null),e.hasFlag(o.fncFlags,e.FncFlags.IsFatArrowFunction)&&(p=!0),this.ambientModule&&this.reportParseError("function declaration not permitted within ambient module"),e.hasFlag(l,e.Modifiers.Exported)&&(o.fncFlags|=e.FncFlags.Exported));break;case e.TokenID.MODULE:(i&e.AllowedElements.ModuleDecls)==e.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()):o=this.parseModuleDecl(r,l);break;case e.TokenID.IMPORT:(i&e.AllowedElements.ModuleDecls)==e.AllowedElements.None?(this.reportParseError("module not allowed in this context"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()):o=this.parseImportDecl(r,l);break;case e.TokenID.EXPORT:(i&e.AllowedElements.ModuleDecls)==e.AllowedElements.None&&(this.reportParseError("'export' statements are only allowed at the global and module levels"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()),this.topLevel&&(this.hasTopLevelImportOrExport=!0),l|=e.Modifiers.Exported,this.tok=this.scanner.scan();break;case e.TokenID.PRIVATE:l|=e.Modifiers.Private,this.tok=this.scanner.scan();if(this.parsingClassConstructorDefinition){this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),c=this.scanner.pos;if(!this.inferPropertiesFromThisAssignment||this.tok.tokenId==e.TokenID.THIS&&(this.tok=this.scanner.scan()).tokenId==e.TokenID.Dot){this.tok=this.scanner.scan();var y=new e.Identifier(this.tok.getText());y.minChar=this.scanner.startPos,y.limChar=this.scanner.pos,this.tok=this.scanner.scan(),o=this.parseClassMemberVariableDeclaration(y,c,this.parsingClassConstructorDefinition,r,l)}else this.reportParseError("Expected 'this.' for property declaration"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()}else if(this.tok.tokenId!=e.TokenID.INTERFACE){if(this.tok.tokenId==e.TokenID.GET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))l|=e.Modifiers.Getter,this.prevIDTok=null}else if(this.tok.tokenId==e.TokenID.SET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))l|=e.Modifiers.Setter,this.prevIDTok=null}d=this.parsePropertyDecl(r|e.ErrorRecoverySet.SColon,l,m(),!1);if(d.nodeType==e.NodeType.VarDecl||d.nodeType==e.NodeType.FuncDecl&&e.hasFlag(d.fncFlags,e.FncFlags.IsFatArrowFunction))p=!0;o=d}break;case e.TokenID.PUBLIC:if(this.parsingClassConstructorDefinition){this.inferPropertiesFromThisAssignment||this.reportParseError("Property declarations are not permitted within constructor bodies"),this.tok=this.scanner.scan(),c=this.scanner.pos,l|=e.Modifiers.Public;if(!this.inferPropertiesFromThisAssignment||this.tok.tokenId==e.TokenID.THIS&&(this.tok=this.scanner.scan()).tokenId==e.TokenID.Dot){this.tok=this.scanner.scan();var y=new e.Identifier(this.tok.getText());y.minChar=this.scanner.startPos,y.limChar=this.scanner.pos,this.tok=this.scanner.scan(),o=this.parseClassMemberVariableDeclaration(y,c,this.parsingClassConstructorDefinition,r,l)}else this.reportParseError("Expected 'this.' for property declaration"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()}else if((i&e.AllowedElements.Properties)==e.AllowedElements.None)this.reportParseError("'property' statements are only allowed within classes"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar();else{l|=e.Modifiers.Public,this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.GET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))l|=e.Modifiers.Getter,this.prevIDTok=null}else if(this.tok.tokenId==e.TokenID.SET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))l|=e.Modifiers.Setter,this.prevIDTok=null}d=this.parsePropertyDecl(r|e.ErrorRecoverySet.SColon,l,m(),!1);if(d.nodeType==e.NodeType.VarDecl||d.nodeType==e.NodeType.FuncDecl&&e.hasFlag(d.fncFlags,e.FncFlags.IsFatArrowFunction))p=!0;o=d}break;case e.TokenID.DECLARE:i&e.AllowedElements.AmbientDecls||this.reportParseError("Ambient declarations are only allowed at the top-level or module scopes"),!this.parsingDeclareFile&&e.hasFlag(s,e.Modifiers.Ambient)&&this.reportParseError("Duplicate ambient declaration in this context. (Is the enclosing module or class already ambient?)"),l|=e.Modifiers.Ambient,this.tok=this.scanner.scan();break;case e.TokenID.CLASS:(i&e.AllowedElements.ClassDecls)==e.AllowedElements.None?(this.reportParseError("class not allowed in this context"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()):o=this.parseClassDecl(r,c,l);break;case e.TokenID.INTERFACE:(i&e.AllowedElements.InterfaceDecls)==e.AllowedElements.None?(this.reportParseError("interface not allowed in this context"),this.tok=this.scanner.scan(),o=new e.AST(e.NodeType.Error),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar()):o=this.parseInterfaceDecl(r,l);break;case e.TokenID.VAR:var b=this.parseVarDecl(r|e.ErrorRecoverySet.StmtStart,l,!0,!1,!1);b.nodeType==e.NodeType.VarDecl?o=b:o=new e.Block(b,!1),p=!0;if(this.parsingDeclareFile||this.ambientModule&&o.nodeType==e.NodeType.VarDecl)o.varFlags|=e.VarFlags.Exported;break;case e.TokenID.STATIC:this.currentClassDecl==null&&this.reportParseError("Statics may only be class members"),g(),l|=e.Modifiers.Public,this.tok=this.scanner.scan();if(this.tok.tokenId==e.TokenID.GET){this.prevIDTok=this.tok,this.tok=this.scanner.scan(),e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))l|=e.Modifiers.Getter,this.prevIDTok=null}else if(this.tok.tokenId==e.TokenID.SET){this.tok=this.scanner.scan(),e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("Property accessors are only available when targeting ES5 or greater");if(this.tok.tokenId==e.TokenID.ID||e.convertTokToID(this.tok,this.strictMode))l|=e.Modifiers.Setter}m()&&(l|=e.Modifiers.Ambient),d=this.parsePropertyDecl(r|e.ErrorRecoverySet.SColon,l,this.parsingDeclareFile||(l&e.Modifiers.Ambient)!=e.Modifiers.None,!0);var w=this.topStaticsList();w&&d.nodeType==e.NodeType.VarDecl&&w.append(d);if(d.nodeType==e.NodeType.VarDecl||d.nodeType==e.NodeType.FuncDecl&&e.hasFlag(d.fncFlags,e.FncFlags.IsFatArrowFunction))p=!0;o=d;break;case e.TokenID.FOR:g(),l!=e.Modifiers.None&&this.reportParseError("syntax error: for statement does not take modifiers"),c=this.scanner.startPos,this.chkNxtTok(e.TokenID.LParen,"Expected '('",r|e.ErrorRecoverySet.ExprStart|e.ErrorRecoverySet.Var),this.state=n.ForInit,h=!0;switch(this.tok.tokenId){case e.TokenID.VAR:f=this.parseVarDecl(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.In,e.Modifiers.None,!1,!1,!1);break;case e.TokenID.SColon:f=null,this.state=n.ForCondStart;break;default:f=this.parseExpr(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.In,e.OperatorPrecedence.No,!1,t.NoTypes)}this.state=n.ForInitAfterVar;if(this.tok.tokenId==e.TokenID.IN)if(f==null||!h)this.reportParseError("malformed for statement"),this.errorRecovery&&(this.skip(r|e.ErrorRecoverySet.StmtStart),o=new e.AST(e.NodeType.Empty),o.flags|=e.ASTFlags.Error);else{this.tok=this.scanner.scan();var E=new e.ForInStatement(f,this.parseExpr(e.ErrorRecoverySet.RParen|r,e.OperatorPrecedence.Cma,!1,t.NoTypes));E.limChar=this.scanner.pos,this.chkCurTok(e.TokenID.RParen,"Expected ')'",e.ErrorRecoverySet.StmtStart|r),this.pushStmt(E,u),E.body=this.parseStatement(r,i,s),this.popStmt(),E.minChar=c,o=E}else{var S=new e.ForStatement(f);S.minChar=c,this.chkCurTok(e.TokenID.SColon,"Expected ';'",r),this.tok.tokenId==e.TokenID.SColon?S.cond=null:(S.cond=this.parseExpr(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.No,!0,t.NoTypes),this.tok.tokenId!=e.TokenID.SColon&&(this.skip(r|e.ErrorRecoverySet.StmtStart),o=S,o.flags|=e.ASTFlags.Error)),this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.RParen?S.incr=null:S.incr=this.parseExpr(r|e.ErrorRecoverySet.SColon|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.No,!0,t.NoTypes),this.chkCurTok(e.TokenID.RParen,"Expected ')'",r|e.ErrorRecoverySet.LCurly),this.pushStmt(S,u),S.body=this.parseStatement(r,i,s),this.popStmt(),S.limChar=S.body.limChar,o=S}break;case e.TokenID.WITH:e.codeGenTarget<e.CodeGenTarget.ES5&&this.reportParseError("'with' statements are only available in ES5 codegen mode or better"),this.strictMode&&this.reportParseError("'with' statements are not available in strict mode"),g(),l!=e.Modifiers.None&&this.reportParseError("'with' statement does not take modifiers"),c=this.scanner.startPos,this.chkNxtTok(e.TokenID.LParen,"Expected '('",r|e.ErrorRecoverySet.ExprStart|e.ErrorRecoverySet.Var);var x=this.parseExpr(r|e.ErrorRecoverySet.Colon,e.OperatorPrecedence.No,!0,t.NoTypes);this.chkCurTok(e.TokenID.RParen,"Expected ')'",r|e.ErrorRecoverySet.LCurly);var T=new e.WithStatement(x);T.body=this.parseStatement(r,i,s),T.minChar=c,T.limChar=T.body.limChar,o=T;break;case e.TokenID.SWITCH:g(),l!=e.Modifiers.None&&this.reportParseError("'switch' statement does not take modifiers"),this.chkNxtTok(e.TokenID.LParen,"Expected '('",r|e.ErrorRecoverySet.ExprStart);var N=new e.SwitchStatement(this.parseExpr(r|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.No,!0,t.NoTypes));this.chkCurTok(e.TokenID.RParen,"Expected ')'",r|e.ErrorRecoverySet.LCurly);var C=this.scanner.startPos;this.chkCurTok(e.TokenID.LCurly,"Expected '{'",r|e.ErrorRecoverySet.SCase),N.defaultCase=null,N.caseList=new e.ASTList;var k=null;this.pushStmt(N,u);for(;;){if(this.tok.tokenId!=e.TokenID.CASE&&this.tok.tokenId!=e.TokenID.DEFAULT)break;var L=this.tok.tokenId==e.TokenID.DEFAULT;k=new e.CaseStatement,k.minChar=this.scanner.startPos,this.tok=this.scanner.scan(),L?N.defaultCase=k:k.expr=this.parseExpr(r|e.ErrorRecoverySet.Colon,e.OperatorPrecedence.No,!0,t.NoTypes),this.chkCurTok(e.TokenID.Colon,"Expected ':'",r|e.ErrorRecoverySet.StmtStart),k.body=new e.ASTList,this.parseStmtList(r|e.ErrorRecoverySet.RCurly,k.body,!1,!0,i,l),k.limChar=k.body.limChar,N.caseList.append(k)}N.caseList.minChar=C,N.caseList.limChar=this.scanner.pos,N.limChar=N.caseList.limChar,this.chkCurTok(e.TokenID.RCurly,"Expected '}'",r),this.popStmt(),o=N;break;case e.TokenID.WHILE:g(),l!=e.Modifiers.None&&this.reportParseError("'while' statement does not take modifiers"),c=this.scanner.startPos,this.chkNxtTok(e.TokenID.LParen,"Expected '('",e.ErrorRecoverySet.ExprStart|r);var A=new e.WhileStatement(this.parseExpr(r|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.No,!0,t.NoTypes));A.minChar=c,this.chkCurTok(e.TokenID.RParen,"Expected ')'",r|e.ErrorRecoverySet.StmtStart),this.pushStmt(A,u),A.body=this.parseStatement(r,i,s),A.limChar=A.body.limChar,this.popStmt(),o=A;break;case e.TokenID.DO:g(),l!=e.Modifiers.None&&this.reportParseError("'do' statement does not take modifiers"),c=this.scanner.startPos,this.tok=this.scanner.scan();var O=new e.DoWhileStatement;O.minChar=c,this.pushStmt(O,u),O.body=this.parseStatement(r|e.ErrorRecoverySet.While,i,s),this.popStmt(),O.whileAST=new e.Identifier("while"),O.whileAST.minChar=this.scanner.startPos,this.chkCurTok(e.TokenID.WHILE,"Expected 'while'",r|e.ErrorRecoverySet.LParen),O.whileAST.limChar=O.whileAST.minChar+5,this.chkCurTok(e.TokenID.LParen,"Expected '('",r|e.ErrorRecoverySet.ExprStart),O.cond=this.parseExpr(r|e.ErrorRecoverySet.RParen,e.OperatorPrecedence.No,!0,t.NoTypes),O.limChar=this.scanner.pos,this.chkCurTok(e.TokenID.RParen,"Expected ')'",r),o=O,this.tok.tokenId==e.TokenID.SColon&&(this.tok=this.scanner.scan());break;case e.TokenID.IF:g(),l!=e.Modifiers.None&&this.reportParseError("if statement does not take modifiers"),c=this.scanner.startPos,this.chkNxtTok(e.TokenID.LParen,"Expected '('",r|e.ErrorRecoverySet.ExprStart);var M=new e.IfStatement(this.parseExpr(r|e.ErrorRecoverySet.LParen,e.OperatorPrecedence.No,!0,t.NoTypes));M.minChar=c,this.chkCurTok(e.TokenID.RParen,"Expected ')'",r|e.ErrorRecoverySet.StmtStart),this.pushStmt(M,u),M.thenBod=this.parseStatement(e.ErrorRecoverySet.Else|r,i,s),M.limChar=M.thenBod.limChar,this.tok.tokenId==e.TokenID.ELSE&&(this.tok=this.scanner.scan(),M.elseBod=this.parseStatement(r,i,s),M.limChar=M.elseBod.limChar),this.popStmt(),o=M;break;case e.TokenID.TRY:g(),l!=e.Modifiers.None&&this.reportParseError("try statement does not take modifiers"),c=this.scanner.startPos,o=this.parseTryCatchFinally(r,e.AllowedElements.FunctionBody,s,u);break;case e.TokenID.LCurly:g(),l!=e.Modifiers.None&&this.reportParseError("block does not take modifiers"),c=this.scanner.startPos,this.tok=this.scanner.scan();var _=new e.Block(new e.ASTList,!0);this.pushStmt(_,u),this.parseStmtList(r|e.ErrorRecoverySet.RCurly,_.stmts,!1,!1,e.AllowedElements.Block,l),this.popStmt(),_.stmts.minChar=c,_.stmts.limChar=this.scanner.pos,_.minChar=_.stmts.minChar,_.limChar=_.stmts.limChar,this.chkCurTok(e.TokenID.RCurly,"Expected '}'",r),o=_;break;case e.TokenID.SColon:g(),l!=e.Modifiers.None&&this.reportParseError("modifier can not appear here"),o=new e.AST(e.NodeType.Empty),this.tok=this.scanner.scan();break;case e.TokenID.BREAK:case e.TokenID.CONTINUE:g(),l!=e.Modifiers.None&&this.reportParseError("modifiers can not appear before jump statement");var D=new e.Jump(this.tok.tokenId==e.TokenID.BREAK?e.NodeType.Break:e.NodeType.Continue);this.tok=this.scanner.scan(),this.tok.tokenId==e.TokenID.ID&&!this.scanner.lastTokenHadNewline()&&(D.target=this.tok.getText(),this.tok=this.scanner.scan()),this.resolveJumpTarget(D),o=D,p=!0;break;case e.TokenID.RETURN:g(),l!=e.Modifiers.None&&this.reportParseError("modifiers can not appear before return statement"),this.inFnc||this.reportParseError("return statement outside of function body"),c=this.scanner.startPos,this.tok=this.scanner.scan();var P=new e.ReturnStatement;P.minChar=c,this.tok.tokenId!=e.TokenID.SColon&&this.tok.tokenId!=e.TokenID.RCurly&&!this.scanner.lastTokenHadNewline()&&(P.returnExpression=this.parseExpr(r|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.No,!0,t.NoTypes)),p=!0,P.limChar=this.scanner.lastTokenLimChar(),o=P;break;case e.TokenID.THROW:g(),l!=e.Modifiers.None&&this.reportParseError("modifiers can not appear before a throw statement"),c=this.scanner.startPos,this.tok=this.scanner.scan(),this.tok.tokenId!=e.TokenID.SColon&&this.tok.tokenId!=e.TokenID.RCurly&&!this.scanner.lastTokenHadNewline()?f=this.parseExpr(r|e.ErrorRecoverySet.SColon,e.OperatorPrecedence.No,!0,t.NoTypes):(this.reportParseError("throw with no target"),f=null),o=new e.UnaryExpression(e.NodeType.Throw,f),o.limChar=this.scanner.lastTokenLimChar(),p=!0;break;case e.TokenID.ENUM:this.tok=this.scanner.scan(),o=this.parseEnumDecl(r,l),o.minChar=c,o.limChar=this.scanner.lastTokenLimChar();if(this.parsingDeclareFile||e.hasFlag(l,e.Modifiers.Ambient))o.modFlags|=e.ModuleFlags.Ambient;e.hasFlag(l,e.Modifiers.Exported)&&(o.modFlags|=e.ModuleFlags.Exported);break;case e.TokenID.DEBUGGER:g(),l!=e.Modifiers.None&&this.reportParseError("modifiers can not appear before debugger statement"),c=this.scanner.startPos,this.tok=this.scanner.scan();var H=new e.DebuggerStatement;H.minChar=c,p=!0,H.limChar=this.scanner.lastTokenLimChar(),o=H;break;default:l!=e.Modifiers.None&&this.reportParseError("modifiers can not appear before an expression statement or label"),c=this.scanner.startPos;var B=this.scanner.pos;f=this.parseExpr(e.ErrorRecoverySet.Colon|e.ErrorRecoverySet.StmtStart|r,e.OperatorPrecedence.No,!0,t.NoTypes),this.scanner.pos==B?(this.tok=this.scanner.scan(),o=f):this.tok.tokenId==e.TokenID.Colon&&!this.scanner.lastTokenHadNewline()&&f&&f.nodeType==e.NodeType.Name?(u==null&&(u=new e.ASTList),u.append(new e.Label(f)),this.tok=this.scanner.scan()):(o=f,p=!0)}if(o)break}if(p)switch(this.tok.tokenId){case e.TokenID.SColon:this.tok=this.scanner.scan(),o.flags|=e.ASTFlags.ExplicitSemicolon;break;case e.TokenID.EOF:case e.TokenID.RCurly:o.flags|=e.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon");break;default:this.scanner.lastTokenHadNewline()?(o.flags|=e.ASTFlags.AutomaticSemicolon,this.style_requireSemi&&this.reportParseStyleError("no automatic semicolon")):this.reportParseError("Expected ';'")}return u&&(o=new e.LabeledStatement(u,o)),o.minChar=c,o.limChar=e.max(o.limChar,this.scanner.lastTokenLimChar()),o.preComments=v,this.ambientModule&&!this.okAmbientModuleMember(o)&&this.reportParseError("statement not permitted within ambient module"),o.flags|=e.ASTFlags.IsStatement,o},i.prototype.okAmbientModuleMember=function(t){var n=t.nodeType;return n==e.NodeType.Class||n==e.NodeType.Import||n==e.NodeType.Interface||n==e.NodeType.Module||n==e.NodeType.Empty||n==e.NodeType.VarDecl&&(e.hasFlag(t.varFlags,e.VarFlags.Property)||e.hasFlag(t.varFlags,e.VarFlags.Exported))||n==e.NodeType.FuncDecl&&t.isMethod()},i.prototype.parseStmtList=function(t,r,i,s,o,u){var a=i;r.minChar=this.scanner.startPos;var f=this.scanner.pos,l=(o&e.AllowedElements.ModuleDecls)==e.AllowedElements.None,c=(o&e.AllowedElements.ClassDecls)==e.AllowedElements.None;t|=e.ErrorRecoverySet.TypeScriptS|e.ErrorRecoverySet.RCurly,this.state=n.StartStmtList;var h=this.strictMode;this.nestingLevel++;for(;;){if(this.tok.tokenId==e.TokenID.RCurly||s&&(this.tok.tokenId==e.TokenID.CASE||this.tok.tokenId==e.TokenID.DEFAULT)||l&&this.tok.tokenId==e.TokenID.EXPORT||c&&this.tok.tokenId==e.TokenID.CLASS||this.tok.tokenId==e.TokenID.EOF){this.state=n.EndStmtList,r.limChar=f,r.members.length==0?r.preComments=this.parseComments():r.postComments=this.parseComments(),this.strictMode=h,this.nestingLevel--;return}var p=this.parseStatement(t&~(e.ErrorRecoverySet.Else|e.ErrorRecoverySet.RParen|e.ErrorRecoverySet.Catch|e.ErrorRecoverySet.Colon),o,u);if(p){p.postComments=this.combineComments(p.postComments,this.parseCommentsForLine(this.scanner.prevLine)),r.append(p),f=p.limChar;if(a)if(p.nodeType==e.NodeType.QString){var d=p;d.text=="use strict"?(r.flags|=e.ASTFlags.StrictMode,this.strictMode=!0):a=!1}else a=!1}}},i.prototype.quickParse=function(t,n,i){var s=e.moduleGenTarget;try{e.moduleGenTarget=e.ModuleGenTarget.Local;var o=this.parse(t,n,i,e.AllowedElements.QuickParse);return new r(o,this.scanner.lexState)}finally{e.moduleGenTarget=s}},i.prototype.parse=function(t,r,i,s){typeof s=="undefined"&&(s=e.AllowedElements.Global),this.ambientModule=!1,this.topLevel=!0,this.parseError=!1,this.hasTopLevelImportOrExport=!1,this.fname=r,this.currentUnitIndex=i,this.amdDependencies=[],this.scanner.resetComments(),this.scanner.setSourceText(t,e.LexMode.File);var o=this.scanner.leftCurlyCount,u=this.scanner.rightCurlyCount,a=this.scanner.pos;this.tok=this.scanner.scan(),this.pushDeclLists();var f=new e.ASTList;f.minChar=a,this.state=n.StartScript,this.parsingDeclareFile=e.isDSTRFile(r)||e.isDTSFile(r),this.parseStmtList(e.ErrorRecoverySet.EOF|e.ErrorRecoverySet.Func,f,!0,!1,s,e.Modifiers.None);if(this.tok.tokenId!=e.TokenID.EOF){var l=e.tokenTable[this.tok.tokenId];this.reportParseError("Unexpected statement block terminator '"+l.text+"'")}this.state=n.EndScript,f.limChar=this.scanner.pos;var c=null;if(e.moduleGenTarget!=e.ModuleGenTarget.Local&&this.hasTopLevelImportOrExport){var h=e.switchToForwardSlashes(r),p=new e.Identifier(h);c=new e.ModuleDecl(p,f,this.topVarList(),this.topScopeList()),c.modFlags|=e.ModuleFlags.IsDynamic,c.modFlags|=e.ModuleFlags.IsWholeFile,c.modFlags|=e.ModuleFlags.Exported,this.parsingDeclareFile&&(c.modFlags|=e.ModuleFlags.Ambient),c.minChar=a,c.limChar=this.scanner.pos,c.prettyName=e.getPrettyName(h),c.amdDependencies=this.amdDependencies,f=new e.ASTList,f.minChar=c.minChar,f.limChar=c.limChar,f.append(c)}var d=new e.Script(this.topVarList(),this.topScopeList());return d.bod=f,this.popDeclLists(),d.minChar=a,d.limChar=this.scanner.pos,d.locationInfo=new e.LocationInfo(r,this.scanner.lineMap,i),d.leftCurlyCount=this.scanner.leftCurlyCount-o,d.rightCurlyCount=this.scanner.rightCurlyCount-u,d.isDeclareFile=this.parsingDeclareFile,d.topLevelMod=c,d},i}();e.Parser=i,e.quickParse=s})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(e,t,n){var r=n.state;return e.print(r),r.increaseIndent(),e}function r(e,t,n){var r=n.state;return r.decreaseIndent(),e}var t=function(){function t(e,t){this.outfile=e,this.parser=t,this.builder="",this.indent1="  ",this.indentStrings=[],this.indentAmt=0}return t.prototype.increaseIndent=function(){this.indentAmt++},t.prototype.decreaseIndent=function(){this.indentAmt--},t.prototype.startLine=function(){this.builder.length>0&&e.CompilerDiagnostics.Alert(this.builder);var t=this.indentStrings[this.indentAmt];if(t===undefined){t="";for(var n=0;n<this.indentAmt;n++)t+=this.indent1;this.indentStrings[this.indentAmt]=t}this.builder+=t},t.prototype.write=function(e){this.builder+=e},t.prototype.writeLine=function(e){this.builder+=e,this.outfile.WriteLine(this.builder),this.builder=""},t}();e.PrintContext=t,e.prePrintAST=n,e.postPrintAST=r})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function r(){e.initializeStaticTokens(),t[e.LexCodeLPR]=e.staticTokens[e.TokenID.LParen],t[e.LexCodeRPR]=e.staticTokens[e.TokenID.RParen],t[e.LexCodeCMA]=e.staticTokens[e.TokenID.Comma],t[e.LexCodeSMC]=e.staticTokens[e.TokenID.SColon],t[e.LexCodeLBR]=e.staticTokens[e.TokenID.LBrack],t[e.LexCodeRBR]=e.staticTokens[e.TokenID.RBrack],t[e.LexCodeTIL]=e.staticTokens[e.TokenID.Tilde],t[e.LexCodeQUE]=e.staticTokens[e.TokenID.QMark],t[e.LexCodeLC]=e.staticTokens[e.TokenID.LCurly],t[e.LexCodeRC]=e.staticTokens[e.TokenID.RCurly],t[e.LexCodeCOL]=e.staticTokens[e.TokenID.Colon],e.LexKeywordTable=new e.StringHashTable;for(var r in e.TokenID._map)r<=e.TokenID.LimKeyword&&e.LexKeywordTable.add(e.TokenID._map[r].toLowerCase(),r);for(var i=0;i<128;i++)s(i)?n[i]=!0:n[i]=!1}function i(t,n){return t==e.LexCodeLBR||t==e.LexCodeLC||t==e.LexCodeLPR?n+1:t==e.LexCodeRBR||t==e.LexCodeRC||t==e.LexCodeRPR?n-1:n}function s(t){return t>=97&&t<=122||t>=65&&t<=90||t==e.LexCodeDollar||t==e.LexCodeUnderscore}function o(e){return e>=48&&e<=57}function u(e){return n[e]||o(e)}function a(t){return t==e.LexCodeRBR?e.LexCodeLBR:t==e.LexCodeRC?e.LexCodeLC:t==e.LexCodeRPR?e.LexCodeLPR:0}function b(e){return E(e,!0,!1)}function w(e,t){return E(e,!1,t)}function E(t,n,r){if(!(t.tokenId<=e.TokenID.LimKeyword))return!1;var i=e.lookupToken(t.tokenId);if(i==undefined)return!1;var s=e.Reservation.Javascript|e.Reservation.JavascriptFuture;r&&(s|=e.Reservation.JavascriptFutureStrict);if(n||!e.hasFlag(i.reservation,s))return!0}function S(e,t){if(t===-1)return 0;var n=0,r=e.length-1;while(n<r){var i=n+r>>1;t<e[i]?r=i-1:t<e[i+1]?n=r=i:n=i+1}return n}function x(e,t,n){var r=S(n,t);r>0&&(e.line=r,e.col=t-n[r])}function T(e,t){var n={line:-1,col:-1};return x(n,t,e.locationInfo.lineMap),n.col>=0&&n.col++,n}function N(e,t,n){return e.locationInfo.lineMap[t]+(n-1)}e.LexEOF=-1,e.LexCodeNWL=10,e.LexCodeRET=13,e.LexCodeTAB=9,e.LexCodeVTAB=11,e.LexCode_e="e".charCodeAt(0),e.LexCode_E="E".charCodeAt(0),e.LexCode_x="x".charCodeAt(0),e.LexCode_X="X".charCodeAt(0),e.LexCode_a="a".charCodeAt(0),e.LexCode_A="A".charCodeAt(0),e.LexCode_f="f".charCodeAt(0),e.LexCode_F="F".charCodeAt(0),e.LexCode_g="g".charCodeAt(0),e.LexCode_m="m".charCodeAt(0),e.LexCode_i="i".charCodeAt(0),e.LexCode_0="0".charCodeAt(0),e.LexCode_9="9".charCodeAt(0),e.LexCode_8="8".charCodeAt(0),e.LexCode_7="7".charCodeAt(0),e.LexCodeBSL="\\".charCodeAt(0),e.LexCodeSHP="#".charCodeAt(0),e.LexCodeBNG="!".charCodeAt(0),e.LexCodeQUO='"'.charCodeAt(0),e.LexCodeAPO="'".charCodeAt(0),e.LexCodePCT="%".charCodeAt(0),e.LexCodeAMP="&".charCodeAt(0),e.LexCodeLPR="(".charCodeAt(0),e.LexCodeRPR=")".charCodeAt(0),e.LexCodePLS="+".charCodeAt(0),e.LexCodeMIN="-".charCodeAt(0),e.LexCodeMUL="*".charCodeAt(0),e.LexCodeSLH="/".charCodeAt(0),e.LexCodeXOR="^".charCodeAt(0),e.LexCodeCMA=",".charCodeAt(0),e.LexCodeDOT=".".charCodeAt(0),e.LexCodeLT="<".charCodeAt(0),e.LexCodeEQ="=".charCodeAt(0),e.LexCodeGT=">".charCodeAt(0),e.LexCodeQUE="?".charCodeAt(0),e.LexCodeLBR="[".charCodeAt(0),e.LexCodeRBR="]".charCodeAt(0),e.LexCodeUSC="_".charCodeAt(0),e.LexCodeLC="{".charCodeAt(0),e.LexCodeRC="}".charCodeAt(0),e.LexCodeBAR="|".charCodeAt(0),e.LexCodeTIL="~".charCodeAt(0),e.LexCodeCOL=":".charCodeAt(0),e.LexCodeSMC=";".charCodeAt(0),e.LexCodeUnderscore="_".charCodeAt(0),e.LexCodeDollar="$".charCodeAt(0),e.LexCodeSpace=32,e.LexKeywordTable=undefined;var t=new Array(128),n=new Array(128);e.LexInitialize=r,e.LexAdjustIndent=i,e.LexIsIdentifierStartChar=s,e.LexIsDigit=o,e.LexIsIdentifierChar=u,e.LexMatchingOpen=a,function(e){e._map=[],e._map[0]="Start",e.Start=0,e._map[1]="InFraction",e.InFraction=1,e._map[2]="InExponent",e.InExponent=2}(e.NumberScanState||(e.NumberScanState={}));var f=e.NumberScanState;(function(e){e._map=[],e._map[0]="Start",e.Start=0,e._map[1]="InMultilineComment",e.InMultilineComment=1})(e.LexState||(e.LexState={}));var l=e.LexState;(function(e){e._map=[],e._map[0]="Line",e.Line=0,e._map[1]="File",e.File=1})(e.LexMode||(e.LexMode={}));var c=e.LexMode;(function(e){e._map=[],e._map[0]="Line",e.Line=0,e._map[1]="Block",e.Block=1})(e.CommentStyle||(e.CommentStyle={}));var h=e.CommentStyle,p=function(){function e(e){this.text=e}return e.prototype.getText=function(e,t){return this.text.substring(e,t)},e.prototype.getLength=function(){return this.text.length},e}();e.StringSourceText=p;var d=function(){function e(e,t,n){this.segmentStart=e,this.segmentEnd=t,this.segment=n}return e.prototype.charCodeAt=function(e){return this.segment.charCodeAt(e-this.segmentStart)},e.prototype.substring=function(e,t){return this.segment.substring(e-this.segmentStart,t-this.segmentStart)},e}();e.SourceTextSegment=d;var v=function(){function e(e,t){this.seg1=e,this.seg2=t}return e.prototype.charCodeAt=function(e){return this.seg1.segmentStart<=e&&e<this.seg1.segmentEnd?this.seg1.segment.charCodeAt(e-this.seg1.segmentStart):this.seg2.segment.charCodeAt(e-this.seg2.segmentStart)},e.prototype.substring=function(e,t){return this.seg1.segmentStart<=e&&t<=this.seg1.segmentEnd?this.seg1.segment.substring(e-this.seg1.segmentStart,t-this.seg1.segmentStart):this.seg2.segment.substring(e-this.seg2.segmentStart)+this.seg1.segment.substring(0,t-this.seg1.segmentStart)},e}();e.AggerateSourceTextSegment=v;var m=function(){function t(e){this.sourceText=e,this.agg=new v(t.emptySegment,t.emptySegment),this.len=this.sourceText.getLength()}return t.emptySegment=new d(0,0,""),t.prototype.max=function(e,t){return e>=t?e:t},t.prototype.min=function(e,t){return e<=t?e:t},t.prototype.fetchSegment=function(t,n){if(this.agg.seg1.segmentStart<=t&&n<=this.agg.seg1.segmentEnd)return this.agg.seg1;if(this.agg.seg2.segmentStart<=t&&n<=this.agg.seg1.segmentEnd)return this.agg;var r=this.agg.seg1,i=r.segmentEnd,s=e.max(i+512,n);s=e.min(s,this.len);var o=this.sourceText.getText(i,s),u=new d(i,s,o);return this.agg.seg2=r,this.agg.seg1=u,this.agg},t.prototype.charCodeAt=function(e){return this.fetchSegment(e,e+1).charCodeAt(e)},t.prototype.substring=function(e,t){return this.fetchSegment(e,t).substring(e,t)},t}();e.ScannerTextStream=m;var g=function(){function t(){this.prevToken=null,this.curSavedToken=null,this.prevSavedToken=null,this.prevToken=null,this.currentToken=0,this.tokens=new Array,this.prevLine=1,this.line=1,this.col=0,this.lexState=l.Start,this.commentStack=new Array}return t.prototype.previousToken=function(){return this.prevToken},t.prototype.close=function(){this.currentToken=0},t.prototype.addToken=function(t,n){this.tokens[this.currentToken++]=new e.SavedToken(t,n.startPos,n.pos)},t.prototype.scan=function(){this.startLine=this.line,this.startPos=this.col;if(this.currentTokenIndex==this.currentTokens.length){if(!(this.line<this.lineMap.length))return e.staticTokens[e.TokenID.EOF];this.line++,this.col=0,this.currentTokenIndex=0,this.currentTokens=this.tokensByLine[this.line]}if(this.currentTokenIndex<this.currentTokens.length){this.prevToken=this.curSavedToken.tok,this.prevSavedToken=this.curSavedToken,this.curSavedToken=this.currentTokens[this.currentTokenIndex++];var t=this.curSavedToken.tok;return this.pos=this.curSavedToken.limChar,this.col+=this.curSavedToken.limChar-this.curSavedToken.minChar,this.startPos=this.curSavedToken.minChar,this.prevLine=this.line,t}return e.staticTokens[e.TokenID.EOF]},t.prototype.syncToTok=function(e){this.line=S(this.lineMap,e),this.currentTokenIndex=0;var t=e-this.lineMap[this.line];while(this.lexStateByLine[this.line]==l.InMultilineComment&&this.line>0)this.line--,t=0;var n=this.lineMap.length-1;this.currentTokens=this.tokensByLine[this.line];while(this.currentTokens.length==0&&this.line<n)this.line++,this.currentTokens=this.tokensByLine[this.line],t=0;if(this.line<=n){while(this.currentTokenIndex<this.currentTokens.length&&t>this.currentTokens[this.currentTokenIndex].limChar)this.currentTokenIndex++;if(this.currentTokenIndex<this.currentTokens.length)return this.col=this.currentTokens[this.currentTokenIndex].minChar,this.col+this.lineMap[this.line]}return-1},t.prototype.lastTokenLimChar=function(){return this.prevSavedToken!==null?this.prevSavedToken.limChar:0},t.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},t.prototype.pushComment=function(e){this.commentStack.push(e)},t.prototype.getComments=function(){var e=this.commentStack;return this.commentStack=[],e},t.prototype.getCommentsForLine=function(e){var t=null;while(this.commentStack.length>0&&this.commentStack[0].line==e)t==null?t=[this.commentStack.shift()]:t=t.concat([this.commentStack.shift()]);return t},t.prototype.resetComments=function(){this.commentStack=[]},t.prototype.setSourceText=function(e,t){},t}();e.SavedTokens=g;var y=function(){function i(){this.prevLine=1,this.line=1,this.col=0,this.pos=0,this.startPos=0,this.len=0,this.lineMap=[],this.ch=e.LexEOF,this.lexState=l.Start,this.mode=c.File,this.scanComments=!0,this.interveningWhitespace=!1,this.interveningWhitespacePos=0,this.leftCurlyCount=0,this.rightCurlyCount=0,this.commentStack=new Array,this.saveScan=null,this.prevTok=e.staticTokens[e.TokenID.EOF],this.startCol=this.col,this.startLine=this.line,this.lineMap[1]=0,e.LexKeywordTable||r()}return i.prototype.previousToken=function(){return this.prevTok},i.prototype.setSourceText=function(e,t){this.mode=t,this.scanComments=this.mode===c.Line,this.pos=0,this.interveningWhitespacePos=0,this.startPos=0,this.line=1,this.col=0,this.startCol=this.col,this.startLine=this.line,this.len=0,this.src=e.getText(0,e.getLength()),this.len=this.src.length,this.lineMap=[],this.lineMap[1]=0,this.commentStack=[],this.leftCurlyCount=0,this.rightCurlyCount=0},i.prototype.setSaveScan=function(e){this.saveScan=e},i.prototype.setText=function(e,t){this.setSourceText(new p(e),t)},i.prototype.setScanComments=function(e){this.scanComments=e},i.prototype.getLexState=function(){return this.lexState},i.prototype.scanLine=function(t,n){this.lexState=n;var r=new Array;this.setText(t,c.Line);var i=this.scan();while(i.tokenId!=e.TokenID.EOF)r[r.length]=i,i=this.scan();return r},i.prototype.tokenStart=function(){this.startPos=this.pos,this.startLine=this.line,this.startCol=this.col,this.interveningWhitespace=!1},i.prototype.peekChar=function(){return this.pos<this.len?this.src.charCodeAt(this.pos):e.LexEOF},i.prototype.peekCharAt=function(t){return t<this.len?this.src.charCodeAt(t):e.LexEOF},i.prototype.IsHexDigit=function(t){return t>=e.LexCode_0&&t<=e.LexCode_9||t>=e.LexCode_A&&t<=e.LexCode_F||t>=e.LexCode_a&&t<=e.LexCode_f},i.prototype.IsOctalDigit=function(t){return t>=e.LexCode_0&&t<=e.LexCode_7||t>=e.LexCode_a&&t<=e.LexCode_f},i.prototype.scanHexDigits=function(){var t=!1;for(;;){if(!this.IsHexDigit(this.ch))return t?new e.NumberToken(parseInt(this.src.substring(this.startPos,this.pos))):null;this.nextChar(),t=!0}},i.prototype.scanOctalDigits=function(){var t=!1;for(;;){if(!this.IsOctalDigit(this.ch))return t?new e.NumberToken(parseInt(this.src.substring(this.startPos,this.pos))):null;this.nextChar(),t=!0}},i.prototype.scanDecimalNumber=function(t){var n=!1,r=this.pos,i=this.col;for(;;)if(o(this.ch))n=!0,this.nextChar();else if(this.ch==e.LexCodeDOT){if(t!=f.Start)return n?new e.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=r,this.col=i,null);this.nextChar(),t=f.InFraction}else if(this.ch==e.LexCode_e||this.ch==e.LexCode_E)if(t==f.Start){if(!n)return this.pos=r,this.col=i,null;n=!1,this.nextChar(),t=f.InExponent}else{if(t!=f.InFraction)return n?new e.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=r,this.col=i,null);this.nextChar(),t=f.InExponent,n=!1}else{if(this.ch!=e.LexCodePLS&&this.ch!=e.LexCodeMIN)return n?new e.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=r,this.col=i,null);if(t!=f.InExponent)return t==f.InFraction?new e.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):n?new e.NumberToken(parseFloat(this.src.substring(this.startPos,this.pos))):(this.pos=r,this.col=i,null);if(!!n)return this.pos=r,this.col=i,null;this.nextChar()}},i.prototype.scanNumber=function(){if(this.peekChar()!=e.LexCode_0)return this.scanDecimalNumber(f.Start);switch(this.peekCharAt(this.pos+1)){case e.LexCode_x:case e.LexCode_X:return this.advanceChar(2),this.scanHexDigits();case e.LexCode_8:case e.LexCode_9:case e.LexCodeDOT:return this.scanDecimalNumber(f.Start);default:return this.scanOctalDigits()}},i.prototype.scanFraction=function(){return this.scanDecimalNumber(f.InFraction)},i.prototype.newLine=function(){this.col=0,this.mode==c.File&&(this.line++,this.lineMap[this.line]=this.pos+1)},i.prototype.finishMultilineComment=function(){var t;this.lexState=l.InMultilineComment;while(this.pos<this.len){if(this.ch==e.LexCodeMUL){t=this.peekCharAt(this.pos+1);if(t==e.LexCodeSLH)return this.advanceChar(2),this.mode==c.File&&this.tokenStart(),this.lexState=l.Start,!0}else if(this.ch==e.LexCodeNWL){this.newLine();if(this.mode==c.Line)return this.nextChar(),!1}this.nextChar()}return!1},i.prototype.pushComment=function(e){this.commentStack.push(e)},i.prototype.getComments=function(){var e=this.commentStack;return this.commentStack=[],e},i.prototype.getCommentsForLine=function(e){var t=null;while(this.commentStack.length>0&&this.commentStack[0].line==e)t==null?t=[this.commentStack.shift()]:t=t.concat([this.commentStack.shift()]);return t},i.prototype.resetComments=function(){this.commentStack=[]},i.prototype.endsLine=function(t){return t==e.LexCodeNWL||t==e.LexCodeRET||t==8232||t==8233},i.prototype.finishSinglelineComment=function(){while(this.pos<this.len){if(this.endsLine(this.ch))break;this.nextChar()}this.mode==c.File&&this.tokenStart()},i.prototype.tokenText=function(){return this.src.substring(this.startPos,this.pos)},i.prototype.findClosingSLH=function(){var t=this.pos,n=this.src.charCodeAt(t),r=0,i=!1;while(!this.endsLine(n)&&t<this.len){if(n==e.LexCodeSLH&&!i)return t;r=n,t++,i?i=!1:i=r==e.LexCodeBSL,n=this.src.charCodeAt(t)}return-1},i.prototype.speculateRegex=function(){if(e.noRegexTable[this.prevTok.tokenId]!=undefined)return null;var t=this.pos,n=this.col,r=this.findClosingSLH();if(r>0){var i=this.src.substring(t,r),s="";this.pos=r+1,this.ch=this.peekChar();var o=this.pos;while(this.ch==e.LexCode_i||this.ch==e.LexCode_g||this.ch==e.LexCode_m)this.nextChar();if(this.pos-o>3)return null;s=this.src.substring(o,this.pos);var u=undefined;try{u=new RegExp(i,s)}catch(a){}if(u)return this.col=n+(this.pos-this.startPos),new e.RegexToken(u)}return this.pos=t,this.col=n,null},i.prototype.lastTokenHadNewline=function(){return this.prevLine!=this.startLine},i.prototype.lastTokenLimChar=function(){return this.interveningWhitespace?this.interveningWhitespacePos:this.startPos},i.prototype.advanceChar=function(e){this.pos+=e,this.col+=e,this.ch=this.peekChar()},i.prototype.nextChar=function(){this.pos++,this.col++,this.ch=this.peekChar()},i.prototype.scan=function(){if(this.lexState==l.InMultilineComment&&this.scanComments){this.ch=this.peekChar();var t=this.line;this.finishMultilineComment();if(this.startPos<this.pos){var n=this.src.substring(this.startPos,this.pos);return this.tokenStart(),new e.CommentToken(e.TokenID.Comment,n,!0,this.startPos,t,!0)}return e.staticTokens[e.TokenID.EOF]}return this.prevLine=this.line,this.prevTok=this.innerScan(),this.saveScan&&this.saveScan.addToken(this.prevTok,this),this.prevTok},i.prototype.innerScan=function(){var r;this.tokenStart(),this.ch=this.peekChar();while(this.pos<this.len){if(n[this.ch]){do this.nextChar();while(n[this.ch]||o(this.ch));var i=this.src.substring(this.startPos,this.pos),s;return(s=e.LexKeywordTable.lookup(i))!=null?e.staticTokens[s]:new e.StringToken(e.TokenID.ID,i)}if(this.ch==e.LexCodeSpace){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos);do this.nextChar();while(this.ch==e.LexCodeSpace);if(this.mode==c.Line){var u=this.src.substring(this.startPos,this.pos);return new e.WhitespaceToken(e.TokenID.Whitespace,u)}this.tokenStart(),this.interveningWhitespace=!0}else if(this.ch==e.LexCodeSLH){this.nextChar();var a;if(this.ch==e.LexCodeSLH){this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1);var f=this.pos-1,l=this.line;this.finishSinglelineComment();var a=this.src.substring(f,this.pos),h=new e.CommentToken(e.TokenID.Comment,a,!1,f,l,!1);if(this.scanComments)return this.startPos=f,h;this.pushComment(h),this.interveningWhitespace=!0}else{if(this.ch!=e.LexCodeMUL){var d=this.speculateRegex();return d?d:this.peekCharAt(this.pos)==e.LexCodeEQ?(this.nextChar(),e.staticTokens[e.TokenID.AsgDiv]):e.staticTokens[e.TokenID.Div]}this.interveningWhitespace||(this.interveningWhitespacePos=this.pos-1);var f=this.pos-1,l=this.line;this.nextChar(),this.finishMultilineComment();var a=this.src.substring(f,this.pos),p=this.peekChar()==e.LexCodeNWL||this.peekChar()==e.LexCodeRET,h=new e.CommentToken(e.TokenID.Comment,a,!0,f,l,p);if(this.scanComments)return this.startPos=f,h;this.pushComment(h),this.interveningWhitespace=!0}}else{if(this.ch==e.LexCodeSMC)return this.nextChar(),e.staticTokens[e.TokenID.SColon];if(this.ch==e.LexCodeAPO||this.ch==e.LexCodeQUO){var v=this.ch,m=0,g=!1;do m=this.ch,g?g=!1:g=m==e.LexCodeBSL,this.nextChar();while(this.ch!=e.LexEOF&&(g||this.ch!=v));return this.ch!=e.LexEOF&&this.nextChar(),new e.StringToken(e.TokenID.QString,this.src.substring(this.startPos,this.pos))}if(t[this.ch]){var y=t[this.ch];return y.tokenId==e.TokenID.LCurly?this.leftCurlyCount++:y.tokenId==e.TokenID.RCurly&&this.rightCurlyCount++,this.nextChar(),y}if(this.ch>=e.LexCode_0&&this.ch<=e.LexCode_9)return r=this.scanNumber(),r?r:(this.nextChar(),e.staticTokens[e.TokenID.Error]);switch(this.ch){case e.LexCodeTAB:case e.LexCodeVTAB:this.interveningWhitespace||(this.interveningWhitespacePos=this.pos);if(this.mode==c.Line){do this.nextChar();while(this.ch==e.LexCodeSpace||this.ch==9);var b=this.src.substring(this.startPos,this.pos);return new e.WhitespaceToken(e.TokenID.Whitespace,b)}this.interveningWhitespace=!0;case 255:case 254:case 239:case 187:case 191:case 8232:case 8233:case e.LexCodeNWL:case e.LexCodeRET:if(this.ch==e.LexCodeNWL){this.newLine();if(this.mode==c.Line)return e.staticTokens[e.TokenID.EOF]}this.interveningWhitespace||(this.interveningWhitespacePos=this.pos),this.nextChar(),this.tokenStart(),this.interveningWhitespace=!0;break;case e.LexCodeDOT:return this.peekCharAt(this.pos+1)==e.LexCodeDOT?this.peekCharAt(this.pos+2)==e.LexCodeDOT?(this.advanceChar(3),e.staticTokens[e.TokenID.Ellipsis]):(this.nextChar(),e.staticTokens[e.TokenID.Dot]):(this.nextChar(),r=this.scanFraction(),r?r:e.staticTokens[e.TokenID.Dot]);case e.LexCodeEQ:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?this.peekCharAt(this.pos+2)==e.LexCodeEQ?(this.advanceChar(3),e.staticTokens[e.TokenID.Eqv]):(this.advanceChar(2),e.staticTokens[e.TokenID.EQ]):this.peekCharAt(this.pos+1)==e.LexCodeGT?(this.advanceChar(2),e.staticTokens[e.TokenID.Arrow]):(this.nextChar(),e.staticTokens[e.TokenID.Asg]);case e.LexCodeBNG:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?this.peekCharAt(this.pos+2)==e.LexCodeEQ?(this.advanceChar(3),e.staticTokens[e.TokenID.NEqv]):(this.advanceChar(2),e.staticTokens[e.TokenID.NE]):(this.nextChar(),e.staticTokens[e.TokenID.Bang]);case e.LexCodePLS:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgAdd]):this.peekCharAt(this.pos+1)==e.LexCodePLS?(this.advanceChar(2),e.staticTokens[e.TokenID.Inc]):(this.nextChar(),e.staticTokens[e.TokenID.Add]);case e.LexCodeMIN:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgSub]):this.peekCharAt(this.pos+1)==e.LexCodeMIN?(this.advanceChar(2),e.staticTokens[e.TokenID.Dec]):(this.nextChar(),e.staticTokens[e.TokenID.Sub]);case e.LexCodeMUL:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgMul]):(this.nextChar(),e.staticTokens[e.TokenID.Mult]);case e.LexCodePCT:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgMod]):(this.nextChar(),e.staticTokens[e.TokenID.Pct]);case e.LexCodeLT:return this.peekCharAt(this.pos+1)==e.LexCodeLT?this.peekCharAt(this.pos+2)==e.LexCodeEQ?(this.advanceChar(3),e.staticTokens[e.TokenID.AsgLsh]):(this.advanceChar(2),e.staticTokens[e.TokenID.Lsh]):this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.LE]):(this.nextChar(),e.staticTokens[e.TokenID.LT]);case e.LexCodeGT:return this.peekCharAt(this.pos+1)==e.LexCodeGT?this.peekCharAt(this.pos+2)==e.LexCodeEQ?(this.advanceChar(3),e.staticTokens[e.TokenID.AsgRsh]):this.peekCharAt(this.pos+2)==e.LexCodeGT?this.peekCharAt(this.pos+3)==e.LexCodeEQ?(this.advanceChar(4),e.staticTokens[e.TokenID.AsgRs2]):(this.advanceChar(3),e.staticTokens[e.TokenID.Rs2]):(this.advanceChar(2),e.staticTokens[e.TokenID.Rsh]):this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.GE]):(this.nextChar(),e.staticTokens[e.TokenID.GT]);case e.LexCodeXOR:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgXor]):(this.nextChar(),e.staticTokens[e.TokenID.Xor]);case e.LexCodeBAR:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgOr]):this.peekCharAt(this.pos+1)==e.LexCodeBAR?(this.advanceChar(2),e.staticTokens[e.TokenID.LogOr]):(this.nextChar(),e.staticTokens[e.TokenID.Or]);case e.LexCodeAMP:return this.peekCharAt(this.pos+1)==e.LexCodeEQ?(this.advanceChar(2),e.staticTokens[e.TokenID.AsgAnd]):this.peekCharAt(this.pos+1)==e.LexCodeAMP?(this.advanceChar(2),e.staticTokens[e.TokenID.LogAnd]):(this.nextChar(),e.staticTokens[e.TokenID.And]);default:return e.staticTokens[e.TokenID.EOF]}}}return e.staticTokens[e.TokenID.EOF]},i}();e.Scanner=y,e.convertTokToIDName=b,e.convertTokToID=w,e.getLineNumberFromPosition=S,e.getSourceLineColFromMap=x,e.getLineColumnFromPosition=T,e.getPositionFromLineColumn=N})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(t,n,r,i,s){var o=new e.ScopeChain(null,n.scopeChain,t);o.thisType=r,o.classType=i,o.fnc=s,n.scopeChain=o}function r(e){e.scopeChain=e.scopeChain.previous}function i(e,t){return e==null||!e.isInstanceProperty()?t:e}function s(e){return e.isInstanceProperty()}function u(t,r){var i=t,s=null,o=null;i.name&&i.mod&&(i.name.sym=i.mod.symbol);var u=i.mod;if(!u)return;s=new e.SymbolTableScope(u.members,u.ambientMembers,u.enclosedTypes,u.ambientEnclosedTypes,u.symbol),u.memberScope=s,r.modDeclChain.push(i),r.typeFlow.checker.currentModDecl=i,o=new e.SymbolAggregateScope(u.symbol),o.addParentScope(s),o.addParentScope(r.scopeChain.scope),n(o,r,null,null,null),u.containedScope=o,u.symbol&&r.typeFlow.addLocalsFromScope(u.containedScope,u.symbol,i.vars,u.members.privateMembers,!0)}function a(t,r){var i=t,s=null,o=null;i.name&&i.type&&(i.name.sym=i.type.symbol);var u=t.type;if(u){var a=u.symbol;s=r.typeFlow.checker.scopeOf(u),o=new e.SymbolAggregateScope(u.symbol),o.addParentScope(s),o.addParentScope(r.scopeChain.scope),u.containedScope=o,u.memberScope=s;var f=u.instanceType;s=r.typeFlow.checker.scopeOf(f),f.memberScope=s,o=new e.SymbolAggregateScope(f.symbol),o.addParentScope(r.scopeChain.scope),n(o,r,f,u,null),f.containedScope=o}else t.type=r.typeFlow.anyType}function f(t,r){var i=t,s=null,o=null;i.name&&i.type&&(i.name.sym=i.type.symbol);var u=t.type;s=r.typeFlow.checker.scopeOf(u),u.memberScope=s,o=new e.SymbolAggregateScope(u.symbol),o.addParentScope(s),o.addParentScope(r.scopeChain.scope),n(o,r,null,null,null),u.containedScope=o}function l(t,r){var i=t,s=i.type,o=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),u=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),s=new e.Type,a=new e.WithSymbol(i.minChar,r.typeFlow.checker.locationInfo.unitIndex,s);s.members=o,s.ambientMembers=u,s.symbol=a,s.setHasImplementation(),i.type=s;var f=new e.SymbolScopeBuilder(s.members,s.ambientMembers,null,null,r.scopeChain.scope,s.symbol);n(f,r,null,null,null),s.containedScope=f}function c(t,r){var i=t,s=null,o=null;i.type&&(o=t.type.symbol);var u=e.hasFlag(i.fncFlags,e.FncFlags.Static),a=u&&r.scopeChain.fnc!=null,f=a?r.scopeChain.fnc.type.memberScope:r.scopeChain.scope;if(r.scopeChain.thisType&&(!i.isConstructor||e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod))){var l=r.scopeChain.thisType;!(l.typeFlags&e.TypeFlags.IsClass)&&!e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod)?!i.isMethod()||u?f=l.constructorScope:f=l.containedScope:r.scopeChain.previous.scope.container&&r.scopeChain.previous.scope.container.declAST&&r.scopeChain.previous.scope.container.declAST.nodeType==e.NodeType.FuncDecl&&r.scopeChain.previous.scope.container.declAST.isConstructor?f=l.constructorScope:u&&r.scopeChain.classType?f=r.scopeChain.classType.containedScope:f=l.containedScope,s=l.symbol}else i.isConstructor&&r.scopeChain.thisType&&(s=r.scopeChain.thisType.symbol);if(i.type==null||e.hasFlag(i.type.symbol.flags,e.SymbolFlags.TypeSetDuringScopeAssignment)){r.scopeChain.fnc&&r.scopeChain.fnc.type&&(s=r.scopeChain.fnc.type.symbol);var c=null,h=r.scopeChain.fnc,p=i.name?i.name.text:null,d=null;u?(h.type.members==null&&s.getType().memberScope&&(h.type.members=s.type.memberScope.valueMembers),c=r.scopeChain.fnc.type.memberScope,h.innerStaticFuncs[h.innerStaticFuncs.length]=i):!i.isConstructor&&s&&s.declAST&&s.declAST.nodeType==e.NodeType.FuncDecl&&s.declAST.isConstructor&&!i.isMethod()?c=r.scopeChain.thisType.constructorScope:c=r.scopeChain.scope,p&&p!="__missing"&&!i.isAccessor()&&(u?d=c.findLocal(p,!1,!1):d=c.findLocal(p,!1,!1)),r.typeFlow.checker.createFunctionSignature(i,s,c,d,d==null);if(!i.accessorSymbol&&i.fncFlags&e.FncFlags.ClassMethod&&s&&(!d||d.declAST.nodeType!=e.NodeType.FuncDecl)&&i.isAccessor()||d&&d.isAccessor())i.accessorSymbol=r.typeFlow.checker.createAccessorSymbol(i,d,s.getType(),i.isMethod()&&u,!0,c,s);i.type.symbol.flags|=e.SymbolFlags.TypeSetDuringScopeAssignment}i.name&&i.type&&(i.name.sym=i.type.symbol),i.scopeType=i.type;if(i.isOverload)return;var v=new e.StringHashTable,m=new e.ScopedMembers(new e.DualStringHashTable(v,new e.StringHashTable)),g=new e.StringHashTable,y=new e.ScopedMembers(new e.DualStringHashTable(g,new e.StringHashTable)),b=new e.StringHashTable,w=new e.ScopedMembers(new e.DualStringHashTable(b,new e.StringHashTable)),E=new e.StringHashTable,S=new e.ScopedMembers(new e.DualStringHashTable(E,new e.StringHashTable));i.unitIndex=r.typeFlow.checker.locationInfo.unitIndex;var x=new e.SymbolScopeBuilder(m,y,null,null,f,o),T=new e.SymbolScopeBuilder(w,S,null,null,f,null);i.isConstructor&&r.scopeChain.thisType&&(r.scopeChain.thisType.constructorScope=x),i.symbols=v;if(!i.isSpecialFn()){var N=i.type,C=i.signature;i.isConstructor||(N.containedScope=x,x.container=N.symbol,N.memberScope=T,T.container=N.symbol),i.enclosingFnc=r.scopeChain.fnc,N.enclosingType=u?r.scopeChain.classType:r.scopeChain.thisType;var d=t.type.symbol;(i.fncFlags&e.FncFlags.Signature)==e.FncFlags.None&&i.vars&&(r.typeFlow.addLocalsFromScope(x,d,i.vars,v,!1),r.typeFlow.addLocalsFromScope(T,d,i.statics,b,!1));if(C.parameters){var k=C.parameters.length;for(var L=0;L<k;L++){var A=C.parameters[L];r.typeFlow.checker.resolveTypeLink(x,A.parameter.typeLink,!0)}}r.typeFlow.checker.resolveTypeLink(x,C.returnType,i.isSignature())}if(!i.isConstructor||e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod)){var O=i.isConstructor&&e.hasFlag(i.fncFlags,e.FncFlags.ClassMethod)?r.scopeChain.thisType:null;n(x,r,O,null,i)}}function h(t,r){var i=t;if(i.param){var s=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),o=new e.SymbolScopeBuilder(s,null,null,null,r.scopeChain.scope,r.scopeChain.scope.container);i.containedScope=o,n(o,r,r.scopeChain.thisType,r.scopeChain.classType,r.scopeChain.fnc)}}function p(t,n,r){var i=r.state,s=!0;if(t)if(t.nodeType==e.NodeType.List){var o=t;o.enclosingScope=i.scopeChain.scope}else t.nodeType==e.NodeType.Module?u(t,i):t.nodeType==e.NodeType.Class?a(t,i):t.nodeType==e.NodeType.Interface?f(t,i):t.nodeType==e.NodeType.With?l(t,i):t.nodeType==e.NodeType.FuncDecl?c(t,i):t.nodeType==e.NodeType.Catch?h(t,i):t.nodeType==e.NodeType.TypeRef&&(s=!1);return r.options.goChildren=s,t}function d(t,n,i){var s=i.state,o=!0;if(t)if(t.nodeType==e.NodeType.Module){var u=t;r(s),s.modDeclChain.pop(),s.modDeclChain.length>=1&&(s.typeFlow.checker.currentModDecl=s.modDeclChain[s.modDeclChain.length-1])}else if(t.nodeType==e.NodeType.Class)r(s);else if(t.nodeType==e.NodeType.Interface)r(s);else if(t.nodeType==e.NodeType.With)r(s);else if(t.nodeType==e.NodeType.FuncDecl){var a=t;(!a.isConstructor||e.hasFlag(a.fncFlags,e.FncFlags.ClassMethod))&&!a.isOverload&&r(s)}else if(t.nodeType==e.NodeType.Catch){var f=t;f.param&&r(s)}else o=!1;return i.options.goChildren=o,t}var t=function(){function e(e,t,n){this.scopeChain=e,this.typeFlow=t,this.modDeclChain=n}return e}();e.AssignScopeContext=t,e.pushAssignScope=n,e.popAssignScope=r,e.instanceCompare=i,e.instanceFilterStop=s;var o=function(){function e(e,t){this.select=e,this.stop=t,this.result=null}return e.prototype.reset=function(){this.result=null},e.prototype.update=function(e){return this.result=this.select(this.result,e),this.result?this.stop(this.result):!1},e}();e.ScopeSearchFilter=o,e.instanceFilter=new o(i,s),e.preAssignModuleScopes=u,e.preAssignClassScopes=a,e.preAssignInterfaceScopes=f,e.preAssignWithScopes=l,e.preAssignFuncDeclScopes=c,e.preAssignCatchScopes=h,e.preAssignScopes=p,e.postAssignScopes=d})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function i(t,n,r){var i=r.state;return e.hasFlag(t.flags,i.matchFlag)&&(i.pos<0||i.pos==t.limChar)&&(i.ast=t,t.type==null&&i.pos>=0&&i.flow.inScopeTypeCheck(t,i.scope),i.type=t.type,i.options.stopWalk()),t}function s(t,n,r,i,s,o,u,a,f){var l=new e.SymbolScopeBuilder(n,r,i,s,null,t),c=new e.ScopeChain(t,o.scopeChain,l);c.thisType=u,c.classType=a,c.moduleDecl=f,o.scopeChain=c}function o(e){e.scopeChain=e.scopeChain.previous}function u(t,n,r){var i=r.state,s=t.minChar,o=t.limChar;t.nodeType==e.NodeType.Script&&i.pos>o&&(o=i.pos);if(s<=i.pos&&o>=i.pos){switch(t.nodeType){case e.NodeType.Script:var u=t;i.scopeGetter=function(){return u.bod===null?null:u.bod.enclosingScope},i.scopeStartAST=u;break;case e.NodeType.Class:i.scopeGetter=function(){return t.type===null||t.type.instanceType.containedScope===null?null:t.type.instanceType.containedScope},i.scopeStartAST=t,i.enclosingClassDecl=t;break;case e.NodeType.ObjectLit:var a=t;a.targetType&&(i.scopeGetter=function(){return a.targetType.containedScope},i.objectLiteralScopeGetter=function(){return a.targetType.memberScope},i.enclosingObjectLit=a);break;case e.NodeType.Module:i.deepestModuleDecl=t,i.scopeGetter=function(){return t.type===null?null:t.type.containedScope},i.scopeStartAST=t;break;case e.NodeType.Interface:i.scopeGetter=function(){return t.type===null?null:t.type.containedScope},i.scopeStartAST=t;break;case e.NodeType.FuncDecl:var f=t;i.skipNextFuncDeclForClass?i.skipNextFuncDeclForClass=!1:(i.scopeGetter=function(){return f.isConstructor&&e.hasFlag(f.fncFlags,e.FncFlags.ClassMethod)&&t.type&&t.type.enclosingType?t.type.enclosingType.constructorScope:f.scopeType?f.scopeType.containedScope:f.type?f.type.containedScope:null},i.scopeStartAST=t)}r.options.goChildren=!0}else r.options.goChildren=!1;return t}function a(t,n,i,s,o){var a=new r(t,n,i,s,o);return e.getAstWalkerFactory().walk(n,u,null,null,a),a.scopeStartAST===null?null:a}var t=function(){function e(e,t){this.scopeChain=e,this.checker=t,this.script=null}return e}();e.TypeCollectionContext=t;var n=function(){function t(t,n,r){this.flow=t,this.pos=n,this.matchFlag=r,this.type=null,this.ast=null,this.options=new e.AstWalkOptions}return t}();e.MemberScopeContext=n;var r=function(){function t(e,t,n,r,i){this.logger=e,this.script=t,this.text=n,this.pos=r,this.isMemberCompletion=i,this.scopeGetter=null,this.objectLiteralScopeGetter=null,this.scopeStartAST=null,this.skipNextFuncDeclForClass=!1,this.deepestModuleDecl=null,this.enclosingClassDecl=null,this.enclosingObjectLit=null,this.publicsOnly=!0,this.useFullAst=!1}return t.prototype.getScope=function(){return this.scopeGetter()},t.prototype.getObjectLiteralScope=function(){return this.objectLiteralScopeGetter()},t.prototype.getScopeAST=function(){return this.scopeStartAST},t.prototype.getScopePosition=function(){return this.scopeStartAST.minChar},t.prototype.getScriptFragmentStartAST=function(){return this.scopeStartAST},t.prototype.getScriptFragmentPosition=function(){return this.getScriptFragmentStartAST().minChar},t.prototype.getScriptFragment=function(){if(this.scriptFragment==null){var t=this.getScriptFragmentStartAST(),n=t.minChar,r=this.isMemberCompletion?this.pos:this.pos+1;this.scriptFragment=e.quickParse(this.logger,t,this.text,n,r,null).Script}return this.scriptFragment},t}();e.EnclosingScopeContext=r,e.preFindMemberScope=i,e.pushTypeCollectionScope=s,e.popTypeCollectionScope=o,e.preFindEnclosingScope=u,e.findEnclosingScopeAt=a})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(){this.hasVariableArgList=!1,this.parameters=null,this.declAST=null,this.typeCheckStatus=e.TypeCheckStatus.NotStarted,this.nonOptionalParameterCount=0}return t.prototype.specializeType=function(n,r,i){var s=new t;this.hasVariableArgList&&(s.hasVariableArgList=!0),s.returnType=new e.TypeLink,this.returnType.type?s.returnType.type=this.returnType.type.specializeType(n,r,i,!1):s.returnType.type=i.anyType;if(this.parameters){s.parameters=[];for(var o=0,u=this.parameters.length;o<u;o++){var a=this.parameters[o],f=new e.ValueLocation,l=new e.ParameterSymbol(a.name,a.location,i.locationInfo.unitIndex,f);l.declAST=this.declAST,f.symbol=l,f.typeLink=new e.TypeLink,s.parameters[o]=l;var c=a.getType();c?(f.typeLink.type=c.specializeType(n,r,i,!1),l.declAST.type=f.typeLink.type):f.typeLink.type=i.anyType}}return s.nonOptionalParameterCount=this.nonOptionalParameterCount,s.declAST=this.declAST,s},t.prototype.toString=function(){return this.toStringHelper(!1,!1,null)},t.prototype.toStringHelper=function(e,t,n){var r;t?r="[":r="(";var i=this.parameters.length;for(var s=0;s<i;s++)r+=this.parameters[s].name+(this.parameters[s].isOptional()?"?":"")+": ",r+=this.parameters[s].getType().getScopedTypeName(n),s<i-1&&(r+=",");return e?t?r+="] => ":r+=") => ":t?r+="]: ":r+="): ",this.returnType.type?r+=this.returnType.type.getScopedTypeName(n):r+="any",r},t}();e.Signature=t;var n=function(){function t(){this.signatures=[],this.hasImplementation=!0,this.definitionSignature=null,this.hasBeenTypechecked=!1,this.flags=e.SignatureFlags.None}return t.prototype.addSignature=function(t){this.signatures==null&&(this.signatures=new Array),this.signatures[this.signatures.length]=t,t.declAST&&!t.declAST.isOverload&&!t.declAST.isSignature()&&!e.hasFlag(t.declAST.fncFlags,e.FncFlags.Ambient)&&e.hasFlag(t.declAST.fncFlags,e.FncFlags.Definition)&&(this.definitionSignature=t)},t.prototype.toString=function(){return this.signatures.toString()},t.prototype.toStrings=function(t,n,r){var i=[],s=this.signatures.length;s>1&&(n=!1);for(var o=0;o<s;o++){if(s>1&&this.signatures[o]==this.definitionSignature)continue;this.flags&e.SignatureFlags.IsIndexer?i[o]=this.signatures[o].toStringHelper(n,!0,r):i[o]=t+this.signatures[o].toStringHelper(n,!1,r)}return i},t.prototype.specializeType=function(e,n,r){var i=new t;if(this.signatures)for(var s=0,o=this.signatures.length;s<o;s++)i.addSignature(this.signatures[s].specializeType(e,n,r));return i},t.prototype.verifySignatures=function(t){var n=0;if(this.signatures&&(n=this.signatures.length)>0)for(var r=0;r<n;r++){for(var i=r+1;i<n;i++)this.signatures[r].declAST&&this.signatures[i].declAST&&!e.hasFlag(this.signatures[r].declAST.fncFlags,e.FncFlags.Definition)&&!e.hasFlag(this.signatures[i].declAST.fncFlags,e.FncFlags.Definition)&&t.signaturesAreIdentical(this.signatures[r],this.signatures[i])&&t.errorReporter.simpleError(this.signatures[r].declAST,this.signatures[r].declAST&&this.signatures[r].declAST.name?"Signature for '"+this.signatures[r].declAST.name.text+"' is duplicated":"Signature is duplicated");this.definitionSignature&&(t.signatureIsAssignableToTarget(this.definitionSignature,this.signatures[r])||t.errorReporter.simpleError(this.signatures[r].declAST,"Overload signature is not compatible with function definition"))}},t.prototype.typeCheck=function(t,n,r){if(this.hasBeenTypechecked)return;this.hasBeenTypechecked=!0;var i=0;if(this.signatures&&(i=this.signatures.length)>0){for(var s=0;s<i;s++)!r&&!this.definitionSignature&&this.signatures[s].declAST&&this.signatures[s].declAST.isOverload&&!e.hasFlag(this.signatures[s].declAST.fncFlags,e.FncFlags.Ambient)&&t.errorReporter.simpleError(this.signatures[s].declAST,"Overload declaration lacks definition"),this.signatures[s].declAST&&this.signatures[s].declAST.isConstructor&&this.signatures[s].declAST.classDecl&&this.signatures[s].declAST.classDecl.type.symbol.typeCheckStatus==e.TypeCheckStatus.NotStarted&&t.typeFlow.typeCheck(this.signatures[s].declAST.classDecl),t.typeFlow.typeCheck(this.signatures[s].declAST);this.verifySignatures(t)}},t}();e.SignatureGroup=n})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(t,n){return t.declAST&&n&&n.declAST&&t.declAST.nodeType==e.NodeType.FuncDecl?t.declAST.minChar<=n.declAST.minChar&&t.declAST.limChar>=n.declAST.limChar:!1}function r(e,t){while(e.container){if(e==t||n(e.container,t))return!0;e=e.container}return!1}(function(e){e._map=[],e._map[0]="NotStarted",e.NotStarted=0,e._map[1]="Started",e.Started=1,e._map[2]="Finished",e.Finished=2})(e.TypeCheckStatus||(e.TypeCheckStatus={}));var t=e.TypeCheckStatus;e.aLexicallyEnclosesB=n,e.aEnclosesB=r;var i=function(){function t(t,n,r){this.name=t,this.location=n,this.unitIndex=r,this.bound=!1,this.flags=e.SymbolFlags.None,this.isObjectLitField=!1,this.declAST=null,this.declModule=null,this.passSymbolCreated=e.CompilerDiagnostics.analysisPass}return t.prototype.instanceScope=function(){return null},t.prototype.isVariable=function(){return!1},t.prototype.isMember=function(){return!1},t.prototype.isInferenceSymbol=function(){return!1},t.prototype.isWith=function(){return!1},t.prototype.writeable=function(){return!1},t.prototype.isType=function(){return!1},t.prototype.getType=function(){return null},t.prototype.isAccessor=function(){return!1},t.prototype.isInstanceProperty=function(){return e.hasFlag(this.flags,e.SymbolFlags.Property)&&!e.hasFlag(this.flags,e.SymbolFlags.ModuleMember)},t.prototype.getTypeName=function(e){return this.toString()},t.prototype.getOptionalNameString=function(){return e.hasFlag(this.flags,e.SymbolFlags.Optional)?"?":""},t.prototype.pathToRoot=function(){var t=new Array,n=this;while(n&&n.name!=e.globalId)t[t.length]=n,n=n.container;return t},t.prototype.findCommonAncestorPath=function(e){if(this.container==null)return new Array;var t=this.container.pathToRoot(),n;e?n=e.pathToRoot():n=new Array;var r=-1;for(var i=0,s=t.length;i<s;i++){var o=t[i];for(var u=0,a=n.length;u<a;u++){var f=n[u];if(o==f){r=i;break}}if(r>=0)break}return r>=0?t.slice(0,r):t},t.prototype.scopeRelativeName=function(e){if(e==null)return this.name;var t=this.findCommonAncestorPath(e.container),n="";for(var r=0,i=t.length;r<i;r++)n=t[r].name+"."+n;return n+=this.name,n},t.prototype.fullName=function(){var t=this.name,n=this.container;while(n&&n.name!=e.globalId)t=n.name+"."+t,n=n.container;return t},t.prototype.visible=function(t,n){if(n==null||this.container==n.gloMod)return!0;if(e.hasFlag(this.flags,e.SymbolFlags.ModuleMember))return e.hasFlag(this.flags,e.SymbolFlags.Exported)?e.hasFlag(this.flags,e.SymbolFlags.Private)?r(this,t.container):!0:n&&n.currentModDecl==this.declModule||n.currentModDecl&&n.currentModDecl.mod&&n.currentModDecl.mod.symbol&&this.declModule&&this.declModule.mod&&this.declModule.mod.symbol&&r(n.currentModDecl.mod.symbol,this.declModule.mod.symbol);var i=this.declAST&&this.declAST.nodeType==e.NodeType.FuncDecl,s=i&&this.declAST.isMethod(),o=i&&e.hasFlag(this.declAST.fncFlags,e.FncFlags.Static),u=s&&e.hasFlag(this.declAST.fncFlags,e.FncFlags.Private),a=this.isType()&&this.aliasLink;return this.isMember()||s||o||a?e.hasFlag(this.flags,e.SymbolFlags.Private)||u?t.container==null&&this.container!=t.container?!1:this.container==null?!0:r(t.container,this.container):!0:this.container?r(this,t.container):!0},t.prototype.addRef=function(e){this.refs||(this.refs=[]),this.refs[this.refs.length]=e},t.prototype.toString=function(){return this.name?this.name:"_anonymous"},t.prototype.print=function(e){e.Write(this.toString())},t.prototype.specializeType=function(e,t,n){throw new Error("please implement in derived class")},t.prototype.setType=function(e){throw new Error("please implement in derived class")},t.prototype.kind=function(){throw new Error("please implement in derived class")},t}();e.Symbol=i;var s=function(){function e(){}return e}();e.ValueLocation=s;var o=function(n){function r(e,r,i){n.call(this,e,r,i),this.typeCheckStatus=t.NotStarted}return __extends(r,n),r.prototype.isInferenceSymbol=function(){return!0},r.prototype.transferVarFlags=function(t){e.hasFlag(t,e.VarFlags.Ambient)&&(this.flags|=e.SymbolFlags.Ambient),e.hasFlag(t,e.VarFlags.Constant)&&(this.flags|=e.SymbolFlags.Constant),e.hasFlag(t,e.VarFlags.Static)&&(this.flags|=e.SymbolFlags.Static),e.hasFlag(t,e.VarFlags.Property)&&(this.flags|=e.SymbolFlags.Property),e.hasFlag(t,e.VarFlags.Private)&&(this.flags|=e.SymbolFlags.Private),e.hasFlag(t,e.VarFlags.Public)&&(this.flags|=e.SymbolFlags.Public),e.hasFlag(t,e.VarFlags.Readonly)&&(this.flags|=e.SymbolFlags.Readonly),e.hasFlag(t,e.VarFlags.Exported)&&(this.flags|=e.SymbolFlags.Exported)},r}(i);e.InferenceSymbol=o;var u=function(t){function n(n,r,i,s){t.call(this,n,r,i),this.type=s,this.expansions=[],this.isMethod=!1,this.aliasLink=null,this.onlyReferencedAsTypeRef=e.optimizeModuleCodeGen,this.prettyName=this.name}return __extends(n,t),n.prototype.addLocation=function(e){this.additionalLocations==null&&(this.additionalLocations=[]),this.additionalLocations[this.additionalLocations.length]=e},n.prototype.kind=function(){return e.SymbolKind.Type},n.prototype.isType=function(){return!0},n.prototype.getType=function(){return this.type},n.prototype.getTypeName=function(e){return this.type.getMemberTypeName(this.name?this.name+this.getOptionalNameString():"",!1,!1,e)},n.prototype.instanceScope=function(){return!(this.type.typeFlags&e.TypeFlags.IsClass)&&this.type.isClass()?this.type.instanceType.constructorScope:this.type.containedScope},n.prototype.toString=function(){var e=this.type.getTypeName();return this.name&&(e=this.name+":"+e),e},n.prototype.isClass=function(){return this.instanceType!=null},n.prototype.isFunction=function(){return this.declAST!=null&&this.declAST.nodeType==e.NodeType.FuncDecl},n.prototype.specializeType=function(e,t,r){if(this.type==e)return t.symbol;var i=this.type.specializeType(e,t,r,!1);if(i!=this.type){var s=new n(this.name,0,-1,i);return s}return this},n.prototype.scopeRelativeName=function(t){if(t==null)return this.prettyName+this.getOptionalNameString();var n=this.findCommonAncestorPath(t.container),r="";for(var i=0,s=n.length;i<s;i++){var o=n[i].kind()==e.SymbolKind.Type?n[i].prettyName:n[i].name;r=o+"."+r}return r+=this.prettyName+this.getOptionalNameString(),r},n}(o);e.TypeSymbol=u;var a=function(e){function t(t,n,r){e.call(this,"with",t,n,r)}return __extends(t,e),t.prototype.isWith=function(){return!0},t}(u);e.WithSymbol=a;var f=function(n){function r(e,t,r,i,s){n.call(this,e,t,r),this.canWrite=i,this.field=s,this.getter=null,this.setter=null,this.hasBeenEmitted=!1,this.name=e,this.location=t}return __extends(r,n),r.prototype.kind=function(){return e.SymbolKind.Field},r.prototype.writeable=function(){return this.isAccessor()?this.setter!=null:this.canWrite},r.prototype.getType=function(){return this.field.typeLink.type},r.prototype.getTypeName=function(e){return this.name+this.getOptionalNameString()+": "+this.field.typeLink.type.getMemberTypeName("",!0,!1,e)},r.prototype.isMember=function(){return!0},r.prototype.setType=function(e){this.field.typeLink.type=e},r.prototype.isAccessor=function(){return this.getter!=null||this.setter!=null},r.prototype.isVariable=function(){return!0},r.prototype.toString=function(){return this.name+this.getOptionalNameString()+":"+this.field.typeLink.type.getTypeName()},r.prototype.specializeType=function(n,i,o){var u=this.field.typeLink.type.specializeType(n,i,o,!1);if(u!=this.field.typeLink.type){var a=new s,f=new r(this.name,0,o.locationInfo.unitIndex,this.canWrite,a);return f.flags=this.flags,a.symbol=f,a.typeLink=new e.TypeLink,f.setType(u),f.typeCheckStatus=t.Finished,f}return this},r}(o);e.FieldSymbol=f;var l=function(t){function n(e,n,r,i){t.call(this,e,n,r),this.parameter=i,this.argsOffset=-1,this.name=e,this.location=n}return __extends(n,t),n.prototype.kind=function(){return e.SymbolKind.Parameter},n.prototype.writeable=function(){return!0},n.prototype.getType=function(){return this.parameter.typeLink.type},n.prototype.setType=function(e){this.parameter.typeLink.type=e},n.prototype.isVariable=function(){return!0},n.prototype.isOptional=function(){return this.parameter&&this.parameter.symbol&&this.parameter.symbol.declAST?this.parameter.symbol.declAST.isOptional:!1},n.prototype.getTypeName=function(e){return this.name+(this.isOptional()?"?":"")+":"+this.getType().getMemberTypeName("",!1,!1,e)},n.prototype.toString=function(){return this.name+(this.isOptional()?"?":"")+":"+this.getType().getTypeName()},n.prototype.specializeType=function(e,t,r){var i=this.parameter.typeLink.type.specializeType(e,t,r,!1);if(this.parameter.typeLink.type!=i){var o=new s,u=new n(this.name,0,r.locationInfo.unitIndex,o);return o.symbol=u,u.setType(i),u}return this},n}(o);e.ParameterSymbol=l;var c=function(t){function n(e,n,r,i){t.call(this,e,n,r),this.variable=i}return __extends(n,t),n.prototype.kind=function(){return e.SymbolKind.Variable},n.prototype.writeable=function(){return!0},n.prototype.getType=function(){return this.variable.typeLink.type},n.prototype.getTypeName=function(e){return this.name+":"+this.getType().getMemberTypeName("",!1,!1,e)},n.prototype.setType=function(e){this.variable.typeLink.type=e},n.prototype.isVariable=function(){return!0},n}(o);e.VariableSymbol=c})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function i(t,n){return n?!(e.hasFlag(t.flags,e.SymbolFlags.Private)||t.declAST&&t.declAST.nodeType==e.NodeType.FuncDecl&&e.hasFlag(t.declAST.fncFlags,e.FncFlags.Private)):!0}var t=function(){function e(e){this.dualMembers=e,this.allMembers=this.dualMembers,this.publicMembers=this.dualMembers.primaryTable,this.privateMembers=this.dualMembers.secondaryTable}return e.prototype.addPublicMember=function(e,t){return this.dualMembers.primaryTable.add(e,t)},e.prototype.addPrivateMember=function(e,t){return this.dualMembers.secondaryTable.add(e,t)},e}();e.ScopedMembers=t,function(e){e._map=[],e._map[0]="None",e.None=0,e._map[1]="Type",e.Type=1,e._map[2]="Field",e.Field=2,e._map[3]="Parameter",e.Parameter=3,e._map[4]="Variable",e.Variable=4}(e.SymbolKind||(e.SymbolKind={}));var n=e.SymbolKind,r=function(){function e(e){this.container=e}return e.prototype.printLabel=function(){return"base"},e.prototype.getAllSymbolNames=function(e){return["please","implement","in","derived","classes"]},e.prototype.getAllTypeSymbolNames=function(e){return["please","implement","in","derived","classes"]},e.prototype.getAllValueSymbolNames=function(e){return["please","implement","in","derived","classes"]},e.prototype.search=function(e,t,n,r){return null},e.prototype.findLocal=function(e,t,n){return null},e.prototype.find=function(e,t,n){return null},e.prototype.findImplementation=function(e,t,n){return null},e.prototype.findAmbient=function(e,t,n){return null},e.prototype.print=function(e){this.container?e.WriteLine(this.printLabel()+" scope with container: "+this.container.name+"..."):e.WriteLine(this.printLabel()+" scope...")},e.prototype.enter=function(e,t,n,r,i,s,o){throw new Error("please implement in derived class")},e.prototype.getTable=function(){throw new Error("please implement in derived class")},e}();e.SymbolScope=r;var s=function(t){function n(e){t.call(this,e),this.valueCache=null,this.valueImplCache=null,this.valueAmbientCache=null,this.typeCache=null,this.typeImplCache=null,this.typeAmbientCache=null,this.parents=null,this.container=e}return __extends(n,t),n.prototype.printLabel=function(){return"agg"},n.prototype.search=function(e,t,n,r){if(this.parents)for(var i=0;i<this.parents.length;i++){var s=this.parents[i].search(e,t,n,r);if(s&&e.update(s))return s}return e.result},n.prototype.getAllSymbolNames=function(e){var t=[];if(this.parents)for(var n=0;n<this.parents.length;n++){var r=this.parents[n].getAllSymbolNames(e);r&&(t=t.concat(r))}return t},n.prototype.getAllTypeSymbolNames=function(e){var t=[];if(this.parents)for(var n=0;n<this.parents.length;n++){var r=this.parents[n].getAllTypeSymbolNames(e);r&&(t=t.concat(r))}return t},n.prototype.getAllValueSymbolNames=function(e){var t=[];if(this.parents)for(var n=0;n<this.parents.length;n++){var r=this.parents[n].getAllValueSymbolNames(e);r&&(t=t.concat(r))}return t},n.prototype.print=function(e){t.prototype.print.call(this,e);if(this.parents)for(var n=0;n<this.parents.length;n++)this.parents[n].print(e)},n.prototype.findImplementation=function(t,n,r){var i=null,s=0,o=this.valueImplCache;r&&(o=this.typeImplCache);if(o&&(i=o.lookup(t))!=null&&(n?!(e.hasFlag(i.flags,e.SymbolFlags.Private)||i.declAST&&i.declAST.nodeType==e.NodeType.FuncDecl&&e.hasFlag(i.declAST.fncFlags,e.FncFlags.Private)):!0))return i;if(this.parents)for(s=0;s<this.parents.length;s++){i=this.parents[s].findImplementation(t,n,r);if(i)break}return o&&(r?(this.typeImplCache=new e.StringHashTable,o=this.typeImplCache):(this.valueImplCache=new e.StringHashTable,o=this.valueImplCache)),o.add(t,i),i},n.prototype.find=function(t,n,r){var i=null,s=0,o=this.valueCache;r&&(o=this.typeCache);if(o&&(i=o.lookup(t))!=null&&(n?!(e.hasFlag(i.flags,e.SymbolFlags.Private)||i.declAST&&i.declAST.nodeType==e.NodeType.FuncDecl&&e.hasFlag(i.declAST.fncFlags,e.FncFlags.Private)):!0))return i;if(this.parents)for(s=0;s<this.parents.length;s++){i=this.parents[s].find(t,n,r);if(i)break}return o==null&&(r?(this.typeCache=new e.StringHashTable,o=this.typeCache):(this.valueCache=new e.StringHashTable,o=this.valueCache)),o.add(t,i),i},n.prototype.findAmbient=function(t,n,r){var i=null,s=0,o=this.valueAmbientCache;r&&(o=this.typeAmbientCache);if(o&&(i=o.lookup(t))!=null)return i;if(this.parents)for(s=0;s<this.parents.length;s++){i=this.parents[s].findAmbient(t,n,r);if(i)break}return o==null&&(r?(this.typeAmbientCache=new e.StringHashTable,o=this.typeAmbientCache):(this.valueAmbientCache=new e.StringHashTable,o=this.valueAmbientCache)),o.add(t,i),i},n.prototype.addParentScope=function(e){this.parents==null&&(this.parents=new Array),this.parents[this.parents.length]=e},n}(r);e.SymbolAggregateScope=s;var o=function(e){function t(t,n,r,i,s){e.call(this,s),this.valueMembers=t,this.ambientValueMembers=n,this.enclosedTypes=r,this.ambientEnclosedTypes=i,this.container=s}return __extends(t,e),t.prototype.printLabel=function(){return"table"},t.prototype.getAllSymbolNames=function(e){var t=this.getAllTypeSymbolNames(e);return t.concat(this.getAllValueSymbolNames(e))},t.prototype.getAllTypeSymbolNames=function(e){var t=[];return this.ambientEnclosedTypes&&(t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(t=t.concat(this.enclosedTypes.allMembers.getAllKeys())),t},t.prototype.getAllValueSymbolNames=function(e){var t=[];return this.ambientValueMembers&&(t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(t=t.concat(this.valueMembers.allMembers.getAllKeys())),t},t.prototype.search=function(e,t,n,r){var i=this.find(t,n,r);return e.update(i),e.result},t.prototype.find=function(e,t,n){var r=null,i=null;n?(r=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,i=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers):(r=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,i=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers);if(i){var s=i.lookup(e);if(s)return s}if(r){var s=r.lookup(e);if(s)return s}return null},t.prototype.findAmbient=function(e,t,n){var r=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;n&&(r=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers);if(r){var i=r.lookup(e);if(i)return i}return null},t.prototype.print=function(t){e.prototype.print.call(this,t),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(e,n,r){t.WriteLine("  "+e)},null)},t.prototype.findImplementation=function(e,t,r){var i=this.find(e,t,r);if(i)if(i.kind()==n.Type){var s=i;s.type.hasImplementation()||(i=null)}else if(i.container&&i.container.kind()==n.Type){var o=i.container;o.type.hasImplementation()||(i=null)}return i},t.prototype.getTable=function(){return this.valueMembers.publicMembers},t}(r);e.SymbolTableScope=o;var u=function(t){function n(e,n,r,i,s,o){t.call(this,o),this.valueMembers=e,this.ambientValueMembers=n,this.enclosedTypes=r,this.ambientEnclosedTypes=i,this.parent=s,this.container=o}return __extends(n,t),n.prototype.printLabel=function(){return"builder"},n.prototype.getAllSymbolNames=function(e){var t=this.getAllTypeSymbolNames(e);return t.concat(this.getAllValueSymbolNames(e))},n.prototype.getAllTypeSymbolNames=function(e){var t=[];this.ambientEnclosedTypes&&(t=t.concat(this.ambientEnclosedTypes.allMembers.getAllKeys())),this.enclosedTypes&&(t=t.concat(this.enclosedTypes.allMembers.getAllKeys()));if(!e&&this.parent){var n=this.parent.getAllTypeSymbolNames(e);n&&(t=t.concat(n))}return t},n.prototype.getAllValueSymbolNames=function(e){var t=[];this.ambientValueMembers&&(t=t.concat(this.ambientValueMembers.allMembers.getAllKeys())),this.valueMembers&&(t=t.concat(this.valueMembers.allMembers.getAllKeys()));if(!e&&this.parent){var n=this.parent.getAllValueSymbolNames(e);n&&(t=t.concat(n))}return t},n.prototype.search=function(e,t,n,r){var i=null,s=this.valueMembers==null?null:n?this.valueMembers.publicMembers:this.valueMembers.allMembers,o=this.ambientValueMembers==null?null:n?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;r&&(s=this.enclosedTypes==null?null:n?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,o=this.ambientEnclosedTypes==null?null:n?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers);if(o&&(i=o.lookup(t))!=null&&e.update(i))return i;if(s&&(i=s.lookup(t))!=null&&e.update(i))return i;if(this.parent){i=this.parent.search(e,t,n,r);if(i&&e.update(i))return i}return e.result},n.prototype.print=function(e){t.prototype.print.call(this,e),this.ambientValueMembers&&this.ambientValueMembers.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null),this.valueMembers&&this.valueMembers.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null),this.ambientEnclosedTypes&&this.ambientEnclosedTypes.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null),this.enclosedTypes&&this.enclosedTypes.allMembers.map(function(t,n,r){var i=n;e.WriteLine("  "+t)},null),this.parent&&this.parent.print(e)},n.prototype.find=function(e,t,n){var r=null,i=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,s=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return n&&(i=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,s=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),s&&(r=s.lookup(e))!=null?r:i&&(r=i.lookup(e))!=null?r:this.parent?this.parent.find(e,t,n):null},n.prototype.findAmbient=function(e,t,n){var r=null,i=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return n&&(i=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),i&&(r=i.lookup(e))!=null?r:this.parent?this.parent.findAmbient(e,t,n):null},n.prototype.findLocal=function(e,t,n){var r=null,i=this.valueMembers==null?null:t?this.valueMembers.publicMembers:this.valueMembers.allMembers,s=this.ambientValueMembers==null?null:t?this.ambientValueMembers.publicMembers:this.ambientValueMembers.allMembers;return n&&(i=this.enclosedTypes==null?null:t?this.enclosedTypes.publicMembers:this.enclosedTypes.allMembers,s=this.ambientEnclosedTypes==null?null:t?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.allMembers),i&&(r=i.lookup(e))!=null&&r?r:s&&(r=s.lookup(e))!=null&&r?r:null},n.prototype.enter=function(t,n,r,i,s,o,u){var a=null;u?o?a=this.ambientEnclosedTypes==null?null:s?this.ambientEnclosedTypes.publicMembers:this.ambientEnclosedTypes.privateMembers:a=this.ambientValueMembers==null?null:s?this.ambientValueMembers.publicMembers:this.ambientValueMembers.privateMembers:o?a=this.enclosedTypes==null?null:s?this.enclosedTypes.publicMembers:this.enclosedTypes.privateMembers:a=this.valueMembers==null?null:s?this.valueMembers.publicMembers:this.valueMembers.privateMembers,a?a.add(r.name,r)||i.duplicateIdentifier(n,r.name):e.CompilerDiagnostics.Alert("YYYYY"),r.container=t},n.prototype.getTable=function(){return this.valueMembers.allMembers},n}(r);e.SymbolScopeBuilder=u;var a=function(e){function t(t,n,r){e.call(this,n),this.scope=t,this.filter=r}return __extends(t,e),t.prototype.print=function(e){this.scope.print(e)},t.prototype.find=function(e,t,n){return this.filter.reset(),this.scope.search(this.filter,e,t,n)},t.prototype.findLocal=function(e,t,n){return this.scope.findLocal(e,t,n)},t}(r);e.FilteredSymbolScope=a;var f=function(e){function t(t,n,r,i){e.call(this,t,null,null,null,n,r),this.filter=i}return __extends(t,e),t.prototype.findLocal=function(t,n,r){var i=e.prototype.findLocal.call(this,t,n,r);return i&&!this.filter(i)?null:i},t.prototype.search=function(e,t,n,r){throw new Error("please implement")},t.prototype.find=function(t,n,r){var i=e.prototype.findLocal.call(this,t,n,r);return i&&!this.filter(i)?null:e.prototype.find.call(this,t,n,r)},t}(u);e.FilteredSymbolScopeBuilder=f})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(t,n,r,s,o,u,a,f){t!==undefined&&(e.tokenTable[t]=new i(t,n,r,s,o,u,a,f),s!=e.NodeType.None&&(e.nodeTypeTable[s]=a,e.nodeTypeToTokTable[s]=t),u!=e.NodeType.None&&(e.nodeTypeTable[u]=a))}function o(t){return e.tokenTable[t]}function v(){for(var n=0;n<=t.LimFixed;n++)e.staticTokens[n]=new f(n)}(function(e){e._map=[],e._map[0]="ANY",e.ANY=0,e._map[1]="BOOL",e.BOOL=1,e._map[2]="BREAK",e.BREAK=2,e._map[3]="CASE",e.CASE=3,e._map[4]="CATCH",e.CATCH=4,e._map[5]="CLASS",e.CLASS=5,e._map[6]="CONST",e.CONST=6,e._map[7]="CONTINUE",e.CONTINUE=7,e._map[8]="DEBUGGER",e.DEBUGGER=8,e._map[9]="DEFAULT",e.DEFAULT=9,e._map[10]="DELETE",e.DELETE=10,e._map[11]="DO",e.DO=11,e._map[12]="ELSE",e.ELSE=12,e._map[13]="ENUM",e.ENUM=13,e._map[14]="EXPORT",e.EXPORT=14,e._map[15]="EXTENDS",e.EXTENDS=15,e._map[16]="DECLARE",e.DECLARE=16,e._map[17]="FALSE",e.FALSE=17,e._map[18]="FINALLY",e.FINALLY=18,e._map[19]="FOR",e.FOR=19,e._map[20]="FUNCTION",e.FUNCTION=20,e._map[21]="CONSTRUCTOR",e.CONSTRUCTOR=21,e._map[22]="GET",e.GET=22,e._map[23]="IF",e.IF=23,e._map[24]="IMPLEMENTS",e.IMPLEMENTS=24,e._map[25]="IMPORT",e.IMPORT=25,e._map[26]="IN",e.IN=26,e._map[27]="INSTANCEOF",e.INSTANCEOF=27,e._map[28]="INTERFACE",e.INTERFACE=28,e._map[29]="LET",e.LET=29,e._map[30]="MODULE",e.MODULE=30,e._map[31]="NEW",e.NEW=31,e._map[32]="NUMBER",e.NUMBER=32,e._map[33]="NULL",e.NULL=33,e._map[34]="PACKAGE",e.PACKAGE=34,e._map[35]="PRIVATE",e.PRIVATE=35,e._map[36]="PROTECTED",e.PROTECTED=36,e._map[37]="PUBLIC",e.PUBLIC=37,e._map[38]="RETURN",e.RETURN=38,e._map[39]="SET",e.SET=39,e._map[40]="STATIC",e.STATIC=40,e._map[41]="STRING",e.STRING=41,e._map[42]="SUPER",e.SUPER=42,e._map[43]="SWITCH",e.SWITCH=43,e._map[44]="THIS",e.THIS=44,e._map[45]="THROW",e.THROW=45,e._map[46]="TRUE",e.TRUE=46,e._map[47]="TRY",e.TRY=47,e._map[48]="TYPEOF",e.TYPEOF=48,e._map[49]="VAR",e.VAR=49,e._map[50]="VOID",e.VOID=50,e._map[51]="WITH",e.WITH=51,e._map[52]="WHILE",e.WHILE=52,e._map[53]="YIELD",e.YIELD=53,e._map[54]="SColon",e.SColon=54,e._map[55]="LParen",e.LParen=55,e._map[56]="RParen",e.RParen=56,e._map[57]="LBrack",e.LBrack=57,e._map[58]="RBrack",e.RBrack=58,e._map[59]="LCurly",e.LCurly=59,e._map[60]="RCurly",e.RCurly=60,e._map[61]="Comma",e.Comma=61,e._map[62]="Asg",e.Asg=62,e._map[63]="AsgAdd",e.AsgAdd=63,e._map[64]="AsgSub",e.AsgSub=64,e._map[65]="AsgMul",e.AsgMul=65,e._map[66]="AsgDiv",e.AsgDiv=66,e._map[67]="AsgMod",e.AsgMod=67,e._map[68]="AsgAnd",e.AsgAnd=68,e._map[69]="AsgXor",e.AsgXor=69,e._map[70]="AsgOr",e.AsgOr=70,e._map[71]="AsgLsh",e.AsgLsh=71,e._map[72]="AsgRsh",e.AsgRsh=72,e._map[73]="AsgRs2",e.AsgRs2=73,e._map[74]="QMark",e.QMark=74,e._map[75]="Colon",e.Colon=75,e._map[76]="LogOr",e.LogOr=76,e._map[77]="LogAnd",e.LogAnd=77,e._map[78]="Or",e.Or=78,e._map[79]="Xor",e.Xor=79,e._map[80]="And",e.And=80,e._map[81]="EQ",e.EQ=81,e._map[82]="NE",e.NE=82,e._map[83]="Eqv",e.Eqv=83,e._map[84]="NEqv",e.NEqv=84,e._map[85]="LT",e.LT=85,e._map[86]="LE",e.LE=86,e._map[87]="GT",e.GT=87,e._map[88]="GE",e.GE=88,e._map[89]="Lsh",e.Lsh=89,e._map[90]="Rsh",e.Rsh=90,e._map[91]="Rs2",e.Rs2=91,e._map[92]="Add",e.Add=92,e._map[93]="Sub",e.Sub=93,e._map[94]="Mult",e.Mult=94,e._map[95]="Div",e.Div=95,e._map[96]="Pct",e.Pct=96,e._map[97]="Tilde",e.Tilde=97,e._map[98]="Bang",e.Bang=98,e._map[99]="Inc",e.Inc=99,e._map[100]="Dec",e.Dec=100,e._map[101]="Dot",e.Dot=101,e._map[102]="Ellipsis",e.Ellipsis=102,e._map[103]="Error",e.Error=103,e._map[104]="EOF",e.EOF=104,e._map[105]="Arrow",e.Arrow=105,e._map[106]="ID",e.ID=106,e._map[107]="QString",e.QString=107,e._map[108]="Regex",e.Regex=108,e._map[109]="NumberLit",e.NumberLit=109,e._map[110]="Whitespace",e.Whitespace=110,e._map[111]="Comment",e.Comment=111,e._map[112]="Lim",e.Lim=112,e.LimFixed=e.Arrow,e.LimKeyword=e.YIELD})(e.TokenID||(e.TokenID={}));var t=e.TokenID;e.tokenTable=new Array,e.nodeTypeTable=new Array,e.nodeTypeToTokTable=new Array,e.noRegexTable=new Array,e.noRegexTable[t.ID]=!0,e.noRegexTable[t.QString]=!0,e.noRegexTable[t.NumberLit]=!0,e.noRegexTable[t.Regex]=!0,e.noRegexTable[t.THIS]=!0,e.noRegexTable[t.Inc]=!0,e.noRegexTable[t.Dec]=!0,e.noRegexTable[t.RParen]=!0,e.noRegexTable[t.RBrack]=!0,e.noRegexTable[t.RCurly]=!0,e.noRegexTable[t.TRUE]=!0,e.noRegexTable[t.FALSE]=!0,function(e){e._map=[],e._map[0]="No",e.No=0,e._map[1]="Cma",e.Cma=1,e._map[2]="Asg",e.Asg=2,e._map[3]="Que",e.Que=3,e._map[4]="Lor",e.Lor=4,e._map[5]="Lan",e.Lan=5,e._map[6]="Bor",e.Bor=6,e._map[7]="Xor",e.Xor=7,e._map[8]="Ban",e.Ban=8,e._map[9]="Equ",e.Equ=9,e._map[10]="Cmp",e.Cmp=10,e._map[11]="Shf",e.Shf=11,e._map[12]="Add",e.Add=12,e._map[13]="Mul",e.Mul=13,e._map[14]="Uni",e.Uni=14,e._map[15]="Lim",e.Lim=15}(e.OperatorPrecedence||(e.OperatorPrecedence={}));var n=e.OperatorPrecedence;(function(e){e._map=[],e.None=0,e.Javascript=1,e.JavascriptFuture=2,e.TypeScript=4,e.JavascriptFutureStrict=8,e.TypeScriptAndJS=e.Javascript|e.TypeScript,e.TypeScriptAndJSFuture=e.JavascriptFuture|e.TypeScript,e.TypeScriptAndJSFutureStrict=e.JavascriptFutureStrict|e.TypeScript})(e.Reservation||(e.Reservation={}));var r=e.Reservation,i=function(){function e(e,t,n,r,i,s,o,u){this.tokenId=e,this.reservation=t,this.binopPrecedence=n,this.binopNodeType=r,this.unopPrecedence=i,this.unopNodeType=s,this.text=o,this.ers=u}return e}();e.TokenInfo=i,s(t.ANY,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"any",e.ErrorRecoverySet.PrimType),s(t.BOOL,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"bool",e.ErrorRecoverySet.PrimType),s(t.BREAK,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"break",e.ErrorRecoverySet.Stmt),s(t.CASE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"case",e.ErrorRecoverySet.SCase),s(t.CATCH,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"catch",e.ErrorRecoverySet.Catch),s(t.CLASS,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"class",e.ErrorRecoverySet.TypeScriptS),s(t.CONST,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"const",e.ErrorRecoverySet.Var),s(t.CONTINUE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"continue",e.ErrorRecoverySet.Stmt),s(t.DEBUGGER,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.Debugger,"debugger",e.ErrorRecoverySet.Stmt),s(t.DEFAULT,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"default",e.ErrorRecoverySet.SCase),s(t.DELETE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.Uni,e.NodeType.Delete,"delete",e.ErrorRecoverySet.Prefix),s(t.DO,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"do",e.ErrorRecoverySet.Stmt),s(t.ELSE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"else",e.ErrorRecoverySet.Else),s(t.ENUM,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"enum",e.ErrorRecoverySet.TypeScriptS),s(t.EXPORT,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"export",e.ErrorRecoverySet.TypeScriptS),s(t.EXTENDS,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"extends",e.ErrorRecoverySet.None),s(t.DECLARE,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"declare",e.ErrorRecoverySet.Stmt),s(t.FALSE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"false",e.ErrorRecoverySet.RLit),s(t.FINALLY,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"finally",e.ErrorRecoverySet.Catch),s(t.FOR,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"for",e.ErrorRecoverySet.Stmt),s(t.FUNCTION,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"function",e.ErrorRecoverySet.Func),s(t.CONSTRUCTOR,r.TypeScriptAndJSFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"constructor",e.ErrorRecoverySet.Func),s(t.GET,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"get",e.ErrorRecoverySet.Func),s(t.SET,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"set",e.ErrorRecoverySet.Func),s(t.IF,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"if",e.ErrorRecoverySet.Stmt),s(t.IMPLEMENTS,r.TypeScriptAndJSFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"implements",e.ErrorRecoverySet.None),s(t.IMPORT,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"import",e.ErrorRecoverySet.TypeScriptS),s(t.IN,r.TypeScriptAndJS,n.Cmp,e.NodeType.In,n.No,e.NodeType.None,"in",e.ErrorRecoverySet.None),s(t.INSTANCEOF,r.TypeScriptAndJS,n.Cmp,e.NodeType.InstOf,n.No,e.NodeType.None,"instanceof",e.ErrorRecoverySet.BinOp),s(t.INTERFACE,r.TypeScriptAndJSFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"interface",e.ErrorRecoverySet.TypeScriptS),s(t.LET,r.JavascriptFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"let",e.ErrorRecoverySet.None),s(t.MODULE,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"module",e.ErrorRecoverySet.TypeScriptS),s(t.NEW,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"new",e.ErrorRecoverySet.PreOp),s(t.NUMBER,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"number",e.ErrorRecoverySet.PrimType),s(t.NULL,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"null",e.ErrorRecoverySet.RLit),s(t.PACKAGE,r.JavascriptFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"package",e.ErrorRecoverySet.None),s(t.PRIVATE,r.TypeScriptAndJSFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"private",e.ErrorRecoverySet.TypeScriptS),s(t.PROTECTED,r.JavascriptFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"protected",e.ErrorRecoverySet.None),s(t.PUBLIC,r.TypeScriptAndJSFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"public",e.ErrorRecoverySet.TypeScriptS),s(t.RETURN,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"return",e.ErrorRecoverySet.Stmt),s(t.STATIC,r.TypeScriptAndJSFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"static",e.ErrorRecoverySet.None),s(t.STRING,r.TypeScript,n.No,e.NodeType.None,n.No,e.NodeType.None,"string",e.ErrorRecoverySet.PrimType),s(t.SUPER,r.TypeScriptAndJSFuture,n.No,e.NodeType.None,n.No,e.NodeType.None,"super",e.ErrorRecoverySet.RLit),s(t.SWITCH,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"switch",e.ErrorRecoverySet.Stmt),s(t.THIS,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"this",e.ErrorRecoverySet.RLit),s(t.THROW,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"throw",e.ErrorRecoverySet.Stmt),s(t.TRUE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"true",e.ErrorRecoverySet.RLit),s(t.TRY,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"try",e.ErrorRecoverySet.Stmt),s(t.TYPEOF,r.TypeScriptAndJS,n.No,e.NodeType.None,n.Uni,e.NodeType.Typeof,"typeof",e.ErrorRecoverySet.Prefix),s(t.VAR,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"var",e.ErrorRecoverySet.Var),s(t.VOID,r.TypeScriptAndJS,n.No,e.NodeType.None,n.Uni,e.NodeType.Void,"void",e.ErrorRecoverySet.Prefix),s(t.WITH,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.With,"with",e.ErrorRecoverySet.Stmt),s(t.WHILE,r.TypeScriptAndJS,n.No,e.NodeType.None,n.No,e.NodeType.None,"while",e.ErrorRecoverySet.While),s(t.YIELD,r.JavascriptFutureStrict,n.No,e.NodeType.None,n.No,e.NodeType.None,"yield",e.ErrorRecoverySet.None),s(t.ID,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"identifier",e.ErrorRecoverySet.ID),s(t.NumberLit,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"numberLiteral",e.ErrorRecoverySet.Literal),s(t.Regex,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"regex",e.ErrorRecoverySet.RegExp),s(t.QString,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"qstring",e.ErrorRecoverySet.Literal),s(t.SColon,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,";",e.ErrorRecoverySet.SColon),s(t.RParen,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,")",e.ErrorRecoverySet.RParen),s(t.RBrack,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"]",e.ErrorRecoverySet.RBrack),s(t.LCurly,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"{",e.ErrorRecoverySet.LCurly),s(t.RCurly,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"}",e.ErrorRecoverySet.RCurly),s(t.Ellipsis,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"...",e.ErrorRecoverySet.None),s(t.Comma,r.None,n.Cma,e.NodeType.Comma,n.No,e.NodeType.None,",",e.ErrorRecoverySet.Comma),s(t.Asg,r.None,n.Asg,e.NodeType.Asg,n.No,e.NodeType.None,"=",e.ErrorRecoverySet.Asg),s(t.AsgAdd,r.None,n.Asg,e.NodeType.AsgAdd,n.No,e.NodeType.None,"+=",e.ErrorRecoverySet.BinOp),s(t.AsgSub,r.None,n.Asg,e.NodeType.AsgSub,n.No,e.NodeType.None,"-=",e.ErrorRecoverySet.BinOp),s(t.AsgMul,r.None,n.Asg,e.NodeType.AsgMul,n.No,e.NodeType.None,"*=",e.ErrorRecoverySet.BinOp),s(t.AsgDiv,r.None,n.Asg,e.NodeType.AsgDiv,n.No,e.NodeType.None,"/=",e.ErrorRecoverySet.BinOp),s(t.AsgMod,r.None,n.Asg,e.NodeType.AsgMod,n.No,e.NodeType.None,"%=",e.ErrorRecoverySet.BinOp),s(t.AsgAnd,r.None,n.Asg,e.NodeType.AsgAnd,n.No,e.NodeType.None,"&=",e.ErrorRecoverySet.BinOp),s(t.AsgXor,r.None,n.Asg,e.NodeType.AsgXor,n.No,e.NodeType.None,"^=",e.ErrorRecoverySet.BinOp),s(t.AsgOr,r.None,n.Asg,e.NodeType.AsgOr,n.No,e.NodeType.None,"|=",e.ErrorRecoverySet.BinOp),s(t.AsgLsh,r.None,n.Asg,e.NodeType.AsgLsh,n.No,e.NodeType.None,"<<=",e.ErrorRecoverySet.BinOp),s(t.AsgRsh,r.None,n.Asg,e.NodeType.AsgRsh,n.No,e.NodeType.None,">>=",e.ErrorRecoverySet.BinOp),s(t.AsgRs2,r.None,n.Asg,e.NodeType.AsgRs2,n.No,e.NodeType.None,">>>=",e.ErrorRecoverySet.BinOp),s(t.QMark,r.None,n.Que,e.NodeType.QMark,n.No,e.NodeType.None,"?",e.ErrorRecoverySet.BinOp),s(t.Colon,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,":",e.ErrorRecoverySet.Colon),s(t.LogOr,r.None,n.Lor,e.NodeType.LogOr,n.No,e.NodeType.None,"||",e.ErrorRecoverySet.BinOp),s(t.LogAnd,r.None,n.Lan,e.NodeType.LogAnd,n.No,e.NodeType.None,"&&",e.ErrorRecoverySet.BinOp),s(t.Or,r.None,n.Bor,e.NodeType.Or,n.No,e.NodeType.None,"|",e.ErrorRecoverySet.BinOp),s(t.Xor,r.None,n.Xor,e.NodeType.Xor,n.No,e.NodeType.None,"^",e.ErrorRecoverySet.BinOp),s(t.And,r.None,n.Ban,e.NodeType.And,n.No,e.NodeType.None,"&",e.ErrorRecoverySet.BinOp),s(t.EQ,r.None,n.Equ,e.NodeType.Eq,n.No,e.NodeType.None,"==",e.ErrorRecoverySet.BinOp),s(t.NE,r.None,n.Equ,e.NodeType.Ne,n.No,e.NodeType.None,"!=",e.ErrorRecoverySet.BinOp),s(t.Eqv,r.None,n.Equ,e.NodeType.Eqv,n.No,e.NodeType.None,"===",e.ErrorRecoverySet.BinOp),s(t.NEqv,r.None,n.Equ,e.NodeType.NEqv,n.No,e.NodeType.None,"!==",e.ErrorRecoverySet.BinOp),s(t.LT,r.None,n.Cmp,e.NodeType.Lt,n.No,e.NodeType.None,"<",e.ErrorRecoverySet.BinOp),s(t.LE,r.None,n.Cmp,e.NodeType.Le,n.No,e.NodeType.None,"<=",e.ErrorRecoverySet.BinOp),s(t.GT,r.None,n.Cmp,e.NodeType.Gt,n.No,e.NodeType.None,">",e.ErrorRecoverySet.BinOp),s(t.GE,r.None,n.Cmp,e.NodeType.Ge,n.No,e.NodeType.None,">=",e.ErrorRecoverySet.BinOp),s(t.Lsh,r.None,n.Shf,e.NodeType.Lsh,n.No,e.NodeType.None,"<<",e.ErrorRecoverySet.BinOp),s(t.Rsh,r.None,n.Shf,e.NodeType.Rsh,n.No,e.NodeType.None,">>",e.ErrorRecoverySet.BinOp),s(t.Rs2,r.None,n.Shf,e.NodeType.Rs2,n.No,e.NodeType.None,">>>",e.ErrorRecoverySet.BinOp),s(t.Add,r.None,n.Add,e.NodeType.Add,n.Uni,e.NodeType.Pos,"+",e.ErrorRecoverySet.AddOp),s(t.Sub,r.None,n.Add,e.NodeType.Sub,n.Uni,e.NodeType.Neg,"-",e.ErrorRecoverySet.AddOp),s(t.Mult,r.None,n.Mul,e.NodeType.Mul,n.No,e.NodeType.None,"*",e.ErrorRecoverySet.BinOp),s(t.Div,r.None,n.Mul,e.NodeType.Div,n.No,e.NodeType.None,"/",e.ErrorRecoverySet.BinOp),s(t.Pct,r.None,n.Mul,e.NodeType.Mod,n.No,e.NodeType.None,"%",e.ErrorRecoverySet.BinOp),s(t.Tilde,r.None,n.No,e.NodeType.None,n.Uni,e.NodeType.Not,"~",e.ErrorRecoverySet.PreOp),s(t.Bang,r.None,n.No,e.NodeType.None,n.Uni,e.NodeType.LogNot,"!",e.ErrorRecoverySet.PreOp),s(t.Inc,r.None,n.No,e.NodeType.None,n.Uni,e.NodeType.IncPre,"++",e.ErrorRecoverySet.PreOp),s(t.Dec,r.None,n.No,e.NodeType.None,n.Uni,e.NodeType.DecPre,"--",e.ErrorRecoverySet.PreOp),s(t.LParen,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"(",e.ErrorRecoverySet.LParen),s(t.LBrack,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"[",e.ErrorRecoverySet.LBrack),s(t.Dot,r.None,n.Uni,e.NodeType.None,n.No,e.NodeType.None,".",e.ErrorRecoverySet.Dot),s(t.EOF,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"<EOF>",e.ErrorRecoverySet.EOF),s(t.Arrow,r.None,n.No,e.NodeType.None,n.No,e.NodeType.None,"=>",e.ErrorRecoverySet.None),e.lookupToken=o,function(e){e._map=[],e._map[0]="Punctuation",e.Punctuation=0,e._map[1]="Keyword",e.Keyword=1,e._map[2]="Operator",e.Operator=2,e._map[3]="Comment",e.Comment=3,e._map[4]="Whitespace",e.Whitespace=4,e._map[5]="Identifier",e.Identifier=5,e._map[6]="Literal",e.Literal=6}(e.TokenClass||(e.TokenClass={}));var u=e.TokenClass,a=function(){function e(e,t,n){this.tok=e,this.minChar=t,this.limChar=n}return e}();e.SavedToken=a;var f=function(){function n(e){this.tokenId=e}return n.prototype.toString=function(){return"token: "+this.tokenId+" "+this.getText()+" ("+t._map[this.tokenId]+")"},n.prototype.print=function(e,t){t.WriteLine(this.toString()+",on line"+e)},n.prototype.getText=function(){return e.tokenTable[this.tokenId].text},n.prototype.classification=function(){if(this.tokenId<=t.LimKeyword)return u.Keyword;var n=o(this.tokenId);if(n!=undefined)if(n.unopNodeType!=e.NodeType.None||n.binopNodeType!=e.NodeType.None)return u.Operator;return u.Punctuation},n}();e.Token=f;var l=function(e){function n(n){e.call(this,t.NumberLit),this.value=n}return __extends(n,e),n.prototype.getText=function(){return this.value.toString()},n.prototype.classification=function(){return u.Literal},n}(f);e.NumberToken=l;var c=function(e){function n(t,n){e.call(this,t),this.value=n,this.tokenId=t}return __extends(n,e),n.prototype.getText=function(){return this.value},n.prototype.classification=function(){return this.tokenId==t.ID?u.Identifier:u.Literal},n}(f);e.StringToken=c;var h=function(e){function t(t,n){e.call(this,t),this.value=n,this.tokenId=t}return __extends(t,e),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return u.Whitespace},t}(f);e.WhitespaceToken=h;var p=function(e){function t(t,n,r,i,s,o){e.call(this,t),this.value=n,this.isBlock=r,this.startPos=i,this.line=s,this.endsLine=o,this.tokenID=t}return __extends(t,e),t.prototype.getText=function(){return this.value},t.prototype.classification=function(){return u.Comment},t}(f);e.CommentToken=p;var d=function(e){function n(n){e.call(this,t.Regex),this.regex=n}return __extends(n,e),n.prototype.getText=function(){return this.regex.toString()},n.prototype.classification=function(){return u.Literal},n}(f);e.RegexToken=d,e.staticTokens=new Array,e.initializeStaticTokens=v})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(){this.arrayBase=null}return e.prototype.specialize=function(e,t){return this.arrayBase==null&&(this.arrayBase=e.specializeType(t.wildElm.type,this.arrayType.elementType,t,!0)),this.arrayBase},e}();e.ArrayCache=t;var n=function(){function t(){this.onlyCaptureFirstError=!1,this.flags=e.TypeRelationshipFlags.SuccessfulComparison,this.message=""}return t.prototype.addMessageToFront=function(e){this.onlyCaptureFirstError?this.setMessage(e):this.message=this.message?e+":\n	"+this.message:e},t.prototype.setMessage=function(e){this.message=e},t}();e.TypeComparisonInfo=n,function(e){e._map=[],e._map[0]="Resident",e.Resident=0,e._map[1]="Transient",e.Transient=1}(e.TypeCheckCollectionMode||(e.TypeCheckCollectionMode={}));var r=e.TypeCheckCollectionMode,i=function(){function t(t){this.errorReporter=t,this.importedGlobalsTable=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),this.importedGlobalsTypeTable=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),this.globals=null,this.globalTypes=null,this.ambientGlobals=null,this.ambientGlobalTypes=null,this.residentGlobalValues=new e.StringHashTable,this.residentGlobalTypes=new e.StringHashTable,this.residentGlobalAmbientValues=new e.StringHashTable,this.residentGlobalAmbientTypes=new e.StringHashTable,this.residentTypeCheck=!0,this.mod=null,this.gloMod=null,this.wildElm=null,this.importedGlobals=new e.SymbolScopeBuilder(null,this.importedGlobalsTable,null,this.importedGlobalsTypeTable,null,null),this.dualGlobalValues=new e.DualStringHashTable(this.residentGlobalValues,new e.StringHashTable),this.dualGlobalTypes=new e.DualStringHashTable(this.residentGlobalTypes,new e.StringHashTable),this.dualAmbientGlobalValues=new e.DualStringHashTable(this.residentGlobalAmbientValues,new e.StringHashTable),this.dualAmbientGlobalTypes=new e.DualStringHashTable(this.residentGlobalAmbientTypes,new e.StringHashTable);var n=new e.ScopedMembers(new e.DualStringHashTable(this.dualGlobalValues,new e.StringHashTable)),i=new e.ScopedMembers(new e.DualStringHashTable(this.dualAmbientGlobalValues,new e.StringHashTable)),s=new e.ScopedMembers(new e.DualStringHashTable(this.dualGlobalTypes,new e.StringHashTable)),o=new e.ScopedMembers(new e.DualStringHashTable(this.dualAmbientGlobalTypes,new e.StringHashTable));this.globalScope=new e.SymbolScopeBuilder(n,i,s,o,this.importedGlobals,null),this.voidType=this.enterPrimitive(e.Primitive.Void,"void"),this.booleanType=this.enterPrimitive(e.Primitive.Boolean,"bool"),this.doubleType=this.enterPrimitive(e.Primitive.Double,"number"),this.importedGlobals.ambientEnclosedTypes.addPublicMember("number",this.doubleType.symbol),this.stringType=this.enterPrimitive(e.Primitive.String,"string"),this.anyType=this.enterPrimitive(e.Primitive.Any,"any"),this.nullType=this.enterPrimitive(e.Primitive.Null,"null"),this.undefinedType=this.enterPrimitive(e.Primitive.Undefined,"undefined"),this.setCollectionMode(r.Resident),this.wildElm=new e.TypeSymbol("_element",0,-1,new e.Type),this.importedGlobalsTypeTable.addPublicMember(this.wildElm.name,this.wildElm),this.mod=new e.ModuleType(s,o),this.mod.members=n,this.mod.ambientMembers=i,this.mod.containedScope=this.globalScope,this.gloMod=new e.TypeSymbol(e.globalId,0,-1,this.mod),this.mod.members.addPublicMember(this.gloMod.name,this.gloMod),this.defineGlobalValue("undefined",this.undefinedType)}return t.prototype.enterPrimitive=function(t,n){var r=new e.Type;r.primitiveTypeClass=t;var i=new e.TypeSymbol(n,0,-1,r);return i.typeCheckStatus=e.TypeCheckStatus.Finished,r.symbol=i,this.importedGlobals.enter(null,null,i,this.errorReporter,!0,!0,!0),r},t.prototype.setCollectionMode=function(e){this.residentTypeCheck=this.dualGlobalValues.insertPrimary=this.dualGlobalTypes.insertPrimary=this.dualAmbientGlobalValues.insertPrimary=this.dualAmbientGlobalTypes.insertPrimary=e==r.Resident},t.prototype.refreshPersistentState=function(){this.globals=new e.StringHashTable,this.globalTypes=new e.StringHashTable,this.ambientGlobals=new e.StringHashTable,this.ambientGlobalTypes=new e.StringHashTable,this.dualGlobalValues.secondaryTable=this.globals,this.dualGlobalTypes.secondaryTable=this.globalTypes,this.dualAmbientGlobalValues.secondaryTable=this.ambientGlobals,this.dualAmbientGlobalTypes.secondaryTable=this.ambientGlobalTypes},t.prototype.defineGlobalValue=function(t,n){var r=new e.ValueLocation;r.typeLink=new e.TypeLink;var i=new e.VariableSymbol(t,0,-1,r);i.setType(n),i.typeCheckStatus=e.TypeCheckStatus.Finished,i.container=this.gloMod,this.importedGlobalsTable.addPublicMember(t,i)},t}();e.PersistentGlobalTypeState=i;var s=function(){function e(e,t,n){this.contextualType=e,this.provisional=t,this.contextID=n,this.targetSig=null,this.targetThis=null,this.targetAccessorType=null}return e}();e.ContextualTypeContext=s;var o=function(){function t(e){this.checker=e,this.contextStack=[],this.hadProvisionalErrors=!1}return t.contextID=e.TypeCheckStatus.Finished+1,t.prototype.pushContextualType=function(e,n){this.contextStack.push(new s(e,n,t.contextID++)),this.checker.errorReporter.pushToErrorSink=n},t.prototype.popContextualType=function(){var e=this.contextStack.pop();return this.checker.errorReporter.pushToErrorSink=this.isProvisional(),this.hadProvisionalErrors=this.hadProvisionalErrors||e.provisional&&this.checker.errorReporter.getCapturedErrors().length,this.checker.errorReporter.freeCapturedErrors(),e},t.prototype.getContextualType=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1]:null},t.prototype.getContextID=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].contextID:e.TypeCheckStatus.Finished},t.prototype.isProvisional=function(){return this.contextStack.length?this.contextStack[this.contextStack.length-1].provisional:!1},t}();e.ContextualTypingContextStack=o;var u=function(){function n(e){this.persistentState=e,this.errorReporter=null,this.checkControlFlow=!1,this.printControlFlowGraph=!1,this.checkControlFlowUseDef=!1,this.styleSettings=null,this.units=null,this.anon="_anonymous",this.locationInfo=null,this.typeFlow=null,this.currentCompareA=null,this.currentCompareB=null,this.currentModDecl=null,this.inBind=!1,this.inWith=!1,this.errorsOnWith=!0,this.currentContextualTypeContext=null,this.resolvingBases=!1,this.canCallDefinitionSignature=!1,this.assignableCache={},this.subtypeCache={},this.identicalCache={},this.provisionalStartedTypecheckObjects=[],this.voidType=this.persistentState.voidType,this.booleanType=this.persistentState.booleanType,this.numberType=this.persistentState.doubleType,this.stringType=this.persistentState.stringType,this.anyType=this.persistentState.anyType,this.nullType=this.persistentState.nullType,this.undefinedType=this.persistentState.undefinedType,this.globals=this.persistentState.dualGlobalValues,this.globalTypes=this.persistentState.dualGlobalTypes,this.ambientGlobals=this.persistentState.dualAmbientGlobalValues,this.ambientGlobalTypes=this.persistentState.dualAmbientGlobalTypes,this.gloModType=this.persistentState.mod,this.gloMod=this.persistentState.gloMod,this.wildElm=this.persistentState.wildElm,this.globalScope=this.persistentState.globalScope,this.typingContextStack=new o(this)}return n.prototype.setStyleOptions=function(e){this.styleSettings=e},n.prototype.setContextualType=function(e,t){this.typingContextStack.pushContextualType(e,t),this.currentContextualTypeContext=this.typingContextStack.getContextualType()},n.prototype.unsetContextualType=function(){var e=this.typingContextStack.popContextualType();return this.currentContextualTypeContext=this.typingContextStack.getContextualType(),e},n.prototype.hadProvisionalErrors=function(){return this.typingContextStack.hadProvisionalErrors},n.prototype.resetProvisionalErrors=function(){this.typingContextStack.getContextualType()||(this.typingContextStack.hadProvisionalErrors=!1)},n.prototype.typeCheckWithContextualType=function(e,t,n,r){n&&this.setContextualType(e,this.typingContextStack.isProvisional()||t),this.typeFlow.typeCheck(r),n&&this.unsetContextualType()},n.prototype.resetTargetType=function(){this.currentContextualTypeContext=this.typingContextStack.getContextualType()},n.prototype.killTargetType=function(){this.currentContextualTypeContext=null,this.errorReporter.pushToErrorSink=!1},n.prototype.hasTargetType=function(){return this.currentContextualTypeContext&&this.currentContextualTypeContext.contextualType},n.prototype.getTargetTypeContext=function(){return this.currentContextualTypeContext},n.prototype.inProvisionalTypecheckMode=function(){return this.typingContextStack.isProvisional()},n.prototype.getTypeCheckFinishedStatus=function(){return this.inProvisionalTypecheckMode()?this.typingContextStack.getContextID():e.TypeCheckStatus.Finished},n.prototype.typeStatusIsFinished=function(t){return t==e.TypeCheckStatus.Finished||this.inProvisionalTypecheckMode()&&t==this.typingContextStack.getContextID()},n.prototype.addStartedPTO=function(e){this.inProvisionalTypecheckMode()&&(this.provisionalStartedTypecheckObjects[this.provisionalStartedTypecheckObjects.length]=e)},n.prototype.cleanStartedPTO=function(){for(var t=0;t<this.provisionalStartedTypecheckObjects.length;t++)this.provisionalStartedTypecheckObjects[t].typeCheckStatus=e.TypeCheckStatus.NotStarted;this.provisionalStartedTypecheckObjects=[]},n.prototype.collectTypes=function(t){if(t.nodeType==e.NodeType.Script){var n=t;this.locationInfo=n.locationInfo}var r=new e.ScopeChain(this.gloMod,null,this.globalScope),i=new e.TypeCollectionContext(r,this);e.getAstWalkerFactory().walk(t,e.preCollectTypes,e.postCollectTypes,null,i)},n.prototype.makeArrayType=function(n){return n.arrayCache==null&&(n.arrayCache=new t,n.arrayCache.arrayType=new e.Type,n.arrayCache.arrayType.elementType=n,n.arrayCache.arrayType.symbol=n.symbol),n.arrayCache.arrayType},n.prototype.getParameterList=function(t,n){var r=null,i=null,s=t.members.length,o=0,u=[];if(s>0){r=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),i=new e.SymbolScopeBuilder(r,null,null,null,null,n);for(var a=0;a<s;a++){var f=t.members[a],l=new e.ValueLocation,c=new e.ParameterSymbol(f.id.text,f.minChar,this.locationInfo.unitIndex,l);c.declAST=f,f.id.sym=c,f.sym=c,l.symbol=c,l.typeLink=e.getTypeLink(f.typeExpr,this,!1),i.enter(null,f,c,this.errorReporter,!0,!1,!1),u[u.length]=c,f.isOptionalArg()||o++}}return{parameters:u,nonOptionalParameterCount:o}},n.prototype.createFunctionSignature=function(t,n,r,i,s){var o=e.hasFlag(t.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported)||n==this.gloMod,u=e.hasFlag(t.fncFlags,e.FncFlags.Static),a=e.hasFlag(t.fncFlags,e.FncFlags.Private),f=e.hasFlag(t.fncFlags,e.FncFlags.Definition),l=e.hasFlag(t.fncFlags,e.FncFlags.Ambient),c=t.isConstructMember()||t.isConstructor,h=n==this.gloMod,p=new e.Signature,d=t.fncFlags&e.FncFlags.IsFunctionExpression;t.returnTypeAnnotation||f?p.returnType=e.getTypeLink(t.returnTypeAnnotation,this,!1):(p.returnType=new e.TypeLink,p.returnType.type=this.anyType),p.hasVariableArgList=t.variableArgList;var v=this.getParameterList(t.args,n);p.parameters=v.parameters,p.nonOptionalParameterCount=v.nonOptionalParameterCount,t.signature=p,p.declAST=t;var m=i&&i.getType()&&!i.isAccessor()&&(t.isSignature()||l==e.hasFlag(i.flags,e.SymbolFlags.Ambient));m&&a!=e.hasFlag(i.flags,e.SymbolFlags.Private)&&this.errorReporter.simpleError(t,"Public/Private visibility of overloads does not agree");var g=m?i.getType():new e.Type;c?(g.construct==null&&(g.construct=new e.SignatureGroup),g.construct.addSignature(p),g.construct.hasImplementation=!t.isSignature(),g.construct.hasImplementation&&g.setHasImplementation()):t.isIndexerMember()?(g.index==null&&(g.index=new e.SignatureGroup,g.index.flags|=e.SignatureFlags.IsIndexer),g.index.addSignature(p),g.index.hasImplementation=!t.isSignature(),g.index.hasImplementation&&g.setHasImplementation()):(g.call==null&&(g.call=new e.SignatureGroup),g.call.addSignature(p),g.call.hasImplementation=!t.isSignature(),g.call.hasImplementation&&g.setHasImplementation());var y=g.instanceType;y&&!u&&(y.call==null?y.call=g.call:g.call&&y.call.signatures.concat(g.call.signatures));var b=null,w=!1;t.name&&!t.name.isMissing()?b=t.name.text:t.hint&&(b=t.hint,w=!0),g.symbol==null&&(g.symbol=new e.TypeSymbol(b?b:this.anon,t.minChar,this.locationInfo.unitIndex,g),m||(g.symbol.declAST=t)),u&&(g.symbol.flags|=e.SymbolFlags.Static),l&&(g.symbol.flags|=e.SymbolFlags.Ambient),a&&(g.symbol.flags|=e.SymbolFlags.Private),g.symbol.isMethod=t.isMethod(),g.symbol.isMethod&&(g.symbol.flags|=e.SymbolFlags.Property),t.type=g,c||(b&&!d&&!t.isAccessor()&&!w?s?t.isMethod()&&u?(n.type.members.publicMembers.add(b,g.symbol)||this.errorReporter.duplicateIdentifier(t,b),g.symbol.container=n):(i==null||i.declAST&&!i.declAST.isOverload&&n.isType())&&r.enter(n,t,g.symbol,this.errorReporter,!a&&(o||u||h),!1,l):t.isSpecialFn()||(g.symbol.container=n):t.isSpecialFn()||(g.symbol.container=n));if(m){var E=i?i.getType():null,S=g;if(S!=E){S.construct==null?E&&E.construct?S.construct=E.construct:S.construct=new e.SignatureGroup:E&&E.construct&&S.construct.signatures.concat(E.construct.signatures);if(E){S.call==null?S.call=E.call:E.call&&S.call.signatures.concat(E.call.signatures);if(!u){S.instanceType==null&&(S.instanceType=E.instanceType);var y=S.instanceType;y&&(y.call==null?y.call=E.call:E.call&&y.call.signatures.concat(E.call.signatures))}S.index==null?S.index=E.index:E.index&&S.index.signatures.concat(E.index.signatures)}}}return p},n.prototype.createAccessorSymbol=function(t,n,r,i,s,o,u){var a=null,f=t.signature,l=t.name.text,c=e.hasFlag(t.fncFlags,e.FncFlags.Static),h=e.hasFlag(t.fncFlags,e.FncFlags.Private);if(n==null){var p=new e.ValueLocation;a=new e.FieldSymbol(l,t.minChar,this.locationInfo.unitIndex,!1,p),p.symbol=a,a.declAST=t,e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)?(a.getter&&this.errorReporter.simpleError(t,"Redeclaration of property getter"),a.getter=f.declAST.type.symbol):(a.setter&&this.errorReporter.simpleError(t,"Redeclaration of property setter"),a.setter=f.declAST.type.symbol),p.typeLink=e.getTypeLink(null,this,!1),i?r?(r.members.publicMembers.add(l,a)||this.errorReporter.duplicateIdentifier(t,a.name),a.container=r.symbol):this.errorReporter.simpleError(t,"Accessor property may not be added in this context"):o.enter(u,t,a,this.errorReporter,!h||c,!1,!1),s&&(a.flags|=e.SymbolFlags.Property),c&&(a.flags|=e.SymbolFlags.Static),h?a.flags|=e.SymbolFlags.Private:a.flags|=e.SymbolFlags.Public}else a=n,h!=e.hasFlag(a.flags,e.SymbolFlags.Private)&&this.errorReporter.simpleError(t,"Getter and setter accessors do not agree in visibility"),e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)?(a.getter&&this.errorReporter.simpleError(t,"Redeclaration of property getter"),a.getter=t.type.symbol):(a.setter&&this.errorReporter.simpleError(t,"Redeclaration of property setter"),a.setter=t.type.symbol);return a},n.prototype.addBases=function(t,n,r){t.addParentScope(new e.SymbolTableScope(n.members,n.ambientMembers,n.getAllEnclosedTypes(),n.getAllAmbientEnclosedTypes(),n.symbol));var i=0,s;if(n.extendsList)for(var o=n.extendsList.length;i<o;i++){s=n.extendsList[i];if(r.baseId==s.typeID){this.errorReporter.reportErrorFromSym(s.symbol,"Type '"+r.base+"' is recursively referenced as a base class of itself"),s.symbol.flags|=e.SymbolFlags.RecursivelyReferenced;break}this.addBases(t,s,r)}},n.prototype.scopeOf=function(t){var n=new e.SymbolAggregateScope(t.symbol),r={base:t.symbol&&t.symbol.name?t.symbol.name:"{}",baseId:t.typeID};return this.addBases(n,t,r),n},n.prototype.lookupMemberType=function(e,t){var n=null;e.containedScope?n=e.containedScope.find(t,!1,!0):e.members&&(n=e.members.allMembers.lookup(t),n==null&&e.ambientMembers&&(n=e.ambientMembers.allMembers.lookup(t)));if(n==null){var r=e.getAllEnclosedTypes(),i=e.getAllAmbientEnclosedTypes();r&&(n=r.allMembers.lookup(t),n==null&&i&&(n=i.allMembers.lookup(t)))}return n&&n.isType()?n.getType():null},n.prototype.findSymbolForDynamicModule=function(t,n,r){var i=t,s=r(t);if(s==null){s||(t=e.swapQuotes(i),s=r(t)),s||(t=e.stripQuotes(i)+".ts",s=r(t)),s||(t=e.stripQuotes(i)+".str",s=r(t)),s||(t=e.stripQuotes(i)+".d.ts",s=r(t)),s||(t=e.stripQuotes(i)+".d.str",s=r(t));if(!s&&!e.isRelative(i)){t=i;var o=e.stripQuotes(t),u=e.getRootFilePath(e.switchToForwardSlashes(n));while(s==null&&u!=""&&u!="/")t=e.normalizePath(u+o+".ts"),s=r(t),s==null&&(t=e.changePathToSTR(t),s=r(t)),s==null&&(t=e.changePathToDTS(t),s=r(t)),s==null&&(t=e.changePathToDSTR(t),s=r(t)),s==null&&(u=e.normalizePath(u+".."),u=u&&u!="/"?u+"/":u)}}return s},n.prototype.resolveTypeMember=function(t,n){var r=n.operand1,i=n.operand2,s=this.anyType,o=this.anyType;if(r&&i&&i.nodeType==e.NodeType.Name){if(r.nodeType==e.NodeType.Dot)o=this.resolveTypeMember(t,r);else if(r.nodeType==e.NodeType.Name){var u=r,a=t.find(u.text,!1,!0);if(a==null)this.errorReporter.unresolvedSymbol(u,u.text);else if(a.isType()){var f=a;if(f.aliasLink&&!f.type&&f.aliasLink.alias.nodeType==e.NodeType.Name){var l=f.aliasLink.alias.text,c=this.findSymbolForDynamicModule(l,this.locationInfo.filename,function(e){return t.find(e,!1,!0)});c&&(f.type=c.getType())}if(e.optimizeModuleCodeGen&&a){var h=a.getType();if(h&&f.aliasLink&&f.onlyReferencedAsTypeRef){var p=h.symbol.declAST;p&&e.hasFlag(p.modFlags,e.ModuleFlags.IsDynamic)&&(f.onlyReferencedAsTypeRef=!this.resolvingBases)}}a.visible(t,this)||this.errorReporter.simpleError(r,"The symbol '"+u.text+"' is not visible at this point"),o=a.getType(),u.sym=a}else this.errorReporter.simpleError(r,"Expected type")}o||(o=this.anyType);if(o!=this.anyType){var d=i;s=this.lookupMemberType(o,d.text),s==null?(s=this.anyType,this.errorReporter.simpleError(n,"Expected type")):s.symbol.visible(t,this)||this.errorReporter.simpleError(r,"The symbol '"+i.text+"' is not visible at this point"),d.sym=s.symbol}}return s.isClass()&&(s=s.instanceType),s},n.prototype.resolveFuncDecl=function(e,t,n){var r=this.createFunctionSignature(e,t.container,t,n,!1).declAST.type.symbol,i;e.isConstructMember()?i=r.type.construct.signatures:e.isIndexerMember()?i=r.type.getInstanceType().index.signatures:i=r.type.call.signatures;var s=i[i.length-1],o=s.parameters.length;for(var u=0;u<o;u++){var a=s.parameters[u];this.resolveTypeLink(t,a.parameter.typeLink,!0)}return o&&e.variableArgList&&(s.parameters[o-1].parameter.typeLink.type.elementType||(this.errorReporter.simpleErrorFromSym(s.parameters[o-1].parameter.symbol,"... parameter must have array type"),s.parameters[o-1].parameter.typeLink.type.elementType=this.makeArrayType(s.parameters[o-1].parameter.typeLink.type))),this.resolveTypeLink(t,s.returnType,e.isSignature()),r},n.prototype.resolveVarDecl=function(t,n){var r=new e.ValueLocation,i=new e.FieldSymbol(t.id.text,t.minChar,this.locationInfo.unitIndex,(t.varFlags&e.VarFlags.Readonly)==e.VarFlags.None,r);return i.transferVarFlags(t.varFlags),r.symbol=i,i.declAST=t,r.typeLink=e.getTypeLink(t.typeExpr,this,t.init==null),this.resolveTypeLink(n,r.typeLink,!0),t.sym=i,t.type=r.typeLink.type,i},n.prototype.resolveTypeLink=function(t,n,r){var i=0;if(n.type==null){var s=n.ast;if(s)while(n.type==null)switch(s.nodeType){case e.NodeType.Name:var o=s,u=t.find(o.text,!1,!0);u==null?(n.type=this.anyType,this.errorReporter.unresolvedSymbol(o,o.text)):u.isType()?(u.visible(t,this)||this.errorReporter.simpleError(s,"The symbol '"+o.text+"' is not visible at this point"),o.sym=u,n.type=u.getType(),n.type?n.type.isClass()&&(n.type=n.type.instanceType):n.type=this.anyType):(n.type=this.anyType,this.errorReporter.simpleError(s,"Expected type"));break;case e.NodeType.Dot:n.type=this.resolveTypeMember(t,s);break;case e.NodeType.TypeRef:var a=s;i=a.arrayCount,s=a.term,s==null&&(n.type=this.anyType);break;case e.NodeType.Interface:var f=s,l=new e.Type,c=new e.TypeSymbol(f.name.text,s.minChar,this.locationInfo.unitIndex,l);l.symbol=c,l.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),l.containedScope=new e.SymbolTableScope(l.members,null,null,null,c),l.containedScope.container=c,l.memberScope=l.containedScope;var h=f.members,p=h.members,d=p.length;for(var v=0;v<d;v++){var m=p[v],g=null,y=!0,b=null;if(m.nodeType==e.NodeType.FuncDecl){var w=m;b=w.name,g=l.members.allMembers.lookup(w.getNameText()),y=g==null,w.isSpecialFn()?(y=!1,g=this.resolveFuncDecl(w,t,c)):g=this.resolveFuncDecl(w,t,g),w.type=g.type}else b=m.id,g=this.resolveVarDecl(m,t);y&&(b&&e.hasFlag(b.flags,e.ASTFlags.OptionalName)&&(g.flags|=e.SymbolFlags.Optional),l.members.allMembers.add(g.name,g)||this.errorReporter.duplicateIdentifier(s,g.name))}s.type=l,n.type=l;break;case e.NodeType.FuncDecl:var E=this.resolveFuncDecl(s,t,null);n.type=E.type;break;default:n.type=this.anyType,this.errorReporter.simpleError(s,"Expected type")}for(var S=i;S>0;S--)n.type=this.makeArrayType(n.type);r&&n.type==null&&(n.type=this.anyType),n.ast&&(n.ast.type=n.type)}},n.prototype.findMostApplicableSignature=function(e,t){if(e.length==1)return{sig:e[0].signature,ambiguous:!1};var n=e[0],r=null,i=null,s=null,o=null,u=!1;for(var a=1;a<e.length;a++){r=e[a];var f=0;for(f=0;t&&f<t.members.length;f++){i=t.members[f].type,s=f<n.signature.parameters.length?n.signature.parameters[f].getType():n.signature.parameters[n.signature.parameters.length-1].getType().elementType,o=f<r.signature.parameters.length?r.signature.parameters[f].getType():r.signature.parameters[r.signature.parameters.length-1].getType().elementType;if(this.typesAreIdentical(s,o))continue;if(this.typesAreIdentical(i,s))break;if(this.typesAreIdentical(i,o)){n=r;break}if(this.sourceIsSubtypeOfTarget(s,o))break;if(this.sourceIsSubtypeOfTarget(o,s)){n=r;break}if(r.hadProvisionalErrors)break;if(n.hadProvisionalErrors){n=r;break}}if(!t||f==t.members.length){var l={getLength:function(){return 2},setTypeAtIndex:function(e,t){},getTypeAtIndex:function(e){return e?r.signature.returnType.type:n.signature.returnType.type}},c=this.findBestCommonType(n.signature.returnType.type,null,l);u=!c}else u=!1}return{sig:n.signature,ambiguous:u}},n.prototype.getApplicableSignatures=function(t,n,r){var i=[],s=null,o=!1,u=null,a=!1;for(var f=0;f<t.length;f++){o=!1;for(var l=0;l<n.members.length;l++){if(l>=t[f].parameters.length)continue;s=t[f].parameters[l].getType(),t[f].declAST.variableArgList&&l>=t[f].nonOptionalParameterCount-1&&s.isArray()&&(s=s.elementType);if(s==this.anyType)continue;if(n.members[l].nodeType==e.NodeType.FuncDecl){if(this.typeFlow.functionInterfaceType&&s==this.typeFlow.functionInterfaceType)continue;if(!this.canContextuallyTypeFunction(s,n.members[l],!0)){if(!this.canContextuallyTypeFunction(s,n.members[l],!1))break;this.typeFlow.typeCheck(n.members[l]);if(!this.sourceIsAssignableToTarget(n.members[l].type,s,r))break}else{this.typeCheckWithContextualType(s,!0,!0,n.members[l]),this.cleanStartedPTO(),a=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(n.members[l].type,s,r)||(r&&r.setMessage("Could not apply type '"+s.getTypeName()+"' to argument "+(l+1)+", which is of type '"+n.members[l].type.getTypeName()+"'"),o=!0),a&&(u=this.currentContextualTypeContext,this.typeCheckWithContextualType(null,!0,!0,n.members[l]),this.sourceIsAssignableToTarget(n.members[l].type,s)||(o=!0),this.cleanStartedPTO()),this.resetProvisionalErrors();if(o)break}}else if(n.members[l].nodeType==e.NodeType.ObjectLit){if(this.typeFlow.objectInterfaceType&&s==this.typeFlow.objectInterfaceType)continue;this.typeCheckWithContextualType(s,!0,!0,n.members[l]),this.cleanStartedPTO(),a=this.hadProvisionalErrors(),this.sourceIsAssignableToTarget(n.members[l].type,s,r)||(r&&r.setMessage("Could not apply type '"+s.getTypeName()+"' to argument "+(l+1)+", which is of type '"+n.members[l].type.getTypeName()+"'"),o=!0),a&&(this.typeCheckWithContextualType(null,!0,!0,n.members[l]),this.sourceIsAssignableToTarget(n.members[l].type,s)||(o=!0),this.cleanStartedPTO()),this.resetProvisionalErrors();if(o)break}else if(n.members[l].nodeType==e.NodeType.ArrayLit){if(this.typeFlow.arrayInterfaceType&&s==this.typeFlow.arrayInterfaceType)continue;this.typeCheckWithContextualType(s,!0,!0,n.members[l]),this.cleanStartedPTO(),a=this.hadProvisionalErrors();if(!this.sourceIsAssignableToTarget(n.members[l].type,s,r)){r&&r.setMessage("Could not apply type '"+s.getTypeName()+"' to argument "+(l+1)+", which is of type '"+n.members[l].type.getTypeName()+"'");break}a&&(this.typeCheckWithContextualType(null,!0,!0,n.members[l]),this.sourceIsAssignableToTarget(n.members[l].type,s)||(o=!0),this.cleanStartedPTO()),this.resetProvisionalErrors();if(o)break}}l==n.members.length&&(i[i.length]={signature:t[f],hadProvisionalErrors:a}),a=!1}return i},n.prototype.canContextuallyTypeFunction=function(e,t,n){if(t.isParenthesized||t.isMethod()||n&&t.returnTypeAnnotation||t.isInlineCallLiteral)return!1;n=n||this.typeFlow.functionInterfaceType==e;if(!n)return!0;t.signature||(this.createFunctionSignature(t,this.typeFlow.scope.container,this.typeFlow.scope,null,null),this.typeFlow.typeCheck(t));var r=t.signature,i=r.parameters.length;for(var s=0;s<i;s++){var o=r.parameters[s],u=o,a=u.declAST;if(n&&a.typeExpr)return!1}if(e.construct&&e.call)return!1;var f=e.construct?e.construct:e.call;return!f||f.signatures.length>1?!1:!0},n.prototype.canContextuallyTypeObjectLiteral=function(t,n){if(t==this.typeFlow.objectInterfaceType)return!0;var r=n.operand;if(!r||!t.memberScope)return!1;var i=null,s=null,o="",u={};for(var a=0;a<r.members.length;a++){i=r.members[a].operand1;if(i.nodeType==e.NodeType.Name)o=i.text;else{if(i.nodeType!=e.NodeType.QString)return!1;var f=i.text;o=f.substring(1,f.length-1)}s=t.memberScope.find(o,!0,!1);if(!s)return!1;u[o]=!0}var l=t.memberScope.getAllValueSymbolNames(!0);for(var a=0;a<l.length;a++){var c=l[a],h=t.memberScope.find(c,!0,!1);if(!u[l[a]]&&!e.hasFlag(h.flags,e.SymbolFlags.Optional))return!1}return!0},n.prototype.widenType=function(e){return e==this.undefinedType||e==this.nullType?this.anyType:e},n.prototype.isNullOrUndefinedType=function(e){return e==this.undefinedType||e==this.nullType},n.prototype.findBestCommonType=function(e,t,n,r){var i=0,s=n.getLength(),o=0,u=e;t&&(u=u?u.mergeOrdered(t,this):t);var a=u;while(o<s){for(i=0;i<s;i++){if(i==o)continue;a&&(u=a.mergeOrdered(n.getTypeAtIndex(i),this,r))&&(a=u);if(u==this.anyType||u==null)break;t&&n.setTypeAtIndex(i,t)}if(a&&u)break;o++,o<s&&(a=n.getTypeAtIndex(o))}return u},n.prototype.typesAreIdentical=function(t,n){if(t==n)return!0;if(!t||!n)return!1;var r=n.typeID<<16|t.typeID;if(this.identicalCache[r])return!0;if(t.typeFlags&e.TypeFlags.IsEnum||n.typeFlags&e.TypeFlags.IsEnum)return!1;if(t.isArray()||n.isArray()){if(!t.isArray()||!n.isArray())return!1;this.identicalCache[r]=!1;var i=this.typesAreIdentical(t.elementType,n.elementType);return i?this.subtypeCache[r]=!0:this.subtypeCache[r]=undefined,i}if(t.primitiveTypeClass!=n.primitiveTypeClass)return!1;this.identicalCache[r]=!1;if(t.memberScope&&n.memberScope){var s=t.memberScope.getAllValueSymbolNames(!0).sort(),o=n.memberScope.getAllValueSymbolNames(!0).sort();if(s.length!=o.length)return this.identicalCache[r]=undefined,!1;var u=null,a=null,f=null,l=null;for(var c=0;c<s.length;c++){if(s[c]!=o[c])return this.identicalCache[r]=undefined,!1;u=t.memberScope.find(s[c],!1,!1),a=n.memberScope.find(o[c],!1,!1);if((u.flags&e.SymbolFlags.Optional)!=(a.flags&e.SymbolFlags.Optional))return this.identicalCache[r]=undefined,!1;f=u.getType(),l=a.getType();if(f&&l&&this.identicalCache[l.typeID<<16|f.typeID]!=undefined)continue;if(!this.typesAreIdentical(f,l))return this.identicalCache[r]=undefined,!1}}else if(t.memberScope||n.memberScope)return this.identicalCache[r]=undefined,!1;return this.signatureGroupsAreIdentical(t.call,n.call)?this.signatureGroupsAreIdentical(t.construct,n.construct)?this.signatureGroupsAreIdentical(t.index,n.index)?(this.identicalCache[r]=!0,!0):(this.identicalCache[r]=undefined,!1):(this.identicalCache[r]=undefined,!1):(this.identicalCache[r]=undefined,!1)},n.prototype.signatureGroupsAreIdentical=function(e,t){if(e==t)return!0;if(!e||!t)return!1;if(e.signatures.length!=t.signatures.length)return!1;var n=null,r=null,i=!1;for(var s=0;s<e.signatures.length;s++){n=e.signatures[s];for(var o=0;o<t.signatures.length;o++){r=t.signatures[o];if(this.signaturesAreIdentical(n,r)){i=!0;break}}if(i){i=!1;continue}return!1}return!0},n.prototype.signaturesAreIdentical=function(e,t){if(e.hasVariableArgList!=t.hasVariableArgList)return!1;if(e.nonOptionalParameterCount!=t.nonOptionalParameterCount)return!1;if(e.parameters.length!=t.parameters.length)return!1;if(!this.typesAreIdentical(e.returnType.type,t.returnType.type))return!1;for(var n=0;n<e.parameters.length;n++)if(!this.typesAreIdentical(e.parameters[n].parameter.typeLink.type,t.parameters[n].parameter.typeLink.type))return!1;return!0},n.prototype.sourceIsSubtypeOfTarget=function(e,t,n){return this.sourceIsRelatableToTarget(e,t,!1,this.subtypeCache,n)},n.prototype.signatureGroupIsSubtypeOfTarget=function(e,t,n){return this.signatureGroupIsRelatableToTarget(e,t,!1,this.subtypeCache,n)},n.prototype.signatureIsSubtypeOfTarget=function(e,t,n){return this.signatureIsRelatableToTarget(e,t,!1,this.subtypeCache,n)},n.prototype.sourceIsAssignableToTarget=function(e,t,n){return this.sourceIsRelatableToTarget(e,t,!0,this.assignableCache,n)},n.prototype.signatureGroupIsAssignableToTarget=function(e,t,n){return this.signatureGroupIsRelatableToTarget(e,t,!0,this.assignableCache,n)},n.prototype.signatureIsAssignableToTarget=function(e,t,n){return this.signatureIsRelatableToTarget(e,t,!0,this.assignableCache,n)},n.prototype.sourceIsRelatableToTarget=function(t,n,r,i,s){if(t==n)return!0;if(!t||!n)return!0;var o=t.typeID<<16|n.typeID;if(i[o])return!0;if(r){if(t==this.anyType||n==this.anyType)return!0}else if(n==this.anyType)return!0;if(t==this.undefinedType)return!0;if(t==this.nullType&&n!=this.undefinedType&&n!=this.voidType)return!0;if(n==this.numberType&&t.typeFlags&e.TypeFlags.IsEnum)return!0;if(t==this.numberType&&n.typeFlags&e.TypeFlags.IsEnum)return!0;if(t.typeFlags&e.TypeFlags.IsEnum||n.typeFlags&e.TypeFlags.IsEnum)return!1;if(t.isArray()||n.isArray()){if(!t.isArray()||!n.isArray())return!1;i[o]=!1;var u=this.sourceIsRelatableToTarget(t.elementType,n.elementType,r,i,s);return u?i[o]=!0:i[o]=undefined,u}if(t.primitiveTypeClass!=n.primitiveTypeClass){if(n.primitiveTypeClass!=e.Primitive.None)return!1;if(t==this.numberType&&this.typeFlow.numberInterfaceType)t=this.typeFlow.numberInterfaceType;else if(t==this.stringType&&this.typeFlow.stringInterfaceType)t=this.typeFlow.stringInterfaceType;else{if(t!=this.booleanType||!this.typeFlow.booleanInterfaceType)return!1;t=this.typeFlow.booleanInterfaceType}}i[o]=!1;if(t.hasBase(n))return i[o]=!0,!0;if(this.typeFlow.objectInterfaceType&&n==this.typeFlow.objectInterfaceType)return!0;if(this.typeFlow.functionInterfaceType&&(t.call||t.construct)&&n==this.typeFlow.functionInterfaceType)return!0;if(n.isClass()||n.isClassInstance())return i[o]=undefined,!1;if(n.memberScope&&t.memberScope){var a=n.memberScope.getAllValueSymbolNames(!0),f=null,l=null,c=null,h=null,p=null;for(var d=0;d<a.length;d++){f=n.memberScope.find(a[d],!1,!1),l=t.memberScope.find(a[d],!1,!1);if(f.kind()==e.SymbolKind.Variable&&f.variable.typeLink.ast&&f.variable.typeLink.ast.nodeType==e.NodeType.Name&&f.variable.typeLink.ast.text=="IArguments")continue;f.isInferenceSymbol()&&(p=f,p.typeCheckStatus==e.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(f.declAST)),c=f.getType();if(!l){this.typeFlow.objectInterfaceType&&(l=this.typeFlow.objectInterfaceType.memberScope.find(a[d],!1,!1));if(!l){this.typeFlow.functionInterfaceType&&(c.call||c.construct)&&(l=this.typeFlow.functionInterfaceType.memberScope.find(a[d],!1,!1));if(!l){if(!(f.flags&e.SymbolFlags.Optional))return i[o]=undefined,s&&(s.flags|=e.TypeRelationshipFlags.RequiredPropertyIsMissing,s.addMessageToFront("Type '"+t.getTypeName()+"' is missing property '"+a[d]+"' from type '"+n.getTypeName()+"'")),!1;continue}}}l.isInferenceSymbol()&&(p=l,p.typeCheckStatus==e.TypeCheckStatus.NotStarted&&this.typeFlow.typeCheck(l.declAST)),h=l.getType();if(c&&h&&i[h.typeID<<16|c.typeID]!=undefined)continue;if(!this.sourceIsRelatableToTarget(h,c,r,i,s))return i[o]=undefined,s&&(s.flags|=e.TypeRelationshipFlags.IncompatiblePropertyTypes,s.addMessageToFront("Types of property '"+f.name+"' of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible")),!1}}if(t.call||n.call)if(!this.signatureGroupIsRelatableToTarget(t.call,n.call,r,i,s)){if(s){if(t.call&&n.call)s.addMessageToFront("Call signatures of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible");else{var v=n.call?n.getTypeName():t.getTypeName(),m=n.call?t.getTypeName():n.getTypeName();s.setMessage("Type '"+v+"' requires a call signature, but Type '"+m+"' lacks one")}s.flags|=e.TypeRelationshipFlags.IncompatibleSignatures}return i[o]=undefined,!1}if(t.construct||n.construct)if(!this.signatureGroupIsRelatableToTarget(t.construct,n.construct,r,i,s)){if(s){if(t.construct&&n.construct)s.addMessageToFront("Construct signatures of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible");else{var v=n.construct?n.getTypeName():t.getTypeName(),m=n.construct?t.getTypeName():n.getTypeName();s.setMessage("Type '"+v+"' requires a construct signature, but Type '"+m+"' lacks one")}s.flags|=e.TypeRelationshipFlags.IncompatibleSignatures}return i[o]=undefined,!1}if(n.index){var g=!n.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:n.index,y=!t.index&&this.typeFlow.objectInterfaceType?this.typeFlow.objectInterfaceType.index:t.index;if(!this.signatureGroupIsRelatableToTarget(y,g,r,i,s))return s&&(s.addMessageToFront("Index signatures of types '"+t.getTypeName()+"' and '"+n.getTypeName()+"' are incompatible"),s.flags|=e.TypeRelationshipFlags.IncompatibleSignatures),i[o]=undefined,!1}return i[o]=!0,!0},n.prototype.signatureGroupIsRelatableToTarget=function(e,t,n,r,i){if(e==t)return!0;if(!e||!t)return!1;var s=null,o=null,u=!1;for(var a=0;a<t.signatures.length;a++){s=t.signatures[a];for(var f=0;f<e.signatures.length;f++){o=e.signatures[f];if(this.signatureIsRelatableToTarget(o,s,n,r,i)){u=!0;break}}if(u){u=!1;continue}return!1}return!0},n.prototype.signatureIsRelatableToTarget=function(t,n,r,i,s){if(!t.parameters||!n.parameters)return!1;var o=n.hasVariableArgList?n.nonOptionalParameterCount-1:n.nonOptionalParameterCount,u=t.hasVariableArgList?t.nonOptionalParameterCount-1:t.nonOptionalParameterCount;if(u>o&&!n.hasVariableArgList)return s&&(s.flags|=e.TypeRelationshipFlags.SourceSignatureHasTooManyParameters,s.addMessageToFront("Call signature expects "+o+" or fewer parameters")),!1;var a=t.returnType.type,f=n.returnType.type;if(f!=this.voidType&&!this.sourceIsRelatableToTarget(a,f,r,i,s))return s&&(s.flags|=e.TypeRelationshipFlags.IncompatibleReturnTypes),!1;var l=u<o&&t.hasVariableArgList?o:u,c=null,h=null,p="",d="";for(var v=0,m=0;v<l;v++,m++){!t.hasVariableArgList||v<u?(c=t.parameters[v].parameter.typeLink.type,p=t.parameters[v].parameter.symbol.name):v==u&&(c=t.parameters[v].parameter.typeLink.type,c.elementType&&(c=c.elementType),p=t.parameters[v].parameter.symbol.name),m<n.parameters.length&&m<o?(h=n.parameters[m].parameter.typeLink.type,d=n.parameters[m].parameter.symbol.name):n.hasVariableArgList&&m==o&&(h=n.parameters[m].parameter.typeLink.type,h.elementType&&(h=h.elementType),d=n.parameters[m].parameter.symbol.name);if(!this.sourceIsRelatableToTarget(c,h,r,i,s)&&!this.sourceIsRelatableToTarget(h,c,r,i,s))return s&&(s.flags|=e.TypeRelationshipFlags.IncompatibleParameterTypes),!1}return!0},n}();e.TypeChecker=u})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function n(t,n){if(t){var r=t.members.length;n==null&&(n=new Array);for(var i=0;i<r;i++){var s=t.members[i],o=s;o.nodeType==e.NodeType.Call&&(o=o.target);var u=new e.TypeLink;u.ast=o,n[n.length]=u}}return n}function r(e,t){e.extendsTypeLinks=n(t.extendsList,e.extendsTypeLinks),e.implementsTypeLinks=n(t.implementsList,e.implementsTypeLinks)}function i(t,n,r){var i=new e.ValueLocation;i.typeLink=new e.TypeLink,i.typeLink.ast=n,i.typeLink.type=t.instanceType;var s=new e.FieldSymbol("prototype",n.minChar,r.checker.locationInfo.unitIndex,!0,i);s.flags|=e.SymbolFlags.Property|e.SymbolFlags.BuiltIn,i.symbol=s,s.declAST=n,t.members.addPublicMember("prototype",s)}function s(t){var n=new e.Signature;n.returnType=new e.TypeLink,n.returnType.type=t.instanceType,n.parameters=[],t.construct=new e.SignatureGroup,t.construct.addSignature(n)}function o(t,n){t.construct=new e.SignatureGroup;var r=null;n.construct||s(n);for(var i=0;i<n.construct.signatures.length;i++)r=new e.Signature,r.parameters=n.construct.signatures[i].parameters,r.nonOptionalParameterCount=n.construct.signatures[i].nonOptionalParameterCount,r.typeCheckStatus=n.construct.signatures[i].typeCheckStatus,r.declAST=n.construct.signatures[i].declAST,r.returnType=new e.TypeLink,r.returnType.type=t.instanceType,t.construct.addSignature(r)}function u(e,t){var n=t.scope.find(e,!1,!0);return n==null&&t.previous&&(n=u(e,t.previous)),n}function a(t,n){var r=null;switch(t.nodeType){case e.NodeType.Name:var i=t.text,s=e.isQuoted(i),o=function(e){return n.members?n.members.lookup(i):u(i,n.topLevelScope)};s?r=n.tcContext.checker.findSymbolForDynamicModule(i,n.tcContext.script.locationInfo.filename,o):r=o(i);break;case e.NodeType.Dot:var f=t,l=a(f.operand1,n);l&&l.getType()&&(r=a(f.operand2,n));break;default:}if(r){var c=r.getType();if(c){var h=c.members;h&&(n.members=h.publicMembers)}else n.tcContext.checker.errorReporter.simpleError(t,"Potentially circular alias reference - could not obtain type of alias")}return r}function f(t,n,r){var i=r.scopeChain,s=null,o=null,u=t,f=e.hasFlag(u.varFlags,e.VarFlags.Exported),l=a(u.alias,{topLevelScope:i,members:null,tcContext:r}),c=r.scopeChain.container==r.checker.gloMod;if(l){var h=l.getType();h&&(o=h)}return s=new e.TypeSymbol(u.id.text,u.minChar,r.checker.locationInfo.unitIndex,o),s.aliasLink=u,r.scopeChain.moduleDecl&&(s.declModule=r.scopeChain.moduleDecl),s.declAST=u,u.id.sym=s,i.scope.enter(i.container,t,s,r.checker.errorReporter,f||c,!0,!1),i.scope.enter(i.container,t,s,r.checker.errorReporter,f||c,!1,!1),!0}function l(t,n,r){var i=r.scopeChain,s=t,o=e.hasFlag(s.modFlags,e.ModuleFlags.Ambient),u=e.hasFlag(s.modFlags,e.ModuleFlags.IsEnum),a=r.scopeChain.container==r.checker.gloMod,f=e.hasFlag(s.modFlags,e.ModuleFlags.Exported),l=s.name.text,c=e.isQuoted(l),h=i.scope.findLocal(l,!1,!1),p=null,d=null;if(h==null||h.kind()!=e.SymbolKind.Type){if(d==null){var v=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),m=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable));d=new e.ModuleType(v,m),u&&(d.typeFlags|=e.TypeFlags.IsEnum),d.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),d.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),d.setHasImplementation()}p=new e.TypeSymbol(l,s.minChar,r.checker.locationInfo.unitIndex,d),r.scopeChain.moduleDecl&&(p.declModule=r.scopeChain.moduleDecl),p.declAST=s,p.prettyName=s.prettyName,i.scope.enter(i.container,t,p,r.checker.errorReporter,f||a,!0,o),i.scope.enter(i.container,t,p,r.checker.errorReporter,f||a,!1,o),d.symbol=p}else{h&&h.declAST&&h.declAST.nodeType!=e.NodeType.Module&&r.checker.errorReporter.simpleError(s,"Conflicting symbol name for module '"+l+"'"),p=h;var g=p.type.getAllEnclosedTypes().publicMembers,y=g==null?new e.StringHashTable:g,v=new e.ScopedMembers(new e.DualStringHashTable(y,new e.StringHashTable)),b=p.type.getAllAmbientEnclosedTypes().publicMembers,w=b==null?new e.StringHashTable:b,m=new e.ScopedMembers(new e.DualStringHashTable(w,new e.StringHashTable)),E=p.type.members.publicMembers,S=E==null?new e.StringHashTable:E,x=new e.ScopedMembers(new e.DualStringHashTable(S,new e.StringHashTable)),T=p.type.ambientMembers.publicMembers,N=T==null?new e.StringHashTable:T,C=new e.ScopedMembers(new e.DualStringHashTable(N,new e.StringHashTable));d=new e.ModuleType(v,m),u&&(d.typeFlags|=e.TypeFlags.IsEnum),d.members=x,d.ambientMembers=C,d.setHasImplementation(),d.symbol=p,p.addLocation(s.minChar),p.expansions.push(d)}r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface(),f&&(p.flags|=e.SymbolFlags.Exported);if(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod)p.flags|=e.SymbolFlags.ModuleMember;return s.mod=d,e.pushTypeCollectionScope(p,d.members,d.ambientMembers,d.enclosedTypes,d.ambientEnclosedTypes,r,null,null,s),!0}function c(t,n,o){var u=o.scopeChain,a=t,f,l,c=null,h=a.name.text,p=!1,d=e.hasFlag(a.varFlags,e.VarFlags.Ambient),v=e.hasFlag(a.varFlags,e.VarFlags.Exported),m=o.scopeChain.container==o.checker.gloMod,g=u.container,y=!1;c=u.scope.findLocal(h,!1,!0);if(!c){var b=u.scope.findLocal(h,!1,!1);b&&b.isType()&&b.declAST&&b.declAST.nodeType==e.NodeType.FuncDecl&&b.declAST.isSignature()&&(c=b,y=!0,v&&(c.flags|=e.SymbolFlags.Exported),d&&(c.flags|=e.SymbolFlags.Ambient),o.scopeChain.scope.enter(o.scopeChain.container,t,c,o.checker.errorReporter,v||m,!0,d))}c&&!y&&c.declAST!=a&&!c.declAST.isOverload&&(c=null);if(c==null){var w=u.scope.findLocal(h,!1,!1);f=new e.Type,f.setHasImplementation(),l=new e.Type,l.setHasImplementation(),f.instanceType=l,f.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),f.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),i(f,a,o),l.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),l.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),c=new e.TypeSymbol(h,a.minChar,o.checker.locationInfo.unitIndex,f),c.declAST=a,c.instanceType=l,f.symbol=c,l.symbol=c,o.scopeChain.moduleDecl&&(o.scopeChain.moduleDecl.recordNonInterface(),c.declModule=o.scopeChain.moduleDecl,c.flags|=e.SymbolFlags.ModuleMember),v&&(c.flags|=e.SymbolFlags.Exported),d&&(c.flags|=e.SymbolFlags.Ambient),t.type=f,o.scopeChain.scope.enter(o.scopeChain.container,t,c,o.checker.errorReporter,v||m,!0,d),w==null&&o.scopeChain.scope.enter(o.scopeChain.container,t,c,o.checker.errorReporter,v||m,!1,d)}else f=c.type,f.instanceType==null&&(f.instanceType=new e.Type,f.instanceType.setHasImplementation(),f.instanceType.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),f.instanceType.symbol=f.symbol,f.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),f.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable))),l=f.instanceType,t.type=f;return a.constructorDecl||(c&&c.declAST&&c.declAST.type&&c.declAST.type.call&&!c.declAST.isOverload&&o.checker.errorReporter.duplicateIdentifier(c.declAST,c.name),s(a.type)),f.typeFlags|=e.TypeFlags.IsClass,l.typeFlags|=e.TypeFlags.IsClass,r(l,a),e.pushTypeCollectionScope(c,l.members,l.ambientMembers,null,null,o,l,f,null),!0}function h(t,n,i){var s=i.scopeChain,o=t,u=null,a=null,f=e.hasFlag(o.varFlags,e.VarFlags.Exported),l=i.scopeChain.container==i.checker.gloMod,c=!0;c=!1;var h=o.name.text;return u=s.scope.findLocal(h,!1,!0),u==null?(a=new e.Type,u=new e.TypeSymbol(h,t.minChar,i.checker.locationInfo.unitIndex,a),a.symbol=u,a.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),a.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),u.declAST=o,u.declModule=i.scopeChain.moduleDecl):(c=!0,a=u.type),a||(a=i.checker.anyType),t.type=a,r(a,o),f&&(u.flags|=e.SymbolFlags.Exported),i.scopeChain.moduleDecl&&(u.flags|=e.SymbolFlags.ModuleMember),c||i.scopeChain.scope.enter(i.scopeChain.container,t,u,i.checker.errorReporter,l||f,!0,!1),e.pushTypeCollectionScope(u,a.members,a.ambientMembers,null,null,i,a,null,null),!0}function p(t,n,r){var i=r.scopeChain,s=t;if(e.hasFlag(s.varFlags,e.VarFlags.Public|e.VarFlags.Private)){var o=new e.ValueLocation,u=e.hasFlag(s.varFlags,e.VarFlags.Private),a=new e.FieldSymbol(s.id.text,s.minChar,r.checker.locationInfo.unitIndex,!e.hasFlag(s.varFlags,e.VarFlags.Readonly),o);a.transferVarFlags(s.varFlags),o.symbol=a,a.declAST=t,s.parameterPropertySym=a,r.scopeChain.scope.enter(r.scopeChain.container,t,a,r.checker.errorReporter,!u,!1,!1),o.typeLink=e.getTypeLink(s.typeExpr,r.checker,s.init==null),s.sym=a}return!1}function d(t,n,r){var i=r.scopeChain,s=t,o=e.hasFlag(s.varFlags,e.VarFlags.Ambient),u=e.hasFlag(s.varFlags,e.VarFlags.Exported),a=r.scopeChain.container==r.checker.gloMod,f=e.hasFlag(s.varFlags,e.VarFlags.Property),l=e.hasFlag(s.varFlags,e.VarFlags.Static),c=e.hasFlag(s.varFlags,e.VarFlags.Private),h=e.hasFlag(s.id.flags,e.ASTFlags.OptionalName);r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface();if(f||u||r.scopeChain.container==r.checker.gloMod||r.scopeChain.moduleDecl){if(o){var p=i.scope.findLocal(s.id.text,!1,!1);if(p)return s.sym=p,!1}if(s.id==null)return r.checker.errorReporter.simpleError(s,"Expected variable identifier at this location"),!1;var d=new e.ValueLocation,v=new e.FieldSymbol(s.id.text,s.minChar,r.checker.locationInfo.unitIndex,(s.varFlags&e.VarFlags.Readonly)==e.VarFlags.None,d);v.transferVarFlags(s.varFlags),h&&(v.flags|=e.SymbolFlags.Optional),d.symbol=v,v.declAST=t;if(r.scopeChain.moduleDecl||r.scopeChain.container==r.checker.gloMod)v.flags|=e.SymbolFlags.ModuleMember,v.declModule=r.scopeChain.moduleDecl;e.hasFlag(s.varFlags,e.VarFlags.Property)&&l&&r.scopeChain.classType?(r.scopeChain.classType.members.publicMembers.add(s.id.text,v)||r.checker.errorReporter.duplicateIdentifier(t,v.name),v.container=r.scopeChain.classType.symbol):r.scopeChain.scope.enter(r.scopeChain.container,t,v,r.checker.errorReporter,!c&&(f||u||a||l),!1,o),e.hasFlag(s.varFlags,e.VarFlags.Exported)&&(v.flags|=e.SymbolFlags.Exported),d.typeLink=e.getTypeLink(s.typeExpr,r.checker,s.init==null),s.sym=v}return!1}function v(t,n,r){var i=r.scopeChain;r.scopeChain.moduleDecl&&r.scopeChain.moduleDecl.recordNonInterface();var s=t,o=null,u=s.getNameText(),a=e.hasFlag(s.fncFlags,e.FncFlags.Exported|e.FncFlags.ClassPropertyMethodExported),f=e.hasFlag(s.fncFlags,e.FncFlags.Static),l=e.hasFlag(s.fncFlags,e.FncFlags.Private),c=s.isConstructMember()||s.isConstructor,h=(s.isMethod()&&f||s.isAccessor())&&r.scopeChain.classType?r.scopeChain.classType.symbol:r.scopeChain.container,p=r.scopeChain.scope,d=h==r.checker.gloMod,v=s.name&&e.hasFlag(s.name.flags,e.ASTFlags.OptionalName),m=!1,g=!1;c&&e.hasFlag(s.fncFlags,e.FncFlags.ClassMethod)&&(h=h.container,p=i.previous.scope),s.unitIndex=r.checker.locationInfo.unitIndex;if(!s.isConstructor&&h&&h.declAST&&h.declAST.nodeType==e.NodeType.FuncDecl&&h.declAST.isConstructor&&!s.isMethod())return m;if(e.hasFlag(s.fncFlags,e.FncFlags.Signature)){var y=r.scopeChain.thisType;u&&u!="__missing"&&(f?o=h.type.members.allMembers.lookup(u):(o=p.findLocal(u,!1,!1),o==null&&(o=p.findLocal(u,!1,!0))),o&&(g=!0,!s.isSignature()&&e.hasFlag(s.fncFlags,e.FncFlags.Ambient)!=e.hasFlag(o.flags,e.SymbolFlags.Ambient)&&(o=null)));if(o==null){s.isSpecialFn()?o=r.checker.createFunctionSignature(s,h,p,h,!1).declAST.type.symbol:o=r.checker.createFunctionSignature(s,h,p,null,!g).declAST.type.symbol;if(o.declAST==null||!s.isSpecialFn())o.declAST=t}else o.kind()==e.SymbolKind.Type?o=r.checker.createFunctionSignature(s,h,p,o,!1).declAST.type.symbol:r.checker.errorReporter.simpleError(s,"Function or method '"+s.name.text+"' already declared as a property");s.isSpecialFn()&&!f?s.type=y?y:o.type:s.type=o.type}else{u&&(f?o=h.type.members.allMembers.lookup(u):(s.isConstructor&&r.scopeChain.previous&&(o=r.scopeChain.previous.scope.findLocal(u,!1,!1)),o==null&&(o=p.findLocal(u,!1,!1))),o&&(g=!0,!c&&o.declAST.nodeType==e.NodeType.FuncDecl&&!o.declAST.isAccessor()&&!o.declAST.isSignature()&&(o=null,g=!1))),o&&!o.isAccessor()&&o.type&&o.type.construct&&o.type.construct.signatures!=[]&&(o.type.construct.signatures[0].declAST==null||!e.hasFlag(o.type.construct.signatures[0].declAST.fncFlags,e.FncFlags.Ambient))&&!s.isConstructor&&r.checker.errorReporter.simpleError(s,"Functions may not have class overloads"),o&&o.kind()!=e.SymbolKind.Type&&s.isMethod()&&!s.isAccessor()&&!s.isConstructor&&(r.checker.errorReporter.simpleError(s,"Function or method '"+s.name.text+"' already declared as a property"),o.type=r.checker.anyType);var b=r.checker.createFunctionSignature(s,h,p,o,!g);if((!o||o.declAST.nodeType!=e.NodeType.FuncDecl)&&s.isAccessor()||o&&o.isAccessor())s.accessorSymbol=r.checker.createAccessorSymbol(s,o,h.type,s.isMethod()&&f,!0,p,h);s.type.symbol.declAST=t,s.isConstructor&&(m=!0)}return a&&(s.type.call&&(s.type.symbol.flags|=e.SymbolFlags.Exported),o&&!o.isAccessor()&&o.type.call&&(o.flags|=e.SymbolFlags.Exported)),r.scopeChain.moduleDecl&&!s.isSpecialFn()&&(s.type.symbol.flags|=e.SymbolFlags.ModuleMember,s.type.symbol.declModule=r.scopeChain.moduleDecl),o&&v&&(o.flags|=e.SymbolFlags.Optional),m}function m(t,n,r){var i=r.state,s=!1,o=i.scopeChain;if(t.nodeType==e.NodeType.Script){var u=t;i.script=u,s=!0}else t.nodeType==e.NodeType.List?s=!0:t.nodeType==e.NodeType.Import?s=f(t,n,i):t.nodeType==e.NodeType.With?s=!1:t.nodeType==e.NodeType.Module?s=l(t,n,i):t.nodeType==e.NodeType.Class?s=c(t,n,i):t.nodeType==e.NodeType.Block?s=!0:t.nodeType==e.NodeType.Interface?s=h(t,n,i):t.nodeType==e.NodeType.ArgDecl?s=p(t,n,i):t.nodeType==e.NodeType.VarDecl?s=d(t,n,i):t.nodeType==e.NodeType.FuncDecl?s=v(t,n,i):t.isStatementOrExpression()&&i.scopeChain.moduleDecl&&i.scopeChain.moduleDecl.recordNonInterface();return r.options.goChildren=s,t}function g(t,n,r){var i=r.state;return t.nodeType==e.NodeType.Module?e.popTypeCollectionScope(i):t.nodeType==e.NodeType.Class?e.popTypeCollectionScope(i):t.nodeType==e.NodeType.Interface&&e.popTypeCollectionScope(i),t}var t=function(){function e(e){this.normalBlock=e,this.exceptionBlock=-1}return e}();e.Continuation=t,e.createNewConstructGroupForType=s,e.cloneParentConstructGroupForChildType=o,e.globalId="__GLO",e.preCollectImportTypes=f,e.preCollectModuleTypes=l,e.preCollectClassTypes=c,e.preCollectInterfaceTypes=h,e.preCollectArgDeclTypes=p,e.preCollectVarDeclTypes=d,e.preCollectFuncDeclTypes=v,e.preCollectTypes=m,e.postCollectTypes=g})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(e,t,n){this.container=e,this.previous=t,this.scope=n}return e}();e.ScopeChain=t;var n=function(){function t(e){this.bb=e,this.defsBySymbol=new Array,this.useIndexBySymbol=new Array}return t.prototype.updateTop=function(){var e=new i(this.top.bitCount);for(var t=0,n=this.bb.successors.length;t<n;t++){var r=this.bb.successors[t];r.useDef&&e.union(r.useDef.top)}e.difference(this.kill),e.union(this.gen);var s=e.notEq(this.top);return this.top=e,s},t.prototype.initialize=function(t){function s(t,n,s){var o=s.state;t==null&&(t=null);if(t.nodeType==e.NodeType.VarDecl){var u=t;(u.init||e.hasFlag(u.varFlags,e.VarFlags.AutoInit))&&r(u.sym,o)}else if(t.nodeType==e.NodeType.Name){if(n)if(n.nodeType==e.NodeType.Asg){var a=n;if(a.operand1==t)return t}else if(n.nodeType==e.NodeType.VarDecl){var f=n;if(f.id==t)return t}var l=t;i(l.sym,o,t)}else if(t.nodeType>=e.NodeType.Asg&&t.nodeType<=e.NodeType.LastAsg){var a=t;if(a.operand1&&a.operand1.nodeType==e.NodeType.Name){var l=a.operand1;r(l.sym,o)}}else t.nodeType==e.NodeType.FuncDecl&&(s.options.goChildren=!1);return t}var n=this,r=function(e,t){if(t.isLocalSym(e)){var r=t.getSymbolIndex(e);n.useIndexBySymbol[r]=new Array,n.defsBySymbol[r]=!0}},i=function(e,t,r){if(t.isLocalSym(e)){var i=t.getSymbolIndex(e);n.useIndexBySymbol[i]==undefined&&(n.useIndexBySymbol[i]=new Array);var s=n.useIndexBySymbol[i],o=t.getUseIndex(r);t.addUse(i,o),s.push(o)}},o=new e.AstWalkOptions;o.reverseSiblings=!0,e.getAstWalkerFactory().walk(this.bb.content,s,null,o,t)},t.prototype.initializeGen=function(e){var t=this.useIndexBySymbol.length,n=e.uses.length;this.gen=new i(n);for(var r=0;r<t;r++){var s=this.useIndexBySymbol[r];if(s!=undefined&&s.length>0)for(var o=0,u=s.length;o<u;o++)this.gen.set(s[o],!0)}this.top=this.gen},t.prototype.initializeKill=function(e){this.kill=new i(this.gen.bitCount);for(var t=0,n=this.defsBySymbol.length;t<n;t++)if(this.defsBySymbol[t]){var r=e.useIndexBySymbol[t];if(r)for(var s=0,o=r.length;s<o;s++)this.kill.set(r[s],!0)}},t}();e.BBUseDefInfo=n;var r=function(){function t(){this.useIndexBySymbol=new Array,this.uses=new Array,this.symbols=new Array,this.symbolMap=new e.StringHashTable,this.symbolCount=0}return t.prototype.getSymbolIndex=function(e){var t=e.name,n=this.symbolMap.lookup(t);return n==null&&(n=this.symbolCount++,this.symbols[n]=e,this.symbolMap.add(t,n)),n},t.prototype.addUse=function(e,t){var n=this.useIndexBySymbol[e];n==undefined&&(n=new Array,this.useIndexBySymbol[e]=n),n[n.length]=t},t.prototype.getUseIndex=function(e){return this.uses[this.uses.length]=e,this.uses.length-1},t.prototype.isLocalSym=function(t){return t&&t.container==this.func&&t.kind()==e.SymbolKind.Variable},t.prototype.killSymbol=function(e,t){var n=this.symbolMap.lookup(e.name),r=this.useIndexBySymbol[n];for(var i=0,s=r.length;i<s;i++)t.set(r[i],!0)},t}();e.UseDefContext=r;var i=function(){function e(t){this.bitCount=t,this.firstBits=0,this.restOfBits=null;if(this.bitCount>e.packBits){this.restOfBits=new Array;var n=Math.floor(this.bitCount/e.packBits);for(var r=0;r<n;r++)this.restOfBits[r]=0}}return e.packBits=30,e.prototype.set=function(t,n){if(t<e.packBits)n?this.firstBits|=1<<t:this.firstBits&=~(1<<t);else{var r=Math.floor(t/e.packBits)-1,i=t%e.packBits;n?this.restOfBits[r]|=1<<i:this.restOfBits[r]&=~(1<<i)}},e.prototype.map=function(t){var n;for(n=0;n<e.packBits;n++){if(n==this.bitCount)return;(1<<n&this.firstBits)!=0&&t(n)}if(this.restOfBits){var r,i=e.packBits;for(n=0,r=this.restOfBits.length;n<r;n++){var s=this.restOfBits[n];for(var o=0;o<e.packBits;o++){(1<<o&s)!=0&&t(i),i++;if(i==this.bitCount)return}}}},e.prototype.union=function(e){this.firstBits|=e.firstBits;if(this.restOfBits)for(var t=0,n=this.restOfBits.length;t<n;t++){var r=this.restOfBits[t],i=e.restOfBits[t];this.restOfBits[t]=r|i}},e.prototype.intersection=function(e){this.firstBits&=e.firstBits;if(this.restOfBits)for(var t=0,n=this.restOfBits.length;t<n;t++){var r=this.restOfBits[t],i=e.restOfBits[t];this.restOfBits[t]=r&i}},e.prototype.notEq=function(e){if(this.firstBits!=e.firstBits)return!0;if(this.restOfBits)for(var t=0,n=this.restOfBits.length;t<n;t++){var r=this.restOfBits[t],i=e.restOfBits[t];if(r!=i)return!0}return!1},e.prototype.difference=function(e){var t=this.firstBits;this.firstBits&=~e.firstBits;if(this.restOfBits)for(var n=0,r=this.restOfBits.length;n<r;n++){var i=this.restOfBits[n],s=e.restOfBits[n];this.restOfBits[n]&=~s}},e}();e.BitVector=i;var s=function(){function t(){this.predecessors=new Array,this.index=-1,this.markValue=0,this.successors=new Array,this.useDef=null,this.content=new e.ASTList}return t.prototype.marked=function(e){return this.markValue>e},t.prototype.mark=function(){this.markValue++},t.prototype.addSuccessor=function(e){this.successors[this.successors.length]=e,e.predecessors[e.predecessors.length]=this},t}();e.BasicBlock=s;var o=function(){function t(e,t){this.current=e,this.exit=t,this.entry=null,this.unreachable=null,this.noContinuation=!1,this.statementStack=new Array,this.currentSwitch=new Array,this.markBase=0,this.linearBBs=new Array,this.entry=this.current}return t.prototype.walk=function(e,t){return this.walker.walk(e,t)},t.prototype.pushSwitch=function(e){this.currentSwitch.push(e)},t.prototype.popSwitch=function(){return this.currentSwitch.pop()},t.prototype.reportUnreachable=function(t){if(this.unreachable&&this.unreachable.length>0){var n=this.unreachable.length;for(var r=0;r<n;r++){var i=this.unreachable[r];i.nodeType!=e.NodeType.EndCode&&t.simpleError(i,"unreachable code")}}},t.prototype.printAST=function(t,n){var r=new e.PrintContext(n,null);r.increaseIndent(),e.getAstWalkerFactory().walk(t,e.prePrintAST,e.postPrintAST,null,r),r.decreaseIndent()},t.prototype.printBlockContent=function(e,t){var n=e.content;for(var r=0,i=n.members.length;r<i;r++){var s=n.members[r];this.printAST(s,t)}},t.prototype.bfs=function(e,t,n,r){var i=this.markBase++,s=new Array;s[s.length]=this.entry;while(s.length>0){var o=s.pop();if(!o.marked(i)){o.mark(),e&&e(o);var u=o.successors.length;if(u>0){n&&n();for(var a=u-1;a>=0;a--){var f=o.successors[a];f.marked(this.markBase)||(t&&t(o,f),s[s.length]=f)}r&&r()}}}},t.prototype.useDef=function(e,t){var i=this,s=new r;s.func=t;var o=function(e){e.useDef=new n(e),e.useDef.initialize(s),i.linearBBs[i.linearBBs.length]=e};this.bfs(o,null,null,null);var u,a;for(u=0,a=this.linearBBs.length;u<a;u++)this.linearBBs[u].useDef.initializeGen(s),this.linearBBs[u].useDef.initializeKill(s);var f=!0;while(f){f=!1;for(u=0;u<a;u++)f=this.linearBBs[u].useDef.updateTop()||f}var l=this.entry.useDef.top;l.map(function(t){var n=s.uses[t];e.simpleError(n,"use of variable '"+n.text+"' that is not definitely assigned")})},t.prototype.print=function(e){function i(){e.Write("  Branches to ")}function s(){e.WriteLine("")}function o(t,r){r.index<0&&(r.index=n++),e.Write(r.index+" ")}var t=this,n=0,r=function(r){r.index<0&&(r.index=n++),r==t.exit?e.WriteLine("Exit block with index "+r.index):(e.WriteLine("Basic block with index "+r.index),t.printBlockContent(r,e))};this.bfs(r,o,i,s);if(this.unreachable!=null)for(var u=0,a=this.unreachable.length;u<a;u++)e.WriteLine("Unreachable basic block ..."),this.printAST(this.unreachable[u],e)},t.prototype.pushStatement=function(e,t,n){this.statementStack.push({stmt:e,continueBB:t,breakBB:n})},t.prototype.popStatement=function(){return this.statementStack.pop()},t.prototype.returnStmt=function(){this.current.addSuccessor(this.exit),this.setUnreachable()},t.prototype.setUnreachable=function(){this.current=null,this.noContinuation=!0},t.prototype.addUnreachable=function(e){this.unreachable===null&&(this.unreachable=new Array),this.unreachable[this.unreachable.length]=e},t.prototype.unconditionalBranch=function(e,t){var n=null;for(var r=0,i=this.statementStack.length;r<i;r++){var s=this.statementStack[r];if(s.stmt==e){t?n=s.continueBB:n=s.breakBB;break}}n&&this.current.addSuccessor(n),this.setUnreachable()},t.prototype.addContent=function(e){this.current&&this.current.content.append(e)},t}();e.ControlFlowContext=o;var u=function(){function e(){this.cacheSize=16,this.rdCache=[],this.nextUp=0;for(var e=0;e<this.cacheSize;e++)this.rdCache[e]={actuals:new Array,exactCandidates:new Array,conversionCandidates:new Array,id:e}}return e.prototype.getResolutionData=function(){var e=null;return this.nextUp<this.cacheSize&&(e=this.rdCache[this.nextUp]),e==null&&(this.cacheSize++,e={actuals:new Array,exactCandidates:new Array,conversionCandidates:new Array,id:this.cacheSize},this.rdCache[this.cacheSize]=e),this.nextUp++,e},e.prototype.returnResolutionData=function(e){e.actuals.length=0,e.exactCandidates.length=0,e.conversionCandidates.length=0,this.nextUp=e.id},e}();e.ResolutionDataCache=u;var a=function(){function n(e,t,n,r){this.logger=e,this.initScope=t,this.parser=n,this.checker=r,this.thisFnc=null,this.thisClassNode=null,this.enclosingFncIsMethod=!1,this.arrayInterfaceType=null,this.stringInterfaceType=null,this.objectInterfaceType=null,this.functionInterfaceType=null,this.numberInterfaceType=null,this.booleanInterfaceType=null,this.currentScript=null,this.inNewTargetTypeCheck=!1,this.inImportTypeCheck=!1,this.inTypeRefTypeCheck=!1,this.inArrayElementTypeCheck=!1,this.resolutionDataCache=new u,this.nestingLevel=0,this.inBoundPropTypeCheck=!1,this.inSuperCall=!1,this.checker.typeFlow=this,this.scope=this.initScope,this.globalScope=this.initScope,this.doubleType=this.checker.numberType,this.booleanType=this.checker.booleanType,this.stringType=this.checker.stringType,this.anyType=this.checker.anyType,this.regexType=this.anyType,this.nullType=this.checker.nullType,this.voidType=this.checker.voidType,this.arrayAnyType=this.checker.makeArrayType(this.anyType)}return n.prototype.initLibs=function(){var t=this.globalScope.find("Array",!1,!0);t&&t.kind()==e.SymbolKind.Type&&(this.arrayInterfaceType=t.type);var n=this.globalScope.find("String",!1,!0);n&&n.kind()==e.SymbolKind.Type&&(this.stringInterfaceType=n.type);var r=this.globalScope.find("Object",!1,!0);r&&r.kind()==e.SymbolKind.Type&&(this.objectInterfaceType=r.type);var i=this.globalScope.find("Function",!1,!0);i&&i.kind()==e.SymbolKind.Type&&(this.functionInterfaceType=i.type);var s=this.globalScope.find("Number",!1,!0);s&&s.kind()==e.SymbolKind.Type&&(this.numberInterfaceType=s.type);var o=this.globalScope.find("Boolean",!1,!0);o&&o.kind()==e.SymbolKind.Type&&(this.booleanInterfaceType=o.type);var u=this.globalScope.find("RegExp",!1,!0);u&&u.kind()==e.SymbolKind.Type&&(this.regexType=u.type)},n.prototype.cast=function(e,t){return this.castWithCoercion(e,t,!0,!1)},n.prototype.castWithCoercion=function(t,n,r,i){var s=new e.TypeComparisonInfo;return this.checker.sourceIsAssignableToTarget(t.type,n,s)||i&&this.checker.sourceIsAssignableToTarget(n,t.type,s)?(r&&(n==null?t.type=this.anyType:n.isClass()?t.type=n.instanceType:t.type=n),t):(this.checker.errorReporter.incompatibleTypes(t,t.type,n,null,this.scope,s),t)},n.prototype.inScopeTypeCheck=function(t,n){var r=this.scope;this.scope=n;var i=this.thisFnc,s=this.thisType,o=this.thisClassNode,u=this.checker.currentModDecl,a=this.enclosingFncIsMethod,f=this.scope.container,l=null;while(f){if(f.kind()==e.SymbolKind.Type){var c=f,h=c.type;h.call&&l==null&&(this.enclosingFncIsMethod=c.isMethod,l=f.declAST);if(h.isClass()){this.thisType=h.instanceType,c.declAST&&c.declAST.nodeType==e.NodeType.Class&&(this.thisClassNode=c.declAST);break}if(h.isModuleType()){this.checker.currentModDecl=c.declAST;break}}f=f.container}this.thisFnc=l;var p=this.typeCheck(t);return this.thisFnc=i,this.thisType=s,this.thisClassNode=o,this.checker.currentModDecl=u,this.enclosingFncIsMethod=a,this.scope=r,p},n.prototype.typeCheck=function(e){return e?e.typeCheck(this):null},n.prototype.inScopeTypeCheckDecl=function(t){if(t.nodeType==e.NodeType.VarDecl||t.nodeType==e.NodeType.ArgDecl)this.inScopeTypeCheckBoundDecl(t);else if(t.nodeType==e.NodeType.FuncDecl){var n=t;n.isAccessor()&&this.typeCheckFunction(n)}},n.prototype.inScopeTypeCheckBoundDecl=function(t){var n=t.sym,r=this.thisFnc,i=this.thisType,s=this.enclosingFncIsMethod,o=this.checker.locationInfo;if(n&&n.container){var u=e.hasFlag(t.varFlags,e.VarFlags.ClassConstructorProperty)?n.container.getType().constructorScope:n.container.instanceScope();e.hasFlag(t.varFlags,e.VarFlags.Property)&&n.container.declAST.nodeType==e.NodeType.FuncDecl&&(this.thisFnc=n.container.declAST);if(u){var a=this.scope;this.scope=u;var f=n.container;this.checker.units&&n.unitIndex>=0&&n.unitIndex<this.checker.units.length?this.checker.locationInfo=this.checker.units[n.unitIndex]:this.checker.locationInfo=e.unknownLocationInfo;while(f){if(f.kind()==e.SymbolKind.Type){var l=f,c=l.type;c.call&&(this.enclosingFncIsMethod=l.isMethod);if(c.isClass()){this.thisType=c.instanceType;break}}f=f.container}this.typeCheckBoundDecl(t),this.scope=a}}this.thisFnc=r,this.thisType=i,this.checker.locationInfo=o,this.enclosingFncIsMethod=s},n.prototype.resolveBoundDecl=function(e){if(e.typeExpr)(e.typeExpr.type==null||e.typeExpr.type&&e.typeExpr.type==this.anyType&&this.scope||e.typeExpr.type.symbol==null||!this.checker.typeStatusIsFinished(e.typeExpr.type.symbol.typeCheckStatus))&&this.typeCheck(e.typeExpr),e.type=e.typeExpr.type,e.sym&&e.sym.setType(e.type);else if(e.init==null){this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(e,"type implicitly set to 'any'"),e.type=this.anyType;if(e.sym){if(e.sym.isType()){var t=e.sym;if(t.isMethod){this.checker.errorReporter.simpleError(e,"Cannot bind method group to variable.  (Did you mean to use 'declare function' instead of 'declare var'?)");return}this.checker.errorReporter.simpleError(e,"Cannot bind type to variable");return}e.sym.setType(e.type)}}},n.prototype.typeCheckBoundDecl=function(t){var n=t.sym;if(n==null)t.init?(t.init=this.typeCheck(t.init),t.type=this.checker.widenType(t.init.type)):(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),t.type=this.anyType);else if(n.typeCheckStatus==e.TypeCheckStatus.Started)this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),t.type=this.anyType,n.setType(this.anyType);else if(n.typeCheckStatus==e.TypeCheckStatus.NotStarted){n.typeCheckStatus=e.TypeCheckStatus.Started,this.checker.addStartedPTO(n);var r=!1;t.type==null&&t.typeExpr&&(this.resolveBoundDecl(t),r=!0,t.type=t.typeExpr.type,n.typeCheckStatus=this.checker.getTypeCheckFinishedStatus());if(t.init){e.hasFlag(t.varFlags,e.VarFlags.Ambient)&&this.checker.errorReporter.simpleError(t,"Ambient variable can not have an initializer");var i=e.hasFlag(t.varFlags,e.VarFlags.LocalStatic),s=this.scope,o=!t.init.isParenthesized;i&&(this.scope=t.sym.container.getType().memberScope),t.varFlags&e.VarFlags.Property&&(this.inBoundPropTypeCheck=!0),this.checker.typeCheckWithContextualType(t.type,this.checker.inProvisionalTypecheckMode(),o,t.init),this.inBoundPropTypeCheck&&(this.inBoundPropTypeCheck=!1),this.scope=s;if(t.type){var u=!1,a=null;t.init.type&&(a=t.init.type.containedScope,u=!0,t.init.type==this.voidType&&this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.text+"'")),t.init=this.castWithCoercion(t.init,t.type,o,!1),u&&t.init.type.containedScope==null&&(t.init.type.containedScope=a)}else t.type=this.checker.widenType(t.init.type),t.type==this.voidType&&(this.checker.errorReporter.simpleError(t,"Cannot assign type 'void' to variable '"+t.id.text+"'"),t.type=this.anyType);n.setType(t.type)}else r||this.resolveBoundDecl(t);n.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else this.checker.typeStatusIsFinished(n.typeCheckStatus)&&n.declAST!=t&&t.init&&(t.init=this.typeCheck(t.init),t.type=n.getType(),t.init=this.cast(t.init,t.type));return t.id&&t.sym&&(t.id.sym=t.sym),t},n.prototype.typeCheckSuper=function(e){return this.thisType&&this.enclosingFncIsMethod&&!this.thisFnc.isStatic()&&this.thisType.baseClass()?e.type=this.thisType.baseClass():(e.type=this.anyType,this.checker.errorReporter.invalidSuperReference(e)),e},n.prototype.typeCheckThis=function(t){var n=!1;this.thisFnc==null?this.thisType?this.thisClassNode&&this.thisClassNode.nty==e.NodeType.Class?(n=!0,t.type=this.anyType):t.type=this.thisType:(this.checker.currentModDecl&&this.checker.errorReporter.simpleError(t,"'this' may not be referenced within module bodies"),t.type=this.anyType):((this.inBoundPropTypeCheck||this.inSuperCall)&&this.thisClassNode&&this.thisClassNode.nty==e.NodeType.Class&&(n=!0),this.thisFnc.isMethod()||this.thisFnc.isConstructor||this.thisFnc.isTargetTypedAsMethod?this.thisType&&!(this.thisFnc.fncFlags&e.FncFlags.Static)?t.type=this.thisType:t.type=this.anyType:t.type=this.anyType);if(!this.enclosingFncIsMethod&&this.thisFnc&&e.hasFlag(this.thisFnc.fncFlags,e.FncFlags.IsFatArrowFunction))if(this.thisFnc.boundToProperty){var r=this.thisFnc.boundToProperty.sym.container;r.declAST.nodeType==e.NodeType.FuncDecl&&r.declAST.setHasSelfReference()}else{var i=this.thisFnc.enclosingFnc,s=i,o=!1;while(i){if(i.isMethod()||i.isConstructor||i.hasSelfReference()){i.setHasSelfReference(),o=!0;break}i=i.enclosingFnc}!o&&s&&s.setHasSelfReference(),o&&this.thisType&&(t.type=this.thisType)}return n&&this.checker.errorReporter.simpleError(t,"Keyword 'this' cannot be referenced in initializers in a class body, or in super constructor calls"),t},n.prototype.setTypeFromSymbol=function(t,n){if(n.isVariable()){if(n.isInferenceSymbol()){var r=n;r.declAST&&!this.checker.typeStatusIsFinished(r.typeCheckStatus)&&this.inScopeTypeCheckDecl(r.declAST),this.checker.styleSettings.innerScopeDeclEscape||r.declAST&&r.declAST.nodeType==e.NodeType.VarDecl&&this.nestingLevel<r.declAST.nestingLevel&&this.checker.errorReporter.styleError(t,"Illegal reference to a variable defined in more nested scope")}t.type=n.getType(),n.writeable()||(t.flags=t.flags&~e.ASTFlags.Writeable)}else n.isType()?(t.type=n.getType(),t.flags=t.flags&~e.ASTFlags.Writeable):(t.type=this.anyType,this.checker.errorReporter.symbolDoesNotReferToAValue(t,n.name))},n.prototype.typeCheckName=function(t){var n=this,r=t;if(this.checker.inWith)r.type=this.anyType;else{var i=!1,s=r.text,o=s,u=e.isQuoted(r.text),a=this.scope.find(s,!1,i);a==null&&u&&(a=this.checker.findSymbolForDynamicModule(s,this.currentScript.locationInfo.filename,function(e){return n.scope.find(e,!1,i)}));if(!a)r.isMissing()||this.checker.errorReporter.unresolvedSymbol(r,r.text),r.type=this.anyType;else{this.inNewTargetTypeCheck&&a.isInferenceSymbol()&&!this.checker.typeStatusIsFinished(a.typeCheckStatus)&&this.checker.errorReporter.simpleError(t,"Symbol '"+r.text+"' is referenced before its declaration");if(e.optimizeModuleCodeGen&&a&&a.isType()){var f=a.getType();if(f&&a.aliasLink&&a.onlyReferencedAsTypeRef){var l=f.symbol.declAST;l&&e.hasFlag(l.modFlags,e.ModuleFlags.IsDynamic)&&(a.onlyReferencedAsTypeRef=this.inTypeRefTypeCheck)}}a.declAST&&a.declAST.nodeType==e.NodeType.FuncDecl&&!a.declAST.returnTypeAnnotation&&a.declAST.signature.typeCheckStatus==e.TypeCheckStatus.Started&&(a.declAST.type.symbol.flags|=e.SymbolFlags.RecursivelyReferenced,a.declAST.signature.returnType.type=this.anyType),this.setTypeFromSymbol(t,a),r.sym=a,this.thisFnc&&this.thisFnc.type&&a.container!=this.thisFnc.type.symbol&&(this.thisFnc.freeVariables[this.thisFnc.freeVariables.length]=a)}}return t},n.prototype.typeCheckScript=function(e){return this.checker.locationInfo=e.locationInfo,this.scope=this.checker.globalScope,e.topLevelMod||this.addLocalsFromScope(this.scope,this.checker.gloMod,e.vars,this.checker.globals,!0),this.currentScript=e,e.bod=this.typeCheck(e.bod),this.currentScript=null,e},n.prototype.typeCheckBitNot=function(e){var t=e;return t.operand=this.typeCheck(t.operand),t.type=this.doubleType,t},n.prototype.typeCheckUnaryNumberOperator=function(e){var t=e;return t.operand=this.typeCheck(t.operand),t.type=this.doubleType,e},n.prototype.typeCheckLogNot=function(e){var t=e;return t.operand=this.typeCheck(t.operand),t.type=this.booleanType,t},n.prototype.astIsWriteable=function(t){return e.hasFlag(t.flags,e.ASTFlags.Writeable)},n.prototype.typeCheckIncOrDec=function(t){var n=t,r=n.operand;return this.astIsWriteable(n)?(n=this.typeCheckUnaryNumberOperator(t),n.operand.type!=this.checker.numberType&&n.operand.type!=this.checker.anyType&&!(n.operand.type.typeFlags&e.TypeFlags.IsEnum)&&this.checker.errorReporter.simpleError(t,"'++' and '--' may only be applied to operands of type 'number' or 'any'")):(this.checker.errorReporter.valueCannotBeModified(n),n.type=this.doubleType),n},n.prototype.typeCheckBitwiseOperator=function(t,n){var r=t,i=null;r.operand1=this.typeCheck(r.operand1),r.operand2=this.typeCheck(r.operand2);var s=r.operand1.type,o=r.operand2.type;n&&!this.astIsWriteable(r)&&this.checker.errorReporter.valueCannotBeModified(r),this.checker.styleSettings.bitwise&&this.checker.errorReporter.styleError(t,"use of "+e.nodeTypeTable[r.nodeType]);if(this.checker.sourceIsSubtypeOfTarget(s,this.doubleType)&&this.checker.sourceIsSubtypeOfTarget(o,this.doubleType))i=this.doubleType;else if(s==this.booleanType&&o==this.booleanType)i=this.booleanType;else if(s==this.anyType){if(o==this.anyType||o==this.doubleType||o==this.booleanType)i=this.anyType}else o==this.anyType&&(s==this.anyType||s==this.doubleType||s==this.booleanType)&&(i=this.anyType);return i==null&&(i=this.anyType,this.checker.errorReporter.incompatibleTypes(r,s,o,r.printLabel(),this.scope)),r.type=i,r},n.prototype.typeCheckArithmeticOperator=function(t,n){var r=t;r.operand1=this.typeCheck(r.operand1),r.operand2=this.typeCheck(r.operand2);var i=r.operand1.type,s=r.operand2.type;n&&!this.astIsWriteable(r)&&this.checker.errorReporter.valueCannotBeModified(r),this.checker.styleSettings.bitwise&&(r.nodeType==e.NodeType.And||r.nodeType==e.NodeType.Or||r.nodeType==e.NodeType.AsgAnd||r.nodeType==e.NodeType.AsgOr)&&this.checker.errorReporter.styleError(t,"use of "+e.nodeTypeTable[r.nodeType]);if(i==null||s==null)return this.checker.errorReporter.simpleError(r,"Could not typecheck arithmetic operation.  Possible recursive typecheck error?"),r.type=this.anyType,r;var o=r.nodeType;return this.checker.isNullOrUndefinedType(i)&&(i=s),this.checker.isNullOrUndefinedType(s)&&(s=i),i=this.checker.widenType(i),s=this.checker.widenType(s),o==e.NodeType.Add||o==e.NodeType.AsgAdd?i==this.checker.stringType||s==this.checker.stringType?r.type=this.checker.stringType:i==this.checker.numberType&&s==this.checker.numberType?r.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(i,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(s,this.checker.numberType)?r.type=this.checker.numberType:i==this.checker.anyType||s==this.checker.anyType?r.type=this.checker.anyType:(r.type=this.anyType,this.checker.errorReporter.incompatibleTypes(r,i,s,r.printLabel(),this.scope)):i==this.checker.numberType&&s==this.checker.numberType?r.type=this.checker.numberType:this.checker.sourceIsSubtypeOfTarget(i,this.checker.numberType)&&this.checker.sourceIsSubtypeOfTarget(s,this.checker.numberType)?r.type=this.checker.numberType:i==this.checker.anyType||s==this.checker.anyType?r.type=this.checker.numberType:(r.type=this.anyType,this.checker.errorReporter.incompatibleTypes(r,i,s,r.printLabel(),this.scope)),r},n.prototype.typeCheckDotOperator=function(e){var t=e,n=!1;t.operand1=this.typeCheck(t.operand1);var r=t.operand1.type,i=null;if(r){if(r==this.anyType)return t.type=this.anyType,t;if(r==this.stringType){if(!this.stringInterfaceType)return t.type=this.anyType,t;i=this.stringInterfaceType.memberScope}else if(r==this.doubleType){if(!this.numberInterfaceType)return t.type=this.anyType,t;i=this.numberInterfaceType.memberScope}else if(r==this.booleanType){if(!this.booleanInterfaceType)return t.type=this.anyType,t;i=this.booleanInterfaceType.memberScope}else if((r.call||r.construct)&&r.members==null){if(!this.functionInterfaceType)return t.type=this.anyType,t;i=this.functionInterfaceType.memberScope}else if(r.elementType){if(!this.arrayInterfaceType)return t.type=this.anyType,t;var s=r.elementType.getArrayBase(this.arrayInterfaceType,this.checker);i=s.memberScope}else i=r.memberScope}if(i==null)this.checker.errorReporter.expectedClassOrInterface(t),t.type=this.anyType;else{var o=t.operand2,u=this.thisClassNode&&t.operand1.type==this.thisClassNode.type.instanceType,a=i.find(o.text,!u,!1);a||this.objectInterfaceType&&r&&(r.isReferenceType()&&(a=this.objectInterfaceType.memberScope.find(o.text,!1,!1)),a||this.functionInterfaceType&&(r.call||r.construct)&&(a=this.functionInterfaceType.memberScope.find(o.text,!1,!1)));if(!a||!a.visible(i,this.checker))t.type=this.anyType,a==null?this.checker.errorReporter.simpleError(o,"The property '"+o.text+"' does not exist on value of type '"+r.getScopedTypeName(this.scope)+"'"):this.checker.errorReporter.simpleError(t,"The property '"+o.text+" on type '"+r.getScopedTypeName(this.scope)+"' is not visible");else{if(a.isVariable()&&a.isInferenceSymbol()){var f=a;f.declAST&&!this.checker.typeStatusIsFinished(f.typeCheckStatus)&&this.inScopeTypeCheckDecl(f.declAST)}o.sym=a,t.type=a.getType()}}return t.type==null&&(t.type=this.anyType),t},n.prototype.typeCheckBooleanOperator=function(e){var t=e;t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2);var n=t.operand1.type,r=t.operand2.type;return!this.checker.sourceIsAssignableToTarget(n,r)&&!this.checker.sourceIsAssignableToTarget(r,n)&&this.checker.errorReporter.incompatibleTypes(t,n,r,t.printLabel(),this.scope),t.type=this.booleanType,t},n.prototype.typeCheckAsgOperator=function(t){var n=t,r=!n.operand2.isParenthesized;n.operand1=this.typeCheck(n.operand1),this.checker.typeCheckWithContextualType(n.operand1.type,this.checker.inProvisionalTypecheckMode(),r,n.operand2);var i=n.operand1.type,s=n.operand2.type;this.astIsWriteable(n.operand1)||this.checker.errorReporter.valueCannotBeModified(n);if(n.operand1.nodeType==e.NodeType.Call)var o=n.operand1;var u=!1,a=null;return n.operand2.type&&(a=n.operand2.type.containedScope,u=!0),n.operand2=this.castWithCoercion(n.operand2,i,r,!1),u&&n.operand2.type.containedScope==null&&(n.operand2.type.containedScope=a),n.type=s,n},n.prototype.typeCheckIndex=function(t){var n=t;n.operand1=this.typeCheck(n.operand1),n.operand2=this.typeCheck(n.operand2),this.checker.styleSettings.literalSubscript||n.operand2.nodeType==e.NodeType.QString&&this.checker.errorReporter.styleError(t,"use literal subscript ('.') notation instead)");var r=n.operand1.type,i=n.operand2.type;if(r.elementType)i==this.checker.anyType||i==this.checker.numberType||e.hasFlag(i.typeFlags,e.TypeFlags.IsEnum)?n.type=r.elementType:i==this.checker.stringType?n.type=this.checker.anyType:(this.checker.errorReporter.simpleError(n,"Illegal property access"),n.type=this.checker.anyType);else if(r.index)if(i==this.checker.anyType||!(r.index.flags&e.SignatureFlags.IsStringIndexer||r.index.flags&e.SignatureFlags.IsNumberIndexer)||r.index.flags&e.SignatureFlags.IsStringIndexer&&i==this.checker.stringType||r.index.flags&e.SignatureFlags.IsNumberIndexer&&(i==this.checker.numberType||e.hasFlag(i.typeFlags,e.TypeFlags.IsEnum))){var s=this.resolveOverload(t,r.index);s?n.type=s.returnType.type:n.type=this.checker.anyType}else i==this.checker.stringType?n.type=this.checker.anyType:(this.checker.errorReporter.simpleError(n,"Illegal property access"),n.type=this.checker.anyType);else r!=this.checker.anyType&&r!=this.checker.stringType&&r!=this.checker.numberType&&r!=this.checker.booleanType&&!r.isReferenceType()||i!=this.checker.anyType&&i!=this.checker.stringType&&i!=this.checker.numberType&&!e.hasFlag(i.typeFlags,e.TypeFlags.IsEnum)?(this.checker.errorReporter.simpleError(n,"Illegal property access"),n.type=this.checker.anyType):n.type=this.checker.anyType;return n},n.prototype.typeCheckInOperator=function(e){return e.operand1=this.cast(this.typeCheck(e.operand1),this.stringType),e.operand2=this.typeCheck(e.operand2),(e.operand1.type!=this.checker.anyType&&e.operand1.type!=this.checker.stringType||e.operand2.type!=this.anyType&&!this.checker.sourceIsSubtypeOfTarget(e.operand2.type,this.objectInterfaceType))&&this.checker.errorReporter.simpleError(e,"The in operator requires the left operand to be of type Any or the String primitive type, and the right operand to be of type Any or an object type"),e.type=this.booleanType,e},n.prototype.typeCheckShift=function(e,t){return e.operand1=this.cast(this.typeCheck(e.operand1),this.doubleType),e.operand2=this.cast(this.typeCheck(e.operand2),this.doubleType),t&&!this.astIsWriteable(e.operand1)&&this.checker.errorReporter.valueCannotBeModified(e),e.type=this.doubleType,e},n.prototype.typeCheckQMark=function(e){e.operand1=this.typeCheck(e.operand1),e.operand2=this.typeCheck(e.operand2),e.operand3=this.typeCheck(e.operand3);var t=e.operand2.type,n=e.operand3.type;return t==n?e.type=t:this.checker.sourceIsSubtypeOfTarget(t,n)?e.type=n:this.checker.sourceIsSubtypeOfTarget(n,t)?e.type=t:(e.type=this.anyType,this.checker.errorReporter.incompatibleTypes(e,t,n,e.printLabel(),this.scope)),e},n.prototype.addFormals=function(e,t,n){var r=t.parameters.length;for(var i=0;i<r;i++){var s=t.parameters[i];s.container=e,n.add(s.name,s)}},n.prototype.addLocalsFromScope=function(t,n,r,i,s){var o=r.members.length,u=!1;for(var a=0;a<o;a++){var f=r.members[a];if(f.sym==null||f.sym.kind()!=e.SymbolKind.Field){var l=null;if((l=i.lookup(f.id.text))==null){var c=new e.ValueLocation;c.typeLink=new e.TypeLink;var h=null;e.hasFlag(f.varFlags,e.VarFlags.Static)?(f.varFlags|=e.VarFlags.LocalStatic,h=new e.FieldSymbol(f.id.text,f.minChar,this.checker.locationInfo.unitIndex,!0,c)):h=new e.VariableSymbol(f.id.text,f.minChar,this.checker.locationInfo.unitIndex,c),h.transferVarFlags(f.varFlags),c.symbol=h,h.declAST=f,c.typeLink.ast=f.typeExpr,this.checker.resolveTypeLink(t,c.typeLink,!1),f.type==null&&f.init==null&&(f.type=this.anyType),c.typeLink.type=f.type,c.symbol.container=n,f.sym=c.symbol,i.add(f.id.text,h),f.id.text=="arguments"&&(u=!0)}else f.type=l.getType(),f.sym=l}}if(!s&&!u){var p=new e.ValueLocation;p.typeLink=new e.TypeLink;var d=new e.VariableSymbol("arguments",r.minChar,this.checker.locationInfo.unitIndex,p);p.typeLink.ast=new e.Identifier("IArguments"),this.checker.resolveTypeLink(t,p.typeLink,!1),i.add("arguments",d)}},n.prototype.addConstructorLocalArgs=function(t,n,r,i){if(n){var s=n.members.length;for(var o=0;o<s;o++){var u=n.members[o];if(u.sym==null||i||u.sym.kind()!=e.SymbolKind.Field){var a=null;if((a=r.lookup(u.id.text))==null){this.resolveBoundDecl(u);var f=new e.ValueLocation;f.typeLink=new e.TypeLink;var l=new e.ParameterSymbol(u.id.text,u.minChar,this.checker.locationInfo.unitIndex,f);l.declAST=u,f.symbol=l,f.typeLink.type=u.type,f.symbol.container=t,u.sym=f.symbol,r.add(u.id.text,l)}else u.type=a.getType(),u.sym=a}}}},n.prototype.checkInitSelf=function(e){if(!e.isMethod()){var t=e.freeVariables;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.isInstanceProperty())return!0}}var s=e.scopes,o=s.members.length;for(var u=0;u<o;u++){var a=s.members[u];if(this.checkInitSelf(a))return!0}return!1},n.prototype.checkPromoteFreeVars=function(t,n){var r=t.freeVariables;for(var i=0,s=r.length;i<s;i++){var o=r[i];!o.isInstanceProperty()&&o.container==n&&(e.instanceFilter.reset(),this.scope.search(e.instanceFilter,o.name,!1,!1)&&this.checker.errorReporter.simpleError(t,"Constructor-local variable shadows class property '"+o.name+"'. To access the class property, use 'self."+o.name+"'"),this.checker.errorReporter.simpleError(t,"Constructor-local variables may not be accessed from instance method bodies. Consider changing local variable '"+o.name+"' to a class property"))}},n.prototype.allReturnsAreVoid=function(t){var n=!0;if(t.signature.returnType.type==null){var r=function(t,r,i){var s=!0;switch(t.nodeType){case e.NodeType.FuncDecl:s=!1;break;case e.NodeType.Return:var o=t;o.returnExpression&&(n=!1,s=!1);default:}return i.options.goChildren=s,i.options.goNextSibling=s,t};e.getAstWalkerFactory().walk(t.bod,r)}return n},n.prototype.classConstructorHasSuperCall=function(t){var n=!1,r=function(t,r,i){var s=!0;switch(t.nodeType){case e.NodeType.FuncDecl:s=!1;break;case e.NodeType.Call:var o=t;if(o.target.nodeType==e.NodeType.Super){s=!1,n=!0;break}break;default:}return i.options.goChildren=s,t};return e.getAstWalkerFactory().walk(t.bod,r),n},n.prototype.typeCheckFunction=function(t){this.nestingLevel=0;var n=t.type,r=n.symbol,i=t.signature;if(this.checker.typeStatusIsFinished(i.typeCheckStatus))return t;if(i.typeCheckStatus==e.TypeCheckStatus.Started)return!t.returnTypeAnnotation&&t.bod&&!t.isSignature()&&!t.isConstructor&&this.allReturnsAreVoid(t)?(i.returnType.type=this.voidType,t):(t.returnTypeAnnotation==null&&(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),i.returnType.type=this.anyType,r.flags|=e.SymbolFlags.RecursivelyReferenced),t);i.typeCheckStatus=e.TypeCheckStatus.Started,this.checker.addStartedPTO(i);var s=this.scope,o=this.thisFnc,u=this.enclosingFncIsMethod,a=this.thisClassNode;this.enclosingFncIsMethod=t.isMethod()||t.isConstructor,this.thisFnc=t;var f=t.type.symbol,l=this.thisType,c=this.checker.locationInfo,h=null,p=!1,d=null,v=null,m=t.isAccessor()&&e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor),g=t.isAccessor()&&e.hasFlag(t.fncFlags,e.FncFlags.SetAccessor),y=(m||g)&&t.accessorSymbol?t.accessorSymbol.getType():null,b=this.checker.currentModDecl;if(t.isConstructor&&!t.isOverload){if(n.instanceType==null)return this.checker.errorReporter.simpleError(t,"Malformed function body (is this a class named the same as an existing interface?)"),t;this.scope=n.instanceType.constructorScope;var w=this.scope;h=w.valueMembers.allMembers}else if(t.isOverload)h=t.symbols,!e.hasFlag(t.fncFlags,e.FncFlags.Static)&&n.containedScope&&(this.scope=n.containedScope);else{t.bod&&(this.scope=n.containedScope);var w=this.scope;w&&w.valueMembers&&(h=w.valueMembers.allMembers)}if(t.isConstructor&&t.bod&&e.hasFlag(t.fncFlags,e.FncFlags.ClassMethod)){var E=e.hasFlag(t.classDecl.type.instanceType.typeFlags,e.TypeFlags.HasBaseType),S=!E||e.hasFlag(t.classDecl.type.instanceType.typeFlags,e.TypeFlags.HasBaseTypeOfObject),x=e.hasFlag(t.classDecl.varFlags,e.VarFlags.ClassSuperMustBeFirstCallInConstructor);S&&this.classConstructorHasSuperCall(t)?this.checker.errorReporter.simpleError(t,"Calls to 'super' constructor are not allowed in classes that either inherit directly from 'Object' or have no base class"):E&&(x?(!t.bod||!t.bod.members.length||t.bod.members[0].nodeType!=e.NodeType.Call||t.bod.members[0].target.nodeType!=e.NodeType.Super)&&this.checker.errorReporter.simpleError(t,"If a derived class contains initialized properties or constructor parameter properties, the first statement in the constructor body must be a call to the super constructor"):this.classConstructorHasSuperCall(t)||this.checker.errorReporter.simpleError(t,"Constructors for derived classes must contain a call to the class's 'super' constructor"))}if(t.isMethod()&&t.type.enclosingType){var T=null;t.type.enclosingType.symbol.declAST.nodeType==e.NodeType.FuncDecl?T=t.type.enclosingType.symbol.declAST.classDecl:t.type.enclosingType.symbol.declAST.nodeType==e.NodeType.Class&&(T=t.type.enclosingType.symbol.declAST),T&&(this.thisClassNode=T)}if(n.enclosingType){var N=n.symbol.container;N&&N.isType()&&N.getType().isClass()&&(N=N.container),N&&N.declAST&&N.declAST.nodeType==e.NodeType.Module&&(this.checker.currentModDecl=N.declAST)}this.checker.units&&t.unitIndex>=0&&t.unitIndex<this.checker.units.length?this.checker.locationInfo=this.checker.units[t.unitIndex]:this.checker.locationInfo=e.unknownLocationInfo,n.enclosingType?this.thisType=n.enclosingType:this.thisType=l;var C=i.parameters.length;if(!t.isConstructor&&t.bod&&!t.isSignature()){var k=this.scope,w=this.scope;if(!t.isMethod()&&t.returnTypeAnnotation==null){if(s&&t.name&&!t.name.isMissing()){var L=s.findAmbient(t.name.text,!1,!1);L&&L.declAST&&L.declAST.type&&(this.checker.setContextualType(L.declAST.type,!1),p=!0)}if(this.checker.hasTargetType()){var A=this.checker.getTargetTypeContext(),O=A.contextualType;if(this.checker.canContextuallyTypeFunction(O,t,!0)){var M=O.construct?O.construct:O.call;A.targetSig=M.signatures[0];var _=A.targetSig.parameters;d=_,v=A.targetSig.returnType.type,A.targetSig.declAST&&(A.targetSig.declAST.isConstructor?t.isTargetTypedAsMethod=!0:A.targetSig.declAST.isMethod()&&(t.isTargetTypedAsMethod=!0)),r.type=A.contextualType}else O&&t.isAccessor()?(y=O,A.targetAccessorType=y):this.checker.killTargetType()}}var D=w.valueMembers;this.scope=new e.SymbolScopeBuilder(D,null,null,null,s,f);for(var P=0;P<C;P++){var H=i.parameters[P],B=H,j=B.declAST;if(this.checker.hasTargetType()&&d&&(this.checker.getTargetTypeContext().targetSig.hasVariableArgList||P<d.length)){var A=this.checker.getTargetTypeContext(),F=A.targetSig.hasVariableArgList;j.type=F&&P>=d.length-1?d[d.length-1].getType().elementType:d[P].getType(),j.sym.setType(j.type),j.sym.typeCheckStatus=this.checker.getTypeCheckFinishedStatus()}else this.typeCheck(j);g&&y&&(j=this.cast(j,y)),B.container=f,D.publicMembers.add(B.name,B)}this.scope=k}else{this.typeCheck(t.args);for(var P=0;P<C;P++)i.parameters[P].parameter.typeLink.type=t.args.members[P].type,t.args.members[P].parameterPropertySym&&t.args.members[P].parameterPropertySym.setType(t.args.members[P].type);t.fncFlags&e.FncFlags.IndexerMember&&(!C||C>1?this.checker.errorReporter.simpleError(t,"Index signatures may take only one parameter"):t.args.members[0].type==this.checker.numberType?n.index.flags|=e.SignatureFlags.IsNumberIndexer:t.args.members[0].type==this.checker.stringType?n.index.flags|=e.SignatureFlags.IsStringIndexer:this.checker.errorReporter.simpleError(t,"Index signatures may only take 'string' or 'number' as their parameter"))}if(t.bod&&!t.isSignature()){if(!t.isConstructor)this.addFormals(f,i,h);else{this.addConstructorLocalArgs(t.type.symbol,t.args,h,e.hasFlag(t.fncFlags,e.FncFlags.ClassMethod));if(this.thisClassNode&&this.thisClassNode.extendsList){var I=this.scope,q=new e.ScopedMembers(h);this.scope=new e.FilteredSymbolScopeBuilder(q,s,t.type.symbol,function(t){return t.kind()==e.SymbolKind.Parameter}),this.typeCheckBaseCalls(this.thisClassNode.extendsList),this.scope=I}}var R=this.checker.currentModDecl;t.type&&t.type.symbol&&!t.isMethod()&&t.type.symbol.declModule&&(this.checker.currentModDecl=t.type.symbol.declModule),this.typeCheck(t.bod),this.checker.currentModDecl=R;if(this.checker.checkControlFlow){var U=t.buildControlFlow();this.checker.printControlFlowGraph&&U.print(this.checker.errorReporter.outfile),U.reportUnreachable(this.checker.errorReporter),this.checker.checkControlFlowUseDef&&U.useDef(this.checker.errorReporter,t.type.symbol)}if(t.isConstructor){var z=t.scopes,W=z.members.length,X,V,$=0;for(;$<W;$++){var J=z.members[$];J.isSignature()||e.hasFlag(J.fncFlags,e.FncFlags.Method)&&!e.hasFlag(J.fncFlags,e.FncFlags.Static)&&this.checkPromoteFreeVars(J,t.type.symbol)}}}this.scope=s,this.thisFnc=o,this.thisClassNode=a,this.enclosingFncIsMethod=u,this.thisType=l,this.checker.locationInfo=c,this.checker.currentModDecl=b,i.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),t.returnTypeAnnotation?(this.checkForVoidConstructor(t.returnTypeAnnotation.type,t.returnTypeAnnotation),i.returnType.type==null&&this.checker.resolveTypeLink(this.scope,i.returnType,!1)):v&&(i.returnType.type=v);if(!(r.flags&e.SymbolFlags.RecursivelyReferenced)&&t.returnStatementsWithExpressions.length>0){var K={getLength:function(){return t.returnStatementsWithExpressions.length},setTypeAtIndex:function(e,n){t.returnStatementsWithExpressions[e].type=n},getTypeAtIndex:function(e){return t.returnStatementsWithExpressions[e].type}},Q=t.returnStatementsWithExpressions[0].type;Q=this.checker.findBestCommonType(Q,null,K);if(Q)i.returnType.type=this.checker.widenType(Q);else{for(var G=0;G<t.returnStatementsWithExpressions.length;G++)this.checker.errorReporter.simpleError(t.returnStatementsWithExpressions[G],"Incompatible return type");i.returnType.type=this.anyType}}if(i.returnType.type==null)e.hasFlag(t.fncFlags,e.FncFlags.HasReturnExpression)?(this.checker.styleSettings.implicitAny&&this.checker.errorReporter.styleError(t,"type implicitly set to 'any'"),i.returnType.type=this.anyType):i.returnType.type=this.voidType;else if(i.returnType.type==this.nullType||i.returnType.type==this.checker.undefinedType)i.returnType.type=this.anyType;else if(i.returnType.type!=this.voidType&&i.returnType.type!=this.checker.undefinedType&&i.returnType.type!=this.anyType&&t.returnTypeAnnotation&&!t.isSignature()&&!t.isConstructor&&!e.hasFlag(t.fncFlags,e.FncFlags.HasReturnExpression)&&!e.hasFlag(t.fncFlags,e.FncFlags.IsFatArrowFunction)){var Y=t.bod.members.length>0&&t.bod.members[0].nodeType==e.NodeType.Throw;Y||this.checker.errorReporter.simpleError(t,"Function declared a non-void return type, but has no return expression")}p&&this.checker.unsetContextualType();if(t.accessorSymbol){var y=t.accessorSymbol.getType();y?(e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)&&y!=i.returnType.type||t.args.members.length>0&&y!=t.args.members[0].type)&&this.checker.errorReporter.simpleError(t,"Getter and setter types do not agree"):e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)?t.accessorSymbol.setType(i.returnType.type):t.args.members.length!=1?this.checker.errorReporter.simpleError(t,"Setters may have one and only one argument"):t.accessorSymbol.setType(t.args.members[0].type)}return this.typeCheckOverloadSignatures(n,t),t},n.prototype.typeCheckBases=function(t){var n=!1,r=t.extendsList;if(r){var i=r.length;this.inNewTargetTypeCheck=!0,i>0&&(t.typeFlags|=e.TypeFlags.HasBaseType);for(var s=0;s<i;s++){var o=r[s],u=o.symbol&&o.symbol.name=="Object"&&o.symbol.container==this.checker.gloMod;u&&(t.typeFlags|=e.TypeFlags.HasBaseTypeOfObject);if(o.isClassInstance())t.isClassInstance()&&!this.checker.typeStatusIsFinished(o.symbol.typeCheckStatus)&&o.symbol.declAST&&(this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Base type '"+o.symbol.name+"' is referenced before its declaration"),this.typeCheck(o.symbol.declAST)),this.currentScript&&(this.currentScript.requiresInherits=!0),t.isClassInstance()?n&&this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Class may not follow interface as base type"):this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Interface base type must be interface");else if(o.isModuleType())this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Types may not be derived from module types");else{if(!o.members){t.isClassInstance()?this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Base type must be interface or class"):this.checker.errorReporter.simpleErrorFromSym(o.symbol,"Interface base type must be interface");break}n||(n=!0)}}this.inNewTargetTypeCheck=!1}},n.prototype.checkMembersImplementInterfaces=function(t){var n=t.getInstanceType();if(n.implementsList){var r=n.implementsList.length;this.inNewTargetTypeCheck=!0;for(var i=0;i<r;i++){var s=n.implementsList[i],o=new e.TypeComparisonInfo;if(!this.checker.sourceIsSubtypeOfTarget(n,s,o)){var u="Class '"+n.getTypeName()+"' declares interface '"+s.getTypeName()+"' but does not implement it";o.message?this.checker.errorReporter.simpleErrorFromSym(n.symbol,u+": "+o.message):this.checker.errorReporter.simpleErrorFromSym(n.symbol,u)}}this.inNewTargetTypeCheck=!1}},n.prototype.typeCheckBaseCalls=function(t){if(t==null)return;var n=t.members.length;for(var r=0;r<n;r++){var i=t.members[r],s=null;i.nodeType==e.NodeType.Call&&this.typeCheckNew(i)}},n.prototype.assertUniqueNamesInBaseTypes=function(t,n,r,i){var s=this;if(n){n.members&&n.members.publicMembers.map(function(e,o,u){var a=o,f=t.lookup(a.name);f?i&&s.checker.errorReporter.simpleError(r,"duplicate member name in bases for "+r.name.text+": "+n.symbol.name+" and "+f.container.name+" both contain member with name "+a.name):t.add(a.name,a)},null);if(n.extendsList){var o=n.extendsList.length;for(var u=0;u<o;u++)n.extendsList[u].symbol.flags&e.SymbolFlags.RecursivelyReferenced||this.assertUniqueNamesInBaseTypes(t,n.extendsList[u],r,i)}}},n.prototype.checkBaseTypeMemberInheritance=function(t,n){var r=this,i=t.getInstanceType();if(i.extendsList==null)return;var s=i.extendsList.length;if(s>0){var o=new e.StringHashTable;if(i.isClassInstance())for(var u=0;u<s;u++)this.assertUniqueNamesInBaseTypes(o,i.extendsList[u],n,u>0);i.members&&i.members.publicMembers.map(function(t,o,u){var a=o;for(var f=0;f<s;f++){var l=i.extendsList[f];if(l.memberScope==null)r.checker.errorReporter.simpleError(n,"Base type '"+l.symbol.name+"' lacks an implementation.");else{var c=l.memberScope.find(a.name,!1,!1);if(c){var h=a.getType(),p=c.getType();r.checker.sourceIsSubtypeOfTarget(h,p)?a.kind()==e.SymbolKind.Type&&c.kind()==e.SymbolKind.Field&&r.checker.errorReporter.simpleErrorFromSym(a,"Cannot override field '"+a.name+"' with method"):r.checker.errorReporter.simpleErrorFromSym(a,"Type of overridden member '"+a.name+"' is not subtype of original member defined by type '"+c.container.name+"'")}}}},null)}},n.prototype.typeCheckClass=function(t){var n=t.type.symbol;if(n.typeCheckStatus==e.TypeCheckStatus.Finished)return t;if(n.typeCheckStatus==e.TypeCheckStatus.Started)return t;n.typeCheckStatus=e.TypeCheckStatus.Started,this.checker.addStartedPTO(n);var r=this.scope,i=this.thisClassNode;this.thisClassNode=t;var s=t.type;this.typeCheckBases(s.instanceType);var o=this.thisType;this.thisType=s.instanceType,this.scope=s.instanceType.containedScope;if(t.constructorDecl){this.scope=s.instanceType.constructorScope;var u=this.scope,a=u.valueMembers.allMembers;this.addConstructorLocalArgs(t.constructorDecl.type.symbol,t.constructorDecl.args,a,!0)}return this.typeCheck(t.members),n.typeCheckStatus=e.TypeCheckStatus.Finished,this.checkBaseTypeMemberInheritance(s,t),this.checkMembersImplementInterfaces(s),this.typeCheckOverloadSignatures(s,t),this.typeCheckOverloadSignatures(s.instanceType,t),t.constructorDecl||t.baseClass&&t.baseClass.members.length&&t.baseClass.members[0].type&&t.baseClass.members[0].type.symbol.type.isClass()&&e.cloneParentConstructGroupForChildType(t.type,t.baseClass.members[0].type.symbol.type),this.thisType=o,this.thisClassNode=i,this.scope=r,t},n.prototype.typeCheckOverloadSignatures=function(e,t){e.call&&e.call.typeCheck(this.checker,t,e.construct!=null),e.construct&&e.construct.typeCheck(this.checker,t,!1),e.index&&e.index.typeCheck(this.checker,t,!1)},n.prototype.typeCheckInterface=function(e){this.typeCheckBases(e.type),this.typeCheck(e.members),this.checkBaseTypeMemberInheritance(e.type,e);if(e.extendsList)for(var t=0;t<e.extendsList.members.length;t++)e.extendsList.members[t].type.call&&(e.type.call?e.type.call.signatures=e.type.call.signatures.concat(e.extendsList.members[t].type.call.signatures):e.type.call=e.extendsList.members[t].type.call),e.extendsList.members[t].type.construct&&(e.type.construct?e.type.construct.signatures=e.type.construct.signatures.concat(e.extendsList.members[t].type.construct.signatures):e.type.construct=e.extendsList.members[t].type.construct),e.extendsList.members[t].type.index&&(e.type.index?e.type.index.signatures=e.type.index.signatures.concat(e.extendsList.members[t].type.index.signatures):e.type.index=e.extendsList.members[t].type.index);return e},n.prototype.typeCheckImportDecl=function(t){var n=t.alias.type,r=null,i=this.inImportTypeCheck;return this.inImportTypeCheck=!0,this.typeCheck(t.alias),n=t.alias.type,n==null&&(this.checker.errorReporter.simpleError(t.alias,"Could not resolve module alias '"+t.id.text+"'"),n=this.checker.anyType,t.id.sym.type=n),t.id.type=n,r=n.symbol,n.isModuleType()?(r.type=n,this.checker.currentModDecl&&this.checker.currentModDecl.mod&&this.checker.currentModDecl.mod.importedModules.push(t),t.id.sym.type=n,n.symbol&&n.symbol.declAST&&(n.symbol.declAST.modFlags&=~e.ModuleFlags.ShouldEmitModuleDecl)):this.checker.errorReporter.simpleError(t.alias,"A module cannot be aliased to a non-module type"),this.inImportTypeCheck=i,t},n.prototype.typeCheckModule=function(t){if(!t.mod)return t;this.currentScript&&(this.currentScript.requiresGlobal=!0);var n=t.mod,r=null,i=this.scope,s=this.thisType,o=this.checker.currentModDecl;return this.checker.currentModDecl=t,!this.inImportTypeCheck&&o&&e.hasFlag(t.modFlags,e.ModuleFlags.IsDynamic)&&!e.hasFlag(t.modFlags,e.ModuleFlags.Ambient)&&this.checker.errorReporter.simpleError(t,"Dynamic modules may not be nested within other modules"),this.thisType=null,this.scope=n.containedScope,this.typeCheck(t.members),r=n.symbol,this.checker.currentModDecl=o,this.thisType=s,this.scope=i,t.type=n,r&&(r.typeCheckStatus=e.TypeCheckStatus.Finished),t},n.prototype.typeCheckFor=function(e){return e.init=this.typeCheck(e.init),this.nestingLevel++,e.cond=this.typeCheck(e.cond),this.typeCheckCondExpr(e.cond),e.incr=this.typeCheck(e.incr),this.nestingLevel--,e.body=this.typeCheck(e.body),this.typeCheckCompoundStmtBlock(e.body,"for statement"),e.type=this.voidType,e},n.prototype.typeCheckWith=function(e){return this.checker.errorsOnWith&&this.checker.errorReporter.simpleError(e.expr,"All symbols within a 'with' block will be typed as 'any'"),e.expr=this.typeCheck(e.expr),this.checker.inWith=!0,e.body=this.typeCheck(e.body),this.typeCheckCompoundStmtBlock(e.body,"with statement"),this.checker.inWith=!1,e},n.prototype.typeCheckForIn=function(t){t.obj=this.typeCheck(t.obj),t.lval=this.cast(this.typeCheck(t.lval),this.checker.stringType);if(t.lval.nodeType==e.NodeType.VarDecl){var n=t.lval;n.typeExpr&&this.checker.errorReporter.simpleError(n,"Variable declarations for for/in expressions may not contain a type annotation"),n.sym&&n.sym.setType(this.checker.stringType)}return t.body=this.typeCheck(t.body),this.typeCheckCompoundStmtBlock(t.body,"for in statement"),t},n.prototype.typeCheckWhile=function(e){return e.cond=this.typeCheck(e.cond),this.typeCheckCondExpr(e.cond),e.body=this.typeCheck(e.body),this.typeCheckCompoundStmtBlock(e.body,"while statement"),e.type=this.voidType,e},n.prototype.typeCheckDoWhile=function(e){return e.cond=this.typeCheck(e.cond),this.typeCheckCondExpr(e.cond),e.body=this.typeCheck(e.body),this.typeCheckCompoundStmtBlock(e.body,"do while statement"),e.type=this.voidType,e},n.prototype.typeCheckCondExpr=function(t){this.checker.styleSettings.assignmentInCond&&t!==null&&t.nodeType>=e.NodeType.Asg&&t.nodeType<=e.NodeType.LastAsg&&this.checker.errorReporter.simpleError(t,"top-level assignment statement in conditional expression")},n.prototype.typeCheckCompoundStmtBlock=function(t,n){this.checker.styleSettings.blockInCompoundStmt&&t&&t.nodeType!=e.NodeType.Block&&this.checker.errorReporter.styleError(t,n+" requires a block")},n.prototype.typeCheckIf=function(e){return e.cond=this.typeCheck(e.cond),this.typeCheckCondExpr(e.cond),e.thenBod=this.typeCheck(e.thenBod),e.elseBod=this.typeCheck(e.elseBod),this.typeCheckCompoundStmtBlock(e.thenBod,"if statement"),this.typeCheckCompoundStmtBlock(e.elseBod,"if statement"),e.type=this.voidType,e},n.prototype.typeFromAccessorFuncDecl=function(t){return t.isAccessor()?e.hasFlag(t.fncFlags,e.FncFlags.GetAccessor)?t.type.call.signatures[0].returnType.type:t.type.call.signatures[0].parameters[0].getType():null},n.prototype.typeCheckObjectLit=function(t){var n=new e.Type;n.symbol=new e.TypeSymbol(this.checker.anon,t.minChar,this.checker.locationInfo.unitIndex,n),n.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),n.memberScope=new e.SymbolTableScope(n.members,null,null,null,null);var r=new e.SymbolAggregateScope(n.symbol);r.addParentScope(n.memberScope),r.addParentScope(this.scope),n.containedScope=r;var i=t.operand,s=this.thisType,o=!1,u=null;this.checker.hasTargetType()&&(u=this.checker.getTargetTypeContext().contextualType,u&&u.symbol&&!this.checker.typeStatusIsFinished(u.symbol.typeCheckStatus)&&u.symbol.declAST&&this.typeCheck(u.symbol.declAST),o=!0);if(i)for(var a=0,f=i.members.length;a<f;a++){var l=i.members[a],c=l.operand1,h,p=null,d=null;if(c.nodeType==e.NodeType.Name)h=c.text;else{if(c.nodeType!=e.NodeType.QString){this.checker.errorReporter.simpleError(t,"malformed object literal"),n=this.anyType;break}var v=c.text;h=v.substring(1,v.length-1)}o&&u.memberScope&&(p=u.memberScope.find(h,!1,!1));if(l.operand2.nodeType==e.NodeType.FuncDecl&&l.operand2.isAccessor()){var m=l.operand2,g=n.members.publicMembers.lookup(h);g=this.checker.createAccessorSymbol(m,g,n,!0,!1,n.memberScope,null),m.accessorSymbol=g,d=g,c.nodeType==e.NodeType.Name&&(c.sym=g)}this.checker.typeCheckWithContextualType(o&&p?p.getType():null,!1,o,l.operand2);if(o&&p){if(l.operand2.type==this.anyType||this.checker.sourceIsAssignableToTarget(l.operand2.type,p.getType())||l.operand2.nodeType==e.NodeType.FuncDecl&&l.operand2.isAccessor()&&this.typeFromAccessorFuncDecl(l.operand2)==p.getType())l.operand1.type=p.getType()}else l.operand2.type=l.operand2.type==this.checker.undefinedType?this.anyType:l.operand2.type;if(d==null){var y=l.operand2.type,b=new e.ValueLocation;d=new e.FieldSymbol(h,c.minChar,this.checker.locationInfo.unitIndex,!0,b),d.flags|=e.SymbolFlags.Property,b.symbol=d,d.typeCheckStatus=this.checker.getTypeCheckFinishedStatus(),b.typeLink=new e.TypeLink,b.typeLink.type=y,n.members.publicMembers.add(h,d)}d.isObjectLitField=!0}this.thisType=s,t.type=n,u&&(t.targetType=u)},n.prototype.typeCheckArrayLit=function(t){var n=t.operand,r=this.anyType,i=null,s=new e.TypeComparisonInfo;s.onlyCaptureFirstError=!0;if(this.checker.hasTargetType()){var o=this.checker.getTargetTypeContext().contextualType;o.elementType&&(i=o.elementType)}if(n){var u=this.inArrayElementTypeCheck;this.inArrayElementTypeCheck=!0,this.checker.typeCheckWithContextualType(i,this.checker.inProvisionalTypecheckMode(),i!=null,n),this.inArrayElementTypeCheck=u,r=n.members[0].type;var a={getLength:function(){return n.members.length},setTypeAtIndex:function(e,t){n.members[e].type=t},getTypeAtIndex:function(e){return n.members[e].type}};r=this.checker.findBestCommonType(r,i,a,s);if(r==this.checker.undefinedType||!u&&r==this.nullType)r=this.anyType}if(!r){var f="Incompatible types in array literal expression";s.message?this.checker.errorReporter.simpleError(t,f+": "+s.message):this.checker.errorReporter.simpleError(t,f),r=this.anyType}else i&&this.checker.sourceIsAssignableToTarget(r,i)&&(r=i);t.type=this.checker.makeArrayType(r)},n.prototype.checkForVoidConstructor=function(e,t){if(e&&e.construct&&e.construct.signatures.length>0)for(var n=0;n<e.construct.signatures.length;n++)if(e.construct.signatures[n].returnType.type==this.checker.voidType){this.checker.errorReporter.simpleError(t,"Constructors may not have a return type of 'void'");break}},n.prototype.typeCheckReturn=function(t){if(this.thisFnc){var n=null;if(this.checker.hasTargetType()){var r=this.checker.getTargetTypeContext(),i=r.targetAccessorType;if(i)n=i;else{var s=this.checker.getTargetTypeContext().targetSig;s&&s.returnType.type!=this.voidType&&(n=s.returnType.type)}}if(t.returnExpression){this.thisFnc.fncFlags|=e.FncFlags.HasReturnExpression,n==null&&this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type&&this.thisFnc.returnTypeAnnotation.type!=this.voidType&&(n=this.thisFnc.returnTypeAnnotation.type),this.checker.typeCheckWithContextualType(n,this.checker.inProvisionalTypecheckMode(),n!=null,t.returnExpression);var o=this.thisFnc.returnTypeAnnotation&&this.thisFnc.returnTypeAnnotation.type?this.thisFnc.returnTypeAnnotation.type:n;o?o==this.voidType&&t.returnExpression.type!=this.voidType?(this.checker.errorReporter.simpleError(t,"Return with value expression in void function"),t.type=t.returnExpression.type):(t.returnExpression=this.cast(t.returnExpression,o),t.type=o):(n&&(t.returnExpression.type!=this.voidType?t.returnExpression=this.cast(t.returnExpression,n):t.returnExpression.type=n),t.type=t.returnExpression.type),this.thisFnc.returnStatementsWithExpressions[this.thisFnc.returnStatementsWithExpressions.length]=t}else t.type=n==null?this.checker.voidType:n}return t},n.prototype.typeCheckInstOf=function(e){var t=e;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),(t.operand1.type!=this.checker.anyType&&!this.checker.sourceIsSubtypeOfTarget(t.operand1.type,this.objectInterfaceType)||t.operand2.type!=this.anyType&&!this.checker.sourceIsSubtypeOfTarget(t.operand2.type,this.functionInterfaceType))&&this.checker.errorReporter.simpleError(e,"The instanceof operator requires the left operand to be of type Any or an object type, and the right operand to be of type Any or a subtype of the Function interface type"),t.type=this.booleanType,t},n.prototype.typeCheckCommaOperator=function(e){var t=e;return t.operand1=this.typeCheck(t.operand1),t.operand2=this.typeCheck(t.operand2),t.type=t.operand2.type,t},n.prototype.typeCheckLogOr=function(e){e.operand1=this.typeCheck(e.operand1),e.operand2=this.typeCheck(e.operand2);var t=e.operand1.type,n=e.operand2.type;return t==this.checker.anyType||n==this.checker.anyType?e.type=this.checker.anyType:t==this.checker.booleanType?n==this.checker.booleanType?e.type=this.checker.booleanType:e.type=this.checker.anyType:t==this.checker.numberType?n==this.checker.numberType?e.type=this.checker.numberType:e.type=this.checker.anyType:t==this.checker.stringType?n==this.checker.stringType?e.type=this.checker.stringType:e.type=this.checker.anyType:this.checker.sourceIsSubtypeOfTarget(t,n)?e.type=n:this.checker.sourceIsSubtypeOfTarget(n,t)?e.type=t:e.type=this.checker.anyType,e},n.prototype.typeCheckLogAnd=function(e){return e.operand1=this.typeCheck(e.operand1),e.operand2=this.typeCheck(e.operand2),e.type=e.operand2.type,e},n.prototype.tryAddCandidates=function(e,t,n,r,i){var s=e.nonOptionalParameterCount,o=e.parameters.length,u=s,a=!1;t.length>=s&&(e.hasVariableArgList||t.length<=o)&&(u=e.hasVariableArgList?e.parameters.length:t.length,a=!0);var f=null;if(a||e.hasVariableArgList){e.hasVariableArgList&&(u-=1,f=e.parameters[u].parameter.typeLink.type,f=f.elementType,a=t.length>=u);var l=t.length,c=a,h=a;for(var p=0;p<l;p++){var d;p<u?d=e.parameters[p].parameter.typeLink.type:d=f;var v=t[p];if(!d||!v||!this.checker.typesAreIdentical(d,v))c=!1;this.checker.sourceIsAssignableToTarget(v,d,i)||(h=!1);if(!c&&!h)break}c?n[n.length]=e:h&&n.length==0&&(r[r.length]=e)}},n.prototype.resolveOverload=function(t,n){var r=this.resolutionDataCache.getResolutionData(),i=r.actuals,s=r.exactCandidates,o=r.conversionCandidates,u=null,a=n.signatures.length>1,f=new e.TypeComparisonInfo,l=null,c=null;if(t.nodeType==e.NodeType.Call||t.nodeType==e.NodeType.New){var h=t;l=h.args,c=h.target;if(h.args){var p=h.args.members.length;for(var d=0;d<p;d++)i[d]=h.args.members[d].type}}else if(t.nodeType==e.NodeType.Index){var v=t;c=v.operand1,l=new e.ASTList,l.members[0]=v.operand2,i[0]=v.operand2.type}for(var m=0,g=n.signatures.length;m<g;m++){var y=n.signatures[m];if(a&&y==n.definitionSignature&&!this.checker.canCallDefinitionSignature)continue;!y.returnType.type&&y.declAST&&y.typeCheckStatus!=e.TypeCheckStatus.Finished&&this.typeCheckFunction(y.declAST),this.tryAddCandidates(y,i,s,o,f)}if(s.length==0){var b=this.checker.getApplicableSignatures(o,l,f);if(b.length>0){var w=this.checker.findMostApplicableSignature(b,l);w.ambiguous&&this.checker.errorReporter.simpleError(c,"Ambiguous call expression - could not choose overload"),u=w.sig}else{var E="Supplied parameters do not match any signature of call target";f.message?this.checker.errorReporter.simpleError(c,E+":\n	"+f.message):this.checker.errorReporter.simpleError(c,E)}}else if(s.length>1){var S=[];for(var d=0;d<s.length;d++)S[d]={signature:s[d],hadProvisionalErrors:!1};var w=this.checker.findMostApplicableSignature(S,l);w.ambiguous&&this.checker.errorReporter.simpleError(c,"Ambiguous call expression - could not choose overload"),u=w.sig}else u=s[0];return this.resolutionDataCache.returnResolutionData(r),u},n.prototype.typeCheckNew=function(e){var t=e;t.target=this.typeCheck(t.target);var n=t.target;n.type.construct||n.type.call?this.preTypeCheckCallArgs(t.args):t.args=this.typeCheck(t.args);if(n.type==this.anyType)t.type=this.anyType,t.args=this.typeCheck(t.args);else if(n.type.construct){var r=this.resolveOverload(t,n.type.construct);r==null?t.type=this.anyType:r.returnType.type==this.voidType?(t.type=this.anyType,t.signature=r):(t.type=r.returnType.type,t.signature=r)}else if(n.type.call){var r=this.resolveOverload(t,n.type.call);r==null?t.type=this.anyType:r.returnType.type==this.voidType||r.returnType.type==this.anyType?(t.type=this.anyType,t.signature=r):this.checker.errorReporter.simpleError(t.target,"new expression only valid on constructors")}else n.type.elementType?t.type=n.type:(this.checker.errorReporter.invalidCall(t,t.nodeType,this.scope),t.type=this.anyType);return this.postTypeCheckCallArgs(t),t},n.prototype.preTypeCheckCallArgs=function(t){if(!t)return;for(var n=0;n<t.members.length;n++)switch(t.members[n].nodeType){case e.NodeType.FuncDecl:case e.NodeType.ObjectLit:case e.NodeType.ArrayLit:continue;default:this.typeCheck(t.members[n])}},n.prototype.postTypeCheckCallArgs=function(t){var n=!1,r=0;if(t.target&&t.target.type&&t.signature&&t.args){var i=t.signature;if(i&&t.args.members.length>=i.nonOptionalParameterCount){n=!0;var s=null,o=t.args.members.length<i.parameters.length?t.args.members.length:i.parameters.length;for(r=0;r<o;r++){s=i.parameters[r].getType(),s&&i.hasVariableArgList&&r>=i.nonOptionalParameterCount-1&&(s=s.elementType);switch(t.args.members[r].nodeType){case e.NodeType.FuncDecl:case e.NodeType.ObjectLit:case e.NodeType.ArrayLit:this.checker.typeCheckWithContextualType(s,this.checker.inProvisionalTypecheckMode(),!i.parameters[r].declAST.isParenthesized,t.args.members[r]);break;default:continue}}}}if(!n&&t.args){this.checker.killTargetType();for(r=0;r<t.args.members.length;r++)switch(t.args.members[r].nodeType){case e.NodeType.FuncDecl:case e.NodeType.ObjectLit:case e.NodeType.ArrayLit:this.typeCheck(t.args.members[r]);break;default:continue}}},n.prototype.typeCheckCall=function(t){var n=t;this.checker.styleSettings.newMustBeUsed&&t.nodeType==e.NodeType.New?e.hasFlag(t.flags,e.ASTFlags.IsStatement)&&this.checker.errorReporter.styleError(t,"use of new expression as a statement"):!this.checker.styleSettings.evalOK&&t.nodeType==e.NodeType.Call&&n.target.nodeType==e.NodeType.Name&&n.target.text=="eval"&&this.checker.errorReporter.styleError(n,"eval not permitted"),n.target.nodeType==e.NodeType.FuncDecl&&(n.target.isInlineCallLiteral=!0);var r=this.inSuperCall;n.target.nodeType==e.NodeType.Super&&(this.inSuperCall=!0),n.target=this.typeCheck(n.target),this.preTypeCheckCallArgs(n.args);var i=n.target;if(i.type==null||i.type==this.anyType||this.functionInterfaceType&&i.type==this.functionInterfaceType)n.type=this.anyType;else{var s=i.type;if(s.call){var o=this.resolveOverload(n,s.call);o==null?n.type=this.anyType:(n.type=o.returnType.type,n.signature=o)}else if(n.target.nodeType==e.NodeType.Super&&this.thisFnc&&this.thisFnc.isConstructor&&e.hasFlag(this.thisFnc.fncFlags,e.FncFlags.ClassMethod)){var o=s.symbol.type.construct?this.resolveOverload(n,s.symbol.type.construct):null;o==null?n.type=this.anyType:(n.flags|=e.ASTFlags.ClassBaseConstructorCall,n.type=o.returnType.type,n.signature=o)}else n.type=this.anyType,this.checker.errorReporter.invalidCall(n,n.nodeType,this.scope)}return this.postTypeCheckCallArgs(n),this.inSuperCall=r,n},n.prototype.assignScopes=function(n){var r=n;this.checker.locationInfo=r.locationInfo;var i=new t(null,null,this.globalScope),s=new e.AssignScopeContext(i,this,[this.checker.currentModDecl]);e.getAstWalkerFactory().walk(n,e.preAssignScopes,e.postAssignScopes,null,s)},n.prototype.findMemberScope=function(t,n){var r=t.getScope(),i=t.pos-t.getScriptFragmentPosition(),s=t.getScriptFragment(),o=new e.MemberScopeContext(this,i,n);return o.scope=r,s.nodeType==e.NodeType.Name?s.type.getMemberScope(this):(e.getAstWalkerFactory().walk(s,e.preFindMemberScope,null,null,o),o.ast&&t.enclosingClassDecl&&o.ast.type==t.enclosingClassDecl.type.instanceType&&(t.publicsOnly=!1),o.type?o.type.getMemberScope(this):null)},n.prototype.findMemberScopeAt=function(t){return this.findMemberScope(t,e.ASTFlags.DotLHS)},n.prototype.findMemberScopeAtFullAst=function(t){var n=e.ASTFlags.DotLHS,r=t.pos,i=null,s=function(t,s,o){return e.isValidAstNode(t)&&(e.hasFlag(t.flags,n)&&(r==t.limChar||r-1==t.limChar)&&(i=t,o.options.stopWalk()),o.options.goChildren=t.minChar<=r&&r<=t.limChar),t},o=function(t,s,o){return e.isValidAstNode(t)&&(e.hasFlag(t.flags,n)&&t.minChar<r&&r<=t.limChar&&(i=t),o.options.goChildren=t.minChar<=r&&r<=t.limChar),t};return e.getAstWalkerFactory().walk(t.script,s),i==null&&e.getAstWalkerFactory().walk(t.script,o),i&&t.enclosingClassDecl&&i.type==t.enclosingClassDecl.type.instanceType&&(t.publicsOnly=!1),i&&i.type?i.type.getMemberScope(this):null},n}();e.TypeFlow=a})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function f(e,t,n){var r=new a;return r.ast=e,e==null&&n?r.type=t.anyType:r.type=null,r}(function(e){e._map=[],e.None=0,e.Void=1,e.Double=2,e.String=4,e.Boolean=8,e.Any=16,e.Null=32,e.Undefined=64})(e.Primitive||(e.Primitive={}));var t=e.Primitive,n=function(){function e(){this.prefix="",this.suffix=""}return e.prototype.isString=function(){return!1},e.prototype.isArray=function(){return!1},e.prototype.toString=function(){return e.memberNameToString(this)},e.memberNameToString=function(n){var r=n.prefix;if(n.isString())r+=n.text;else{var i=n;for(var s=0;s<i.entries.length;s++)r+=e.memberNameToString(i.entries[s]),r+=i.delim}return r+=n.suffix,r},e.create=function(t,n,s){if(typeof t=="string")return new r(t);var o=new i;return n&&(o.prefix=n),s&&(o.suffix=s),o.entries.push(t),o},e}();e.MemberName=n;var r=function(e){function t(t){e.call(this),this.text=t}return __extends(t,e),t.prototype.isString=function(){return!0},t}(n);e.MemberNameString=r;var i=function(e){function t(){e.apply(this,arguments),this.delim="",this.entries=[]}return __extends(t,e),t.prototype.isArray=function(){return!0},t.prototype.add=function(e){this.entries.push(e)},t.prototype.addAll=function(e){for(var t=0;t<e.length;t++)this.entries.push(e[t])},t}(n);e.MemberNameArray=i;var s=-1,o=function(){function r(){this.typeID=s++,this.construct=null,this.call=null,this.index=null,this.passTypeCreated=e.CompilerDiagnostics.analysisPass,this.primitiveTypeClass=t.None,this.typeFlags=e.TypeFlags.None}return r.prototype.baseClass=function(){return this.extendsList&&this.extendsList.length>0?this.extendsList[0]:null},r.prototype.getArrayBase=function(e,t){return this.arrayCache.specialize(e,t)},r.prototype.isClass=function(){return this.instanceType!=null},r.prototype.isArray=function(){return this.elementType!=null},r.prototype.isClassInstance=function(){return this.symbol&&!this.elementType&&this.symbol.type.isClass()},r.prototype.getInstanceType=function(){return this.isClass()?this.instanceType:this},r.prototype.hasImplementation=function(){return e.hasFlag(this.typeFlags,e.TypeFlags.HasImplementation)},r.prototype.setHasImplementation=function(){this.typeFlags|=e.TypeFlags.HasImplementation},r.prototype.isDouble=function(){return e.hasFlag(this.primitiveTypeClass,t.Double)},r.prototype.isString=function(){return e.hasFlag(this.primitiveTypeClass,t.String)},r.prototype.isBoolean=function(){return e.hasFlag(this.primitiveTypeClass,t.Boolean)},r.prototype.isNull=function(){return e.hasFlag(this.primitiveTypeClass,t.Null)},r.prototype.getTypeName=function(){return this.getMemberTypeName("",!0,!1,null)},r.prototype.getScopedTypeName=function(e){return this.getMemberTypeName("",!0,!1,e)},r.prototype.getScopedTypeNameEx=function(e){return this.getMemberTypeNameEx("",!0,!1,e)},r.prototype.callCount=function(){var e=0;return this.call&&(e+=this.call.signatures.length),this.construct&&(e+=this.construct.signatures.length),this.index&&(e+=this.index.signatures.length),e},r.prototype.getMemberTypeName=function(e,t,n,r){var i=this.getMemberTypeNameEx(e,t,n,r);return i.toString()},r.prototype.getMemberTypeNameEx=function(t,r,s,o){if(this.elementType)return n.create(this.elementType.getMemberTypeNameEx(t,!1,!0,o),"","[]");if(this.symbol&&this.symbol.name&&this.symbol.name!="_anonymous"&&(this.call==null&&this.construct==null&&this.index==null||e.hasFlag(this.typeFlags,e.TypeFlags.BuildingName)||this.members&&!this.isClass())){var u=this.symbol.scopeRelativeName(o);return n.create(u=="null"?"any":u)}if(this.members||this.call||this.construct){if(e.hasFlag(this.typeFlags,e.TypeFlags.BuildingName))return n.create("this");this.typeFlags|=e.TypeFlags.BuildingName;var a="",f=new i,l=s,c=0,h=0,p="; ";this.members&&this.members.allMembers.map(function(t,r,i){var s=r;if(!e.hasFlag(s.flags,e.SymbolFlags.BuiltIn)){var u=s.getTypeName(o);u.length>=p.length&&u.substring(u.length-p.length)==p&&(u=u.substring(0,u.length-p.length)),f.add(n.create(u)),h++;if(s.kind()==e.SymbolKind.Type){var a=s.type;a.callCount()>1&&(l=!0)}else l=!0}},null);var d,v,m=0,g=h==0&&this.callCount()==1&&r;g||(f.delim=p);if(this.call){d=this.call.toStrings(t,g,o);for(v=0,m=d.length;v<m;v++)f.add(n.create(d[v])),c++}if(this.construct){d=this.construct.toStrings("new",g,o);for(v=0,m=d.length;v<m;v++)f.add(n.create(d[v])),c++}if(this.index){d=this.index.toStrings("",g,o);for(v=0,m=d.length;v<m;v++)f.add(n.create(d[v])),c++}if(l||c>1&&r)f.prefix="{ ",f.suffix="}";return this.typeFlags&=~e.TypeFlags.BuildingName,c==0&&h==0?n.create("{}"):f}return n.create("{}")},r.prototype.checkDecl=function(e){(this.isClassInstance()||this.isClass())&&this.symbol.declAST&&e.typeFlow.inScopeTypeCheckDecl(this.symbol.declAST)},r.prototype.getMemberScope=function(e){if(this==e.anyType)return null;if(this.isDouble())return e.numberInterfaceType?e.numberInterfaceType.memberScope:null;if(this.isBoolean())return e.booleanInterfaceType?e.booleanInterfaceType.memberScope:null;if(this==e.stringType)return e.stringInterfaceType?e.stringInterfaceType.memberScope:null;if(this.elementType){if(e.arrayInterfaceType){var t=this.elementType.getArrayBase(e.arrayInterfaceType,e.checker);return t.memberScope}return null}return this.memberScope},r.prototype.isReferenceType=function(){return this.members||this.extendsList||this.construct||this.call||this.index||this.elementType},r.prototype.specializeType=function(t,n,i,s){if(t==this)return n;var o=this;return s?this.isReferenceType()&&(o=new r,this.members&&(o.members=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),this.members.publicMembers.map(function(e,r,s){var u=r,a=u.specializeType(t,n,i);o.members.addPublicMember(a.name,a)},null),this.members.privateMembers.map(function(e,r,s){var u=r,a=u.specializeType(t,n,i);o.members.addPrivateMember(a.name,a)},null)),this.ambientMembers&&(o.ambientMembers=new e.ScopedMembers(new e.DualStringHashTable(new e.StringHashTable,new e.StringHashTable)),this.ambientMembers.publicMembers.map(function(e,r,s){var u=r,a=u.specializeType(t,n,i);o.ambientMembers.addPublicMember(a.name,a)},null),this.ambientMembers.privateMembers.map(function(e,r,s){var u=r,a=u.specializeType(t,n,i);o.ambientMembers.addPrivateMember(a.name,a)},null)),o.containedScope=i.scopeOf(o),o.memberScope=o.containedScope):this.elementType?this.elementType==t?o=i.makeArrayType(n):this.elementType.elementType==t&&(o=i.makeArrayType(i.makeArrayType(n))):this.call&&(o=new r,o.call=this.call.specializeType(t,n,i)),o},r.prototype.hasBase=function(e){if(e==this)return!0;if(this.extendsList)for(var t=0,n=this.extendsList.length;t<n;t++)if(this.extendsList[t].hasBase(e))return!0;return!1},r.prototype.mergeOrdered=function(e,t,n){if(this==t.anyType||e==t.anyType)return t.anyType;if(this==e)return this;if(e==t.nullType&&this!=t.nullType)return this;if(this==t.nullType&&e!=t.nullType)return e;if(e==t.voidType&&this!=t.voidType)return this;if(this==t.voidType&&e!=t.voidType)return e;if(e==t.undefinedType&&this!=t.undefinedType)return this;if(this==t.undefinedType&&e!=t.undefinedType)return e;if(this.elementType&&e.elementType){if(this.elementType==e.elementType)return this;var r=this.elementType.mergeOrdered(e.elementType,t,n);return r==null?t.makeArrayType(t.anyType):t.makeArrayType(r)}return t.sourceIsSubtypeOfTarget(this,e,n)?e:t.sourceIsSubtypeOfTarget(e,this,n)?this:null},r.prototype.isModuleType=function(){return!1},r.prototype.hasMembers=function(){return this.members!=null},r.prototype.getAllEnclosedTypes=function(){return null},r.prototype.getAllAmbientEnclosedTypes=function(){return null},r.prototype.getPublicEnclosedTypes=function(){return null},r.prototype.getpublicAmbientEnclosedTypes=function(){return null},r}();e.Type=o;var u=function(e){function t(t,n){e.call(this),this.enclosedTypes=t,this.ambientEnclosedTypes=n,this.importedModules=[]}return __extends(t,e),t.prototype.isModuleType=function(){return!0},t.prototype.hasMembers=function(){return this.members!=null||this.enclosedTypes!=null},t.prototype.getAllEnclosedTypes=function(){return this.enclosedTypes},t.prototype.getAllAmbientEnclosedTypes=function(){return this.ambientEnclosedTypes},t.prototype.getPublicEnclosedTypes=function(){return null},t.prototype.getpublicAmbientEnclosedTypes=function(){return null},t}(o);e.ModuleType=u;var a=function(){function e(){this.type=null,this.ast=null}return e}();e.TypeLink=a,e.getTypeLink=f})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function t(e){return e.replace('"',"").replace("'","").replace("'","").replace('"',"")}function n(e){return e.indexOf('"')!=-1||e.indexOf("'")!=-1||e.indexOf("'")!=-1||e.indexOf('"')!=-1}function r(e){return'"'+e+'"'}function i(e){return e.indexOf('"')!=-1?(e=e.replace('"',"'"),e=e.replace('"',"'")):(e=e.replace("'",'"'),e=e.replace("'",'"')),e}function s(e){return e.replace(/\\/g,"/")}function o(e){return e.length>6&&e.substring(e.length-6,e.length)==".d.str"?e.substring(0,e.length-6):e.length>4&&e.substring(e.length-4,e.length)==".str"?e.substring(0,e.length-4):e.length>5&&e.substring(e.length-5,e.length)==".d.ts"?e.substring(0,e.length-5):e.length>3&&e.substring(e.length-3,e.length)==".ts"?e.substring(0,e.length-3):e.length>3&&e.substring(e.length-3,e.length)==".js"?e.substring(0,e.length-3):e}function u(e){return e.length>4&&e.substring(e.length-4,e.length)==".str"}function a(e){return e.length>3&&e.substring(e.length-3,e.length)==".ts"}function f(e){return e.length>6&&e.substring(e.length-6,e.length)==".d.str"}function l(e){return e.length>5&&e.substring(e.length-5,e.length)==".d.ts"}function c(e,n,i){typeof n=="undefined"&&(n=!0),typeof i=="undefined"&&(i=!1);var u=i?s(e):o(t(e)),a=u.split("/");return a.length?n?r(a[a.length-1]):a[a.length-1]:e}function h(e){var n=o(t(e)),i=b(n);if(i=="")return e;var s=n.split(i),u=s.length>1?1:0;return r(s[u])}function p(e){return o(t(e))+".str"}function d(e){return o(t(e))+".d.str"}function v(e){return o(t(e))+".ts"}function m(e){return o(t(e))+".d.ts"}function g(e){return e.charAt(0)=="."}function y(e){return e.charAt(0)=="\\"||e.charAt(0)=="/"||e.indexOf(":\\")!=-1||e.indexOf(":/")!=-1}function b(e){if(e=="")return e;var t=e.indexOf("/")!=-1;return t?w(e):""}function w(e){e=s(e);var t=e.split("/"),n=t.slice(0,t.length-1);return n.join("/")+"/"}function E(e){var t=/^(https?:\/\/[\-\w\.]+(:\d+)?\/)(.*)$/i,n=t.exec(e);if(n){var r=n[1],i=n[3];return r+S(i)}return S(e)}function S(e){e=s(e);var t=e.charAt(0)==="/",n=e.split("/");for(var r=0;r<n.length;r++){if(n[r]==="."||n[r]==="")n.splice(r,1),r--;r>0&&n[r]===".."&&n[r-1]!==".."&&(n.splice(r-1,2),r-=2)}return(t?"/":"")+n.join("/")}function x(e){return S(e)}e.stripQuotes=t,e.isQuoted=n,e.quoteStr=r,e.swapQuotes=i,e.switchToForwardSlashes=s,e.trimModName=o,e.isSTRFile=u,e.isTSFile=a,e.isDSTRFile=f,e.isDTSFile=l,e.getPrettyName=c,e.quoteBaseName=h,e.changePathToSTR=p,e.changePathToDSTR=d,e.changePathToTS=v,e.changePathToDTS=m,e.isRelative=g,e.isRooted=y,e.getRootFilePath=b,e.filePath=w,e.normalizeURL=E,e.pathNormalizeRegExp=/\//g,e.normalizePath=S,e.normalizeImportPath=x})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function e(e,t){this.path=e,this.content=t}return e.prototype.getText=function(e,t){return this.content.substring(e,t)},e.prototype.getLength=function(){return this.content.length},e}();e.SourceUnit=t;var n=function(){function e(e,t){this.compilationSettings=e,this.ioHost=t,this.residentCode=[],this.code=[]}return e}();e.CompilationEnvironment=n;var r=function(){function n(e){this.environment=e,this.visited={}}return n.prototype.resolveCode=function(n,r,i,s){var o={content:"",path:n},u=this.environment.ioHost,a=e.isRelative(n),f=a?!1:e.isRooted(n),l=a?u.resolvePath(r+"/"+n):f||!r||i?n:r+"/"+n;!e.isSTRFile(l)&&!e.isTSFile(l)&&(l+=".ts"),l=e.switchToForwardSlashes(e.stripQuotes(l));var c=this.environment.compilationSettings.useCaseSensitiveFileResolution?l:l.toLocaleUpperCase();if(!this.visited[c]){if(a||f||!i)try{e.CompilerDiagnostics.debugPrint("   Reading code from "+l);try{o.content=u.readFile(l)}catch(h){try{e.isSTRFile(l)?l=e.changePathToTS(l):e.isTSFile(l)&&(l=e.changePathToSTR(l)),e.CompilerDiagnostics.debugPrint("   Reading code from "+l),o.content=u.readFile(l)}catch(h){l=e.changePathToDSTR(l),e.CompilerDiagnostics.debugPrint("   Reading code from "+l);try{o.content=u.readFile(l)}catch(h){l=e.changePathToDTS(l),e.CompilerDiagnostics.debugPrint("   Reading code from "+l),o.content=u.readFile(l)}}}e.CompilerDiagnostics.debugPrint("   Found code at "+l),o.path=l,this.visited[c]=!0}catch(h){e.CompilerDiagnostics.debugPrint("   Did not find code for "+n)}else o=u.findFile(r,l),o||(e.isSTRFile(l)?l=e.changePathToTS(l):e.isTSFile(l)&&(l=e.changePathToSTR(l)),o=u.findFile(r,l)),o||(l=e.changePathToDTS(l),o=u.findFile(r,l),o||(l=e.changePathToDSTR(l),o=u.findFile(r,l))),o?(o.path=e.switchToForwardSlashes(e.stripQuotes(o.path)),e.CompilerDiagnostics.debugPrint(n+" resolved to: "+o.path),o.content=o.content,this.visited[c]=!0):e.CompilerDiagnostics.debugPrint("Could not find "+n);if(o&&o.content){var p=u.dirName(o.path),d=new t(o.path,o.content),v=e.preProcessFile(d,this.environment.compilationSettings);for(var m=0;m<v.referencedFiles.length;m++){var g=v.referencedFiles[m],l=e.isRooted(g.path)?g.path:p+"/"+g.path;l=u.resolvePath(l);if(n==l){s.postResolutionError(l,"File contains reference to itself",null);continue}this.resolveCode(g.path,p,!1,s)}for(var m=0;m<v.importedFiles.length;m++)this.resolveCode(v.importedFiles[m].path,p,!0,s);s.postResolution(d.path,d)}}},n}();e.CodeResolver=r})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function r(t){var n=/^(\/\/\/\s*<reference\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,r=n.exec(t);if(r){var i=e.normalizePath(r[3]),s=e.normalizePath(i),o=r.length>=7&&r[6]=="true";return o&&e.CompilerDiagnostics.debugPrint(i+" is resident"),{minChar:0,limChar:0,path:e.switchToForwardSlashes(s),isResident:o}}return null}function i(e){var t=/^(\/\/\/\s*<amd-dependency\s+path=)('|")(.+?)\2\s*(static=('|")(.+?)\2\s*)*\/>/igm,n=t.exec(e);if(n){var r=n[3];return r}return null}function s(e,t){var n=/^(\/\/\/\s*<style\s+)(([a-zA-Z])+=('|").+('|"))\s*\/>/igm,r=n.exec(e);if(r){var i=/^([a-zA-Z]+=['"]on['|"])/igm;r=i.exec(r[2]);if(r)for(var s=0;s<r.length;s++){var o=r[s].split("="),u='"on"';switch(o[0]){case"blockInCompoundStmt":t.blockInCompoundStmt=o[1]==u;break;case"eqeqeq":t.eqeqeq=o[1]==u;break;case"forin":t.forin=o[1]==u;break;case"emptyBlocks":t.emptyBlocks=o[1]==u;break;case"newMustBeUsed":t.newMustBeUsed=o[1]==u;break;case"requireSemi":t.requireSemi=o[1]==u;break;case"assignmentInCond":t.assignmentInCond=o[1]==u;break;case"eqnull":t.eqnull=o[1]==u;break;case"evalOK":t.evalOK=o[1]==u;break;case"innerScopeDeclEscape":t.innerScopeDeclEscape=o[1]==u;break;case"funcInLoop":t.funcInLoop=o[1]==u;break;case"reDeclareLocal":t.reDeclareLocal=o[1]==u;break;case"literalSubscript":t.literalSubscript=o[1]==u;break;case"implicitAny":t.implicitAny=o[1]==u}}}}function o(t,i){typeof i=="undefined"&&(i=new n);var o=new e.Scanner;o.resetComments(),o.setSourceText(t,e.LexMode.File);var u=o.scan(),a=[],f=null,l=[],c=i,h=[],p=[],d=!1;while(u.tokenId!=e.TokenID.EOF){if(u.tokenId==e.TokenID.IMPORT){u=o.scan();if(u.tokenId==e.TokenID.ID||e.convertTokToID(u,!1)){u=o.scan();if(u.tokenId==e.TokenID.Asg){u=o.scan();if(u.tokenId==e.TokenID.MODULE){u=o.scan();if(u.tokenId==e.TokenID.LParen){u=o.scan();if(u.tokenId==e.TokenID.QString){var v={minChar:o.startPos,limChar:o.pos,path:e.stripQuotes(e.switchToForwardSlashes(u.getText())),isResident:!1};p.push(v)}}}}}}u.tokenId==e.TokenID.LCurly&&l.push(u),u.tokenId==e.TokenID.RCurly&&l.pop(),u=o.scan()}a=o.getComments();for(var m=0;m<a.length;m++){f=a[m];if(!f.isBlock){var g=r(f.getText());g&&(g.minChar=f.startPos,g.limChar=g.minChar+f.value.length,h.push(g)),s(f.getText(),c.styleSettings);var y=/^(\/\/\/\s*<reference\s+no-default-lib=)('|")(.+?)\2\s*\/>/igm,b=y.exec(f.getText());b&&(d=b[3]=="true")}}return{settings:c,referencedFiles:h,importedFiles:p,isLibFile:d}}var t=function(){function e(){this.bitwise=!1,this.blockInCompoundStmt=!1,this.eqeqeq=!1,this.forin=!1,this.emptyBlocks=!0,this.newMustBeUsed=!1,this.requireSemi=!1,this.assignmentInCond=!1,this.eqnull=!1,this.evalOK=!0,this.innerScopeDeclEscape=!0,this.funcInLoop=!0,this.reDeclareLocal=!0,this.literalSubscript=!0,this.implicitAny=!1}return e.prototype.setOption=function(e,t){var n=this[e];return n!==undefined?(this[e]=t,!0):!1},e.prototype.parseOptions=function(e){var t=e.split(";");for(var n=0,r=t.length;n<r;n++){var i=t[n],s=!0,o=i.lastIndexOf(":");if(o>=0){var u=i.substring(o+1);i=i.substring(0,o),u=="off"&&(s=!1)}if(!this.setOption(i,s))return!1}return!0},e}();e.StyleSettings=t;var n=function(){function n(){this.styleSettings=new t,this.propagateConstants=!1,this.minWhitespace=!1,this.parseOnly=!1,this.outputMany=!0,this.errorRecovery=!1,this.emitComments=!1,this.watch=!1,this.exec=!1,this.resolve=!0,this.controlFlow=!1,this.printControlFlow=!1,this.controlFlowUseDef=!1,this.errorOnWith=!0,this.preprocess=!0,this.canCallDefinitionSignature=!1,this.inferPropertiesFromThisAssignment=!1,this.useDefaultLib=!0,this.codeGenTarget=e.CodeGenTarget.ES3,this.moduleGenTarget=e.ModuleGenTarget.Synchronous,this.outputFileName="",this.errorFileName="",this.mapSourceFiles=!1,this.generateDeclarationFiles=!1,this.useCaseSensitiveFileResolution=!1}return n.prototype.setStyleOptions=function(e){this.styleSettings.parseOptions(e)},n.prototype.outputOne=function(e){this.outputFileName=e,this.outputMany=!1},n}();e.CompilationSettings=n,e.getAdditionalDependencyPath=i,e.getStyleSettings=s,e.preProcessFile=o})(TypeScript||(TypeScript={}));var TypeScript;(function(e){var t=function(){function t(t){this.logger=t,this.astLogger=new e.AstLogger(this.logger)}return t.prototype.getEnclosingScopeContextIfSingleScopeEdit=function(t,n,r,i){this.logger.log('checkEditsInsideSingleScope("'+n+'")');if(i===null)throw new Error("editRange should be valid");if(i.isUnknown())return this.logger.log("  Bailing out because edit range is unknown"),null;var s=e.findEnclosingScopeAt(this.logger,t,r,i.minChar,!1),o=e.findEnclosingScopeAt(this.logger,t,r,i.limChar,!1);if(s==null||o==null)return this.logger.log("  Bailing out because containing scopes cannot be determined"),null;if(s.scopeStartAST!==o.scopeStartAST)return this.logger.log("  Bailing out because edit overlaps 2 disctint scopes"),null;var u=s.scopeStartAST.limChar-s.scopeStartAST.minChar+i.delta;return u<=0?(this.logger.log("  Bailing out because scope has been entirely removed from new source text"),null):s},t.prototype.attemptIncrementalUpdateUnit=function(t,n,r,i){this.logger.log('attemptIncrementalUpdateUnit("'+n+'")');if(i===null)throw new Error("editRange should be valid");var s=this.getEnclosingScopeContextIfSingleScopeEdit(t,n,r,i);if(s===null)return null;var o=s.scopeStartAST.limChar-s.scopeStartAST.minChar+i.delta;if(o>=r.getLength()/2)return this.logger.log("  Bailing out because range of scope to reparse ("+o+" characters) is greater than half the size of the source text"),null;var u=[],a=function(t,n,r,i){u.push(new e.ErrorEntry(i,t,t+n,r))},f=e.quickParse(this.logger,s.scopeStartAST,r,s.scopeStartAST.minChar,s.scopeStartAST.minChar+o,a);if(f.endLexState!=e.LexState.Start)return this.logger.log("  Bailing out because scope contains unterminated comment"),null;var l=f.Script;if(l.vars.members.length!==0)return this.logger.log("  Bailing out because new source text defines variables"),null;if(l.bod.members.length!==1)return this.logger.log("  Bailing out because new source text defines more than one scope (or none)"),null;var c=s.scopeStartAST,h=l.bod.members[0];return c.nodeType!=h.nodeType?(this.logger.log("  Bailing out because new source text does not define the same scope type as the existing scope"),null):!c.leftCurlyCount||!c.rightCurlyCount?(this.logger.log("  Bailing out because sopce doesn't have left/right curly count"),null):c.leftCurlyCount!==h.leftCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) left curly braces"),null):c.rightCurlyCount!==h.rightCurlyCount?(this.logger.log("  Bailing out because new source text contains more (or fewer) right curly braces"),null):h.minChar!==0?(this.logger.log("  Bailing out because new function declaration does not start at position 0"),null):h.limChar!==o?(this.logger.log("  Bailing out because new function declaration does not end at the new end position"),null):e.UpdateUnitResult.singleScopeEdits(t,l,c,h,i,u)},t.prototype.mergeTrees=function(t){var n=this;e.timeFunction(this.logger,"mergeTrees()",function(){var r=new e.ScriptEditRange(t.scope1.minChar,t.scope1.limChar,t.editRange.delta);n.applyDeltaPosition(t.script1,r.limChar,r.delta),n.applyDeltaPosition(t.script2,0,r.minChar),n.mergeLocationInfo(t.script1,t.script2,r),n.replaceAST(t.script1,t.scope1,t.scope2)})},t.prototype.replaceAST=function(t,n,r){var i=this,s=function(t,s,o){return t===n?(r.preComments=t.preComments,r.postComments=t.postComments,i.logger.log("replaced old AST node with new one in script AST"),o.options.stopWalk(),r):(e.isValidAstNode(t)&&(t.limChar<n.minChar||t.minChar>n.limChar)&&(o.options.goChildren=!1),t)};e.getAstWalkerFactory().walk(t,s)},t.prototype.mergeLocationInfo=function(e,t,n){var r=e.locationInfo.lineMap,i=t.locationInfo.lineMap;this.logger.information()&&(this.logger.log("lineMap1 (before):"),this.astLogger.logLinemap(r),this.logger.log("lineMap2 (quick parse):"),this.astLogger.logLinemap(i),this.logger.log("EditRange="+n));var s=2,o=2,u=r.length,a=i.length;while(s<u||o<a)s<u?r[s]<=n.minChar?s++:r[s]>=n.limChar?(r[s]+=n.delta,s++):o<a?(r.splice(s,0,i[o]+n.minChar),s++,u++,o++):(r.splice(s,1),u--):(r.push(i[o]+n.minChar),o++);this.logger.information()&&(this.logger.log("lineMap1 (after merge):"),this.astLogger.logLinemap(r))},t.prototype.applyDeltaPosition=function(t,n,r){var i=function(e){e.minChar!==-1&&e.minChar>=n&&(e.minChar+=r),e.limChar!==-1&&e.limChar>=n&&(e.limChar+=r)},s=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)i(e[t])},o=function(e,t,r){return e.limChar!==-1&&e.limChar<n&&(r.options.goChildren=!1),i(e),s(e.preComments),s(e.postComments),e};e.getAstWalkerFactory().walk(t,o)},t}();e.IncrementalParser=t})(TypeScript||(TypeScript={}));var TypeScript;(function(e){(function(e){e._map=[],e._map[0]="Unknown",e.Unknown=0,e._map[1]="NoEdits",e.NoEdits=1,e._map[2]="EditsInsideSingleScope",e.EditsInsideSingleScope=2})(e.UpdateUnitKind||(e.UpdateUnitKind={}));var t=e.UpdateUnitKind,n=function(){function e(e,t,n){this.minChar=e,this.limChar=t,this.delta=n}return e.unknown=function(){return new e(-1,-1,-1)},e.prototype.isUnknown=function(){return this.minChar===-1&&this.limChar===-1&&this.delta===-1},e.prototype.containsPosition=function(e){return this.minChar<=e&&e<this.limChar||this.minChar<=e&&e<this.limChar+this.delta},e.prototype.toString=function(){return"editRange(minChar="+this.minChar+", limChar="+this.limChar+", delta="+this.delta+")"},e}();e.ScriptEditRange=n;var r=function(){function e(e,t,n,r){this.kind=e,this.unitIndex=t,this.script1=n,this.script2=r,this.scope1=null,this.scope2=null,this.editRange=null,this.parseErrors=[]}return e.noEdits=function(r){return new e(t.NoEdits,r,null,null)},e.unknownEdits=function(r,i,s){var o=new e(t.Unknown,r.locationInfo.unitIndex,r,i);return o.parseErrors=s,o},e.singleScopeEdits=function(r,i,s,o,u,a){var f=new e(t.EditsInsideSingleScope,r.locationInfo.unitIndex,r,i);return f.scope1=s,f.scope2=o,f.editRange=u,f.parseErrors=a,f},e}();e.UpdateUnitResult=r;var i=function(){function e(e,t,n,r){this.unitIndex=e,this.minChar=t,this.limChar=n,this.message=r}return e}();e.ErrorEntry=i,e.defaultSettings=new e.CompilationSettings;var s=function(){function n(t,n,r,i){typeof r=="undefined"&&(r=new e.NullLogger),typeof i=="undefined"&&(i=e.defaultSettings),this.outfile=t,this.errorOutput=n,this.logger=r,this.settings=i,this.parser=new e.Parser,this.typeFlow=null,this.scripts=new e.ASTList,this.units=new Array,this.errorReporter=new e.ErrorReporter(this.outfile),this.persistentTypeState=new e.PersistentGlobalTypeState(this.errorReporter),this.errorReporter.parser=this.parser,this.initTypeChecker(this.errorOutput),this.parser.style_requireSemi=this.settings.styleSettings.requireSemi,this.parser.style_funcInLoop=this.settings.styleSettings.funcInLoop,this.parser.inferPropertiesFromThisAssignment=this.settings.inferPropertiesFromThisAssignment,this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany},e.codeGenTarget=i.codeGenTarget}return n.prototype.timeFunction=function(t,n){return e.timeFunction(this.logger,t,n)},n.prototype.initTypeChecker=function(t){this.persistentTypeState.refreshPersistentState(),this.typeChecker=new e.TypeChecker(this.persistentTypeState),this.typeChecker.errorReporter=this.errorReporter,this.typeChecker.checkControlFlow=this.settings.controlFlow,this.typeChecker.checkControlFlowUseDef=this.settings.controlFlowUseDef,this.typeChecker.printControlFlowGraph=this.settings.printControlFlow,this.typeChecker.errorsOnWith=this.settings.errorOnWith,this.typeChecker.styleSettings=this.settings.styleSettings,this.typeChecker.canCallDefinitionSignature=this.settings.canCallDefinitionSignature,this.errorReporter.checker=this.typeChecker,this.setErrorOutput(this.errorOutput)},n.prototype.setErrorOutput=function(e){this.errorOutput=e,this.errorReporter.setErrOut(e),this.parser.outfile=e},n.prototype.emitCommentsToOutput=function(){this.emitSettings={minWhitespace:this.settings.minWhitespace,propagateConstants:this.settings.propagateConstants,emitComments:this.settings.emitComments,path:this.settings.outputFileName,createFile:null,outputMany:this.settings.outputMany}},n.prototype.setErrorCallback=function(e){this.parser.errorCallback=e},n.prototype.updateUnit=function(t,n,r){return this.updateSourceUnit(new e.StringSourceText(t),n,r)},n.prototype.updateSourceUnit=function(e,t,n){var r=this;return this.timeFunction("updateSourceUnit("+t+")",function(){var i=r.partialUpdateUnit(e,t,n);return r.applyUpdateResult(i)})},n.prototype.applyUpdateResult=function(n){switch(n.kind){case t.NoEdits:return!1;case t.Unknown:this.scripts.members[n.unitIndex]=n.script2,this.units[n.unitIndex]=n.script2.locationInfo;for(var r=0,i=n.parseErrors.length;r<i;r++){var s=n.parseErrors[r];this.parser.errorCallback&&this.parser.errorCallback(s.minChar,s.limChar-s.minChar,s.message,s.unitIndex)}return!0;case t.EditsInsideSingleScope:return(new e.IncrementalParser(this.logger)).mergeTrees(n),!0}},n.prototype.partialUpdateUnit=function(e,t,n){var s=this;return this.timeFunction("partialUpdateUnit("+t+")",function(){for(var o=0,u=s.units.length;o<u;o++)if(s.units[o].filename==t){if(s.scripts.members[o].isResident)return r.noEdits(o);n&&s.parser.setErrorRecovery(null,0,0);var a,f=[],l=function(e,t,n,r){f.push(new i(r,e,e+t,n))},c=s.parser.errorCallback;c&&(s.parser.errorCallback=l);var h=s.scripts.members[o],p=s.parser.parse(e,t,o);return c&&(s.parser.errorCallback=c),a=r.unknownEdits(h,p,f),a}throw new Error('Unknown file "'+t+'"')})},n.prototype.addUnit=function(t,n,r){return typeof r=="undefined"&&(r=!1),this.addSourceUnit(new e.StringSourceText(t),n,r)},n.prototype.addSourceUnit=function(t,n,r){typeof r=="undefined"&&(r=!1);var i=this;return this.timeFunction("addSourceUnit("+n+", "+r+")",function(){var s=i.parser.parse(t,n,i.units.length,e.AllowedElements.Global);s.isResident=r,i.persistentTypeState.setCollectionMode(r?e.TypeCheckCollectionMode.Resident:e.TypeCheckCollectionMode.Transient);var o=i.units.length;return i.units[o]=s.locationInfo,i.typeChecker.collectTypes(s),i.scripts.append(s),s})},n.prototype.parseUnit=function(t,n){return this.parseSourceUnit(new e.StringSourceText(t),n)},n.prototype.parseSourceUnit=function(t,n){this.parser.setErrorRecovery(this.outfile,-1,-1);var r=this.parser.parse(t,n,0),i=new e.PrintContext(this.outfile,this.parser);e.getAstWalkerFactory().walk(r,e.prePrintAST,e.postPrintAST,null,i)},n.prototype.typeCheck=function(){var t=this;return this.timeFunction("typeCheck()",function(){var n=new e.Binder(t.typeChecker);t.typeChecker.units=t.units,n.bind(t.typeChecker.globalScope,t.typeChecker.globals),n.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobals),n.bind(t.typeChecker.globalScope,t.typeChecker.globalTypes),n.bind(t.typeChecker.globalScope,t.typeChecker.ambientGlobalTypes),t.typeFlow=new e.TypeFlow(t.logger,t.typeChecker.globalScope,t.parser,t.typeChecker);var r=0,i=null,s=t.scripts.members.length;t.persistentTypeState.setCollectionMode(e.TypeCheckCollectionMode.Resident);for(r=0;r<s;r++){i=t.scripts.members[r];if(!i.isResident||i.hasBeenTypeChecked)continue;t.typeFlow.assignScopes(i),t.typeFlow.initLibs()}for(r=0;r<s;r++){i=t.scripts.members[r];if(!i.isResident||i.hasBeenTypeChecked)continue;t.typeFlow.typeCheck(i),i.hasBeenTypeChecked=!0}t.persistentTypeState.setCollectionMode(e.TypeCheckCollectionMode.Transient),s=t.scripts.members.length;for(r=0;r<s;r++){i=t.scripts.members[r];if(i.isResident)continue;t.typeFlow.assignScopes(i),t.typeFlow.initLibs()}for(r=0;r<s;r++){i=t.scripts.members[r];if(i.isResident)continue;t.typeFlow.typeCheck(i)}return null})},n.prototype.cleanASTTypesForReTypeCheck=function(t){function n(t,n){t.type=null;if(t.nodeType==e.NodeType.VarDecl){var r=t;r.sym=null}else if(t.nodeType==e.NodeType.ArgDecl){var i=t;i.sym=null}else if(t.nodeType==e.NodeType.Name){var s=t;s.sym=null}else if(t.nodeType==e.NodeType.FuncDecl){var o=t;o.signature=null,o.freeVariables=new Array,o.symbols=null,o.accessorSymbol=null,o.scopeType=null}else if(t.nodeType==e.NodeType.Module){var u=t;u.mod=null}else t.nodeType==e.NodeType.With?t.withSym=null:t.nodeType==e.NodeType.Catch&&(t.containedScope=null);return t}e.getAstWalkerFactory().walk(t,n)},n.prototype.cleanTypesForReTypeCheck=function(){var e=this;return this.timeFunction("cleanTypesForReTypeCheck()",function(){for(var t=0,n=e.scripts.members.length;t<n;t++){var r=e.scripts.members[t];if(r.isResident)continue;e.cleanASTTypesForReTypeCheck(r),e.typeChecker.collectTypes(r)}return null})},n.prototype.attemptIncrementalTypeCheck=function(e){return this.timeFunction("attemptIncrementalTypeCheck()",function(){return!1})},n.prototype.reTypeCheck=function(){var t=this;return this.timeFunction("reTypeCheck()",function(){return e.CompilerDiagnostics.analysisPass++,t.initTypeChecker(t.errorOutput),t.persistentTypeState.setCollectionMode(e.TypeCheckCollectionMode.Transient),t.cleanTypesForReTypeCheck(),t.typeCheck()})},n.prototype.emit=function(t,n){var r=null;this.emitSettings.createFile=n;for(var i=0,s=this.scripts.members.length;i<s;i++){var o=this.scripts.members[i];if(!o.emitRequired())continue;var u=this.outfile;if(t){var a=this.units[i].filename,f=a.split(".");f.pop();var l=f.join("."),c=l+".js";this.emitSettings.path=c,u=n(c),r=new e.Emitter(this.typeChecker,u,this.emitSettings),this.settings.mapSourceFiles&&r.setSourceMappings(new e.SourceMapper(a,c,u,n(c+e.SourceMapper.MapFileExtension)));if(this.settings.generateDeclarationFiles){var h=e.isSTRFile(a)?e.changePathToDSTR(a):e.isTSFile(a)?e.changePathToDTS(a):e.changePathToDTS(a);r.setDeclarationFile(n(h))}}else if(r==null){r=new e.Emitter(this.typeChecker,this.outfile,this.emitSettings),this.settings.mapSourceFiles&&r.setSourceMappings(new e.SourceMapper(o.locationInfo.filename,this.settings.outputFileName,this.outfile,n(this.settings.outputFileName+e.SourceMapper.MapFileExtension)));if(this.settings.generateDeclarationFiles){var p=this.settings.outputFileName;p=e.isSTRFile(p)?e.changePathToDSTR(p):e.isTSFile(p)?e.changePathToDTS(p):e.changePathToDTS(p),r.setDeclarationFile(n(p))}}else this.settings.mapSourceFiles&&r.setSourceMappings(new e.SourceMapper(o.locationInfo.filename,r.sourceMapper.jsFileName,this.outfile,r.sourceMapper.sourceMapOut));this.typeChecker.locationInfo=o.locationInfo,r.emitJavascript(o,e.TokenID.Comma,!1,r.canWriteDeclFile()),t&&(this.settings.mapSourceFiles&&r.emitSourceMappings(),this.settings.generateDeclarationFiles&&r.declFile.Close(),u.Close())}t||(this.settings.mapSourceFiles&&r.emitSourceMappings(),this.settings.generateDeclarationFiles&&r.declFile.Close())},n.prototype.emitToOutfile=function(){var t=null;if(this.settings.mapSourceFiles)throw Error("Cannot generate source map");if(this.settings.generateDeclarationFiles)throw Error("Cannot generate declaration files");for(var n=0,r=this.scripts.members.length;n<r;n++){t==null&&(t=new e.Emitter(this.typeChecker,this.outfile,this.emitSettings));var i=this.scripts.members[n];this.typeChecker.locationInfo=i.locationInfo,t.emitJavascript(i,e.TokenID.Comma,!1)}},n}();e.TypeScriptCompiler=s;var o=function(){function e(e,t,n){this.name=e,this.type=t,this.sym=n}return e}();e.ScopeEntry=o;var u=function(){function t(e){this.compiler=e}return t.prototype.getScope=function(e){return e.enclosingObjectLit&&e.isMemberCompletion?e.getObjectLiteralScope():e.isMemberCompletion?e.useFullAst?this.compiler.typeFlow.findMemberScopeAtFullAst(e):this.compiler.typeFlow.findMemberScopeAt(e):e.getScope()},t.prototype.getScopeEntries=function(t){var n=this.getScope(t);if(n==null)return[];var r=new e.StringHashTable,i=n.getAllSymbolNames(t.isMemberCompletion);for(var s=0;s<i.length;s++){var o=i[s];if(o==e.globalId||o=="_Core"||o=="_element")continue;r.add(o,"")}var u=this.compiler.typeChecker.currentModDecl;this.compiler.typeChecker.currentModDecl=t.deepestModuleDecl;var a=this.getTypeNamesForNames(t,r.getAllKeys(),n);return this.compiler.typeChecker.currentModDecl=u,a},t.prototype.getTypeNamesForNames=function(t,n,r){var i=[],s=t.getScope();for(var u=0;u<n.length;u++){var a=n[u],f=t.publicsOnly&&t.isMemberCompletion,l=r.find(a,f,!1);l==null&&(l=r.find(a,f,!0));var c=l&&l.flags&e.SymbolFlags.Private?l.container==r.container:!0;if(l){if(c&&!e.isQuoted(l.name)&&!e.isRelative(l.name)){var h=l.getType().getScopedTypeName(s);i.push(new o(a,h,l))}}else(a=="true"||a=="false")&&i.push(new o(a,"bool",this.compiler.typeChecker.booleanType.symbol))}return i},t}();e.ScopeTraversal=u})(TypeScript||(TypeScript={}));var TypeScript;(function(e){function s(e,t,n){var r=+(new Date),i=n(),s=+(new Date);return e.log(t+" completed in "+(s-r)+" msec"),i}function o(e,t){var n="",r=function(t){var r=e.charCodeAt(t);switch(r){case 9:n+="\\t";break;case 10:n+="\\n";break;case 11:n+="\\v";break;case 12:n+="\\f";break;case 13:n+="\\r";break;case 34:n+='\\"';break;case 39:n+="\\'";break;case 92:n+="\\";break;default:n+=e.charAt(t)}},i=e.length>t;if(i){var s=t>>1;for(var o=0;o<s;o++)r(o);n+="(...)";for(var o=e.length-s;o<e.length;o++)r(o)}else{t=e.length;for(var o=0;o<t;o++)r(o)}return n}(function(e){function t(t){e.diagnosticWriter&&e.diagnosticWriter.Alert(t)}function n(n){e.debug&&t(n)}function r(n,r){e.debug&&(n||t(r))}e.debug=!1,e.diagnosticWriter=null,e.analysisPass=0,e.Alert=t,e.debugPrint=n,e.assert=r})(e.CompilerDiagnostics||(e.CompilerDiagnostics={}));var t=e.CompilerDiagnostics,n=function(){function e(){}return e.prototype.information=function(){return!1},e.prototype.debug=function(){return!1},e.prototype.warning=function(){return!1},e.prototype.error=function(){return!1},e.prototype.fatal=function(){return!1},e.prototype.log=function(e){},e}();e.NullLogger=n;var r=function(){function e(e){this.logger=e,this._information=this.logger.information(),this._debug=this.logger.debug(),this._warning=this.logger.warning(),this._error=this.logger.error(),this._fatal=this.logger.fatal()}return e.prototype.information=function(){return this._information},e.prototype.debug=function(){return this._debug},e.prototype.warning=function(){return this._warning},e.prototype.error=function(){return this._error},e.prototype.fatal=function(){return this._fatal},e.prototype.log=function(e){this.logger.log(e)},e}();e.LoggerAdapter=r;var i=function(){function e(){this.logContents=[]}return e.prototype.information=function(){return!1},e.prototype.debug=function(){return!1},e.prototype.warning=function(){return!1},e.prototype.error=function(){return!1},e.prototype.fatal=function(){return!1},e.prototype.log=function(e){this.logContents.push(e)},e}();e.BufferedLogger=i,e.timeFunction=s,e.stringToLiteral=o})(TypeScript||(TypeScript={}))